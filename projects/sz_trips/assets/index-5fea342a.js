function pC(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const o in i)if(o!=="default"&&!(o in t)){const c=Object.getOwnPropertyDescriptor(i,o);c&&Object.defineProperty(t,o,c.get?c:{enumerable:!0,get:()=>i[o]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function n(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(o){if(o.ep)return;o.ep=!0;const c=n(o);fetch(o.href,c)}})();var mC=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Cm(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var oT={exports:{}},Xt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xd=Symbol.for("react.element"),gC=Symbol.for("react.portal"),_C=Symbol.for("react.fragment"),yC=Symbol.for("react.strict_mode"),vC=Symbol.for("react.profiler"),xC=Symbol.for("react.provider"),bC=Symbol.for("react.context"),wC=Symbol.for("react.forward_ref"),EC=Symbol.for("react.suspense"),TC=Symbol.for("react.memo"),SC=Symbol.for("react.lazy"),B1=Symbol.iterator;function AC(t){return t===null||typeof t!="object"?null:(t=B1&&t[B1]||t["@@iterator"],typeof t=="function"?t:null)}var aT={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},lT=Object.assign,cT={};function _u(t,e,n){this.props=t,this.context=e,this.refs=cT,this.updater=n||aT}_u.prototype.isReactComponent={};_u.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};_u.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function uT(){}uT.prototype=_u.prototype;function N0(t,e,n){this.props=t,this.context=e,this.refs=cT,this.updater=n||aT}var U0=N0.prototype=new uT;U0.constructor=N0;lT(U0,_u.prototype);U0.isPureReactComponent=!0;var N1=Array.isArray,hT=Object.prototype.hasOwnProperty,V0={current:null},dT={key:!0,ref:!0,__self:!0,__source:!0};function fT(t,e,n){var i,o={},c=null,d=null;if(e!=null)for(i in e.ref!==void 0&&(d=e.ref),e.key!==void 0&&(c=""+e.key),e)hT.call(e,i)&&!dT.hasOwnProperty(i)&&(o[i]=e[i]);var l=arguments.length-2;if(l===1)o.children=n;else if(1<l){for(var v=Array(l),w=0;w<l;w++)v[w]=arguments[w+2];o.children=v}if(t&&t.defaultProps)for(i in l=t.defaultProps,l)o[i]===void 0&&(o[i]=l[i]);return{$$typeof:xd,type:t,key:c,ref:d,props:o,_owner:V0.current}}function PC(t,e){return{$$typeof:xd,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function j0(t){return typeof t=="object"&&t!==null&&t.$$typeof===xd}function IC(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var U1=/\/+/g;function s_(t,e){return typeof t=="object"&&t!==null&&t.key!=null?IC(""+t.key):e.toString(36)}function yp(t,e,n,i,o){var c=typeof t;(c==="undefined"||c==="boolean")&&(t=null);var d=!1;if(t===null)d=!0;else switch(c){case"string":case"number":d=!0;break;case"object":switch(t.$$typeof){case xd:case gC:d=!0}}if(d)return d=t,o=o(d),t=i===""?"."+s_(d,0):i,N1(o)?(n="",t!=null&&(n=t.replace(U1,"$&/")+"/"),yp(o,e,n,"",function(w){return w})):o!=null&&(j0(o)&&(o=PC(o,n+(!o.key||d&&d.key===o.key?"":(""+o.key).replace(U1,"$&/")+"/")+t)),e.push(o)),1;if(d=0,i=i===""?".":i+":",N1(t))for(var l=0;l<t.length;l++){c=t[l];var v=i+s_(c,l);d+=yp(c,e,n,v,o)}else if(v=AC(t),typeof v=="function")for(t=v.call(t),l=0;!(c=t.next()).done;)c=c.value,v=i+s_(c,l++),d+=yp(c,e,n,v,o);else if(c==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return d}function Bf(t,e,n){if(t==null)return t;var i=[],o=0;return yp(t,i,"","",function(c){return e.call(n,c,o++)}),i}function CC(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var _r={current:null},vp={transition:null},MC={ReactCurrentDispatcher:_r,ReactCurrentBatchConfig:vp,ReactCurrentOwner:V0};Xt.Children={map:Bf,forEach:function(t,e,n){Bf(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Bf(t,function(){e++}),e},toArray:function(t){return Bf(t,function(e){return e})||[]},only:function(t){if(!j0(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Xt.Component=_u;Xt.Fragment=_C;Xt.Profiler=vC;Xt.PureComponent=N0;Xt.StrictMode=yC;Xt.Suspense=EC;Xt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=MC;Xt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=lT({},t.props),o=t.key,c=t.ref,d=t._owner;if(e!=null){if(e.ref!==void 0&&(c=e.ref,d=V0.current),e.key!==void 0&&(o=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(v in e)hT.call(e,v)&&!dT.hasOwnProperty(v)&&(i[v]=e[v]===void 0&&l!==void 0?l[v]:e[v])}var v=arguments.length-2;if(v===1)i.children=n;else if(1<v){l=Array(v);for(var w=0;w<v;w++)l[w]=arguments[w+2];i.children=l}return{$$typeof:xd,type:t.type,key:o,ref:c,props:i,_owner:d}};Xt.createContext=function(t){return t={$$typeof:bC,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:xC,_context:t},t.Consumer=t};Xt.createElement=fT;Xt.createFactory=function(t){var e=fT.bind(null,t);return e.type=t,e};Xt.createRef=function(){return{current:null}};Xt.forwardRef=function(t){return{$$typeof:wC,render:t}};Xt.isValidElement=j0;Xt.lazy=function(t){return{$$typeof:SC,_payload:{_status:-1,_result:t},_init:CC}};Xt.memo=function(t,e){return{$$typeof:TC,type:t,compare:e===void 0?null:e}};Xt.startTransition=function(t){var e=vp.transition;vp.transition={};try{t()}finally{vp.transition=e}};Xt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Xt.useCallback=function(t,e){return _r.current.useCallback(t,e)};Xt.useContext=function(t){return _r.current.useContext(t)};Xt.useDebugValue=function(){};Xt.useDeferredValue=function(t){return _r.current.useDeferredValue(t)};Xt.useEffect=function(t,e){return _r.current.useEffect(t,e)};Xt.useId=function(){return _r.current.useId()};Xt.useImperativeHandle=function(t,e,n){return _r.current.useImperativeHandle(t,e,n)};Xt.useInsertionEffect=function(t,e){return _r.current.useInsertionEffect(t,e)};Xt.useLayoutEffect=function(t,e){return _r.current.useLayoutEffect(t,e)};Xt.useMemo=function(t,e){return _r.current.useMemo(t,e)};Xt.useReducer=function(t,e,n){return _r.current.useReducer(t,e,n)};Xt.useRef=function(t){return _r.current.useRef(t)};Xt.useState=function(t){return _r.current.useState(t)};Xt.useSyncExternalStore=function(t,e,n){return _r.current.useSyncExternalStore(t,e,n)};Xt.useTransition=function(){return _r.current.useTransition()};Xt.version="18.2.0";oT.exports=Xt;var ot=oT.exports;const hy=Cm(ot);var pT={exports:{}},es={},mT={exports:{}},gT={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(tt,wt){var St=tt.length;tt.push(wt);e:for(;0<St;){var nn=St-1>>>1,rn=tt[nn];if(0<o(rn,wt))tt[nn]=wt,tt[St]=rn,St=nn;else break e}}function n(tt){return tt.length===0?null:tt[0]}function i(tt){if(tt.length===0)return null;var wt=tt[0],St=tt.pop();if(St!==wt){tt[0]=St;e:for(var nn=0,rn=tt.length,nr=rn>>>1;nn<nr;){var ri=2*(nn+1)-1,bi=tt[ri],si=ri+1,cn=tt[si];if(0>o(bi,St))si<rn&&0>o(cn,bi)?(tt[nn]=cn,tt[si]=St,nn=si):(tt[nn]=bi,tt[ri]=St,nn=ri);else if(si<rn&&0>o(cn,St))tt[nn]=cn,tt[si]=St,nn=si;else break e}}return wt}function o(tt,wt){var St=tt.sortIndex-wt.sortIndex;return St!==0?St:tt.id-wt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var c=performance;t.unstable_now=function(){return c.now()}}else{var d=Date,l=d.now();t.unstable_now=function(){return d.now()-l}}var v=[],w=[],C=1,L=null,P=3,N=!1,X=!1,ee=!1,me=typeof setTimeout=="function"?setTimeout:null,Y=typeof clearTimeout=="function"?clearTimeout:null,W=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function q(tt){for(var wt=n(w);wt!==null;){if(wt.callback===null)i(w);else if(wt.startTime<=tt)i(w),wt.sortIndex=wt.expirationTime,e(v,wt);else break;wt=n(w)}}function oe(tt){if(ee=!1,q(tt),!X)if(n(v)!==null)X=!0,vt(ye);else{var wt=n(w);wt!==null&&ii(oe,wt.startTime-tt)}}function ye(tt,wt){X=!1,ee&&(ee=!1,Y(Fe),Fe=-1),N=!0;var St=P;try{for(q(wt),L=n(v);L!==null&&(!(L.expirationTime>wt)||tt&&!ut());){var nn=L.callback;if(typeof nn=="function"){L.callback=null,P=L.priorityLevel;var rn=nn(L.expirationTime<=wt);wt=t.unstable_now(),typeof rn=="function"?L.callback=rn:L===n(v)&&i(v),q(wt)}else i(v);L=n(v)}if(L!==null)var nr=!0;else{var ri=n(w);ri!==null&&ii(oe,ri.startTime-wt),nr=!1}return nr}finally{L=null,P=St,N=!1}}var Se=!1,Oe=null,Fe=-1,Ve=5,je=-1;function ut(){return!(t.unstable_now()-je<Ve)}function Gt(){if(Oe!==null){var tt=t.unstable_now();je=tt;var wt=!0;try{wt=Oe(!0,tt)}finally{wt?Yt():(Se=!1,Oe=null)}}else Se=!1}var Yt;if(typeof W=="function")Yt=function(){W(Gt)};else if(typeof MessageChannel<"u"){var Mt=new MessageChannel,zn=Mt.port2;Mt.port1.onmessage=Gt,Yt=function(){zn.postMessage(null)}}else Yt=function(){me(Gt,0)};function vt(tt){Oe=tt,Se||(Se=!0,Yt())}function ii(tt,wt){Fe=me(function(){tt(t.unstable_now())},wt)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(tt){tt.callback=null},t.unstable_continueExecution=function(){X||N||(X=!0,vt(ye))},t.unstable_forceFrameRate=function(tt){0>tt||125<tt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ve=0<tt?Math.floor(1e3/tt):5},t.unstable_getCurrentPriorityLevel=function(){return P},t.unstable_getFirstCallbackNode=function(){return n(v)},t.unstable_next=function(tt){switch(P){case 1:case 2:case 3:var wt=3;break;default:wt=P}var St=P;P=wt;try{return tt()}finally{P=St}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(tt,wt){switch(tt){case 1:case 2:case 3:case 4:case 5:break;default:tt=3}var St=P;P=tt;try{return wt()}finally{P=St}},t.unstable_scheduleCallback=function(tt,wt,St){var nn=t.unstable_now();switch(typeof St=="object"&&St!==null?(St=St.delay,St=typeof St=="number"&&0<St?nn+St:nn):St=nn,tt){case 1:var rn=-1;break;case 2:rn=250;break;case 5:rn=1073741823;break;case 4:rn=1e4;break;default:rn=5e3}return rn=St+rn,tt={id:C++,callback:wt,priorityLevel:tt,startTime:St,expirationTime:rn,sortIndex:-1},St>nn?(tt.sortIndex=St,e(w,tt),n(v)===null&&tt===n(w)&&(ee?(Y(Fe),Fe=-1):ee=!0,ii(oe,St-nn))):(tt.sortIndex=rn,e(v,tt),X||N||(X=!0,vt(ye))),tt},t.unstable_shouldYield=ut,t.unstable_wrapCallback=function(tt){var wt=P;return function(){var St=P;P=wt;try{return tt.apply(this,arguments)}finally{P=St}}}})(gT);mT.exports=gT;var LC=mT.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _T=ot,Qr=LC;function Ge(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var yT=new Set,Zh={};function Ul(t,e){Jc(t,e),Jc(t+"Capture",e)}function Jc(t,e){for(Zh[t]=e,t=0;t<e.length;t++)yT.add(e[t])}var Vo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),dy=Object.prototype.hasOwnProperty,kC=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,V1={},j1={};function RC(t){return dy.call(j1,t)?!0:dy.call(V1,t)?!1:kC.test(t)?j1[t]=!0:(V1[t]=!0,!1)}function DC(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function zC(t,e,n,i){if(e===null||typeof e>"u"||DC(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function yr(t,e,n,i,o,c,d){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=c,this.removeEmptyString=d}var Vi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Vi[t]=new yr(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Vi[e]=new yr(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Vi[t]=new yr(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Vi[t]=new yr(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Vi[t]=new yr(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Vi[t]=new yr(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Vi[t]=new yr(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Vi[t]=new yr(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Vi[t]=new yr(t,5,!1,t.toLowerCase(),null,!1,!1)});var G0=/[\-:]([a-z])/g;function $0(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(G0,$0);Vi[e]=new yr(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(G0,$0);Vi[e]=new yr(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(G0,$0);Vi[e]=new yr(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Vi[t]=new yr(t,1,!1,t.toLowerCase(),null,!1,!1)});Vi.xlinkHref=new yr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Vi[t]=new yr(t,1,!1,t.toLowerCase(),null,!0,!0)});function H0(t,e,n,i){var o=Vi.hasOwnProperty(e)?Vi[e]:null;(o!==null?o.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(zC(e,n,o,i)&&(n=null),i||o===null?RC(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):o.mustUseProperty?t[o.propertyName]=n===null?o.type===3?!1:"":n:(e=o.attributeName,i=o.attributeNamespace,n===null?t.removeAttribute(e):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var Zo=_T.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Nf=Symbol.for("react.element"),Cc=Symbol.for("react.portal"),Mc=Symbol.for("react.fragment"),W0=Symbol.for("react.strict_mode"),fy=Symbol.for("react.profiler"),vT=Symbol.for("react.provider"),xT=Symbol.for("react.context"),q0=Symbol.for("react.forward_ref"),py=Symbol.for("react.suspense"),my=Symbol.for("react.suspense_list"),Z0=Symbol.for("react.memo"),Ea=Symbol.for("react.lazy"),bT=Symbol.for("react.offscreen"),G1=Symbol.iterator;function ph(t){return t===null||typeof t!="object"?null:(t=G1&&t[G1]||t["@@iterator"],typeof t=="function"?t:null)}var Gn=Object.assign,o_;function Ch(t){if(o_===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);o_=e&&e[1]||""}return`
`+o_+t}var a_=!1;function l_(t,e){if(!t||a_)return"";a_=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(w){var i=w}Reflect.construct(t,[],e)}else{try{e.call()}catch(w){i=w}t.call(e.prototype)}else{try{throw Error()}catch(w){i=w}t()}}catch(w){if(w&&i&&typeof w.stack=="string"){for(var o=w.stack.split(`
`),c=i.stack.split(`
`),d=o.length-1,l=c.length-1;1<=d&&0<=l&&o[d]!==c[l];)l--;for(;1<=d&&0<=l;d--,l--)if(o[d]!==c[l]){if(d!==1||l!==1)do if(d--,l--,0>l||o[d]!==c[l]){var v=`
`+o[d].replace(" at new "," at ");return t.displayName&&v.includes("<anonymous>")&&(v=v.replace("<anonymous>",t.displayName)),v}while(1<=d&&0<=l);break}}}finally{a_=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Ch(t):""}function OC(t){switch(t.tag){case 5:return Ch(t.type);case 16:return Ch("Lazy");case 13:return Ch("Suspense");case 19:return Ch("SuspenseList");case 0:case 2:case 15:return t=l_(t.type,!1),t;case 11:return t=l_(t.type.render,!1),t;case 1:return t=l_(t.type,!0),t;default:return""}}function gy(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Mc:return"Fragment";case Cc:return"Portal";case fy:return"Profiler";case W0:return"StrictMode";case py:return"Suspense";case my:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case xT:return(t.displayName||"Context")+".Consumer";case vT:return(t._context.displayName||"Context")+".Provider";case q0:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Z0:return e=t.displayName||null,e!==null?e:gy(t.type)||"Memo";case Ea:e=t._payload,t=t._init;try{return gy(t(e))}catch{}}return null}function FC(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return gy(e);case 8:return e===W0?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ja(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function wT(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function BC(t){var e=wT(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,c=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return o.call(this)},set:function(d){i=""+d,c.call(this,d)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(d){i=""+d},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Uf(t){t._valueTracker||(t._valueTracker=BC(t))}function ET(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=wT(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function Np(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function _y(t,e){var n=e.checked;return Gn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function $1(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=ja(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function TT(t,e){e=e.checked,e!=null&&H0(t,"checked",e,!1)}function yy(t,e){TT(t,e);var n=ja(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?vy(t,e.type,n):e.hasOwnProperty("defaultValue")&&vy(t,e.type,ja(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function H1(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function vy(t,e,n){(e!=="number"||Np(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Mh=Array.isArray;function $c(t,e,n,i){if(t=t.options,e){e={};for(var o=0;o<n.length;o++)e["$"+n[o]]=!0;for(n=0;n<t.length;n++)o=e.hasOwnProperty("$"+t[n].value),t[n].selected!==o&&(t[n].selected=o),o&&i&&(t[n].defaultSelected=!0)}else{for(n=""+ja(n),e=null,o=0;o<t.length;o++){if(t[o].value===n){t[o].selected=!0,i&&(t[o].defaultSelected=!0);return}e!==null||t[o].disabled||(e=t[o])}e!==null&&(e.selected=!0)}}function xy(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ge(91));return Gn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function W1(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Ge(92));if(Mh(n)){if(1<n.length)throw Error(Ge(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:ja(n)}}function ST(t,e){var n=ja(e.value),i=ja(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function q1(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function AT(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function by(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?AT(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Vf,PT=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,o){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,o)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Vf=Vf||document.createElement("div"),Vf.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Vf.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Xh(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Oh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},NC=["Webkit","ms","Moz","O"];Object.keys(Oh).forEach(function(t){NC.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Oh[e]=Oh[t]})});function IT(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Oh.hasOwnProperty(t)&&Oh[t]?(""+e).trim():e+"px"}function CT(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,o=IT(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,o):t[n]=o}}var UC=Gn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function wy(t,e){if(e){if(UC[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ge(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ge(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ge(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ge(62))}}function Ey(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ty=null;function X0(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Sy=null,Hc=null,Wc=null;function Z1(t){if(t=Ed(t)){if(typeof Sy!="function")throw Error(Ge(280));var e=t.stateNode;e&&(e=Dm(e),Sy(t.stateNode,t.type,e))}}function MT(t){Hc?Wc?Wc.push(t):Wc=[t]:Hc=t}function LT(){if(Hc){var t=Hc,e=Wc;if(Wc=Hc=null,Z1(t),e)for(t=0;t<e.length;t++)Z1(e[t])}}function kT(t,e){return t(e)}function RT(){}var c_=!1;function DT(t,e,n){if(c_)return t(e,n);c_=!0;try{return kT(t,e,n)}finally{c_=!1,(Hc!==null||Wc!==null)&&(RT(),LT())}}function Yh(t,e){var n=t.stateNode;if(n===null)return null;var i=Dm(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Ge(231,e,typeof n));return n}var Ay=!1;if(Vo)try{var mh={};Object.defineProperty(mh,"passive",{get:function(){Ay=!0}}),window.addEventListener("test",mh,mh),window.removeEventListener("test",mh,mh)}catch{Ay=!1}function VC(t,e,n,i,o,c,d,l,v){var w=Array.prototype.slice.call(arguments,3);try{e.apply(n,w)}catch(C){this.onError(C)}}var Fh=!1,Up=null,Vp=!1,Py=null,jC={onError:function(t){Fh=!0,Up=t}};function GC(t,e,n,i,o,c,d,l,v){Fh=!1,Up=null,VC.apply(jC,arguments)}function $C(t,e,n,i,o,c,d,l,v){if(GC.apply(this,arguments),Fh){if(Fh){var w=Up;Fh=!1,Up=null}else throw Error(Ge(198));Vp||(Vp=!0,Py=w)}}function Vl(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function zT(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function X1(t){if(Vl(t)!==t)throw Error(Ge(188))}function HC(t){var e=t.alternate;if(!e){if(e=Vl(t),e===null)throw Error(Ge(188));return e!==t?null:t}for(var n=t,i=e;;){var o=n.return;if(o===null)break;var c=o.alternate;if(c===null){if(i=o.return,i!==null){n=i;continue}break}if(o.child===c.child){for(c=o.child;c;){if(c===n)return X1(o),t;if(c===i)return X1(o),e;c=c.sibling}throw Error(Ge(188))}if(n.return!==i.return)n=o,i=c;else{for(var d=!1,l=o.child;l;){if(l===n){d=!0,n=o,i=c;break}if(l===i){d=!0,i=o,n=c;break}l=l.sibling}if(!d){for(l=c.child;l;){if(l===n){d=!0,n=c,i=o;break}if(l===i){d=!0,i=c,n=o;break}l=l.sibling}if(!d)throw Error(Ge(189))}}if(n.alternate!==i)throw Error(Ge(190))}if(n.tag!==3)throw Error(Ge(188));return n.stateNode.current===n?t:e}function OT(t){return t=HC(t),t!==null?FT(t):null}function FT(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=FT(t);if(e!==null)return e;t=t.sibling}return null}var BT=Qr.unstable_scheduleCallback,Y1=Qr.unstable_cancelCallback,WC=Qr.unstable_shouldYield,qC=Qr.unstable_requestPaint,ni=Qr.unstable_now,ZC=Qr.unstable_getCurrentPriorityLevel,Y0=Qr.unstable_ImmediatePriority,NT=Qr.unstable_UserBlockingPriority,jp=Qr.unstable_NormalPriority,XC=Qr.unstable_LowPriority,UT=Qr.unstable_IdlePriority,Mm=null,fo=null;function YC(t){if(fo&&typeof fo.onCommitFiberRoot=="function")try{fo.onCommitFiberRoot(Mm,t,void 0,(t.current.flags&128)===128)}catch{}}var Fs=Math.clz32?Math.clz32:QC,KC=Math.log,JC=Math.LN2;function QC(t){return t>>>=0,t===0?32:31-(KC(t)/JC|0)|0}var jf=64,Gf=4194304;function Lh(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Gp(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,o=t.suspendedLanes,c=t.pingedLanes,d=n&268435455;if(d!==0){var l=d&~o;l!==0?i=Lh(l):(c&=d,c!==0&&(i=Lh(c)))}else d=n&~o,d!==0?i=Lh(d):c!==0&&(i=Lh(c));if(i===0)return 0;if(e!==0&&e!==i&&!(e&o)&&(o=i&-i,c=e&-e,o>=c||o===16&&(c&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-Fs(e),o=1<<n,i|=t[n],e&=~o;return i}function eM(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function tM(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,o=t.expirationTimes,c=t.pendingLanes;0<c;){var d=31-Fs(c),l=1<<d,v=o[d];v===-1?(!(l&n)||l&i)&&(o[d]=eM(l,e)):v<=e&&(t.expiredLanes|=l),c&=~l}}function Iy(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function VT(){var t=jf;return jf<<=1,!(jf&4194240)&&(jf=64),t}function u_(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function bd(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Fs(e),t[e]=n}function nM(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var o=31-Fs(n),c=1<<o;e[o]=0,i[o]=-1,t[o]=-1,n&=~c}}function K0(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-Fs(n),o=1<<i;o&e|t[i]&e&&(t[i]|=e),n&=~o}}var pn=0;function jT(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var GT,J0,$T,HT,WT,Cy=!1,$f=[],ka=null,Ra=null,Da=null,Kh=new Map,Jh=new Map,Sa=[],iM="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function K1(t,e){switch(t){case"focusin":case"focusout":ka=null;break;case"dragenter":case"dragleave":Ra=null;break;case"mouseover":case"mouseout":Da=null;break;case"pointerover":case"pointerout":Kh.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jh.delete(e.pointerId)}}function gh(t,e,n,i,o,c){return t===null||t.nativeEvent!==c?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:c,targetContainers:[o]},e!==null&&(e=Ed(e),e!==null&&J0(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,o!==null&&e.indexOf(o)===-1&&e.push(o),t)}function rM(t,e,n,i,o){switch(e){case"focusin":return ka=gh(ka,t,e,n,i,o),!0;case"dragenter":return Ra=gh(Ra,t,e,n,i,o),!0;case"mouseover":return Da=gh(Da,t,e,n,i,o),!0;case"pointerover":var c=o.pointerId;return Kh.set(c,gh(Kh.get(c)||null,t,e,n,i,o)),!0;case"gotpointercapture":return c=o.pointerId,Jh.set(c,gh(Jh.get(c)||null,t,e,n,i,o)),!0}return!1}function qT(t){var e=Al(t.target);if(e!==null){var n=Vl(e);if(n!==null){if(e=n.tag,e===13){if(e=zT(n),e!==null){t.blockedOn=e,WT(t.priority,function(){$T(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function xp(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=My(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);Ty=i,n.target.dispatchEvent(i),Ty=null}else return e=Ed(n),e!==null&&J0(e),t.blockedOn=n,!1;e.shift()}return!0}function J1(t,e,n){xp(t)&&n.delete(e)}function sM(){Cy=!1,ka!==null&&xp(ka)&&(ka=null),Ra!==null&&xp(Ra)&&(Ra=null),Da!==null&&xp(Da)&&(Da=null),Kh.forEach(J1),Jh.forEach(J1)}function _h(t,e){t.blockedOn===e&&(t.blockedOn=null,Cy||(Cy=!0,Qr.unstable_scheduleCallback(Qr.unstable_NormalPriority,sM)))}function Qh(t){function e(o){return _h(o,t)}if(0<$f.length){_h($f[0],t);for(var n=1;n<$f.length;n++){var i=$f[n];i.blockedOn===t&&(i.blockedOn=null)}}for(ka!==null&&_h(ka,t),Ra!==null&&_h(Ra,t),Da!==null&&_h(Da,t),Kh.forEach(e),Jh.forEach(e),n=0;n<Sa.length;n++)i=Sa[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Sa.length&&(n=Sa[0],n.blockedOn===null);)qT(n),n.blockedOn===null&&Sa.shift()}var qc=Zo.ReactCurrentBatchConfig,$p=!0;function oM(t,e,n,i){var o=pn,c=qc.transition;qc.transition=null;try{pn=1,Q0(t,e,n,i)}finally{pn=o,qc.transition=c}}function aM(t,e,n,i){var o=pn,c=qc.transition;qc.transition=null;try{pn=4,Q0(t,e,n,i)}finally{pn=o,qc.transition=c}}function Q0(t,e,n,i){if($p){var o=My(t,e,n,i);if(o===null)x_(t,e,i,Hp,n),K1(t,i);else if(rM(o,t,e,n,i))i.stopPropagation();else if(K1(t,i),e&4&&-1<iM.indexOf(t)){for(;o!==null;){var c=Ed(o);if(c!==null&&GT(c),c=My(t,e,n,i),c===null&&x_(t,e,i,Hp,n),c===o)break;o=c}o!==null&&i.stopPropagation()}else x_(t,e,i,null,n)}}var Hp=null;function My(t,e,n,i){if(Hp=null,t=X0(i),t=Al(t),t!==null)if(e=Vl(t),e===null)t=null;else if(n=e.tag,n===13){if(t=zT(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Hp=t,null}function ZT(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ZC()){case Y0:return 1;case NT:return 4;case jp:case XC:return 16;case UT:return 536870912;default:return 16}default:return 16}}var Pa=null,ev=null,bp=null;function XT(){if(bp)return bp;var t,e=ev,n=e.length,i,o="value"in Pa?Pa.value:Pa.textContent,c=o.length;for(t=0;t<n&&e[t]===o[t];t++);var d=n-t;for(i=1;i<=d&&e[n-i]===o[c-i];i++);return bp=o.slice(t,1<i?1-i:void 0)}function wp(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Hf(){return!0}function Q1(){return!1}function ts(t){function e(n,i,o,c,d){this._reactName=n,this._targetInst=o,this.type=i,this.nativeEvent=c,this.target=d,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(c):c[l]);return this.isDefaultPrevented=(c.defaultPrevented!=null?c.defaultPrevented:c.returnValue===!1)?Hf:Q1,this.isPropagationStopped=Q1,this}return Gn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Hf)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Hf)},persist:function(){},isPersistent:Hf}),e}var yu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},tv=ts(yu),wd=Gn({},yu,{view:0,detail:0}),lM=ts(wd),h_,d_,yh,Lm=Gn({},wd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:nv,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==yh&&(yh&&t.type==="mousemove"?(h_=t.screenX-yh.screenX,d_=t.screenY-yh.screenY):d_=h_=0,yh=t),h_)},movementY:function(t){return"movementY"in t?t.movementY:d_}}),eb=ts(Lm),cM=Gn({},Lm,{dataTransfer:0}),uM=ts(cM),hM=Gn({},wd,{relatedTarget:0}),f_=ts(hM),dM=Gn({},yu,{animationName:0,elapsedTime:0,pseudoElement:0}),fM=ts(dM),pM=Gn({},yu,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),mM=ts(pM),gM=Gn({},yu,{data:0}),tb=ts(gM),_M={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yM={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vM={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xM(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=vM[t])?!!e[t]:!1}function nv(){return xM}var bM=Gn({},wd,{key:function(t){if(t.key){var e=_M[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=wp(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?yM[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:nv,charCode:function(t){return t.type==="keypress"?wp(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?wp(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),wM=ts(bM),EM=Gn({},Lm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),nb=ts(EM),TM=Gn({},wd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:nv}),SM=ts(TM),AM=Gn({},yu,{propertyName:0,elapsedTime:0,pseudoElement:0}),PM=ts(AM),IM=Gn({},Lm,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),CM=ts(IM),MM=[9,13,27,32],iv=Vo&&"CompositionEvent"in window,Bh=null;Vo&&"documentMode"in document&&(Bh=document.documentMode);var LM=Vo&&"TextEvent"in window&&!Bh,YT=Vo&&(!iv||Bh&&8<Bh&&11>=Bh),ib=String.fromCharCode(32),rb=!1;function KT(t,e){switch(t){case"keyup":return MM.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function JT(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Lc=!1;function kM(t,e){switch(t){case"compositionend":return JT(e);case"keypress":return e.which!==32?null:(rb=!0,ib);case"textInput":return t=e.data,t===ib&&rb?null:t;default:return null}}function RM(t,e){if(Lc)return t==="compositionend"||!iv&&KT(t,e)?(t=XT(),bp=ev=Pa=null,Lc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return YT&&e.locale!=="ko"?null:e.data;default:return null}}var DM={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function sb(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!DM[t.type]:e==="textarea"}function QT(t,e,n,i){MT(i),e=Wp(e,"onChange"),0<e.length&&(n=new tv("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Nh=null,ed=null;function zM(t){u2(t,0)}function km(t){var e=Dc(t);if(ET(e))return t}function OM(t,e){if(t==="change")return e}var e2=!1;if(Vo){var p_;if(Vo){var m_="oninput"in document;if(!m_){var ob=document.createElement("div");ob.setAttribute("oninput","return;"),m_=typeof ob.oninput=="function"}p_=m_}else p_=!1;e2=p_&&(!document.documentMode||9<document.documentMode)}function ab(){Nh&&(Nh.detachEvent("onpropertychange",t2),ed=Nh=null)}function t2(t){if(t.propertyName==="value"&&km(ed)){var e=[];QT(e,ed,t,X0(t)),DT(zM,e)}}function FM(t,e,n){t==="focusin"?(ab(),Nh=e,ed=n,Nh.attachEvent("onpropertychange",t2)):t==="focusout"&&ab()}function BM(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return km(ed)}function NM(t,e){if(t==="click")return km(e)}function UM(t,e){if(t==="input"||t==="change")return km(e)}function VM(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Us=typeof Object.is=="function"?Object.is:VM;function td(t,e){if(Us(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var o=n[i];if(!dy.call(e,o)||!Us(t[o],e[o]))return!1}return!0}function lb(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function cb(t,e){var n=lb(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=lb(n)}}function n2(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?n2(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function i2(){for(var t=window,e=Np();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Np(t.document)}return e}function rv(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function jM(t){var e=i2(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&n2(n.ownerDocument.documentElement,n)){if(i!==null&&rv(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var o=n.textContent.length,c=Math.min(i.start,o);i=i.end===void 0?c:Math.min(i.end,o),!t.extend&&c>i&&(o=i,i=c,c=o),o=cb(n,c);var d=cb(n,i);o&&d&&(t.rangeCount!==1||t.anchorNode!==o.node||t.anchorOffset!==o.offset||t.focusNode!==d.node||t.focusOffset!==d.offset)&&(e=e.createRange(),e.setStart(o.node,o.offset),t.removeAllRanges(),c>i?(t.addRange(e),t.extend(d.node,d.offset)):(e.setEnd(d.node,d.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var GM=Vo&&"documentMode"in document&&11>=document.documentMode,kc=null,Ly=null,Uh=null,ky=!1;function ub(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;ky||kc==null||kc!==Np(i)||(i=kc,"selectionStart"in i&&rv(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Uh&&td(Uh,i)||(Uh=i,i=Wp(Ly,"onSelect"),0<i.length&&(e=new tv("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=kc)))}function Wf(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Rc={animationend:Wf("Animation","AnimationEnd"),animationiteration:Wf("Animation","AnimationIteration"),animationstart:Wf("Animation","AnimationStart"),transitionend:Wf("Transition","TransitionEnd")},g_={},r2={};Vo&&(r2=document.createElement("div").style,"AnimationEvent"in window||(delete Rc.animationend.animation,delete Rc.animationiteration.animation,delete Rc.animationstart.animation),"TransitionEvent"in window||delete Rc.transitionend.transition);function Rm(t){if(g_[t])return g_[t];if(!Rc[t])return t;var e=Rc[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in r2)return g_[t]=e[n];return t}var s2=Rm("animationend"),o2=Rm("animationiteration"),a2=Rm("animationstart"),l2=Rm("transitionend"),c2=new Map,hb="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ha(t,e){c2.set(t,e),Ul(e,[t])}for(var __=0;__<hb.length;__++){var y_=hb[__],$M=y_.toLowerCase(),HM=y_[0].toUpperCase()+y_.slice(1);Ha($M,"on"+HM)}Ha(s2,"onAnimationEnd");Ha(o2,"onAnimationIteration");Ha(a2,"onAnimationStart");Ha("dblclick","onDoubleClick");Ha("focusin","onFocus");Ha("focusout","onBlur");Ha(l2,"onTransitionEnd");Jc("onMouseEnter",["mouseout","mouseover"]);Jc("onMouseLeave",["mouseout","mouseover"]);Jc("onPointerEnter",["pointerout","pointerover"]);Jc("onPointerLeave",["pointerout","pointerover"]);Ul("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ul("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ul("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ul("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ul("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ul("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var kh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),WM=new Set("cancel close invalid load scroll toggle".split(" ").concat(kh));function db(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,$C(i,e,void 0,t),t.currentTarget=null}function u2(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],o=i.event;i=i.listeners;e:{var c=void 0;if(e)for(var d=i.length-1;0<=d;d--){var l=i[d],v=l.instance,w=l.currentTarget;if(l=l.listener,v!==c&&o.isPropagationStopped())break e;db(o,l,w),c=v}else for(d=0;d<i.length;d++){if(l=i[d],v=l.instance,w=l.currentTarget,l=l.listener,v!==c&&o.isPropagationStopped())break e;db(o,l,w),c=v}}}if(Vp)throw t=Py,Vp=!1,Py=null,t}function In(t,e){var n=e[Fy];n===void 0&&(n=e[Fy]=new Set);var i=t+"__bubble";n.has(i)||(h2(e,t,2,!1),n.add(i))}function v_(t,e,n){var i=0;e&&(i|=4),h2(n,t,i,e)}var qf="_reactListening"+Math.random().toString(36).slice(2);function nd(t){if(!t[qf]){t[qf]=!0,yT.forEach(function(n){n!=="selectionchange"&&(WM.has(n)||v_(n,!1,t),v_(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[qf]||(e[qf]=!0,v_("selectionchange",!1,e))}}function h2(t,e,n,i){switch(ZT(e)){case 1:var o=oM;break;case 4:o=aM;break;default:o=Q0}n=o.bind(null,e,n,t),o=void 0,!Ay||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(o=!0),i?o!==void 0?t.addEventListener(e,n,{capture:!0,passive:o}):t.addEventListener(e,n,!0):o!==void 0?t.addEventListener(e,n,{passive:o}):t.addEventListener(e,n,!1)}function x_(t,e,n,i,o){var c=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var d=i.tag;if(d===3||d===4){var l=i.stateNode.containerInfo;if(l===o||l.nodeType===8&&l.parentNode===o)break;if(d===4)for(d=i.return;d!==null;){var v=d.tag;if((v===3||v===4)&&(v=d.stateNode.containerInfo,v===o||v.nodeType===8&&v.parentNode===o))return;d=d.return}for(;l!==null;){if(d=Al(l),d===null)return;if(v=d.tag,v===5||v===6){i=c=d;continue e}l=l.parentNode}}i=i.return}DT(function(){var w=c,C=X0(n),L=[];e:{var P=c2.get(t);if(P!==void 0){var N=tv,X=t;switch(t){case"keypress":if(wp(n)===0)break e;case"keydown":case"keyup":N=wM;break;case"focusin":X="focus",N=f_;break;case"focusout":X="blur",N=f_;break;case"beforeblur":case"afterblur":N=f_;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":N=eb;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":N=uM;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":N=SM;break;case s2:case o2:case a2:N=fM;break;case l2:N=PM;break;case"scroll":N=lM;break;case"wheel":N=CM;break;case"copy":case"cut":case"paste":N=mM;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":N=nb}var ee=(e&4)!==0,me=!ee&&t==="scroll",Y=ee?P!==null?P+"Capture":null:P;ee=[];for(var W=w,q;W!==null;){q=W;var oe=q.stateNode;if(q.tag===5&&oe!==null&&(q=oe,Y!==null&&(oe=Yh(W,Y),oe!=null&&ee.push(id(W,oe,q)))),me)break;W=W.return}0<ee.length&&(P=new N(P,X,null,n,C),L.push({event:P,listeners:ee}))}}if(!(e&7)){e:{if(P=t==="mouseover"||t==="pointerover",N=t==="mouseout"||t==="pointerout",P&&n!==Ty&&(X=n.relatedTarget||n.fromElement)&&(Al(X)||X[jo]))break e;if((N||P)&&(P=C.window===C?C:(P=C.ownerDocument)?P.defaultView||P.parentWindow:window,N?(X=n.relatedTarget||n.toElement,N=w,X=X?Al(X):null,X!==null&&(me=Vl(X),X!==me||X.tag!==5&&X.tag!==6)&&(X=null)):(N=null,X=w),N!==X)){if(ee=eb,oe="onMouseLeave",Y="onMouseEnter",W="mouse",(t==="pointerout"||t==="pointerover")&&(ee=nb,oe="onPointerLeave",Y="onPointerEnter",W="pointer"),me=N==null?P:Dc(N),q=X==null?P:Dc(X),P=new ee(oe,W+"leave",N,n,C),P.target=me,P.relatedTarget=q,oe=null,Al(C)===w&&(ee=new ee(Y,W+"enter",X,n,C),ee.target=q,ee.relatedTarget=me,oe=ee),me=oe,N&&X)t:{for(ee=N,Y=X,W=0,q=ee;q;q=vc(q))W++;for(q=0,oe=Y;oe;oe=vc(oe))q++;for(;0<W-q;)ee=vc(ee),W--;for(;0<q-W;)Y=vc(Y),q--;for(;W--;){if(ee===Y||Y!==null&&ee===Y.alternate)break t;ee=vc(ee),Y=vc(Y)}ee=null}else ee=null;N!==null&&fb(L,P,N,ee,!1),X!==null&&me!==null&&fb(L,me,X,ee,!0)}}e:{if(P=w?Dc(w):window,N=P.nodeName&&P.nodeName.toLowerCase(),N==="select"||N==="input"&&P.type==="file")var ye=OM;else if(sb(P))if(e2)ye=UM;else{ye=BM;var Se=FM}else(N=P.nodeName)&&N.toLowerCase()==="input"&&(P.type==="checkbox"||P.type==="radio")&&(ye=NM);if(ye&&(ye=ye(t,w))){QT(L,ye,n,C);break e}Se&&Se(t,P,w),t==="focusout"&&(Se=P._wrapperState)&&Se.controlled&&P.type==="number"&&vy(P,"number",P.value)}switch(Se=w?Dc(w):window,t){case"focusin":(sb(Se)||Se.contentEditable==="true")&&(kc=Se,Ly=w,Uh=null);break;case"focusout":Uh=Ly=kc=null;break;case"mousedown":ky=!0;break;case"contextmenu":case"mouseup":case"dragend":ky=!1,ub(L,n,C);break;case"selectionchange":if(GM)break;case"keydown":case"keyup":ub(L,n,C)}var Oe;if(iv)e:{switch(t){case"compositionstart":var Fe="onCompositionStart";break e;case"compositionend":Fe="onCompositionEnd";break e;case"compositionupdate":Fe="onCompositionUpdate";break e}Fe=void 0}else Lc?KT(t,n)&&(Fe="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(Fe="onCompositionStart");Fe&&(YT&&n.locale!=="ko"&&(Lc||Fe!=="onCompositionStart"?Fe==="onCompositionEnd"&&Lc&&(Oe=XT()):(Pa=C,ev="value"in Pa?Pa.value:Pa.textContent,Lc=!0)),Se=Wp(w,Fe),0<Se.length&&(Fe=new tb(Fe,t,null,n,C),L.push({event:Fe,listeners:Se}),Oe?Fe.data=Oe:(Oe=JT(n),Oe!==null&&(Fe.data=Oe)))),(Oe=LM?kM(t,n):RM(t,n))&&(w=Wp(w,"onBeforeInput"),0<w.length&&(C=new tb("onBeforeInput","beforeinput",null,n,C),L.push({event:C,listeners:w}),C.data=Oe))}u2(L,e)})}function id(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Wp(t,e){for(var n=e+"Capture",i=[];t!==null;){var o=t,c=o.stateNode;o.tag===5&&c!==null&&(o=c,c=Yh(t,n),c!=null&&i.unshift(id(t,c,o)),c=Yh(t,e),c!=null&&i.push(id(t,c,o))),t=t.return}return i}function vc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function fb(t,e,n,i,o){for(var c=e._reactName,d=[];n!==null&&n!==i;){var l=n,v=l.alternate,w=l.stateNode;if(v!==null&&v===i)break;l.tag===5&&w!==null&&(l=w,o?(v=Yh(n,c),v!=null&&d.unshift(id(n,v,l))):o||(v=Yh(n,c),v!=null&&d.push(id(n,v,l)))),n=n.return}d.length!==0&&t.push({event:e,listeners:d})}var qM=/\r\n?/g,ZM=/\u0000|\uFFFD/g;function pb(t){return(typeof t=="string"?t:""+t).replace(qM,`
`).replace(ZM,"")}function Zf(t,e,n){if(e=pb(e),pb(t)!==e&&n)throw Error(Ge(425))}function qp(){}var Ry=null,Dy=null;function zy(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Oy=typeof setTimeout=="function"?setTimeout:void 0,XM=typeof clearTimeout=="function"?clearTimeout:void 0,mb=typeof Promise=="function"?Promise:void 0,YM=typeof queueMicrotask=="function"?queueMicrotask:typeof mb<"u"?function(t){return mb.resolve(null).then(t).catch(KM)}:Oy;function KM(t){setTimeout(function(){throw t})}function b_(t,e){var n=e,i=0;do{var o=n.nextSibling;if(t.removeChild(n),o&&o.nodeType===8)if(n=o.data,n==="/$"){if(i===0){t.removeChild(o),Qh(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=o}while(n);Qh(e)}function za(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function gb(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var vu=Math.random().toString(36).slice(2),lo="__reactFiber$"+vu,rd="__reactProps$"+vu,jo="__reactContainer$"+vu,Fy="__reactEvents$"+vu,JM="__reactListeners$"+vu,QM="__reactHandles$"+vu;function Al(t){var e=t[lo];if(e)return e;for(var n=t.parentNode;n;){if(e=n[jo]||n[lo]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=gb(t);t!==null;){if(n=t[lo])return n;t=gb(t)}return e}t=n,n=t.parentNode}return null}function Ed(t){return t=t[lo]||t[jo],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Dc(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Ge(33))}function Dm(t){return t[rd]||null}var By=[],zc=-1;function Wa(t){return{current:t}}function Mn(t){0>zc||(t.current=By[zc],By[zc]=null,zc--)}function An(t,e){zc++,By[zc]=t.current,t.current=e}var Ga={},tr=Wa(Ga),Ir=Wa(!1),Rl=Ga;function Qc(t,e){var n=t.type.contextTypes;if(!n)return Ga;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var o={},c;for(c in n)o[c]=e[c];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=o),o}function Cr(t){return t=t.childContextTypes,t!=null}function Zp(){Mn(Ir),Mn(tr)}function _b(t,e,n){if(tr.current!==Ga)throw Error(Ge(168));An(tr,e),An(Ir,n)}function d2(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var o in i)if(!(o in e))throw Error(Ge(108,FC(t)||"Unknown",o));return Gn({},n,i)}function Xp(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Ga,Rl=tr.current,An(tr,t),An(Ir,Ir.current),!0}function yb(t,e,n){var i=t.stateNode;if(!i)throw Error(Ge(169));n?(t=d2(t,e,Rl),i.__reactInternalMemoizedMergedChildContext=t,Mn(Ir),Mn(tr),An(tr,t)):Mn(Ir),An(Ir,n)}var zo=null,zm=!1,w_=!1;function f2(t){zo===null?zo=[t]:zo.push(t)}function eL(t){zm=!0,f2(t)}function qa(){if(!w_&&zo!==null){w_=!0;var t=0,e=pn;try{var n=zo;for(pn=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}zo=null,zm=!1}catch(o){throw zo!==null&&(zo=zo.slice(t+1)),BT(Y0,qa),o}finally{pn=e,w_=!1}}return null}var Oc=[],Fc=0,Yp=null,Kp=0,ms=[],gs=0,Dl=null,Bo=1,No="";function El(t,e){Oc[Fc++]=Kp,Oc[Fc++]=Yp,Yp=t,Kp=e}function p2(t,e,n){ms[gs++]=Bo,ms[gs++]=No,ms[gs++]=Dl,Dl=t;var i=Bo;t=No;var o=32-Fs(i)-1;i&=~(1<<o),n+=1;var c=32-Fs(e)+o;if(30<c){var d=o-o%5;c=(i&(1<<d)-1).toString(32),i>>=d,o-=d,Bo=1<<32-Fs(e)+o|n<<o|i,No=c+t}else Bo=1<<c|n<<o|i,No=t}function sv(t){t.return!==null&&(El(t,1),p2(t,1,0))}function ov(t){for(;t===Yp;)Yp=Oc[--Fc],Oc[Fc]=null,Kp=Oc[--Fc],Oc[Fc]=null;for(;t===Dl;)Dl=ms[--gs],ms[gs]=null,No=ms[--gs],ms[gs]=null,Bo=ms[--gs],ms[gs]=null}var Kr=null,Xr=null,Dn=!1,Ds=null;function m2(t,e){var n=_s(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function vb(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Kr=t,Xr=za(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Kr=t,Xr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Dl!==null?{id:Bo,overflow:No}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=_s(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Kr=t,Xr=null,!0):!1;default:return!1}}function Ny(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Uy(t){if(Dn){var e=Xr;if(e){var n=e;if(!vb(t,e)){if(Ny(t))throw Error(Ge(418));e=za(n.nextSibling);var i=Kr;e&&vb(t,e)?m2(i,n):(t.flags=t.flags&-4097|2,Dn=!1,Kr=t)}}else{if(Ny(t))throw Error(Ge(418));t.flags=t.flags&-4097|2,Dn=!1,Kr=t}}}function xb(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Kr=t}function Xf(t){if(t!==Kr)return!1;if(!Dn)return xb(t),Dn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!zy(t.type,t.memoizedProps)),e&&(e=Xr)){if(Ny(t))throw g2(),Error(Ge(418));for(;e;)m2(t,e),e=za(e.nextSibling)}if(xb(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Ge(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Xr=za(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Xr=null}}else Xr=Kr?za(t.stateNode.nextSibling):null;return!0}function g2(){for(var t=Xr;t;)t=za(t.nextSibling)}function eu(){Xr=Kr=null,Dn=!1}function av(t){Ds===null?Ds=[t]:Ds.push(t)}var tL=Zo.ReactCurrentBatchConfig;function ks(t,e){if(t&&t.defaultProps){e=Gn({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var Jp=Wa(null),Qp=null,Bc=null,lv=null;function cv(){lv=Bc=Qp=null}function uv(t){var e=Jp.current;Mn(Jp),t._currentValue=e}function Vy(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function Zc(t,e){Qp=t,lv=Bc=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Pr=!0),t.firstContext=null)}function xs(t){var e=t._currentValue;if(lv!==t)if(t={context:t,memoizedValue:e,next:null},Bc===null){if(Qp===null)throw Error(Ge(308));Bc=t,Qp.dependencies={lanes:0,firstContext:t}}else Bc=Bc.next=t;return e}var Pl=null;function hv(t){Pl===null?Pl=[t]:Pl.push(t)}function _2(t,e,n,i){var o=e.interleaved;return o===null?(n.next=n,hv(e)):(n.next=o.next,o.next=n),e.interleaved=n,Go(t,i)}function Go(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Ta=!1;function dv(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function y2(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Uo(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Oa(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,an&2){var o=i.pending;return o===null?e.next=e:(e.next=o.next,o.next=e),i.pending=e,Go(t,n)}return o=i.interleaved,o===null?(e.next=e,hv(i)):(e.next=o.next,o.next=e),i.interleaved=e,Go(t,n)}function Ep(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,K0(t,n)}}function bb(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var o=null,c=null;if(n=n.firstBaseUpdate,n!==null){do{var d={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};c===null?o=c=d:c=c.next=d,n=n.next}while(n!==null);c===null?o=c=e:c=c.next=e}else o=c=e;n={baseState:i.baseState,firstBaseUpdate:o,lastBaseUpdate:c,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function em(t,e,n,i){var o=t.updateQueue;Ta=!1;var c=o.firstBaseUpdate,d=o.lastBaseUpdate,l=o.shared.pending;if(l!==null){o.shared.pending=null;var v=l,w=v.next;v.next=null,d===null?c=w:d.next=w,d=v;var C=t.alternate;C!==null&&(C=C.updateQueue,l=C.lastBaseUpdate,l!==d&&(l===null?C.firstBaseUpdate=w:l.next=w,C.lastBaseUpdate=v))}if(c!==null){var L=o.baseState;d=0,C=w=v=null,l=c;do{var P=l.lane,N=l.eventTime;if((i&P)===P){C!==null&&(C=C.next={eventTime:N,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var X=t,ee=l;switch(P=e,N=n,ee.tag){case 1:if(X=ee.payload,typeof X=="function"){L=X.call(N,L,P);break e}L=X;break e;case 3:X.flags=X.flags&-65537|128;case 0:if(X=ee.payload,P=typeof X=="function"?X.call(N,L,P):X,P==null)break e;L=Gn({},L,P);break e;case 2:Ta=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,P=o.effects,P===null?o.effects=[l]:P.push(l))}else N={eventTime:N,lane:P,tag:l.tag,payload:l.payload,callback:l.callback,next:null},C===null?(w=C=N,v=L):C=C.next=N,d|=P;if(l=l.next,l===null){if(l=o.shared.pending,l===null)break;P=l,l=P.next,P.next=null,o.lastBaseUpdate=P,o.shared.pending=null}}while(1);if(C===null&&(v=L),o.baseState=v,o.firstBaseUpdate=w,o.lastBaseUpdate=C,e=o.shared.interleaved,e!==null){o=e;do d|=o.lane,o=o.next;while(o!==e)}else c===null&&(o.shared.lanes=0);Ol|=d,t.lanes=d,t.memoizedState=L}}function wb(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],o=i.callback;if(o!==null){if(i.callback=null,i=n,typeof o!="function")throw Error(Ge(191,o));o.call(i)}}}var v2=new _T.Component().refs;function jy(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:Gn({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Om={isMounted:function(t){return(t=t._reactInternals)?Vl(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=gr(),o=Ba(t),c=Uo(i,o);c.payload=e,n!=null&&(c.callback=n),e=Oa(t,c,o),e!==null&&(Bs(e,t,o,i),Ep(e,t,o))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=gr(),o=Ba(t),c=Uo(i,o);c.tag=1,c.payload=e,n!=null&&(c.callback=n),e=Oa(t,c,o),e!==null&&(Bs(e,t,o,i),Ep(e,t,o))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=gr(),i=Ba(t),o=Uo(n,i);o.tag=2,e!=null&&(o.callback=e),e=Oa(t,o,i),e!==null&&(Bs(e,t,i,n),Ep(e,t,i))}};function Eb(t,e,n,i,o,c,d){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,c,d):e.prototype&&e.prototype.isPureReactComponent?!td(n,i)||!td(o,c):!0}function x2(t,e,n){var i=!1,o=Ga,c=e.contextType;return typeof c=="object"&&c!==null?c=xs(c):(o=Cr(e)?Rl:tr.current,i=e.contextTypes,c=(i=i!=null)?Qc(t,o):Ga),e=new e(n,c),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Om,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=o,t.__reactInternalMemoizedMaskedChildContext=c),e}function Tb(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&Om.enqueueReplaceState(e,e.state,null)}function Gy(t,e,n,i){var o=t.stateNode;o.props=n,o.state=t.memoizedState,o.refs=v2,dv(t);var c=e.contextType;typeof c=="object"&&c!==null?o.context=xs(c):(c=Cr(e)?Rl:tr.current,o.context=Qc(t,c)),o.state=t.memoizedState,c=e.getDerivedStateFromProps,typeof c=="function"&&(jy(t,e,c,n),o.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(e=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),e!==o.state&&Om.enqueueReplaceState(o,o.state,null),em(t,n,o,i),o.state=t.memoizedState),typeof o.componentDidMount=="function"&&(t.flags|=4194308)}function vh(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Ge(309));var i=n.stateNode}if(!i)throw Error(Ge(147,t));var o=i,c=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===c?e.ref:(e=function(d){var l=o.refs;l===v2&&(l=o.refs={}),d===null?delete l[c]:l[c]=d},e._stringRef=c,e)}if(typeof t!="string")throw Error(Ge(284));if(!n._owner)throw Error(Ge(290,t))}return t}function Yf(t,e){throw t=Object.prototype.toString.call(e),Error(Ge(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Sb(t){var e=t._init;return e(t._payload)}function b2(t){function e(Y,W){if(t){var q=Y.deletions;q===null?(Y.deletions=[W],Y.flags|=16):q.push(W)}}function n(Y,W){if(!t)return null;for(;W!==null;)e(Y,W),W=W.sibling;return null}function i(Y,W){for(Y=new Map;W!==null;)W.key!==null?Y.set(W.key,W):Y.set(W.index,W),W=W.sibling;return Y}function o(Y,W){return Y=Na(Y,W),Y.index=0,Y.sibling=null,Y}function c(Y,W,q){return Y.index=q,t?(q=Y.alternate,q!==null?(q=q.index,q<W?(Y.flags|=2,W):q):(Y.flags|=2,W)):(Y.flags|=1048576,W)}function d(Y){return t&&Y.alternate===null&&(Y.flags|=2),Y}function l(Y,W,q,oe){return W===null||W.tag!==6?(W=C_(q,Y.mode,oe),W.return=Y,W):(W=o(W,q),W.return=Y,W)}function v(Y,W,q,oe){var ye=q.type;return ye===Mc?C(Y,W,q.props.children,oe,q.key):W!==null&&(W.elementType===ye||typeof ye=="object"&&ye!==null&&ye.$$typeof===Ea&&Sb(ye)===W.type)?(oe=o(W,q.props),oe.ref=vh(Y,W,q),oe.return=Y,oe):(oe=Cp(q.type,q.key,q.props,null,Y.mode,oe),oe.ref=vh(Y,W,q),oe.return=Y,oe)}function w(Y,W,q,oe){return W===null||W.tag!==4||W.stateNode.containerInfo!==q.containerInfo||W.stateNode.implementation!==q.implementation?(W=M_(q,Y.mode,oe),W.return=Y,W):(W=o(W,q.children||[]),W.return=Y,W)}function C(Y,W,q,oe,ye){return W===null||W.tag!==7?(W=Ll(q,Y.mode,oe,ye),W.return=Y,W):(W=o(W,q),W.return=Y,W)}function L(Y,W,q){if(typeof W=="string"&&W!==""||typeof W=="number")return W=C_(""+W,Y.mode,q),W.return=Y,W;if(typeof W=="object"&&W!==null){switch(W.$$typeof){case Nf:return q=Cp(W.type,W.key,W.props,null,Y.mode,q),q.ref=vh(Y,null,W),q.return=Y,q;case Cc:return W=M_(W,Y.mode,q),W.return=Y,W;case Ea:var oe=W._init;return L(Y,oe(W._payload),q)}if(Mh(W)||ph(W))return W=Ll(W,Y.mode,q,null),W.return=Y,W;Yf(Y,W)}return null}function P(Y,W,q,oe){var ye=W!==null?W.key:null;if(typeof q=="string"&&q!==""||typeof q=="number")return ye!==null?null:l(Y,W,""+q,oe);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case Nf:return q.key===ye?v(Y,W,q,oe):null;case Cc:return q.key===ye?w(Y,W,q,oe):null;case Ea:return ye=q._init,P(Y,W,ye(q._payload),oe)}if(Mh(q)||ph(q))return ye!==null?null:C(Y,W,q,oe,null);Yf(Y,q)}return null}function N(Y,W,q,oe,ye){if(typeof oe=="string"&&oe!==""||typeof oe=="number")return Y=Y.get(q)||null,l(W,Y,""+oe,ye);if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case Nf:return Y=Y.get(oe.key===null?q:oe.key)||null,v(W,Y,oe,ye);case Cc:return Y=Y.get(oe.key===null?q:oe.key)||null,w(W,Y,oe,ye);case Ea:var Se=oe._init;return N(Y,W,q,Se(oe._payload),ye)}if(Mh(oe)||ph(oe))return Y=Y.get(q)||null,C(W,Y,oe,ye,null);Yf(W,oe)}return null}function X(Y,W,q,oe){for(var ye=null,Se=null,Oe=W,Fe=W=0,Ve=null;Oe!==null&&Fe<q.length;Fe++){Oe.index>Fe?(Ve=Oe,Oe=null):Ve=Oe.sibling;var je=P(Y,Oe,q[Fe],oe);if(je===null){Oe===null&&(Oe=Ve);break}t&&Oe&&je.alternate===null&&e(Y,Oe),W=c(je,W,Fe),Se===null?ye=je:Se.sibling=je,Se=je,Oe=Ve}if(Fe===q.length)return n(Y,Oe),Dn&&El(Y,Fe),ye;if(Oe===null){for(;Fe<q.length;Fe++)Oe=L(Y,q[Fe],oe),Oe!==null&&(W=c(Oe,W,Fe),Se===null?ye=Oe:Se.sibling=Oe,Se=Oe);return Dn&&El(Y,Fe),ye}for(Oe=i(Y,Oe);Fe<q.length;Fe++)Ve=N(Oe,Y,Fe,q[Fe],oe),Ve!==null&&(t&&Ve.alternate!==null&&Oe.delete(Ve.key===null?Fe:Ve.key),W=c(Ve,W,Fe),Se===null?ye=Ve:Se.sibling=Ve,Se=Ve);return t&&Oe.forEach(function(ut){return e(Y,ut)}),Dn&&El(Y,Fe),ye}function ee(Y,W,q,oe){var ye=ph(q);if(typeof ye!="function")throw Error(Ge(150));if(q=ye.call(q),q==null)throw Error(Ge(151));for(var Se=ye=null,Oe=W,Fe=W=0,Ve=null,je=q.next();Oe!==null&&!je.done;Fe++,je=q.next()){Oe.index>Fe?(Ve=Oe,Oe=null):Ve=Oe.sibling;var ut=P(Y,Oe,je.value,oe);if(ut===null){Oe===null&&(Oe=Ve);break}t&&Oe&&ut.alternate===null&&e(Y,Oe),W=c(ut,W,Fe),Se===null?ye=ut:Se.sibling=ut,Se=ut,Oe=Ve}if(je.done)return n(Y,Oe),Dn&&El(Y,Fe),ye;if(Oe===null){for(;!je.done;Fe++,je=q.next())je=L(Y,je.value,oe),je!==null&&(W=c(je,W,Fe),Se===null?ye=je:Se.sibling=je,Se=je);return Dn&&El(Y,Fe),ye}for(Oe=i(Y,Oe);!je.done;Fe++,je=q.next())je=N(Oe,Y,Fe,je.value,oe),je!==null&&(t&&je.alternate!==null&&Oe.delete(je.key===null?Fe:je.key),W=c(je,W,Fe),Se===null?ye=je:Se.sibling=je,Se=je);return t&&Oe.forEach(function(Gt){return e(Y,Gt)}),Dn&&El(Y,Fe),ye}function me(Y,W,q,oe){if(typeof q=="object"&&q!==null&&q.type===Mc&&q.key===null&&(q=q.props.children),typeof q=="object"&&q!==null){switch(q.$$typeof){case Nf:e:{for(var ye=q.key,Se=W;Se!==null;){if(Se.key===ye){if(ye=q.type,ye===Mc){if(Se.tag===7){n(Y,Se.sibling),W=o(Se,q.props.children),W.return=Y,Y=W;break e}}else if(Se.elementType===ye||typeof ye=="object"&&ye!==null&&ye.$$typeof===Ea&&Sb(ye)===Se.type){n(Y,Se.sibling),W=o(Se,q.props),W.ref=vh(Y,Se,q),W.return=Y,Y=W;break e}n(Y,Se);break}else e(Y,Se);Se=Se.sibling}q.type===Mc?(W=Ll(q.props.children,Y.mode,oe,q.key),W.return=Y,Y=W):(oe=Cp(q.type,q.key,q.props,null,Y.mode,oe),oe.ref=vh(Y,W,q),oe.return=Y,Y=oe)}return d(Y);case Cc:e:{for(Se=q.key;W!==null;){if(W.key===Se)if(W.tag===4&&W.stateNode.containerInfo===q.containerInfo&&W.stateNode.implementation===q.implementation){n(Y,W.sibling),W=o(W,q.children||[]),W.return=Y,Y=W;break e}else{n(Y,W);break}else e(Y,W);W=W.sibling}W=M_(q,Y.mode,oe),W.return=Y,Y=W}return d(Y);case Ea:return Se=q._init,me(Y,W,Se(q._payload),oe)}if(Mh(q))return X(Y,W,q,oe);if(ph(q))return ee(Y,W,q,oe);Yf(Y,q)}return typeof q=="string"&&q!==""||typeof q=="number"?(q=""+q,W!==null&&W.tag===6?(n(Y,W.sibling),W=o(W,q),W.return=Y,Y=W):(n(Y,W),W=C_(q,Y.mode,oe),W.return=Y,Y=W),d(Y)):n(Y,W)}return me}var tu=b2(!0),w2=b2(!1),Td={},po=Wa(Td),sd=Wa(Td),od=Wa(Td);function Il(t){if(t===Td)throw Error(Ge(174));return t}function fv(t,e){switch(An(od,e),An(sd,t),An(po,Td),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:by(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=by(e,t)}Mn(po),An(po,e)}function nu(){Mn(po),Mn(sd),Mn(od)}function E2(t){Il(od.current);var e=Il(po.current),n=by(e,t.type);e!==n&&(An(sd,t),An(po,n))}function pv(t){sd.current===t&&(Mn(po),Mn(sd))}var Un=Wa(0);function tm(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var E_=[];function mv(){for(var t=0;t<E_.length;t++)E_[t]._workInProgressVersionPrimary=null;E_.length=0}var Tp=Zo.ReactCurrentDispatcher,T_=Zo.ReactCurrentBatchConfig,zl=0,jn=null,yi=null,Ii=null,nm=!1,Vh=!1,ad=0,nL=0;function Yi(){throw Error(Ge(321))}function gv(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Us(t[n],e[n]))return!1;return!0}function _v(t,e,n,i,o,c){if(zl=c,jn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Tp.current=t===null||t.memoizedState===null?oL:aL,t=n(i,o),Vh){c=0;do{if(Vh=!1,ad=0,25<=c)throw Error(Ge(301));c+=1,Ii=yi=null,e.updateQueue=null,Tp.current=lL,t=n(i,o)}while(Vh)}if(Tp.current=im,e=yi!==null&&yi.next!==null,zl=0,Ii=yi=jn=null,nm=!1,e)throw Error(Ge(300));return t}function yv(){var t=ad!==0;return ad=0,t}function ao(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ii===null?jn.memoizedState=Ii=t:Ii=Ii.next=t,Ii}function bs(){if(yi===null){var t=jn.alternate;t=t!==null?t.memoizedState:null}else t=yi.next;var e=Ii===null?jn.memoizedState:Ii.next;if(e!==null)Ii=e,yi=t;else{if(t===null)throw Error(Ge(310));yi=t,t={memoizedState:yi.memoizedState,baseState:yi.baseState,baseQueue:yi.baseQueue,queue:yi.queue,next:null},Ii===null?jn.memoizedState=Ii=t:Ii=Ii.next=t}return Ii}function ld(t,e){return typeof e=="function"?e(t):e}function S_(t){var e=bs(),n=e.queue;if(n===null)throw Error(Ge(311));n.lastRenderedReducer=t;var i=yi,o=i.baseQueue,c=n.pending;if(c!==null){if(o!==null){var d=o.next;o.next=c.next,c.next=d}i.baseQueue=o=c,n.pending=null}if(o!==null){c=o.next,i=i.baseState;var l=d=null,v=null,w=c;do{var C=w.lane;if((zl&C)===C)v!==null&&(v=v.next={lane:0,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null}),i=w.hasEagerState?w.eagerState:t(i,w.action);else{var L={lane:C,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null};v===null?(l=v=L,d=i):v=v.next=L,jn.lanes|=C,Ol|=C}w=w.next}while(w!==null&&w!==c);v===null?d=i:v.next=l,Us(i,e.memoizedState)||(Pr=!0),e.memoizedState=i,e.baseState=d,e.baseQueue=v,n.lastRenderedState=i}if(t=n.interleaved,t!==null){o=t;do c=o.lane,jn.lanes|=c,Ol|=c,o=o.next;while(o!==t)}else o===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function A_(t){var e=bs(),n=e.queue;if(n===null)throw Error(Ge(311));n.lastRenderedReducer=t;var i=n.dispatch,o=n.pending,c=e.memoizedState;if(o!==null){n.pending=null;var d=o=o.next;do c=t(c,d.action),d=d.next;while(d!==o);Us(c,e.memoizedState)||(Pr=!0),e.memoizedState=c,e.baseQueue===null&&(e.baseState=c),n.lastRenderedState=c}return[c,i]}function T2(){}function S2(t,e){var n=jn,i=bs(),o=e(),c=!Us(i.memoizedState,o);if(c&&(i.memoizedState=o,Pr=!0),i=i.queue,vv(I2.bind(null,n,i,t),[t]),i.getSnapshot!==e||c||Ii!==null&&Ii.memoizedState.tag&1){if(n.flags|=2048,cd(9,P2.bind(null,n,i,o,e),void 0,null),Mi===null)throw Error(Ge(349));zl&30||A2(n,e,o)}return o}function A2(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=jn.updateQueue,e===null?(e={lastEffect:null,stores:null},jn.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function P2(t,e,n,i){e.value=n,e.getSnapshot=i,C2(e)&&M2(t)}function I2(t,e,n){return n(function(){C2(e)&&M2(t)})}function C2(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Us(t,n)}catch{return!0}}function M2(t){var e=Go(t,1);e!==null&&Bs(e,t,1,-1)}function Ab(t){var e=ao();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ld,lastRenderedState:t},e.queue=t,t=t.dispatch=sL.bind(null,jn,t),[e.memoizedState,t]}function cd(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=jn.updateQueue,e===null?(e={lastEffect:null,stores:null},jn.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function L2(){return bs().memoizedState}function Sp(t,e,n,i){var o=ao();jn.flags|=t,o.memoizedState=cd(1|e,n,void 0,i===void 0?null:i)}function Fm(t,e,n,i){var o=bs();i=i===void 0?null:i;var c=void 0;if(yi!==null){var d=yi.memoizedState;if(c=d.destroy,i!==null&&gv(i,d.deps)){o.memoizedState=cd(e,n,c,i);return}}jn.flags|=t,o.memoizedState=cd(1|e,n,c,i)}function Pb(t,e){return Sp(8390656,8,t,e)}function vv(t,e){return Fm(2048,8,t,e)}function k2(t,e){return Fm(4,2,t,e)}function R2(t,e){return Fm(4,4,t,e)}function D2(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function z2(t,e,n){return n=n!=null?n.concat([t]):null,Fm(4,4,D2.bind(null,e,t),n)}function xv(){}function O2(t,e){var n=bs();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&gv(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function F2(t,e){var n=bs();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&gv(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function B2(t,e,n){return zl&21?(Us(n,e)||(n=VT(),jn.lanes|=n,Ol|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Pr=!0),t.memoizedState=n)}function iL(t,e){var n=pn;pn=n!==0&&4>n?n:4,t(!0);var i=T_.transition;T_.transition={};try{t(!1),e()}finally{pn=n,T_.transition=i}}function N2(){return bs().memoizedState}function rL(t,e,n){var i=Ba(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},U2(t))V2(e,n);else if(n=_2(t,e,n,i),n!==null){var o=gr();Bs(n,t,i,o),j2(n,e,i)}}function sL(t,e,n){var i=Ba(t),o={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(U2(t))V2(e,o);else{var c=t.alternate;if(t.lanes===0&&(c===null||c.lanes===0)&&(c=e.lastRenderedReducer,c!==null))try{var d=e.lastRenderedState,l=c(d,n);if(o.hasEagerState=!0,o.eagerState=l,Us(l,d)){var v=e.interleaved;v===null?(o.next=o,hv(e)):(o.next=v.next,v.next=o),e.interleaved=o;return}}catch{}finally{}n=_2(t,e,o,i),n!==null&&(o=gr(),Bs(n,t,i,o),j2(n,e,i))}}function U2(t){var e=t.alternate;return t===jn||e!==null&&e===jn}function V2(t,e){Vh=nm=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function j2(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,K0(t,n)}}var im={readContext:xs,useCallback:Yi,useContext:Yi,useEffect:Yi,useImperativeHandle:Yi,useInsertionEffect:Yi,useLayoutEffect:Yi,useMemo:Yi,useReducer:Yi,useRef:Yi,useState:Yi,useDebugValue:Yi,useDeferredValue:Yi,useTransition:Yi,useMutableSource:Yi,useSyncExternalStore:Yi,useId:Yi,unstable_isNewReconciler:!1},oL={readContext:xs,useCallback:function(t,e){return ao().memoizedState=[t,e===void 0?null:e],t},useContext:xs,useEffect:Pb,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Sp(4194308,4,D2.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Sp(4194308,4,t,e)},useInsertionEffect:function(t,e){return Sp(4,2,t,e)},useMemo:function(t,e){var n=ao();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=ao();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=rL.bind(null,jn,t),[i.memoizedState,t]},useRef:function(t){var e=ao();return t={current:t},e.memoizedState=t},useState:Ab,useDebugValue:xv,useDeferredValue:function(t){return ao().memoizedState=t},useTransition:function(){var t=Ab(!1),e=t[0];return t=iL.bind(null,t[1]),ao().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=jn,o=ao();if(Dn){if(n===void 0)throw Error(Ge(407));n=n()}else{if(n=e(),Mi===null)throw Error(Ge(349));zl&30||A2(i,e,n)}o.memoizedState=n;var c={value:n,getSnapshot:e};return o.queue=c,Pb(I2.bind(null,i,c,t),[t]),i.flags|=2048,cd(9,P2.bind(null,i,c,n,e),void 0,null),n},useId:function(){var t=ao(),e=Mi.identifierPrefix;if(Dn){var n=No,i=Bo;n=(i&~(1<<32-Fs(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=ad++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=nL++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},aL={readContext:xs,useCallback:O2,useContext:xs,useEffect:vv,useImperativeHandle:z2,useInsertionEffect:k2,useLayoutEffect:R2,useMemo:F2,useReducer:S_,useRef:L2,useState:function(){return S_(ld)},useDebugValue:xv,useDeferredValue:function(t){var e=bs();return B2(e,yi.memoizedState,t)},useTransition:function(){var t=S_(ld)[0],e=bs().memoizedState;return[t,e]},useMutableSource:T2,useSyncExternalStore:S2,useId:N2,unstable_isNewReconciler:!1},lL={readContext:xs,useCallback:O2,useContext:xs,useEffect:vv,useImperativeHandle:z2,useInsertionEffect:k2,useLayoutEffect:R2,useMemo:F2,useReducer:A_,useRef:L2,useState:function(){return A_(ld)},useDebugValue:xv,useDeferredValue:function(t){var e=bs();return yi===null?e.memoizedState=t:B2(e,yi.memoizedState,t)},useTransition:function(){var t=A_(ld)[0],e=bs().memoizedState;return[t,e]},useMutableSource:T2,useSyncExternalStore:S2,useId:N2,unstable_isNewReconciler:!1};function iu(t,e){try{var n="",i=e;do n+=OC(i),i=i.return;while(i);var o=n}catch(c){o=`
Error generating stack: `+c.message+`
`+c.stack}return{value:t,source:e,stack:o,digest:null}}function P_(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function $y(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var cL=typeof WeakMap=="function"?WeakMap:Map;function G2(t,e,n){n=Uo(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){sm||(sm=!0,e0=i),$y(t,e)},n}function $2(t,e,n){n=Uo(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var o=e.value;n.payload=function(){return i(o)},n.callback=function(){$y(t,e)}}var c=t.stateNode;return c!==null&&typeof c.componentDidCatch=="function"&&(n.callback=function(){$y(t,e),typeof i!="function"&&(Fa===null?Fa=new Set([this]):Fa.add(this));var d=e.stack;this.componentDidCatch(e.value,{componentStack:d!==null?d:""})}),n}function Ib(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new cL;var o=new Set;i.set(e,o)}else o=i.get(e),o===void 0&&(o=new Set,i.set(e,o));o.has(n)||(o.add(n),t=EL.bind(null,t,e,n),e.then(t,t))}function Cb(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Mb(t,e,n,i,o){return t.mode&1?(t.flags|=65536,t.lanes=o,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Uo(-1,1),e.tag=2,Oa(n,e,1))),n.lanes|=1),t)}var uL=Zo.ReactCurrentOwner,Pr=!1;function fr(t,e,n,i){e.child=t===null?w2(e,null,n,i):tu(e,t.child,n,i)}function Lb(t,e,n,i,o){n=n.render;var c=e.ref;return Zc(e,o),i=_v(t,e,n,i,c,o),n=yv(),t!==null&&!Pr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,$o(t,e,o)):(Dn&&n&&sv(e),e.flags|=1,fr(t,e,i,o),e.child)}function kb(t,e,n,i,o){if(t===null){var c=n.type;return typeof c=="function"&&!Iv(c)&&c.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=c,H2(t,e,c,i,o)):(t=Cp(n.type,null,i,e,e.mode,o),t.ref=e.ref,t.return=e,e.child=t)}if(c=t.child,!(t.lanes&o)){var d=c.memoizedProps;if(n=n.compare,n=n!==null?n:td,n(d,i)&&t.ref===e.ref)return $o(t,e,o)}return e.flags|=1,t=Na(c,i),t.ref=e.ref,t.return=e,e.child=t}function H2(t,e,n,i,o){if(t!==null){var c=t.memoizedProps;if(td(c,i)&&t.ref===e.ref)if(Pr=!1,e.pendingProps=i=c,(t.lanes&o)!==0)t.flags&131072&&(Pr=!0);else return e.lanes=t.lanes,$o(t,e,o)}return Hy(t,e,n,i,o)}function W2(t,e,n){var i=e.pendingProps,o=i.children,c=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},An(Uc,Wr),Wr|=n;else{if(!(n&1073741824))return t=c!==null?c.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,An(Uc,Wr),Wr|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=c!==null?c.baseLanes:n,An(Uc,Wr),Wr|=i}else c!==null?(i=c.baseLanes|n,e.memoizedState=null):i=n,An(Uc,Wr),Wr|=i;return fr(t,e,o,n),e.child}function q2(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Hy(t,e,n,i,o){var c=Cr(n)?Rl:tr.current;return c=Qc(e,c),Zc(e,o),n=_v(t,e,n,i,c,o),i=yv(),t!==null&&!Pr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,$o(t,e,o)):(Dn&&i&&sv(e),e.flags|=1,fr(t,e,n,o),e.child)}function Rb(t,e,n,i,o){if(Cr(n)){var c=!0;Xp(e)}else c=!1;if(Zc(e,o),e.stateNode===null)Ap(t,e),x2(e,n,i),Gy(e,n,i,o),i=!0;else if(t===null){var d=e.stateNode,l=e.memoizedProps;d.props=l;var v=d.context,w=n.contextType;typeof w=="object"&&w!==null?w=xs(w):(w=Cr(n)?Rl:tr.current,w=Qc(e,w));var C=n.getDerivedStateFromProps,L=typeof C=="function"||typeof d.getSnapshotBeforeUpdate=="function";L||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(l!==i||v!==w)&&Tb(e,d,i,w),Ta=!1;var P=e.memoizedState;d.state=P,em(e,i,d,o),v=e.memoizedState,l!==i||P!==v||Ir.current||Ta?(typeof C=="function"&&(jy(e,n,C,i),v=e.memoizedState),(l=Ta||Eb(e,n,l,i,P,v,w))?(L||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(e.flags|=4194308)):(typeof d.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=v),d.props=i,d.state=v,d.context=w,i=l):(typeof d.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{d=e.stateNode,y2(t,e),l=e.memoizedProps,w=e.type===e.elementType?l:ks(e.type,l),d.props=w,L=e.pendingProps,P=d.context,v=n.contextType,typeof v=="object"&&v!==null?v=xs(v):(v=Cr(n)?Rl:tr.current,v=Qc(e,v));var N=n.getDerivedStateFromProps;(C=typeof N=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(l!==L||P!==v)&&Tb(e,d,i,v),Ta=!1,P=e.memoizedState,d.state=P,em(e,i,d,o);var X=e.memoizedState;l!==L||P!==X||Ir.current||Ta?(typeof N=="function"&&(jy(e,n,N,i),X=e.memoizedState),(w=Ta||Eb(e,n,w,i,P,X,v)||!1)?(C||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(i,X,v),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(i,X,v)),typeof d.componentDidUpdate=="function"&&(e.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof d.componentDidUpdate!="function"||l===t.memoizedProps&&P===t.memoizedState||(e.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&P===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=X),d.props=i,d.state=X,d.context=v,i=w):(typeof d.componentDidUpdate!="function"||l===t.memoizedProps&&P===t.memoizedState||(e.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&P===t.memoizedState||(e.flags|=1024),i=!1)}return Wy(t,e,n,i,c,o)}function Wy(t,e,n,i,o,c){q2(t,e);var d=(e.flags&128)!==0;if(!i&&!d)return o&&yb(e,n,!1),$o(t,e,c);i=e.stateNode,uL.current=e;var l=d&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&d?(e.child=tu(e,t.child,null,c),e.child=tu(e,null,l,c)):fr(t,e,l,c),e.memoizedState=i.state,o&&yb(e,n,!0),e.child}function Z2(t){var e=t.stateNode;e.pendingContext?_b(t,e.pendingContext,e.pendingContext!==e.context):e.context&&_b(t,e.context,!1),fv(t,e.containerInfo)}function Db(t,e,n,i,o){return eu(),av(o),e.flags|=256,fr(t,e,n,i),e.child}var qy={dehydrated:null,treeContext:null,retryLane:0};function Zy(t){return{baseLanes:t,cachePool:null,transitions:null}}function X2(t,e,n){var i=e.pendingProps,o=Un.current,c=!1,d=(e.flags&128)!==0,l;if((l=d)||(l=t!==null&&t.memoizedState===null?!1:(o&2)!==0),l?(c=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(o|=1),An(Un,o&1),t===null)return Uy(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(d=i.children,t=i.fallback,c?(i=e.mode,c=e.child,d={mode:"hidden",children:d},!(i&1)&&c!==null?(c.childLanes=0,c.pendingProps=d):c=Um(d,i,0,null),t=Ll(t,i,n,null),c.return=e,t.return=e,c.sibling=t,e.child=c,e.child.memoizedState=Zy(n),e.memoizedState=qy,t):bv(e,d));if(o=t.memoizedState,o!==null&&(l=o.dehydrated,l!==null))return hL(t,e,d,i,l,o,n);if(c){c=i.fallback,d=e.mode,o=t.child,l=o.sibling;var v={mode:"hidden",children:i.children};return!(d&1)&&e.child!==o?(i=e.child,i.childLanes=0,i.pendingProps=v,e.deletions=null):(i=Na(o,v),i.subtreeFlags=o.subtreeFlags&14680064),l!==null?c=Na(l,c):(c=Ll(c,d,n,null),c.flags|=2),c.return=e,i.return=e,i.sibling=c,e.child=i,i=c,c=e.child,d=t.child.memoizedState,d=d===null?Zy(n):{baseLanes:d.baseLanes|n,cachePool:null,transitions:d.transitions},c.memoizedState=d,c.childLanes=t.childLanes&~n,e.memoizedState=qy,i}return c=t.child,t=c.sibling,i=Na(c,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function bv(t,e){return e=Um({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Kf(t,e,n,i){return i!==null&&av(i),tu(e,t.child,null,n),t=bv(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function hL(t,e,n,i,o,c,d){if(n)return e.flags&256?(e.flags&=-257,i=P_(Error(Ge(422))),Kf(t,e,d,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(c=i.fallback,o=e.mode,i=Um({mode:"visible",children:i.children},o,0,null),c=Ll(c,o,d,null),c.flags|=2,i.return=e,c.return=e,i.sibling=c,e.child=i,e.mode&1&&tu(e,t.child,null,d),e.child.memoizedState=Zy(d),e.memoizedState=qy,c);if(!(e.mode&1))return Kf(t,e,d,null);if(o.data==="$!"){if(i=o.nextSibling&&o.nextSibling.dataset,i)var l=i.dgst;return i=l,c=Error(Ge(419)),i=P_(c,i,void 0),Kf(t,e,d,i)}if(l=(d&t.childLanes)!==0,Pr||l){if(i=Mi,i!==null){switch(d&-d){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(i.suspendedLanes|d)?0:o,o!==0&&o!==c.retryLane&&(c.retryLane=o,Go(t,o),Bs(i,t,o,-1))}return Pv(),i=P_(Error(Ge(421))),Kf(t,e,d,i)}return o.data==="$?"?(e.flags|=128,e.child=t.child,e=TL.bind(null,t),o._reactRetry=e,null):(t=c.treeContext,Xr=za(o.nextSibling),Kr=e,Dn=!0,Ds=null,t!==null&&(ms[gs++]=Bo,ms[gs++]=No,ms[gs++]=Dl,Bo=t.id,No=t.overflow,Dl=e),e=bv(e,i.children),e.flags|=4096,e)}function zb(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Vy(t.return,e,n)}function I_(t,e,n,i,o){var c=t.memoizedState;c===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:o}:(c.isBackwards=e,c.rendering=null,c.renderingStartTime=0,c.last=i,c.tail=n,c.tailMode=o)}function Y2(t,e,n){var i=e.pendingProps,o=i.revealOrder,c=i.tail;if(fr(t,e,i.children,n),i=Un.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&zb(t,n,e);else if(t.tag===19)zb(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(An(Un,i),!(e.mode&1))e.memoizedState=null;else switch(o){case"forwards":for(n=e.child,o=null;n!==null;)t=n.alternate,t!==null&&tm(t)===null&&(o=n),n=n.sibling;n=o,n===null?(o=e.child,e.child=null):(o=n.sibling,n.sibling=null),I_(e,!1,o,n,c);break;case"backwards":for(n=null,o=e.child,e.child=null;o!==null;){if(t=o.alternate,t!==null&&tm(t)===null){e.child=o;break}t=o.sibling,o.sibling=n,n=o,o=t}I_(e,!0,n,null,c);break;case"together":I_(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ap(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function $o(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ol|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Ge(153));if(e.child!==null){for(t=e.child,n=Na(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Na(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function dL(t,e,n){switch(e.tag){case 3:Z2(e),eu();break;case 5:E2(e);break;case 1:Cr(e.type)&&Xp(e);break;case 4:fv(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,o=e.memoizedProps.value;An(Jp,i._currentValue),i._currentValue=o;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(An(Un,Un.current&1),e.flags|=128,null):n&e.child.childLanes?X2(t,e,n):(An(Un,Un.current&1),t=$o(t,e,n),t!==null?t.sibling:null);An(Un,Un.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return Y2(t,e,n);e.flags|=128}if(o=e.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),An(Un,Un.current),i)break;return null;case 22:case 23:return e.lanes=0,W2(t,e,n)}return $o(t,e,n)}var K2,Xy,J2,Q2;K2=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Xy=function(){};J2=function(t,e,n,i){var o=t.memoizedProps;if(o!==i){t=e.stateNode,Il(po.current);var c=null;switch(n){case"input":o=_y(t,o),i=_y(t,i),c=[];break;case"select":o=Gn({},o,{value:void 0}),i=Gn({},i,{value:void 0}),c=[];break;case"textarea":o=xy(t,o),i=xy(t,i),c=[];break;default:typeof o.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=qp)}wy(n,i);var d;n=null;for(w in o)if(!i.hasOwnProperty(w)&&o.hasOwnProperty(w)&&o[w]!=null)if(w==="style"){var l=o[w];for(d in l)l.hasOwnProperty(d)&&(n||(n={}),n[d]="")}else w!=="dangerouslySetInnerHTML"&&w!=="children"&&w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(Zh.hasOwnProperty(w)?c||(c=[]):(c=c||[]).push(w,null));for(w in i){var v=i[w];if(l=o!=null?o[w]:void 0,i.hasOwnProperty(w)&&v!==l&&(v!=null||l!=null))if(w==="style")if(l){for(d in l)!l.hasOwnProperty(d)||v&&v.hasOwnProperty(d)||(n||(n={}),n[d]="");for(d in v)v.hasOwnProperty(d)&&l[d]!==v[d]&&(n||(n={}),n[d]=v[d])}else n||(c||(c=[]),c.push(w,n)),n=v;else w==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,l=l?l.__html:void 0,v!=null&&l!==v&&(c=c||[]).push(w,v)):w==="children"?typeof v!="string"&&typeof v!="number"||(c=c||[]).push(w,""+v):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&(Zh.hasOwnProperty(w)?(v!=null&&w==="onScroll"&&In("scroll",t),c||l===v||(c=[])):(c=c||[]).push(w,v))}n&&(c=c||[]).push("style",n);var w=c;(e.updateQueue=w)&&(e.flags|=4)}};Q2=function(t,e,n,i){n!==i&&(e.flags|=4)};function xh(t,e){if(!Dn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Ki(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var o=t.child;o!==null;)n|=o.lanes|o.childLanes,i|=o.subtreeFlags&14680064,i|=o.flags&14680064,o.return=t,o=o.sibling;else for(o=t.child;o!==null;)n|=o.lanes|o.childLanes,i|=o.subtreeFlags,i|=o.flags,o.return=t,o=o.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function fL(t,e,n){var i=e.pendingProps;switch(ov(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ki(e),null;case 1:return Cr(e.type)&&Zp(),Ki(e),null;case 3:return i=e.stateNode,nu(),Mn(Ir),Mn(tr),mv(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(Xf(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ds!==null&&(i0(Ds),Ds=null))),Xy(t,e),Ki(e),null;case 5:pv(e);var o=Il(od.current);if(n=e.type,t!==null&&e.stateNode!=null)J2(t,e,n,i,o),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(Ge(166));return Ki(e),null}if(t=Il(po.current),Xf(e)){i=e.stateNode,n=e.type;var c=e.memoizedProps;switch(i[lo]=e,i[rd]=c,t=(e.mode&1)!==0,n){case"dialog":In("cancel",i),In("close",i);break;case"iframe":case"object":case"embed":In("load",i);break;case"video":case"audio":for(o=0;o<kh.length;o++)In(kh[o],i);break;case"source":In("error",i);break;case"img":case"image":case"link":In("error",i),In("load",i);break;case"details":In("toggle",i);break;case"input":$1(i,c),In("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!c.multiple},In("invalid",i);break;case"textarea":W1(i,c),In("invalid",i)}wy(n,c),o=null;for(var d in c)if(c.hasOwnProperty(d)){var l=c[d];d==="children"?typeof l=="string"?i.textContent!==l&&(c.suppressHydrationWarning!==!0&&Zf(i.textContent,l,t),o=["children",l]):typeof l=="number"&&i.textContent!==""+l&&(c.suppressHydrationWarning!==!0&&Zf(i.textContent,l,t),o=["children",""+l]):Zh.hasOwnProperty(d)&&l!=null&&d==="onScroll"&&In("scroll",i)}switch(n){case"input":Uf(i),H1(i,c,!0);break;case"textarea":Uf(i),q1(i);break;case"select":case"option":break;default:typeof c.onClick=="function"&&(i.onclick=qp)}i=o,e.updateQueue=i,i!==null&&(e.flags|=4)}else{d=o.nodeType===9?o:o.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=AT(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=d.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=d.createElement(n,{is:i.is}):(t=d.createElement(n),n==="select"&&(d=t,i.multiple?d.multiple=!0:i.size&&(d.size=i.size))):t=d.createElementNS(t,n),t[lo]=e,t[rd]=i,K2(t,e,!1,!1),e.stateNode=t;e:{switch(d=Ey(n,i),n){case"dialog":In("cancel",t),In("close",t),o=i;break;case"iframe":case"object":case"embed":In("load",t),o=i;break;case"video":case"audio":for(o=0;o<kh.length;o++)In(kh[o],t);o=i;break;case"source":In("error",t),o=i;break;case"img":case"image":case"link":In("error",t),In("load",t),o=i;break;case"details":In("toggle",t),o=i;break;case"input":$1(t,i),o=_y(t,i),In("invalid",t);break;case"option":o=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},o=Gn({},i,{value:void 0}),In("invalid",t);break;case"textarea":W1(t,i),o=xy(t,i),In("invalid",t);break;default:o=i}wy(n,o),l=o;for(c in l)if(l.hasOwnProperty(c)){var v=l[c];c==="style"?CT(t,v):c==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,v!=null&&PT(t,v)):c==="children"?typeof v=="string"?(n!=="textarea"||v!=="")&&Xh(t,v):typeof v=="number"&&Xh(t,""+v):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Zh.hasOwnProperty(c)?v!=null&&c==="onScroll"&&In("scroll",t):v!=null&&H0(t,c,v,d))}switch(n){case"input":Uf(t),H1(t,i,!1);break;case"textarea":Uf(t),q1(t);break;case"option":i.value!=null&&t.setAttribute("value",""+ja(i.value));break;case"select":t.multiple=!!i.multiple,c=i.value,c!=null?$c(t,!!i.multiple,c,!1):i.defaultValue!=null&&$c(t,!!i.multiple,i.defaultValue,!0);break;default:typeof o.onClick=="function"&&(t.onclick=qp)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ki(e),null;case 6:if(t&&e.stateNode!=null)Q2(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(Ge(166));if(n=Il(od.current),Il(po.current),Xf(e)){if(i=e.stateNode,n=e.memoizedProps,i[lo]=e,(c=i.nodeValue!==n)&&(t=Kr,t!==null))switch(t.tag){case 3:Zf(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Zf(i.nodeValue,n,(t.mode&1)!==0)}c&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[lo]=e,e.stateNode=i}return Ki(e),null;case 13:if(Mn(Un),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Dn&&Xr!==null&&e.mode&1&&!(e.flags&128))g2(),eu(),e.flags|=98560,c=!1;else if(c=Xf(e),i!==null&&i.dehydrated!==null){if(t===null){if(!c)throw Error(Ge(318));if(c=e.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(Ge(317));c[lo]=e}else eu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ki(e),c=!1}else Ds!==null&&(i0(Ds),Ds=null),c=!0;if(!c)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||Un.current&1?vi===0&&(vi=3):Pv())),e.updateQueue!==null&&(e.flags|=4),Ki(e),null);case 4:return nu(),Xy(t,e),t===null&&nd(e.stateNode.containerInfo),Ki(e),null;case 10:return uv(e.type._context),Ki(e),null;case 17:return Cr(e.type)&&Zp(),Ki(e),null;case 19:if(Mn(Un),c=e.memoizedState,c===null)return Ki(e),null;if(i=(e.flags&128)!==0,d=c.rendering,d===null)if(i)xh(c,!1);else{if(vi!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(d=tm(t),d!==null){for(e.flags|=128,xh(c,!1),i=d.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)c=n,t=i,c.flags&=14680066,d=c.alternate,d===null?(c.childLanes=0,c.lanes=t,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=d.childLanes,c.lanes=d.lanes,c.child=d.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=d.memoizedProps,c.memoizedState=d.memoizedState,c.updateQueue=d.updateQueue,c.type=d.type,t=d.dependencies,c.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return An(Un,Un.current&1|2),e.child}t=t.sibling}c.tail!==null&&ni()>ru&&(e.flags|=128,i=!0,xh(c,!1),e.lanes=4194304)}else{if(!i)if(t=tm(d),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),xh(c,!0),c.tail===null&&c.tailMode==="hidden"&&!d.alternate&&!Dn)return Ki(e),null}else 2*ni()-c.renderingStartTime>ru&&n!==1073741824&&(e.flags|=128,i=!0,xh(c,!1),e.lanes=4194304);c.isBackwards?(d.sibling=e.child,e.child=d):(n=c.last,n!==null?n.sibling=d:e.child=d,c.last=d)}return c.tail!==null?(e=c.tail,c.rendering=e,c.tail=e.sibling,c.renderingStartTime=ni(),e.sibling=null,n=Un.current,An(Un,i?n&1|2:n&1),e):(Ki(e),null);case 22:case 23:return Av(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Wr&1073741824&&(Ki(e),e.subtreeFlags&6&&(e.flags|=8192)):Ki(e),null;case 24:return null;case 25:return null}throw Error(Ge(156,e.tag))}function pL(t,e){switch(ov(e),e.tag){case 1:return Cr(e.type)&&Zp(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return nu(),Mn(Ir),Mn(tr),mv(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return pv(e),null;case 13:if(Mn(Un),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Ge(340));eu()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Mn(Un),null;case 4:return nu(),null;case 10:return uv(e.type._context),null;case 22:case 23:return Av(),null;case 24:return null;default:return null}}var Jf=!1,er=!1,mL=typeof WeakSet=="function"?WeakSet:Set,mt=null;function Nc(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){Xn(t,e,i)}else n.current=null}function Yy(t,e,n){try{n()}catch(i){Xn(t,e,i)}}var Ob=!1;function gL(t,e){if(Ry=$p,t=i2(),rv(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var o=i.anchorOffset,c=i.focusNode;i=i.focusOffset;try{n.nodeType,c.nodeType}catch{n=null;break e}var d=0,l=-1,v=-1,w=0,C=0,L=t,P=null;t:for(;;){for(var N;L!==n||o!==0&&L.nodeType!==3||(l=d+o),L!==c||i!==0&&L.nodeType!==3||(v=d+i),L.nodeType===3&&(d+=L.nodeValue.length),(N=L.firstChild)!==null;)P=L,L=N;for(;;){if(L===t)break t;if(P===n&&++w===o&&(l=d),P===c&&++C===i&&(v=d),(N=L.nextSibling)!==null)break;L=P,P=L.parentNode}L=N}n=l===-1||v===-1?null:{start:l,end:v}}else n=null}n=n||{start:0,end:0}}else n=null;for(Dy={focusedElem:t,selectionRange:n},$p=!1,mt=e;mt!==null;)if(e=mt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,mt=t;else for(;mt!==null;){e=mt;try{var X=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(X!==null){var ee=X.memoizedProps,me=X.memoizedState,Y=e.stateNode,W=Y.getSnapshotBeforeUpdate(e.elementType===e.type?ee:ks(e.type,ee),me);Y.__reactInternalSnapshotBeforeUpdate=W}break;case 3:var q=e.stateNode.containerInfo;q.nodeType===1?q.textContent="":q.nodeType===9&&q.documentElement&&q.removeChild(q.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ge(163))}}catch(oe){Xn(e,e.return,oe)}if(t=e.sibling,t!==null){t.return=e.return,mt=t;break}mt=e.return}return X=Ob,Ob=!1,X}function jh(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var o=i=i.next;do{if((o.tag&t)===t){var c=o.destroy;o.destroy=void 0,c!==void 0&&Yy(e,n,c)}o=o.next}while(o!==i)}}function Bm(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function Ky(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function eS(t){var e=t.alternate;e!==null&&(t.alternate=null,eS(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[lo],delete e[rd],delete e[Fy],delete e[JM],delete e[QM])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function tS(t){return t.tag===5||t.tag===3||t.tag===4}function Fb(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||tS(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Jy(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=qp));else if(i!==4&&(t=t.child,t!==null))for(Jy(t,e,n),t=t.sibling;t!==null;)Jy(t,e,n),t=t.sibling}function Qy(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(Qy(t,e,n),t=t.sibling;t!==null;)Qy(t,e,n),t=t.sibling}var Ni=null,Rs=!1;function _a(t,e,n){for(n=n.child;n!==null;)nS(t,e,n),n=n.sibling}function nS(t,e,n){if(fo&&typeof fo.onCommitFiberUnmount=="function")try{fo.onCommitFiberUnmount(Mm,n)}catch{}switch(n.tag){case 5:er||Nc(n,e);case 6:var i=Ni,o=Rs;Ni=null,_a(t,e,n),Ni=i,Rs=o,Ni!==null&&(Rs?(t=Ni,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ni.removeChild(n.stateNode));break;case 18:Ni!==null&&(Rs?(t=Ni,n=n.stateNode,t.nodeType===8?b_(t.parentNode,n):t.nodeType===1&&b_(t,n),Qh(t)):b_(Ni,n.stateNode));break;case 4:i=Ni,o=Rs,Ni=n.stateNode.containerInfo,Rs=!0,_a(t,e,n),Ni=i,Rs=o;break;case 0:case 11:case 14:case 15:if(!er&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){o=i=i.next;do{var c=o,d=c.destroy;c=c.tag,d!==void 0&&(c&2||c&4)&&Yy(n,e,d),o=o.next}while(o!==i)}_a(t,e,n);break;case 1:if(!er&&(Nc(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(l){Xn(n,e,l)}_a(t,e,n);break;case 21:_a(t,e,n);break;case 22:n.mode&1?(er=(i=er)||n.memoizedState!==null,_a(t,e,n),er=i):_a(t,e,n);break;default:_a(t,e,n)}}function Bb(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new mL),e.forEach(function(i){var o=SL.bind(null,t,i);n.has(i)||(n.add(i),i.then(o,o))})}}function Ls(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var o=n[i];try{var c=t,d=e,l=d;e:for(;l!==null;){switch(l.tag){case 5:Ni=l.stateNode,Rs=!1;break e;case 3:Ni=l.stateNode.containerInfo,Rs=!0;break e;case 4:Ni=l.stateNode.containerInfo,Rs=!0;break e}l=l.return}if(Ni===null)throw Error(Ge(160));nS(c,d,o),Ni=null,Rs=!1;var v=o.alternate;v!==null&&(v.return=null),o.return=null}catch(w){Xn(o,e,w)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)iS(e,t),e=e.sibling}function iS(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ls(e,t),io(t),i&4){try{jh(3,t,t.return),Bm(3,t)}catch(ee){Xn(t,t.return,ee)}try{jh(5,t,t.return)}catch(ee){Xn(t,t.return,ee)}}break;case 1:Ls(e,t),io(t),i&512&&n!==null&&Nc(n,n.return);break;case 5:if(Ls(e,t),io(t),i&512&&n!==null&&Nc(n,n.return),t.flags&32){var o=t.stateNode;try{Xh(o,"")}catch(ee){Xn(t,t.return,ee)}}if(i&4&&(o=t.stateNode,o!=null)){var c=t.memoizedProps,d=n!==null?n.memoizedProps:c,l=t.type,v=t.updateQueue;if(t.updateQueue=null,v!==null)try{l==="input"&&c.type==="radio"&&c.name!=null&&TT(o,c),Ey(l,d);var w=Ey(l,c);for(d=0;d<v.length;d+=2){var C=v[d],L=v[d+1];C==="style"?CT(o,L):C==="dangerouslySetInnerHTML"?PT(o,L):C==="children"?Xh(o,L):H0(o,C,L,w)}switch(l){case"input":yy(o,c);break;case"textarea":ST(o,c);break;case"select":var P=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!c.multiple;var N=c.value;N!=null?$c(o,!!c.multiple,N,!1):P!==!!c.multiple&&(c.defaultValue!=null?$c(o,!!c.multiple,c.defaultValue,!0):$c(o,!!c.multiple,c.multiple?[]:"",!1))}o[rd]=c}catch(ee){Xn(t,t.return,ee)}}break;case 6:if(Ls(e,t),io(t),i&4){if(t.stateNode===null)throw Error(Ge(162));o=t.stateNode,c=t.memoizedProps;try{o.nodeValue=c}catch(ee){Xn(t,t.return,ee)}}break;case 3:if(Ls(e,t),io(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Qh(e.containerInfo)}catch(ee){Xn(t,t.return,ee)}break;case 4:Ls(e,t),io(t);break;case 13:Ls(e,t),io(t),o=t.child,o.flags&8192&&(c=o.memoizedState!==null,o.stateNode.isHidden=c,!c||o.alternate!==null&&o.alternate.memoizedState!==null||(Tv=ni())),i&4&&Bb(t);break;case 22:if(C=n!==null&&n.memoizedState!==null,t.mode&1?(er=(w=er)||C,Ls(e,t),er=w):Ls(e,t),io(t),i&8192){if(w=t.memoizedState!==null,(t.stateNode.isHidden=w)&&!C&&t.mode&1)for(mt=t,C=t.child;C!==null;){for(L=mt=C;mt!==null;){switch(P=mt,N=P.child,P.tag){case 0:case 11:case 14:case 15:jh(4,P,P.return);break;case 1:Nc(P,P.return);var X=P.stateNode;if(typeof X.componentWillUnmount=="function"){i=P,n=P.return;try{e=i,X.props=e.memoizedProps,X.state=e.memoizedState,X.componentWillUnmount()}catch(ee){Xn(i,n,ee)}}break;case 5:Nc(P,P.return);break;case 22:if(P.memoizedState!==null){Ub(L);continue}}N!==null?(N.return=P,mt=N):Ub(L)}C=C.sibling}e:for(C=null,L=t;;){if(L.tag===5){if(C===null){C=L;try{o=L.stateNode,w?(c=o.style,typeof c.setProperty=="function"?c.setProperty("display","none","important"):c.display="none"):(l=L.stateNode,v=L.memoizedProps.style,d=v!=null&&v.hasOwnProperty("display")?v.display:null,l.style.display=IT("display",d))}catch(ee){Xn(t,t.return,ee)}}}else if(L.tag===6){if(C===null)try{L.stateNode.nodeValue=w?"":L.memoizedProps}catch(ee){Xn(t,t.return,ee)}}else if((L.tag!==22&&L.tag!==23||L.memoizedState===null||L===t)&&L.child!==null){L.child.return=L,L=L.child;continue}if(L===t)break e;for(;L.sibling===null;){if(L.return===null||L.return===t)break e;C===L&&(C=null),L=L.return}C===L&&(C=null),L.sibling.return=L.return,L=L.sibling}}break;case 19:Ls(e,t),io(t),i&4&&Bb(t);break;case 21:break;default:Ls(e,t),io(t)}}function io(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(tS(n)){var i=n;break e}n=n.return}throw Error(Ge(160))}switch(i.tag){case 5:var o=i.stateNode;i.flags&32&&(Xh(o,""),i.flags&=-33);var c=Fb(t);Qy(t,c,o);break;case 3:case 4:var d=i.stateNode.containerInfo,l=Fb(t);Jy(t,l,d);break;default:throw Error(Ge(161))}}catch(v){Xn(t,t.return,v)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function _L(t,e,n){mt=t,rS(t)}function rS(t,e,n){for(var i=(t.mode&1)!==0;mt!==null;){var o=mt,c=o.child;if(o.tag===22&&i){var d=o.memoizedState!==null||Jf;if(!d){var l=o.alternate,v=l!==null&&l.memoizedState!==null||er;l=Jf;var w=er;if(Jf=d,(er=v)&&!w)for(mt=o;mt!==null;)d=mt,v=d.child,d.tag===22&&d.memoizedState!==null?Vb(o):v!==null?(v.return=d,mt=v):Vb(o);for(;c!==null;)mt=c,rS(c),c=c.sibling;mt=o,Jf=l,er=w}Nb(t)}else o.subtreeFlags&8772&&c!==null?(c.return=o,mt=c):Nb(t)}}function Nb(t){for(;mt!==null;){var e=mt;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:er||Bm(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!er)if(n===null)i.componentDidMount();else{var o=e.elementType===e.type?n.memoizedProps:ks(e.type,n.memoizedProps);i.componentDidUpdate(o,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var c=e.updateQueue;c!==null&&wb(e,c,i);break;case 3:var d=e.updateQueue;if(d!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}wb(e,d,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var v=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":v.autoFocus&&n.focus();break;case"img":v.src&&(n.src=v.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var w=e.alternate;if(w!==null){var C=w.memoizedState;if(C!==null){var L=C.dehydrated;L!==null&&Qh(L)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ge(163))}er||e.flags&512&&Ky(e)}catch(P){Xn(e,e.return,P)}}if(e===t){mt=null;break}if(n=e.sibling,n!==null){n.return=e.return,mt=n;break}mt=e.return}}function Ub(t){for(;mt!==null;){var e=mt;if(e===t){mt=null;break}var n=e.sibling;if(n!==null){n.return=e.return,mt=n;break}mt=e.return}}function Vb(t){for(;mt!==null;){var e=mt;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Bm(4,e)}catch(v){Xn(e,n,v)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var o=e.return;try{i.componentDidMount()}catch(v){Xn(e,o,v)}}var c=e.return;try{Ky(e)}catch(v){Xn(e,c,v)}break;case 5:var d=e.return;try{Ky(e)}catch(v){Xn(e,d,v)}}}catch(v){Xn(e,e.return,v)}if(e===t){mt=null;break}var l=e.sibling;if(l!==null){l.return=e.return,mt=l;break}mt=e.return}}var yL=Math.ceil,rm=Zo.ReactCurrentDispatcher,wv=Zo.ReactCurrentOwner,ys=Zo.ReactCurrentBatchConfig,an=0,Mi=null,di=null,Ui=0,Wr=0,Uc=Wa(0),vi=0,ud=null,Ol=0,Nm=0,Ev=0,Gh=null,Ar=null,Tv=0,ru=1/0,Do=null,sm=!1,e0=null,Fa=null,Qf=!1,Ia=null,om=0,$h=0,t0=null,Pp=-1,Ip=0;function gr(){return an&6?ni():Pp!==-1?Pp:Pp=ni()}function Ba(t){return t.mode&1?an&2&&Ui!==0?Ui&-Ui:tL.transition!==null?(Ip===0&&(Ip=VT()),Ip):(t=pn,t!==0||(t=window.event,t=t===void 0?16:ZT(t.type)),t):1}function Bs(t,e,n,i){if(50<$h)throw $h=0,t0=null,Error(Ge(185));bd(t,n,i),(!(an&2)||t!==Mi)&&(t===Mi&&(!(an&2)&&(Nm|=n),vi===4&&Aa(t,Ui)),Mr(t,i),n===1&&an===0&&!(e.mode&1)&&(ru=ni()+500,zm&&qa()))}function Mr(t,e){var n=t.callbackNode;tM(t,e);var i=Gp(t,t===Mi?Ui:0);if(i===0)n!==null&&Y1(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&Y1(n),e===1)t.tag===0?eL(jb.bind(null,t)):f2(jb.bind(null,t)),YM(function(){!(an&6)&&qa()}),n=null;else{switch(jT(i)){case 1:n=Y0;break;case 4:n=NT;break;case 16:n=jp;break;case 536870912:n=UT;break;default:n=jp}n=dS(n,sS.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function sS(t,e){if(Pp=-1,Ip=0,an&6)throw Error(Ge(327));var n=t.callbackNode;if(Xc()&&t.callbackNode!==n)return null;var i=Gp(t,t===Mi?Ui:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=am(t,i);else{e=i;var o=an;an|=2;var c=aS();(Mi!==t||Ui!==e)&&(Do=null,ru=ni()+500,Ml(t,e));do try{bL();break}catch(l){oS(t,l)}while(1);cv(),rm.current=c,an=o,di!==null?e=0:(Mi=null,Ui=0,e=vi)}if(e!==0){if(e===2&&(o=Iy(t),o!==0&&(i=o,e=n0(t,o))),e===1)throw n=ud,Ml(t,0),Aa(t,i),Mr(t,ni()),n;if(e===6)Aa(t,i);else{if(o=t.current.alternate,!(i&30)&&!vL(o)&&(e=am(t,i),e===2&&(c=Iy(t),c!==0&&(i=c,e=n0(t,c))),e===1))throw n=ud,Ml(t,0),Aa(t,i),Mr(t,ni()),n;switch(t.finishedWork=o,t.finishedLanes=i,e){case 0:case 1:throw Error(Ge(345));case 2:Tl(t,Ar,Do);break;case 3:if(Aa(t,i),(i&130023424)===i&&(e=Tv+500-ni(),10<e)){if(Gp(t,0)!==0)break;if(o=t.suspendedLanes,(o&i)!==i){gr(),t.pingedLanes|=t.suspendedLanes&o;break}t.timeoutHandle=Oy(Tl.bind(null,t,Ar,Do),e);break}Tl(t,Ar,Do);break;case 4:if(Aa(t,i),(i&4194240)===i)break;for(e=t.eventTimes,o=-1;0<i;){var d=31-Fs(i);c=1<<d,d=e[d],d>o&&(o=d),i&=~c}if(i=o,i=ni()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*yL(i/1960))-i,10<i){t.timeoutHandle=Oy(Tl.bind(null,t,Ar,Do),i);break}Tl(t,Ar,Do);break;case 5:Tl(t,Ar,Do);break;default:throw Error(Ge(329))}}}return Mr(t,ni()),t.callbackNode===n?sS.bind(null,t):null}function n0(t,e){var n=Gh;return t.current.memoizedState.isDehydrated&&(Ml(t,e).flags|=256),t=am(t,e),t!==2&&(e=Ar,Ar=n,e!==null&&i0(e)),t}function i0(t){Ar===null?Ar=t:Ar.push.apply(Ar,t)}function vL(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var o=n[i],c=o.getSnapshot;o=o.value;try{if(!Us(c(),o))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Aa(t,e){for(e&=~Ev,e&=~Nm,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Fs(e),i=1<<n;t[n]=-1,e&=~i}}function jb(t){if(an&6)throw Error(Ge(327));Xc();var e=Gp(t,0);if(!(e&1))return Mr(t,ni()),null;var n=am(t,e);if(t.tag!==0&&n===2){var i=Iy(t);i!==0&&(e=i,n=n0(t,i))}if(n===1)throw n=ud,Ml(t,0),Aa(t,e),Mr(t,ni()),n;if(n===6)throw Error(Ge(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Tl(t,Ar,Do),Mr(t,ni()),null}function Sv(t,e){var n=an;an|=1;try{return t(e)}finally{an=n,an===0&&(ru=ni()+500,zm&&qa())}}function Fl(t){Ia!==null&&Ia.tag===0&&!(an&6)&&Xc();var e=an;an|=1;var n=ys.transition,i=pn;try{if(ys.transition=null,pn=1,t)return t()}finally{pn=i,ys.transition=n,an=e,!(an&6)&&qa()}}function Av(){Wr=Uc.current,Mn(Uc)}function Ml(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,XM(n)),di!==null)for(n=di.return;n!==null;){var i=n;switch(ov(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Zp();break;case 3:nu(),Mn(Ir),Mn(tr),mv();break;case 5:pv(i);break;case 4:nu();break;case 13:Mn(Un);break;case 19:Mn(Un);break;case 10:uv(i.type._context);break;case 22:case 23:Av()}n=n.return}if(Mi=t,di=t=Na(t.current,null),Ui=Wr=e,vi=0,ud=null,Ev=Nm=Ol=0,Ar=Gh=null,Pl!==null){for(e=0;e<Pl.length;e++)if(n=Pl[e],i=n.interleaved,i!==null){n.interleaved=null;var o=i.next,c=n.pending;if(c!==null){var d=c.next;c.next=o,i.next=d}n.pending=i}Pl=null}return t}function oS(t,e){do{var n=di;try{if(cv(),Tp.current=im,nm){for(var i=jn.memoizedState;i!==null;){var o=i.queue;o!==null&&(o.pending=null),i=i.next}nm=!1}if(zl=0,Ii=yi=jn=null,Vh=!1,ad=0,wv.current=null,n===null||n.return===null){vi=1,ud=e,di=null;break}e:{var c=t,d=n.return,l=n,v=e;if(e=Ui,l.flags|=32768,v!==null&&typeof v=="object"&&typeof v.then=="function"){var w=v,C=l,L=C.tag;if(!(C.mode&1)&&(L===0||L===11||L===15)){var P=C.alternate;P?(C.updateQueue=P.updateQueue,C.memoizedState=P.memoizedState,C.lanes=P.lanes):(C.updateQueue=null,C.memoizedState=null)}var N=Cb(d);if(N!==null){N.flags&=-257,Mb(N,d,l,c,e),N.mode&1&&Ib(c,w,e),e=N,v=w;var X=e.updateQueue;if(X===null){var ee=new Set;ee.add(v),e.updateQueue=ee}else X.add(v);break e}else{if(!(e&1)){Ib(c,w,e),Pv();break e}v=Error(Ge(426))}}else if(Dn&&l.mode&1){var me=Cb(d);if(me!==null){!(me.flags&65536)&&(me.flags|=256),Mb(me,d,l,c,e),av(iu(v,l));break e}}c=v=iu(v,l),vi!==4&&(vi=2),Gh===null?Gh=[c]:Gh.push(c),c=d;do{switch(c.tag){case 3:c.flags|=65536,e&=-e,c.lanes|=e;var Y=G2(c,v,e);bb(c,Y);break e;case 1:l=v;var W=c.type,q=c.stateNode;if(!(c.flags&128)&&(typeof W.getDerivedStateFromError=="function"||q!==null&&typeof q.componentDidCatch=="function"&&(Fa===null||!Fa.has(q)))){c.flags|=65536,e&=-e,c.lanes|=e;var oe=$2(c,l,e);bb(c,oe);break e}}c=c.return}while(c!==null)}cS(n)}catch(ye){e=ye,di===n&&n!==null&&(di=n=n.return);continue}break}while(1)}function aS(){var t=rm.current;return rm.current=im,t===null?im:t}function Pv(){(vi===0||vi===3||vi===2)&&(vi=4),Mi===null||!(Ol&268435455)&&!(Nm&268435455)||Aa(Mi,Ui)}function am(t,e){var n=an;an|=2;var i=aS();(Mi!==t||Ui!==e)&&(Do=null,Ml(t,e));do try{xL();break}catch(o){oS(t,o)}while(1);if(cv(),an=n,rm.current=i,di!==null)throw Error(Ge(261));return Mi=null,Ui=0,vi}function xL(){for(;di!==null;)lS(di)}function bL(){for(;di!==null&&!WC();)lS(di)}function lS(t){var e=hS(t.alternate,t,Wr);t.memoizedProps=t.pendingProps,e===null?cS(t):di=e,wv.current=null}function cS(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=pL(n,e),n!==null){n.flags&=32767,di=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{vi=6,di=null;return}}else if(n=fL(n,e,Wr),n!==null){di=n;return}if(e=e.sibling,e!==null){di=e;return}di=e=t}while(e!==null);vi===0&&(vi=5)}function Tl(t,e,n){var i=pn,o=ys.transition;try{ys.transition=null,pn=1,wL(t,e,n,i)}finally{ys.transition=o,pn=i}return null}function wL(t,e,n,i){do Xc();while(Ia!==null);if(an&6)throw Error(Ge(327));n=t.finishedWork;var o=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Ge(177));t.callbackNode=null,t.callbackPriority=0;var c=n.lanes|n.childLanes;if(nM(t,c),t===Mi&&(di=Mi=null,Ui=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Qf||(Qf=!0,dS(jp,function(){return Xc(),null})),c=(n.flags&15990)!==0,n.subtreeFlags&15990||c){c=ys.transition,ys.transition=null;var d=pn;pn=1;var l=an;an|=4,wv.current=null,gL(t,n),iS(n,t),jM(Dy),$p=!!Ry,Dy=Ry=null,t.current=n,_L(n),qC(),an=l,pn=d,ys.transition=c}else t.current=n;if(Qf&&(Qf=!1,Ia=t,om=o),c=t.pendingLanes,c===0&&(Fa=null),YC(n.stateNode),Mr(t,ni()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)o=e[n],i(o.value,{componentStack:o.stack,digest:o.digest});if(sm)throw sm=!1,t=e0,e0=null,t;return om&1&&t.tag!==0&&Xc(),c=t.pendingLanes,c&1?t===t0?$h++:($h=0,t0=t):$h=0,qa(),null}function Xc(){if(Ia!==null){var t=jT(om),e=ys.transition,n=pn;try{if(ys.transition=null,pn=16>t?16:t,Ia===null)var i=!1;else{if(t=Ia,Ia=null,om=0,an&6)throw Error(Ge(331));var o=an;for(an|=4,mt=t.current;mt!==null;){var c=mt,d=c.child;if(mt.flags&16){var l=c.deletions;if(l!==null){for(var v=0;v<l.length;v++){var w=l[v];for(mt=w;mt!==null;){var C=mt;switch(C.tag){case 0:case 11:case 15:jh(8,C,c)}var L=C.child;if(L!==null)L.return=C,mt=L;else for(;mt!==null;){C=mt;var P=C.sibling,N=C.return;if(eS(C),C===w){mt=null;break}if(P!==null){P.return=N,mt=P;break}mt=N}}}var X=c.alternate;if(X!==null){var ee=X.child;if(ee!==null){X.child=null;do{var me=ee.sibling;ee.sibling=null,ee=me}while(ee!==null)}}mt=c}}if(c.subtreeFlags&2064&&d!==null)d.return=c,mt=d;else e:for(;mt!==null;){if(c=mt,c.flags&2048)switch(c.tag){case 0:case 11:case 15:jh(9,c,c.return)}var Y=c.sibling;if(Y!==null){Y.return=c.return,mt=Y;break e}mt=c.return}}var W=t.current;for(mt=W;mt!==null;){d=mt;var q=d.child;if(d.subtreeFlags&2064&&q!==null)q.return=d,mt=q;else e:for(d=W;mt!==null;){if(l=mt,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Bm(9,l)}}catch(ye){Xn(l,l.return,ye)}if(l===d){mt=null;break e}var oe=l.sibling;if(oe!==null){oe.return=l.return,mt=oe;break e}mt=l.return}}if(an=o,qa(),fo&&typeof fo.onPostCommitFiberRoot=="function")try{fo.onPostCommitFiberRoot(Mm,t)}catch{}i=!0}return i}finally{pn=n,ys.transition=e}}return!1}function Gb(t,e,n){e=iu(n,e),e=G2(t,e,1),t=Oa(t,e,1),e=gr(),t!==null&&(bd(t,1,e),Mr(t,e))}function Xn(t,e,n){if(t.tag===3)Gb(t,t,n);else for(;e!==null;){if(e.tag===3){Gb(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Fa===null||!Fa.has(i))){t=iu(n,t),t=$2(e,t,1),e=Oa(e,t,1),t=gr(),e!==null&&(bd(e,1,t),Mr(e,t));break}}e=e.return}}function EL(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=gr(),t.pingedLanes|=t.suspendedLanes&n,Mi===t&&(Ui&n)===n&&(vi===4||vi===3&&(Ui&130023424)===Ui&&500>ni()-Tv?Ml(t,0):Ev|=n),Mr(t,e)}function uS(t,e){e===0&&(t.mode&1?(e=Gf,Gf<<=1,!(Gf&130023424)&&(Gf=4194304)):e=1);var n=gr();t=Go(t,e),t!==null&&(bd(t,e,n),Mr(t,n))}function TL(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),uS(t,n)}function SL(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,o=t.memoizedState;o!==null&&(n=o.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(Ge(314))}i!==null&&i.delete(e),uS(t,n)}var hS;hS=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ir.current)Pr=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Pr=!1,dL(t,e,n);Pr=!!(t.flags&131072)}else Pr=!1,Dn&&e.flags&1048576&&p2(e,Kp,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Ap(t,e),t=e.pendingProps;var o=Qc(e,tr.current);Zc(e,n),o=_v(null,e,i,t,o,n);var c=yv();return e.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Cr(i)?(c=!0,Xp(e)):c=!1,e.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,dv(e),o.updater=Om,e.stateNode=o,o._reactInternals=e,Gy(e,i,t,n),e=Wy(null,e,i,!0,c,n)):(e.tag=0,Dn&&c&&sv(e),fr(null,e,o,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Ap(t,e),t=e.pendingProps,o=i._init,i=o(i._payload),e.type=i,o=e.tag=PL(i),t=ks(i,t),o){case 0:e=Hy(null,e,i,t,n);break e;case 1:e=Rb(null,e,i,t,n);break e;case 11:e=Lb(null,e,i,t,n);break e;case 14:e=kb(null,e,i,ks(i.type,t),n);break e}throw Error(Ge(306,i,""))}return e;case 0:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:ks(i,o),Hy(t,e,i,o,n);case 1:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:ks(i,o),Rb(t,e,i,o,n);case 3:e:{if(Z2(e),t===null)throw Error(Ge(387));i=e.pendingProps,c=e.memoizedState,o=c.element,y2(t,e),em(e,i,null,n);var d=e.memoizedState;if(i=d.element,c.isDehydrated)if(c={element:i,isDehydrated:!1,cache:d.cache,pendingSuspenseBoundaries:d.pendingSuspenseBoundaries,transitions:d.transitions},e.updateQueue.baseState=c,e.memoizedState=c,e.flags&256){o=iu(Error(Ge(423)),e),e=Db(t,e,i,n,o);break e}else if(i!==o){o=iu(Error(Ge(424)),e),e=Db(t,e,i,n,o);break e}else for(Xr=za(e.stateNode.containerInfo.firstChild),Kr=e,Dn=!0,Ds=null,n=w2(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(eu(),i===o){e=$o(t,e,n);break e}fr(t,e,i,n)}e=e.child}return e;case 5:return E2(e),t===null&&Uy(e),i=e.type,o=e.pendingProps,c=t!==null?t.memoizedProps:null,d=o.children,zy(i,o)?d=null:c!==null&&zy(i,c)&&(e.flags|=32),q2(t,e),fr(t,e,d,n),e.child;case 6:return t===null&&Uy(e),null;case 13:return X2(t,e,n);case 4:return fv(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=tu(e,null,i,n):fr(t,e,i,n),e.child;case 11:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:ks(i,o),Lb(t,e,i,o,n);case 7:return fr(t,e,e.pendingProps,n),e.child;case 8:return fr(t,e,e.pendingProps.children,n),e.child;case 12:return fr(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,o=e.pendingProps,c=e.memoizedProps,d=o.value,An(Jp,i._currentValue),i._currentValue=d,c!==null)if(Us(c.value,d)){if(c.children===o.children&&!Ir.current){e=$o(t,e,n);break e}}else for(c=e.child,c!==null&&(c.return=e);c!==null;){var l=c.dependencies;if(l!==null){d=c.child;for(var v=l.firstContext;v!==null;){if(v.context===i){if(c.tag===1){v=Uo(-1,n&-n),v.tag=2;var w=c.updateQueue;if(w!==null){w=w.shared;var C=w.pending;C===null?v.next=v:(v.next=C.next,C.next=v),w.pending=v}}c.lanes|=n,v=c.alternate,v!==null&&(v.lanes|=n),Vy(c.return,n,e),l.lanes|=n;break}v=v.next}}else if(c.tag===10)d=c.type===e.type?null:c.child;else if(c.tag===18){if(d=c.return,d===null)throw Error(Ge(341));d.lanes|=n,l=d.alternate,l!==null&&(l.lanes|=n),Vy(d,n,e),d=c.sibling}else d=c.child;if(d!==null)d.return=c;else for(d=c;d!==null;){if(d===e){d=null;break}if(c=d.sibling,c!==null){c.return=d.return,d=c;break}d=d.return}c=d}fr(t,e,o.children,n),e=e.child}return e;case 9:return o=e.type,i=e.pendingProps.children,Zc(e,n),o=xs(o),i=i(o),e.flags|=1,fr(t,e,i,n),e.child;case 14:return i=e.type,o=ks(i,e.pendingProps),o=ks(i.type,o),kb(t,e,i,o,n);case 15:return H2(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:ks(i,o),Ap(t,e),e.tag=1,Cr(i)?(t=!0,Xp(e)):t=!1,Zc(e,n),x2(e,i,o),Gy(e,i,o,n),Wy(null,e,i,!0,t,n);case 19:return Y2(t,e,n);case 22:return W2(t,e,n)}throw Error(Ge(156,e.tag))};function dS(t,e){return BT(t,e)}function AL(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _s(t,e,n,i){return new AL(t,e,n,i)}function Iv(t){return t=t.prototype,!(!t||!t.isReactComponent)}function PL(t){if(typeof t=="function")return Iv(t)?1:0;if(t!=null){if(t=t.$$typeof,t===q0)return 11;if(t===Z0)return 14}return 2}function Na(t,e){var n=t.alternate;return n===null?(n=_s(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Cp(t,e,n,i,o,c){var d=2;if(i=t,typeof t=="function")Iv(t)&&(d=1);else if(typeof t=="string")d=5;else e:switch(t){case Mc:return Ll(n.children,o,c,e);case W0:d=8,o|=8;break;case fy:return t=_s(12,n,e,o|2),t.elementType=fy,t.lanes=c,t;case py:return t=_s(13,n,e,o),t.elementType=py,t.lanes=c,t;case my:return t=_s(19,n,e,o),t.elementType=my,t.lanes=c,t;case bT:return Um(n,o,c,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case vT:d=10;break e;case xT:d=9;break e;case q0:d=11;break e;case Z0:d=14;break e;case Ea:d=16,i=null;break e}throw Error(Ge(130,t==null?t:typeof t,""))}return e=_s(d,n,e,o),e.elementType=t,e.type=i,e.lanes=c,e}function Ll(t,e,n,i){return t=_s(7,t,i,e),t.lanes=n,t}function Um(t,e,n,i){return t=_s(22,t,i,e),t.elementType=bT,t.lanes=n,t.stateNode={isHidden:!1},t}function C_(t,e,n){return t=_s(6,t,null,e),t.lanes=n,t}function M_(t,e,n){return e=_s(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function IL(t,e,n,i,o){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=u_(0),this.expirationTimes=u_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=u_(0),this.identifierPrefix=i,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Cv(t,e,n,i,o,c,d,l,v){return t=new IL(t,e,n,l,v),e===1?(e=1,c===!0&&(e|=8)):e=0,c=_s(3,null,null,e),t.current=c,c.stateNode=t,c.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},dv(c),t}function CL(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Cc,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function fS(t){if(!t)return Ga;t=t._reactInternals;e:{if(Vl(t)!==t||t.tag!==1)throw Error(Ge(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Cr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ge(171))}if(t.tag===1){var n=t.type;if(Cr(n))return d2(t,n,e)}return e}function pS(t,e,n,i,o,c,d,l,v){return t=Cv(n,i,!0,t,o,c,d,l,v),t.context=fS(null),n=t.current,i=gr(),o=Ba(n),c=Uo(i,o),c.callback=e??null,Oa(n,c,o),t.current.lanes=o,bd(t,o,i),Mr(t,i),t}function Vm(t,e,n,i){var o=e.current,c=gr(),d=Ba(o);return n=fS(n),e.context===null?e.context=n:e.pendingContext=n,e=Uo(c,d),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Oa(o,e,d),t!==null&&(Bs(t,o,d,c),Ep(t,o,d)),d}function lm(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function $b(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Mv(t,e){$b(t,e),(t=t.alternate)&&$b(t,e)}function ML(){return null}var mS=typeof reportError=="function"?reportError:function(t){console.error(t)};function Lv(t){this._internalRoot=t}jm.prototype.render=Lv.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Ge(409));Vm(t,e,null,null)};jm.prototype.unmount=Lv.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Fl(function(){Vm(null,t,null,null)}),e[jo]=null}};function jm(t){this._internalRoot=t}jm.prototype.unstable_scheduleHydration=function(t){if(t){var e=HT();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Sa.length&&e!==0&&e<Sa[n].priority;n++);Sa.splice(n,0,t),n===0&&qT(t)}};function kv(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Gm(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Hb(){}function LL(t,e,n,i,o){if(o){if(typeof i=="function"){var c=i;i=function(){var w=lm(d);c.call(w)}}var d=pS(e,i,t,0,null,!1,!1,"",Hb);return t._reactRootContainer=d,t[jo]=d.current,nd(t.nodeType===8?t.parentNode:t),Fl(),d}for(;o=t.lastChild;)t.removeChild(o);if(typeof i=="function"){var l=i;i=function(){var w=lm(v);l.call(w)}}var v=Cv(t,0,!1,null,null,!1,!1,"",Hb);return t._reactRootContainer=v,t[jo]=v.current,nd(t.nodeType===8?t.parentNode:t),Fl(function(){Vm(e,v,n,i)}),v}function $m(t,e,n,i,o){var c=n._reactRootContainer;if(c){var d=c;if(typeof o=="function"){var l=o;o=function(){var v=lm(d);l.call(v)}}Vm(e,d,t,o)}else d=LL(n,e,t,o,i);return lm(d)}GT=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Lh(e.pendingLanes);n!==0&&(K0(e,n|1),Mr(e,ni()),!(an&6)&&(ru=ni()+500,qa()))}break;case 13:Fl(function(){var i=Go(t,1);if(i!==null){var o=gr();Bs(i,t,1,o)}}),Mv(t,1)}};J0=function(t){if(t.tag===13){var e=Go(t,134217728);if(e!==null){var n=gr();Bs(e,t,134217728,n)}Mv(t,134217728)}};$T=function(t){if(t.tag===13){var e=Ba(t),n=Go(t,e);if(n!==null){var i=gr();Bs(n,t,e,i)}Mv(t,e)}};HT=function(){return pn};WT=function(t,e){var n=pn;try{return pn=t,e()}finally{pn=n}};Sy=function(t,e,n){switch(e){case"input":if(yy(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var o=Dm(i);if(!o)throw Error(Ge(90));ET(i),yy(i,o)}}}break;case"textarea":ST(t,n);break;case"select":e=n.value,e!=null&&$c(t,!!n.multiple,e,!1)}};kT=Sv;RT=Fl;var kL={usingClientEntryPoint:!1,Events:[Ed,Dc,Dm,MT,LT,Sv]},bh={findFiberByHostInstance:Al,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},RL={bundleType:bh.bundleType,version:bh.version,rendererPackageName:bh.rendererPackageName,rendererConfig:bh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Zo.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=OT(t),t===null?null:t.stateNode},findFiberByHostInstance:bh.findFiberByHostInstance||ML,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ep=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ep.isDisabled&&ep.supportsFiber)try{Mm=ep.inject(RL),fo=ep}catch{}}es.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=kL;es.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!kv(e))throw Error(Ge(200));return CL(t,e,null,n)};es.createRoot=function(t,e){if(!kv(t))throw Error(Ge(299));var n=!1,i="",o=mS;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(o=e.onRecoverableError)),e=Cv(t,1,!1,null,null,n,!1,i,o),t[jo]=e.current,nd(t.nodeType===8?t.parentNode:t),new Lv(e)};es.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Ge(188)):(t=Object.keys(t).join(","),Error(Ge(268,t)));return t=OT(e),t=t===null?null:t.stateNode,t};es.flushSync=function(t){return Fl(t)};es.hydrate=function(t,e,n){if(!Gm(e))throw Error(Ge(200));return $m(null,t,e,!0,n)};es.hydrateRoot=function(t,e,n){if(!kv(t))throw Error(Ge(405));var i=n!=null&&n.hydratedSources||null,o=!1,c="",d=mS;if(n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(c=n.identifierPrefix),n.onRecoverableError!==void 0&&(d=n.onRecoverableError)),e=pS(e,null,t,1,n??null,o,!1,c,d),t[jo]=e.current,nd(t),i)for(t=0;t<i.length;t++)n=i[t],o=n._getVersion,o=o(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,o]:e.mutableSourceEagerHydrationData.push(n,o);return new jm(e)};es.render=function(t,e,n){if(!Gm(e))throw Error(Ge(200));return $m(null,t,e,!1,n)};es.unmountComponentAtNode=function(t){if(!Gm(t))throw Error(Ge(40));return t._reactRootContainer?(Fl(function(){$m(null,null,t,!1,function(){t._reactRootContainer=null,t[jo]=null})}),!0):!1};es.unstable_batchedUpdates=Sv;es.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Gm(n))throw Error(Ge(200));if(t==null||t._reactInternals===void 0)throw Error(Ge(38));return $m(t,e,n,!1,i)};es.version="18.2.0-next-9e3b772b8-20220608";function gS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(gS)}catch(t){console.error(t)}}gS(),pT.exports=es;var Rv=pT.exports,_S,Wb=Rv;_S=Wb.createRoot,Wb.hydrateRoot;const DL="modulepreload",zL=function(t){return"/"+t},qb={},OL=function(e,n,i){if(!n||n.length===0)return e();const o=document.getElementsByTagName("link");return Promise.all(n.map(c=>{if(c=zL(c),c in qb)return;qb[c]=!0;const d=c.endsWith(".css"),l=d?'[rel="stylesheet"]':"";if(!!i)for(let C=o.length-1;C>=0;C--){const L=o[C];if(L.href===c&&(!d||L.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${l}`))return;const w=document.createElement("link");if(w.rel=d?"stylesheet":DL,d||(w.as="script",w.crossOrigin=""),w.href=c,document.head.appendChild(w),d)return new Promise((C,L)=>{w.addEventListener("load",C),w.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${c}`)))})})).then(()=>e()).catch(c=>{const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=c,window.dispatchEvent(d),!d.defaultPrevented)throw c})},FL=ot.createContext(null);function BL(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,o=Array.isArray(e)?e[0]:e?e.x:0,c=Array.isArray(e)?e[1]:e?e.y:0;return n===o&&i===c}function Oo(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Oo(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const o of n)if(!e.hasOwnProperty(o)||!Oo(t[o],e[o]))return!1;return!0}return!1}function NL(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function Zb(t,e){if(!t.getProjection)return;const n=t.getProjection(),i=e.getProjection();Oo(n,i)||e.setProjection(n)}function Xb(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function Yb(t,e){const n=e.viewState||e;let i=!1;if("longitude"in n&&"latitude"in n){const o=t.center;t.center=new o.constructor(n.longitude,n.latitude),i=i||o!==t.center}if("zoom"in n){const o=t.zoom;t.zoom=n.zoom,i=i||o!==t.zoom}if("bearing"in n){const o=t.bearing;t.bearing=n.bearing,i=i||o!==t.bearing}if("pitch"in n){const o=t.pitch;t.pitch=n.pitch,i=i||o!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),i}const UL=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Kb(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map(i=>{let o=null;"interactive"in i&&(o=Object.assign({},i),delete o.interactive);const c=e[i.ref];if(c){o=o||Object.assign({},i),delete o.ref;for(const d of UL)d in c&&(o[d]=c[d])}return o||i});return{...t,layers:n}}const Jb={version:8,sources:{},layers:[]},Qb={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},L_={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},ew={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},VL=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],jL=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class su{constructor(e,n,i){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=o=>{const c=this.props[ew[o.type]];c?c(o):o.type==="error"&&console.error(o.error)},this._onPointerEvent=o=>{(o.type==="mousemove"||o.type==="mouseout")&&this._updateHover(o);const c=this.props[Qb[o.type]];c&&(this.props.interactiveLayerIds&&o.type!=="mouseover"&&o.type!=="mouseout"&&(o.features=this._hoveredFeatures||this._queryRenderedFeatures(o.point)),c(o),delete o.features)},this._onCameraEvent=o=>{if(!this._internalUpdate){const c=this.props[L_[o.type]];c&&c(o)}o.type in this._deferredEvents&&(this._deferredEvents[o.type]=!1)},this._MapClass=e,this.props=n,this._initialize(i)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const i=this._updateSettings(e,n);i&&this._createShadowTransform(this._map);const o=this._updateSize(e),c=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(i||o||c&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const i=su.savedMaps.pop();if(!i)return null;const o=i.map,c=o.getContainer();for(n.className=c.className;c.childNodes.length>0;)n.appendChild(c.childNodes[0]);o._container=n;const d=o._resizeObserver;d&&(d.disconnect(),d.observe(n)),i.setProps({...e,styleDiffing:!1}),o.resize();const{initialViewState:l}=e;return l&&(l.bounds?o.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):i._updateViewState(l,!1)),o.isStyleLoaded()?o.fire("load"):o.once("styledata",()=>o.fire("load")),o._update(),i}_initialize(e){const{props:n}=this,{mapStyle:i=Jb}=n,o={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||GL()||null,container:e,style:Kb(i)},c=o.initialViewState||o.viewState||o;if(Object.assign(o,{center:[c.longitude||0,c.latitude||0],zoom:c.zoom||0,pitch:c.pitch||0,bearing:c.bearing||0}),n.gl){const C=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=C,n.gl)}const d=new this._MapClass(o);c.padding&&d.setPadding(c.padding),n.cursor&&(d.getCanvas().style.cursor=n.cursor),this._createShadowTransform(d);const l=d._render;d._render=C=>{this._inRender=!0,l.call(d,C),this._inRender=!1};const v=d._renderTaskQueue.run;d._renderTaskQueue.run=C=>{v.call(d._renderTaskQueue,C),this._onBeforeRepaint()},d.on("render",()=>this._onAfterRepaint());const w=d.fire;d.fire=this._fireEvent.bind(this,w),d.on("resize",()=>{this._renderTransform.resize(d.transform.width,d.transform.height)}),d.on("styledata",()=>{this._updateStyleComponents(this.props,{}),Zb(d.transform,this._renderTransform)}),d.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const C in Qb)d.on(C,this._onPointerEvent);for(const C in L_)d.on(C,this._onCameraEvent);for(const C in ew)d.on(C,this._onEvent);this._map=d}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),su.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=NL(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const i=this._map;if(n.width!==i.transform.width||n.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const i=this._map,o=this._renderTransform,{zoom:c,pitch:d,bearing:l}=o,v=i.isMoving();v&&(o.cameraElevationReference="sea");const w=Yb(o,{...Xb(i.transform),...e});if(v&&(o.cameraElevationReference="ground"),w&&n){const C=this._deferredEvents;C.move=!0,C.zoom||(C.zoom=c!==o.zoom),C.rotate||(C.rotate=l!==o.bearing),C.pitch||(C.pitch=d!==o.pitch)}return v||Yb(i.transform,e),w}_updateSettings(e,n){const i=this._map;let o=!1;for(const c of VL)if(c in e&&!Oo(e[c],n[c])){o=!0;const d=i[`set${c[0].toUpperCase()}${c.slice(1)}`];d==null||d.call(i,e[c])}return o}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:i=Jb,styleDiffing:o=!0}=e,c={diff:o};return"localIdeographFontFamily"in e&&(c.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(Kb(i),c),!0}return!1}_updateStyleComponents(e,n){const i=this._map;let o=!1;return i.isStyleLoaded()&&("light"in e&&i.setLight&&!Oo(e.light,n.light)&&(o=!0,i.setLight(e.light)),"fog"in e&&i.setFog&&!Oo(e.fog,n.fog)&&(o=!0,i.setFog(e.fog)),"terrain"in e&&i.setTerrain&&!Oo(e.terrain,n.terrain)&&(!e.terrain||i.getSource(e.terrain.source))&&(o=!0,i.setTerrain(e.terrain))),o}_updateHandlers(e,n){var i,o;const c=this._map;let d=!1;for(const l of jL){const v=(i=e[l])!==null&&i!==void 0?i:!0,w=(o=n[l])!==null&&o!==void 0?o:!0;Oo(v,w)||(d=!0,v?c[l].enable(v):c[l].disable())}return d}_queryRenderedFeatures(e){const n=this._map,i=n.transform,{interactiveLayerIds:o=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:o.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=i}}_updateHover(e){var n;const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const c=e.type,d=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,l=this._queryRenderedFeatures(e.point),v=l.length>0;!v&&d&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=l,v&&!d&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=c}else this._hoveredFeatures=null}_fireEvent(e,n,i){const o=this._map,c=o.transform,d=typeof n=="string"?n:n.type;return d==="move"&&this._updateViewState(this.props,!1),d in L_&&(typeof n=="object"&&(n.viewState=Xb(c)),this._map.isMoving())?(o.transform=this._renderTransform,e.call(o,n,i),o.transform=c,o):(e.call(o,n,i),o)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const i in this._deferredEvents)this._deferredEvents[i]&&e.fire(i);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{Zb(this._renderTransform,n),e.transform=n}}}su.savedMaps=[];function GL(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const $L=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function HL(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:i=>{const o=e.transform;e.transform=t.transform;const c=e.project(i);return e.transform=o,c},unproject:i=>{const o=e.transform;e.transform=t.transform;const c=e.unproject(i);return e.transform=o,c},queryTerrainElevation:(i,o)=>{const c=e.transform;e.transform=t.transform;const d=e.queryTerrainElevation(i,o);return e.transform=c,d},queryRenderedFeatures:(i,o)=>{const c=e.transform;e.transform=t.transform;const d=e.queryRenderedFeatures(i,o);return e.transform=c,d}};for(const i of WL(e))!(i in n)&&!$L.includes(i)&&(n[i]=e[i].bind(e));return n}function WL(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))i[0]!=="_"&&typeof t[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}const qL=typeof document<"u"?ot.useLayoutEffect:ot.useEffect,ZL=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function XL(t,e){for(const i of ZL)i in e&&(t[i]=e[i]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,i=>{i&&console.error(i)},!1)}const Hm=ot.createContext(null);function YL(t,e,n){const i=ot.useContext(FL),[o,c]=ot.useState(null),d=ot.useRef(),{current:l}=ot.useRef({mapLib:null,map:null});ot.useEffect(()=>{const C=t.mapLib;let L=!0,P;return Promise.resolve(C||n).then(N=>{if(!L)return;if(!N)throw new Error("Invalid mapLib");const X="Map"in N?N:N.default;if(!X.Map)throw new Error("Invalid mapLib");if(XL(X,t),!X.supported||X.supported(t))t.reuseMaps&&(P=su.reuse(t,d.current)),P||(P=new su(X.Map,t,d.current)),l.map=HL(P),l.mapLib=X,c(P),i==null||i.onMapMount(l.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(N=>{const{onError:X}=t;X?X({type:"error",target:null,originalEvent:null,error:N}):console.error(N)}),()=>{L=!1,P&&(i==null||i.onMapUnmount(t.id),t.reuseMaps?P.recycle():P.destroy())}},[]),qL(()=>{o&&o.setProps(t)}),ot.useImperativeHandle(e,()=>l.map,[o]);const v=ot.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),w={height:"100%"};return ot.createElement("div",{id:t.id,ref:d,style:v},o&&ot.createElement(Hm.Provider,{value:l},ot.createElement("div",{"mapboxgl-children":"",style:w},t.children)))}const KL=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function jl(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const o=e[i];Number.isFinite(o)&&!KL.test(i)?n[i]=`${o}px`:n[i]=o}}function JL(t,e){const{map:n,mapLib:i}=ot.useContext(Hm),o=ot.useRef({props:t});o.current.props=t;const c=ot.useMemo(()=>{let ee=!1;ot.Children.forEach(t.children,W=>{W&&(ee=!0)});const me={...t,element:ee?document.createElement("div"):null},Y=new i.Marker(me);return Y.setLngLat([t.longitude,t.latitude]),Y.getElement().addEventListener("click",W=>{var q,oe;(oe=(q=o.current.props).onClick)===null||oe===void 0||oe.call(q,{type:"click",target:Y,originalEvent:W})}),Y.on("dragstart",W=>{var q,oe;const ye=W;ye.lngLat=c.getLngLat(),(oe=(q=o.current.props).onDragStart)===null||oe===void 0||oe.call(q,ye)}),Y.on("drag",W=>{var q,oe;const ye=W;ye.lngLat=c.getLngLat(),(oe=(q=o.current.props).onDrag)===null||oe===void 0||oe.call(q,ye)}),Y.on("dragend",W=>{var q,oe;const ye=W;ye.lngLat=c.getLngLat(),(oe=(q=o.current.props).onDragEnd)===null||oe===void 0||oe.call(q,ye)}),Y},[]);ot.useEffect(()=>(c.addTo(n.getMap()),()=>{c.remove()}),[]);const{longitude:d,latitude:l,offset:v,style:w,draggable:C=!1,popup:L=null,rotation:P=0,rotationAlignment:N="auto",pitchAlignment:X="auto"}=t;return ot.useEffect(()=>{jl(c.getElement(),w)},[w]),ot.useImperativeHandle(e,()=>c,[]),(c.getLngLat().lng!==d||c.getLngLat().lat!==l)&&c.setLngLat([d,l]),v&&!BL(c.getOffset(),v)&&c.setOffset(v),c.isDraggable()!==C&&c.setDraggable(C),c.getRotation()!==P&&c.setRotation(P),c.getRotationAlignment()!==N&&c.setRotationAlignment(N),c.getPitchAlignment()!==X&&c.setPitchAlignment(X),c.getPopup()!==L&&c.setPopup(L),Rv.createPortal(t.children,c.getElement())}ot.memo(ot.forwardRef(JL));function tw(t){return new Set(t?t.trim().split(/\s+/):[])}function QL(t,e){const{map:n,mapLib:i}=ot.useContext(Hm),o=ot.useMemo(()=>document.createElement("div"),[]),c=ot.useRef({props:t});c.current.props=t;const d=ot.useMemo(()=>{const l={...t},v=new i.Popup(l);return v.setLngLat([t.longitude,t.latitude]),v.once("open",w=>{var C,L;(L=(C=c.current.props).onOpen)===null||L===void 0||L.call(C,w)}),v},[]);if(ot.useEffect(()=>{const l=v=>{var w,C;(C=(w=c.current.props).onClose)===null||C===void 0||C.call(w,v)};return d.on("close",l),d.setDOMContent(o).addTo(n.getMap()),()=>{d.off("close",l),d.isOpen()&&d.remove()}},[]),ot.useEffect(()=>{jl(d.getElement(),t.style)},[t.style]),ot.useImperativeHandle(e,()=>d,[]),d.isOpen()&&((d.getLngLat().lng!==t.longitude||d.getLngLat().lat!==t.latitude)&&d.setLngLat([t.longitude,t.latitude]),t.offset&&!Oo(d.options.offset,t.offset)&&d.setOffset(t.offset),(d.options.anchor!==t.anchor||d.options.maxWidth!==t.maxWidth)&&(d.options.anchor=t.anchor,d.setMaxWidth(t.maxWidth)),d.options.className!==t.className)){const l=tw(d.options.className),v=tw(t.className);for(const w of l)v.has(w)||d.removeClassName(w);for(const w of v)l.has(w)||d.addClassName(w);d.options.className=t.className}return Rv.createPortal(t.children,o)}ot.memo(ot.forwardRef(QL));function Sd(t,e,n,i){const o=ot.useContext(Hm),c=ot.useMemo(()=>t(o),[]);return ot.useEffect(()=>{const d=i||n||e,l=typeof e=="function"&&typeof n=="function"?e:null,v=typeof n=="function"?n:typeof e=="function"?e:null,{map:w}=o;return w.hasControl(c)||(w.addControl(c,d==null?void 0:d.position),l&&l(o)),()=>{v&&v(o),w.hasControl(c)&&w.removeControl(c)}},[]),c}function ek(t){const e=Sd(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return ot.useEffect(()=>{jl(e._container,t.style)},[t.style]),null}ot.memo(ek);function tk(t){const e=Sd(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return ot.useEffect(()=>{jl(e._controlContainer,t.style)},[t.style]),null}ot.memo(tk);function nk(t,e){const n=ot.useRef({props:t}),i=Sd(({mapLib:o})=>{const c=new o.GeolocateControl(t),d=c._setupUI;return c._setupUI=l=>{c._container.hasChildNodes()||d(l)},c.on("geolocate",l=>{var v,w;(w=(v=n.current.props).onGeolocate)===null||w===void 0||w.call(v,l)}),c.on("error",l=>{var v,w;(w=(v=n.current.props).onError)===null||w===void 0||w.call(v,l)}),c.on("outofmaxbounds",l=>{var v,w;(w=(v=n.current.props).onOutOfMaxBounds)===null||w===void 0||w.call(v,l)}),c.on("trackuserlocationstart",l=>{var v,w;(w=(v=n.current.props).onTrackUserLocationStart)===null||w===void 0||w.call(v,l)}),c.on("trackuserlocationend",l=>{var v,w;(w=(v=n.current.props).onTrackUserLocationEnd)===null||w===void 0||w.call(v,l)}),c},{position:t.position});return n.current.props=t,ot.useImperativeHandle(e,()=>i,[]),ot.useEffect(()=>{jl(i._container,t.style)},[t.style]),null}ot.memo(ot.forwardRef(nk));function ik(t){const e=Sd(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return ot.useEffect(()=>{jl(e._container,t.style)},[t.style]),null}ot.memo(ik);function rk(t){const e=Sd(({mapLib:c})=>new c.ScaleControl(t),{position:t.position}),n=ot.useRef(t),i=n.current;n.current=t;const{style:o}=t;return t.maxWidth!==void 0&&t.maxWidth!==i.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==i.unit&&e.setUnit(t.unit),ot.useEffect(()=>{jl(e._container,o)},[o]),null}ot.memo(rk);const sk=OL(()=>import("./__vite-optional-peer-dep_mapbox-gl_react-map-gl-b25bb000.js"),[]),ok=(()=>ot.forwardRef(function(e,n){return YL(e,n,sk)}))();var yS={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(mC,function(){var n,i,o;function c(l,v){if(!n)n=v;else if(!i)i=v;else{var w="var sharedChunk = {}; ("+n+")(sharedChunk); ("+i+")(sharedChunk);",C={};n(C),o=v(C),typeof window<"u"&&(o.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}c(["exports"],function(l){var v=w;function w(a,r,u,f){this.cx=3*a,this.bx=3*(u-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(f-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=r,this.p2x=u,this.p2y=f}function C(a,r,u,f){const g=new v(a,r,u,f);return function(y){return g.solve(y)}}w.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,r){if(r===void 0&&(r=1e-6),a<0)return 0;if(a>1)return 1;for(var u=a,f=0;f<8;f++){var g=this.sampleCurveX(u)-a;if(Math.abs(g)<r)return u;var y=this.sampleCurveDerivativeX(u);if(Math.abs(y)<1e-6)break;u-=g/y}var b=0,T=1;for(u=a,f=0;f<20&&(g=this.sampleCurveX(u),!(Math.abs(g-a)<r));f++)a>g?b=u:T=u,u=.5*(T-b)+b;return u},solve:function(a,r){return this.sampleCurveY(this.solveCurveX(a,r))}};const L=C(.25,.1,.25,1);function P(a,r,u){return Math.min(u,Math.max(r,a))}function N(a,r,u){const f=u-r,g=((a-r)%f+f)%f+r;return g===r?u:g}function X(a,...r){for(const u of r)for(const f in u)a[f]=u[f];return a}let ee=1;function me(a,r){a.forEach(u=>{r[u]&&(r[u]=r[u].bind(r))})}function Y(a,r,u){const f={};for(const g in a)f[g]=r.call(u||this,a[g],g,a);return f}function W(a,r,u){const f={};for(const g in a)r.call(u||this,a[g],g,a)&&(f[g]=a[g]);return f}function q(a){return Array.isArray(a)?a.map(q):typeof a=="object"&&a?Y(a,q):a}const oe={};function ye(a){oe[a]||(typeof console<"u"&&console.warn(a),oe[a]=!0)}function Se(a,r,u){return(u.y-a.y)*(r.x-a.x)>(r.y-a.y)*(u.x-a.x)}function Oe(a){let r=0;for(let u,f,g=0,y=a.length,b=y-1;g<y;b=g++)u=a[g],f=a[b],r+=(f.x-u.x)*(u.y+f.y);return r}function Fe(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ve(a){const r={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,f,g,y)=>{const b=g||y;return r[f]=!b||b.toLowerCase(),""}),r["max-age"]){const u=parseInt(r["max-age"],10);isNaN(u)?delete r["max-age"]:r["max-age"]=u}return r}let je,ut,Gt=null;function Yt(a){if(Gt==null){const r=a.navigator?a.navigator.userAgent:null;Gt=!!a.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Gt}function Mt(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const zn={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(a){const r=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(a,r=0){const u=window.document.createElement("canvas"),f=u.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return u.width=a.width,u.height=a.height,f.drawImage(a,0,0,a.width,a.height),f.getImageData(-r,-r,a.width+2*r,a.height+2*r)},resolveURL:a=>(je||(je=document.createElement("a")),je.href=a,je.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ut==null&&(ut=matchMedia("(prefers-reduced-motion: reduce)")),ut.matches)}};var vt=ii;function ii(a,r){this.x=a,this.y=r}ii.prototype={clone:function(){return new ii(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,r){return this.clone()._rotateAround(a,r)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var r=a.x-this.x,u=a.y-this.y;return r*r+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,r){return Math.atan2(this.x*r-this.y*a,this.x*a+this.y*r)},_matMult:function(a){var r=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=r,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var r=Math.cos(a),u=Math.sin(a),f=u*this.x+r*this.y;return this.x=r*this.x-u*this.y,this.y=f,this},_rotateAround:function(a,r){var u=Math.cos(a),f=Math.sin(a),g=r.y+f*(this.x-r.x)+u*(this.y-r.y);return this.x=r.x+u*(this.x-r.x)-f*(this.y-r.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ii.convert=function(a){return a instanceof ii?a:Array.isArray(a)?new ii(a[0],a[1]):a};const tt={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},wt="mapbox-tiles";let St,nn,rn=500,nr=50;function ri(){typeof caches>"u"||St||(St=caches.open(wt))}let bi=1/0;const si={supported:!1,testSupport:function(a){!Wt&&wi&&(On?ns(a):cn=a)}};let cn,wi,Wt=!1,On=!1;function ns(a){const r=a.createTexture();a.bindTexture(a.TEXTURE_2D,r);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,wi),a.isContextLost())return;si.supported=!0}catch{}a.deleteTexture(r),Wt=!0}typeof document<"u"&&(wi=document.createElement("img"),wi.onload=function(){cn&&ns(cn),cn=null,On=!0},wi.onerror=function(){Wt=!0,cn=null},wi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Li={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Li);class Yn extends Error{constructor(r,u,f,g){super(`AJAXError: ${u} (${r}): ${f}`),this.status=r,this.statusText=u,this.url=f,this.body=g}}const Lr=Fe()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function ji(a,r){const u=new AbortController,f=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Lr(),signal:u.signal});let g=!1,y=!1;return a.type==="json"&&f.headers.set("Accept","application/json"),((b,T,S)=>{if(y)return;const M=Date.now();fetch(f).then(D=>D.ok?((O,U,$)=>{(a.type==="arrayBuffer"?O.arrayBuffer():a.type==="json"?O.json():O.text()).then(H=>{y||(U&&$&&function(ae,se,ve){if(ri(),!St)return;const Te={status:se.status,statusText:se.statusText,headers:new Headers};se.headers.forEach((we,De)=>Te.headers.set(De,we));const _e=Ve(se.headers.get("Cache-Control")||"");_e["no-store"]||(_e["max-age"]&&Te.headers.set("Expires",new Date(ve+1e3*_e["max-age"]).toUTCString()),new Date(Te.headers.get("Expires")).getTime()-ve<42e4||function(we,De){if(nn===void 0)try{new Response(new ReadableStream),nn=!0}catch{nn=!1}nn?De(we.body):we.blob().then(De)}(se,we=>{const De=new Response(we,Te);ri(),St&&St.then(Re=>Re.put(function(it){const ct=it.indexOf("?");return ct<0?it:it.slice(0,ct)}(ae.url),De)).catch(Re=>ye(Re.message))}))}(f,U,$),g=!0,r(null,H,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(H=>{y||r(new Error(H.message))})})(D,null,M):D.blob().then(O=>r(new Yn(D.status,D.statusText,a.url,O)))).catch(D=>{D.code!==20&&r(new Error(D.message))})})(),{cancel:()=>{y=!0,g||u.abort()}}}const fi=function(a,r){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){if(Fe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,r);if(!Fe()){const f=a.url.substring(0,a.url.indexOf("://"));return(tt.REGISTERED_PROTOCOLS[f]||ji)(a,r)}}if(!(/^file:/.test(u=a.url)||/^file:/.test(Lr())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ji(a,r);if(Fe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,r,void 0,!0)}var u;return function(f,g){const y=new XMLHttpRequest;y.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const b in f.headers)y.setRequestHeader(b,f.headers[b]);return f.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=f.credentials==="include",y.onerror=()=>{g(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let b=y.response;if(f.type==="json")try{b=JSON.parse(y.response)}catch(T){return g(T)}g(null,b,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else{const b=new Blob([y.response],{type:y.getResponseHeader("Content-Type")});g(new Yn(y.status,y.statusText,f.url,b))}},y.send(f.body),{cancel:()=>y.abort()}}(a,r)},Gi=function(a,r){return fi(X(a,{type:"arrayBuffer"}),r)};function js(a){const r=window.document.createElement("a");return r.href=a,r.protocol===window.document.location.protocol&&r.host===window.document.location.host}const Vt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ki,Fn;ki=[],Fn=0;const is=function(a,r){if(si.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Fn>=tt.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:a,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return ki.push(y),y}Fn++;let u=!1;const f=()=>{if(!u)for(u=!0,Fn--;ki.length&&Fn<tt.MAX_PARALLEL_IMAGE_REQUESTS;){const y=ki.shift(),{requestParameters:b,callback:T,cancelled:S}=y;S||(y.cancel=is(b,T).cancel)}},g=Gi(a,(y,b,T,S)=>{f(),y?r(y):b&&function(M,D){typeof createImageBitmap=="function"?function(O,U){const $=new Blob([new Uint8Array(O)],{type:"image/png"});createImageBitmap($).then(H=>{U(null,H)}).catch(H=>{U(new Error(`Could not load image because of ${H.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(M,D):function(O,U){const $=new Image;$.onload=()=>{U(null,$),URL.revokeObjectURL($.src),$.onload=null,window.requestAnimationFrame(()=>{$.src=Vt})},$.onerror=()=>U(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const H=new Blob([new Uint8Array(O)],{type:"image/png"});$.src=O.byteLength?URL.createObjectURL(H):Vt}(M,D)}(b,(M,D)=>{M!=null?r(M):D!=null&&r(null,D,{cacheControl:T,expires:S})})});return{cancel:()=>{g.cancel(),f()}}};function _o(a,r,u){u[a]&&u[a].indexOf(r)!==-1||(u[a]=u[a]||[],u[a].push(r))}function kr(a,r,u){if(u&&u[a]){const f=u[a].indexOf(r);f!==-1&&u[a].splice(f,1)}}class Rr{constructor(r,u={}){X(this,u),this.type=r}}class Gs extends Rr{constructor(r,u={}){super("error",X({error:r},u))}}class vr{on(r,u){return this._listeners=this._listeners||{},_o(r,u,this._listeners),this}off(r,u){return kr(r,u,this._listeners),kr(r,u,this._oneTimeListeners),this}once(r,u){return this._oneTimeListeners=this._oneTimeListeners||{},_o(r,u,this._oneTimeListeners),this}fire(r,u){typeof r=="string"&&(r=new Rr(r,u||{}));const f=r.type;if(this.listens(f)){r.target=this;const g=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const T of g)T.call(this,r);const y=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const T of y)kr(f,T,this._oneTimeListeners),T.call(this,r);const b=this._eventedParent;b&&(X(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(r))}else r instanceof Gs&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,u){return this._eventedParent=r,this._eventedParentData=u,this}}var Me={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class We{constructor(r,u,f,g){this.message=(r?`${r}: `:"")+f,g&&(this.identifier=g),u!=null&&u.__line__&&(this.line=u.__line__)}}function rs(a){const r=a.value;return r?[new We(a.key,r,"constants have been deprecated as of v8")]:[]}function Ei(a,...r){for(const u of r)for(const f in u)a[f]=u[f];return a}function Bt(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function $i(a){if(Array.isArray(a))return a.map($i);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const r={};for(const u in a)r[u]=$i(a[u]);return r}return Bt(a)}class Ri extends Error{constructor(r,u){super(u),this.message=u,this.key=r}}class Di{constructor(r,u=[]){this.parent=r,this.bindings={};for(const[f,g]of u)this.bindings[f]=g}concat(r){return new Di(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const ss={kind:"null"},He={kind:"number"},It={kind:"string"},Pt={kind:"boolean"},Kn={kind:"color"},Dr={kind:"object"},At={kind:"value"},ir={kind:"collator"},$n={kind:"formatted"},$s={kind:"padding"},Ln={kind:"resolvedImage"};function oi(a,r){return{kind:"array",itemType:a,N:r}}function Qt(a){if(a.kind==="array"){const r=Qt(a.itemType);return typeof a.N=="number"?`array<${r}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${r}>`}return a.kind}const Hs=[ss,He,It,Pt,Kn,$n,Dr,oi(At),$s,Ln];function xr(a,r){if(r.kind==="error")return null;if(a.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!xr(a.itemType,r.itemType))&&(typeof a.N!="number"||a.N===r.N))return null}else{if(a.kind===r.kind)return null;if(a.kind==="value"){for(const u of Hs)if(!xr(u,r))return null}}return`Expected ${Qt(a)} but found ${Qt(r)} instead.`}function br(a,r){return r.some(u=>u.kind===a.kind)}function ws(a,r){return r.some(u=>u==="null"?a===null:u==="array"?Array.isArray(a):u==="object"?a&&!Array.isArray(a)&&typeof a=="object":u===typeof a)}var Ws,os={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Q(a){return(a=Math.round(a))<0?0:a>255?255:a}function R(a){return Q(a[a.length-1]==="%"?parseFloat(a)/100*255:parseInt(a))}function F(a){return(r=a[a.length-1]==="%"?parseFloat(a)/100:parseFloat(a))<0?0:r>1?1:r;var r}function Z(a,r,u){return u<0?u+=1:u>1&&(u-=1),6*u<1?a+(r-a)*u*6:2*u<1?r:3*u<2?a+(r-a)*(2/3-u)*6:a}try{Ws={}.parseCSSColor=function(a){var r,u=a.replace(/ /g,"").toLowerCase();if(u in os)return os[u].slice();if(u[0]==="#")return u.length===4?(r=parseInt(u.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:u.length===7&&(r=parseInt(u.substr(1),16))>=0&&r<=16777215?[(16711680&r)>>16,(65280&r)>>8,255&r,1]:null;var f=u.indexOf("("),g=u.indexOf(")");if(f!==-1&&g+1===u.length){var y=u.substr(0,f),b=u.substr(f+1,g-(f+1)).split(","),T=1;switch(y){case"rgba":if(b.length!==4)return null;T=F(b.pop());case"rgb":return b.length!==3?null:[R(b[0]),R(b[1]),R(b[2]),T];case"hsla":if(b.length!==4)return null;T=F(b.pop());case"hsl":if(b.length!==3)return null;var S=(parseFloat(b[0])%360+360)%360/360,M=F(b[1]),D=F(b[2]),O=D<=.5?D*(M+1):D+M-D*M,U=2*D-O;return[Q(255*Z(U,O,S+1/3)),Q(255*Z(U,O,S)),Q(255*Z(U,O,S-1/3)),T];default:return null}}return null}}catch{}class K{constructor(r,u,f,g=1){this.r=r,this.g=u,this.b=f,this.a=g}static parse(r){if(!r)return;if(r instanceof K)return r;if(typeof r!="string")return;const u=Ws(r);return u?new K(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3]):void 0}toString(){const[r,u,f,g]=this.toArray();return`rgba(${Math.round(r)},${Math.round(u)},${Math.round(f)},${g})`}toArray(){const{r,g:u,b:f,a:g}=this;return g===0?[0,0,0,0]:[255*r/g,255*u/g,255*f/g,g]}}K.black=new K(0,0,0,1),K.white=new K(1,1,1,1),K.transparent=new K(0,0,0,0),K.red=new K(1,0,0,1);class ce{constructor(r,u,f){this.sensitivity=r?u?"variant":"case":u?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,u){return this.collator.compare(r,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class fe{constructor(r,u,f,g,y){this.text=r,this.image=u,this.scale=f,this.fontStack=g,this.textColor=y}}class he{constructor(r){this.sections=r}static fromString(r){return new he([new fe(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof he?r:he.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}}class le{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof le)return r;if(typeof r=="number")return new le([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const u of r)if(typeof u!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]]}return new le(r)}}toString(){return JSON.stringify(this.values)}}class pe{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new pe({name:r,available:!1}):null}}function Ie(a,r,u,f){return typeof a=="number"&&a>=0&&a<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof u=="number"&&u>=0&&u<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[a,r,u,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[a,r,u,f]:[a,r,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ze(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof K||a instanceof ce||a instanceof he||a instanceof le||a instanceof pe)return!0;if(Array.isArray(a)){for(const r of a)if(!ze(r))return!1;return!0}if(typeof a=="object"){for(const r in a)if(!ze(a[r]))return!1;return!0}return!1}function Pe(a){if(a===null)return ss;if(typeof a=="string")return It;if(typeof a=="boolean")return Pt;if(typeof a=="number")return He;if(a instanceof K)return Kn;if(a instanceof ce)return ir;if(a instanceof he)return $n;if(a instanceof le)return $s;if(a instanceof pe)return Ln;if(Array.isArray(a)){const r=a.length;let u;for(const f of a){const g=Pe(f);if(u){if(u===g)continue;u=At;break}u=g}return oi(u||At,r)}return Dr}function rt(a){const r=typeof a;return a===null?"":r==="string"||r==="number"||r==="boolean"?String(a):a instanceof K||a instanceof he||a instanceof le||a instanceof pe?a.toString():JSON.stringify(a)}class lt{constructor(r,u){this.type=r,this.value=u}static parse(r,u){if(r.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!ze(r[1]))return u.error("invalid value");const f=r[1];let g=Pe(f);const y=u.expectedType;return g.kind!=="array"||g.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(g=y),new lt(g,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ye{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const gt={string:It,number:He,boolean:Pt,object:Dr};class ft{constructor(r,u){this.type=r,this.args=u}static parse(r,u){if(r.length<2)return u.error("Expected at least one argument.");let f,g=1;const y=r[0];if(y==="array"){let T,S;if(r.length>2){const M=r[1];if(typeof M!="string"||!(M in gt)||M==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);T=gt[M],g++}else T=At;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return u.error('The length argument to "array" must be a positive integer literal',2);S=r[2],g++}f=oi(T,S)}else{if(!gt[y])throw new Error(`Types doesn't contain name = ${y}`);f=gt[y]}const b=[];for(;g<r.length;g++){const T=u.parse(r[g],g,At);if(!T)return null;b.push(T)}return new ft(f,b)}evaluate(r){for(let u=0;u<this.args.length;u++){const f=this.args[u].evaluate(r);if(!xr(this.type,Pe(f)))return f;if(u===this.args.length-1)throw new Ye(`Expected value to be of type ${Qt(this.type)}, but found ${Qt(Pe(f))} instead.`)}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const Lt={"to-boolean":Pt,"to-color":Kn,"to-number":He,"to-string":It};class xt{constructor(r,u){this.type=r,this.args=u}static parse(r,u){if(r.length<2)return u.error("Expected at least one argument.");const f=r[0];if(!Lt[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&r.length!==2)return u.error("Expected one argument.");const g=Lt[f],y=[];for(let b=1;b<r.length;b++){const T=u.parse(r[b],b,At);if(!T)return null;y.push(T)}return new xt(g,y)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let u,f;for(const g of this.args){if(u=g.evaluate(r),f=null,u instanceof K)return u;if(typeof u=="string"){const y=r.parseColor(u);if(y)return y}else if(Array.isArray(u)&&(f=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:Ie(u[0],u[1],u[2],u[3]),!f))return new K(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new Ye(f||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}if(this.type.kind==="padding"){let u;for(const f of this.args){u=f.evaluate(r);const g=le.parse(u);if(g)return g}throw new Ye(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}if(this.type.kind==="number"){let u=null;for(const f of this.args){if(u=f.evaluate(r),u===null)return 0;const g=Number(u);if(!isNaN(g))return g}throw new Ye(`Could not convert ${JSON.stringify(u)} to number.`)}return this.type.kind==="formatted"?he.fromString(rt(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?pe.fromString(rt(this.args[0].evaluate(r))):rt(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const Tt=["Unknown","Point","LineString","Polygon"];class zt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Tt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let u=this._parseColorCache[r];return u||(u=this._parseColorCache[r]=K.parse(r)),u}}class Nt{constructor(r,u,f,g){this.name=r,this.type=u,this._evaluate=f,this.args=g}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,u){const f=r[0],g=Nt.definitions[f];if(!g)return u.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(g)?g[0]:g.type,b=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,T=b.filter(([M])=>!Array.isArray(M)||M.length===r.length-1);let S=null;for(const[M,D]of T){S=new Ne(u.registry,u.path,null,u.scope);const O=[];let U=!1;for(let $=1;$<r.length;$++){const H=r[$],ae=Array.isArray(M)?M[$-1]:M.type,se=S.parse(H,1+O.length,ae);if(!se){U=!0;break}O.push(se)}if(!U)if(Array.isArray(M)&&M.length!==O.length)S.error(`Expected ${M.length} arguments, but found ${O.length} instead.`);else{for(let $=0;$<O.length;$++){const H=Array.isArray(M)?M[$]:M.type,ae=O[$];S.concat($+1).checkSubtype(H,ae.type)}if(S.errors.length===0)return new Nt(f,y,D,O)}}if(T.length===1)u.errors.push(...S.errors);else{const M=(T.length?T:b).map(([O])=>{return U=O,Array.isArray(U)?`(${U.map(Qt).join(", ")})`:`(${Qt(U.type)}...)`;var U}).join(" | "),D=[];for(let O=1;O<r.length;O++){const U=u.parse(r[O],1+D.length);if(!U)return null;D.push(Qt(U.type))}u.error(`Expected arguments of type ${M}, but found (${D.join(", ")}) instead.`)}return null}static register(r,u){Nt.definitions=u;for(const f in u)r[f]=Nt}}class hn{constructor(r,u,f){this.type=ir,this.locale=f,this.caseSensitive=r,this.diacriticSensitive=u}static parse(r,u){if(r.length!==2)return u.error("Expected one argument.");const f=r[1];if(typeof f!="object"||Array.isArray(f))return u.error("Collator options argument must be an object.");const g=u.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Pt);if(!g)return null;const y=u.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Pt);if(!y)return null;let b=null;return f.locale&&(b=u.parse(f.locale,1,It),!b)?null:new hn(g,y,b)}evaluate(r){return new ce(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}}const dn=8192;function Jn(a,r){a[0]=Math.min(a[0],r[0]),a[1]=Math.min(a[1],r[1]),a[2]=Math.max(a[2],r[0]),a[3]=Math.max(a[3],r[1])}function zr(a,r){return!(a[0]<=r[0]||a[2]>=r[2]||a[1]<=r[1]||a[3]>=r[3])}function pi(a,r){const u=(180+a[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,g=Math.pow(2,r.z);return[Math.round(u*g*dn),Math.round(f*g*dn)]}function qt(a,r,u){const f=a[0]-r[0],g=a[1]-r[1],y=a[0]-u[0],b=a[1]-u[1];return f*b-y*g==0&&f*y<=0&&g*b<=0}function yo(a,r){let u=!1;for(let b=0,T=r.length;b<T;b++){const S=r[b];for(let M=0,D=S.length;M<D-1;M++){if(qt(a,S[M],S[M+1]))return!1;(g=S[M])[1]>(f=a)[1]!=(y=S[M+1])[1]>f[1]&&f[0]<(y[0]-g[0])*(f[1]-g[1])/(y[1]-g[1])+g[0]&&(u=!u)}}var f,g,y;return u}function vo(a,r){for(let u=0;u<r.length;u++)if(yo(a,r[u]))return!0;return!1}function Ko(a,r,u,f){const g=f[0]-u[0],y=f[1]-u[1],b=(a[0]-u[0])*y-g*(a[1]-u[1]),T=(r[0]-u[0])*y-g*(r[1]-u[1]);return b>0&&T<0||b<0&&T>0}function Jo(a,r,u){for(const M of u)for(let D=0;D<M.length-1;++D)if((T=[(b=M[D+1])[0]-(y=M[D])[0],b[1]-y[1]])[0]*(S=[(g=r)[0]-(f=a)[0],g[1]-f[1]])[1]-T[1]*S[0]!=0&&Ko(f,g,y,b)&&Ko(y,b,f,g))return!0;var f,g,y,b,T,S;return!1}function qs(a,r){for(let u=0;u<a.length;++u)if(!yo(a[u],r))return!1;for(let u=0;u<a.length-1;++u)if(Jo(a[u],a[u+1],r))return!1;return!0}function Or(a,r){for(let u=0;u<r.length;u++)if(qs(a,r[u]))return!0;return!1}function Qo(a,r,u){const f=[];for(let g=0;g<a.length;g++){const y=[];for(let b=0;b<a[g].length;b++){const T=pi(a[g][b],u);Jn(r,T),y.push(T)}f.push(y)}return f}function ea(a,r,u){const f=[];for(let g=0;g<a.length;g++){const y=Qo(a[g],r,u);f.push(y)}return f}function ta(a,r,u,f){if(a[0]<u[0]||a[0]>u[2]){const g=.5*f;let y=a[0]-u[0]>g?-f:u[0]-a[0]>g?f:0;y===0&&(y=a[0]-u[2]>g?-f:u[2]-a[0]>g?f:0),a[0]+=y}Jn(r,a)}function Za(a,r,u,f){const g=Math.pow(2,f.z)*dn,y=[f.x*dn,f.y*dn],b=[];for(const T of a)for(const S of T){const M=[S.x+y[0],S.y+y[1]];ta(M,r,u,g),b.push(M)}return b}function Wl(a,r,u,f){const g=Math.pow(2,f.z)*dn,y=[f.x*dn,f.y*dn],b=[];for(const S of a){const M=[];for(const D of S){const O=[D.x+y[0],D.y+y[1]];Jn(r,O),M.push(O)}b.push(M)}if(r[2]-r[0]<=g/2){(T=r)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const S of b)for(const M of S)ta(M,r,u,g)}var T;return b}class Es{constructor(r,u){this.type=Pt,this.geojson=r,this.geometries=u}static parse(r,u){if(r.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(ze(r[1])){const f=r[1];if(f.type==="FeatureCollection")for(let g=0;g<f.features.length;++g){const y=f.features[g].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Es(f,f.features[g].geometry)}else if(f.type==="Feature"){const g=f.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Es(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Es(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(u,f){const g=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=u.canonicalID();if(f.type==="Polygon"){const T=Qo(f.coordinates,y,b),S=Za(u.geometry(),g,y,b);if(!zr(g,y))return!1;for(const M of S)if(!yo(M,T))return!1}if(f.type==="MultiPolygon"){const T=ea(f.coordinates,y,b),S=Za(u.geometry(),g,y,b);if(!zr(g,y))return!1;for(const M of S)if(!vo(M,T))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(u,f){const g=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=u.canonicalID();if(f.type==="Polygon"){const T=Qo(f.coordinates,y,b),S=Wl(u.geometry(),g,y,b);if(!zr(g,y))return!1;for(const M of S)if(!qs(M,T))return!1}if(f.type==="MultiPolygon"){const T=ea(f.coordinates,y,b),S=Wl(u.geometry(),g,y,b);if(!zr(g,y))return!1;for(const M of S)if(!Or(M,T))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function G(a){if(a instanceof Nt&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Es)return!1;let r=!0;return a.eachChild(u=>{r&&!G(u)&&(r=!1)}),r}function J(a){if(a instanceof Nt&&a.name==="feature-state")return!1;let r=!0;return a.eachChild(u=>{r&&!J(u)&&(r=!1)}),r}function ue(a,r){if(a instanceof Nt&&r.indexOf(a.name)>=0)return!1;let u=!0;return a.eachChild(f=>{u&&!ue(f,r)&&(u=!1)}),u}class Ae{constructor(r,u){this.type=u.type,this.name=r,this.boundExpression=u}static parse(r,u){if(r.length!==2||typeof r[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const f=r[1];return u.scope.has(f)?new Ae(f,u.scope.get(f)):u.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}}class Ne{constructor(r,u=[],f,g=new Di,y=[]){this.registry=r,this.path=u,this.key=u.map(b=>`[${b}]`).join(""),this.scope=g,this.errors=y,this.expectedType=f}parse(r,u,f,g,y={}){return u?this.concat(u,f,g)._parse(r,y):this._parse(r,y)}_parse(r,u){function f(g,y,b){return b==="assert"?new ft(y,[g]):b==="coerce"?new xt(y,[g]):g}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=r[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[g];if(y){let b=y.parse(r,this);if(!b)return null;if(this.expectedType){const T=this.expectedType,S=b.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||S.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(T.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array"){if(this.checkSubtype(T,S))return null}else b=f(b,T,u.typeAnnotation||"coerce");else b=f(b,T,u.typeAnnotation||"coerce");else b=f(b,T,u.typeAnnotation||"assert")}if(!(b instanceof lt)&&b.type.kind!=="resolvedImage"&&at(b)){const T=new zt;try{b=new lt(b.type,b.evaluate(T))}catch(S){return this.error(S.message),null}}return b}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,u,f){const g=typeof r=="number"?this.path.concat(r):this.path,y=f?this.scope.concat(f):this.scope;return new Ne(this.registry,g,u||null,y,this.errors)}error(r,...u){const f=`${this.key}${u.map(g=>`[${g}]`).join("")}`;this.errors.push(new Ri(f,r))}checkSubtype(r,u){const f=xr(r,u);return f&&this.error(f),f}}function at(a){if(a instanceof Ae)return at(a.boundExpression);if(a instanceof Nt&&a.name==="error"||a instanceof hn||a instanceof Es)return!1;const r=a instanceof xt||a instanceof ft;let u=!0;return a.eachChild(f=>{u=r?u&&at(f):u&&f instanceof lt}),!!u&&G(a)&&ue(a,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ot(a,r){const u=a.length-1;let f,g,y=0,b=u,T=0;for(;y<=b;)if(T=Math.floor((y+b)/2),f=a[T],g=a[T+1],f<=r){if(T===u||r<g)return T;y=T+1}else{if(!(f>r))throw new Ye("Input is not a number.");b=T-1}return 0}class En{constructor(r,u,f){this.type=r,this.input=u,this.labels=[],this.outputs=[];for(const[g,y]of f)this.labels.push(g),this.outputs.push(y)}static parse(r,u){if(r.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return u.error("Expected an even number of arguments.");const f=u.parse(r[1],1,He);if(!f)return null;const g=[];let y=null;u.expectedType&&u.expectedType.kind!=="value"&&(y=u.expectedType);for(let b=1;b<r.length;b+=2){const T=b===1?-1/0:r[b],S=r[b+1],M=b,D=b+1;if(typeof T!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(g.length&&g[g.length-1][0]>=T)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const O=u.parse(S,D,y);if(!O)return null;y=y||O.type,g.push([T,O])}return new En(y,f,g)}evaluate(r){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(r);const g=this.input.evaluate(r);if(g<=u[0])return f[0].evaluate(r);const y=u.length;return g>=u[y-1]?f[y-1].evaluate(r):f[Ot(u,g)].evaluate(r)}eachChild(r){r(this.input);for(const u of this.outputs)r(u)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function kt(a,r,u){return a*(1-u)+r*u}var Bn=Object.freeze({__proto__:null,number:kt,color:function(a,r,u){return new K(kt(a.r,r.r,u),kt(a.g,r.g,u),kt(a.b,r.b,u),kt(a.a,r.a,u))},array:function(a,r,u){return a.map((f,g)=>kt(f,r[g],u))},padding:function(a,r,u){const f=a.values,g=r.values;return new le([kt(f[0],g[0],u),kt(f[1],g[1],u),kt(f[2],g[2],u),kt(f[3],g[3],u)])}});const rr=.95047,Od=1.08883,wu=4/29,ql=6/29,Fd=3*ql*ql,ng=Math.PI/180,ig=180/Math.PI;function Eu(a){return a>.008856451679035631?Math.pow(a,1/3):a/Fd+wu}function Tu(a){return a>ql?a*a*a:Fd*(a-wu)}function Su(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Au(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Kt(a){const r=Au(a.r),u=Au(a.g),f=Au(a.b),g=Eu((.4124564*r+.3575761*u+.1804375*f)/rr),y=Eu((.2126729*r+.7151522*u+.072175*f)/1);return{l:116*y-16,a:500*(g-y),b:200*(y-Eu((.0193339*r+.119192*u+.9503041*f)/Od)),alpha:a.a}}function Bd(a){let r=(a.l+16)/116,u=isNaN(a.a)?r:r+a.a/500,f=isNaN(a.b)?r:r-a.b/200;return r=1*Tu(r),u=rr*Tu(u),f=Od*Tu(f),new K(Su(3.2404542*u-1.5371385*r-.4985314*f),Su(-.969266*u+1.8760108*r+.041556*f),Su(.0556434*u-.2040259*r+1.0572252*f),a.alpha)}function rg(a,r,u){const f=r-a;return a+u*(f>180||f<-180?f-360*Math.round(f/360):f)}const Xa={forward:Kt,reverse:Bd,interpolate:function(a,r,u){return{l:kt(a.l,r.l,u),a:kt(a.a,r.a,u),b:kt(a.b,r.b,u),alpha:kt(a.alpha,r.alpha,u)}}},Ya={forward:function(a){const{l:r,a:u,b:f}=Kt(a),g=Math.atan2(f,u)*ig;return{h:g<0?g+360:g,c:Math.sqrt(u*u+f*f),l:r,alpha:a.a}},reverse:function(a){const r=a.h*ng,u=a.c;return Bd({l:a.l,a:Math.cos(r)*u,b:Math.sin(r)*u,alpha:a.alpha})},interpolate:function(a,r,u){return{h:rg(a.h,r.h,u),c:kt(a.c,r.c,u),l:kt(a.l,r.l,u),alpha:kt(a.alpha,r.alpha,u)}}};var Nd=Object.freeze({__proto__:null,lab:Xa,hcl:Ya});class sr{constructor(r,u,f,g,y){this.type=r,this.operator=u,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(const[b,T]of y)this.labels.push(b),this.outputs.push(T)}static interpolationFactor(r,u,f,g){let y=0;if(r.name==="exponential")y=Pu(u,r.base,f,g);else if(r.name==="linear")y=Pu(u,1,f,g);else if(r.name==="cubic-bezier"){const b=r.controlPoints;y=new v(b[0],b[1],b[2],b[3]).solve(Pu(u,1,f,g))}return y}static parse(r,u){let[f,g,y,...b]=r;if(!Array.isArray(g)||g.length===0)return u.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const M=g[1];if(typeof M!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:M}}else{if(g[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const M=g.slice(1);if(M.length!==4||M.some(D=>typeof D!="number"||D<0||D>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:M}}}if(r.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(y=u.parse(y,2,He),!y)return null;const T=[];let S=null;f==="interpolate-hcl"||f==="interpolate-lab"?S=Kn:u.expectedType&&u.expectedType.kind!=="value"&&(S=u.expectedType);for(let M=0;M<b.length;M+=2){const D=b[M],O=b[M+1],U=M+3,$=M+4;if(typeof D!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(T.length&&T[T.length-1][0]>=D)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const H=u.parse(O,$,S);if(!H)return null;S=S||H.type,T.push([D,H])}return S.kind==="number"||S.kind==="color"||S.kind==="padding"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new sr(S,f,g,y,T):u.error(`Type ${Qt(S)} is not interpolatable.`)}evaluate(r){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(r);const g=this.input.evaluate(r);if(g<=u[0])return f[0].evaluate(r);const y=u.length;if(g>=u[y-1])return f[y-1].evaluate(r);const b=Ot(u,g),T=sr.interpolationFactor(this.interpolation,g,u[b],u[b+1]),S=f[b].evaluate(r),M=f[b+1].evaluate(r);return this.operator==="interpolate"?Bn[this.type.kind.toLowerCase()](S,M,T):this.operator==="interpolate-hcl"?Ya.reverse(Ya.interpolate(Ya.forward(S),Ya.forward(M),T)):Xa.reverse(Xa.interpolate(Xa.forward(S),Xa.forward(M),T))}eachChild(r){r(this.input);for(const u of this.outputs)r(u)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function Pu(a,r,u,f){const g=f-u,y=a-u;return g===0?0:r===1?y/g:(Math.pow(r,y)-1)/(Math.pow(r,g)-1)}class Zl{constructor(r,u){this.type=r,this.args=u}static parse(r,u){if(r.length<2)return u.error("Expectected at least one argument.");let f=null;const g=u.expectedType;g&&g.kind!=="value"&&(f=g);const y=[];for(const T of r.slice(1)){const S=u.parse(T,1+y.length,f,void 0,{typeAnnotation:"omit"});if(!S)return null;f=f||S.type,y.push(S)}if(!f)throw new Error("No output type");const b=g&&y.some(T=>xr(g,T.type));return new Zl(b?At:f,y)}evaluate(r){let u,f=null,g=0;for(const y of this.args)if(g++,f=y.evaluate(r),f&&f instanceof pe&&!f.available&&(u||(u=f.name),f=null,g===this.args.length&&(f=u)),f!==null)break;return f}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}class Xl{constructor(r,u){this.type=u.type,this.bindings=[].concat(r),this.result=u}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const u of this.bindings)r(u[1]);r(this.result)}static parse(r,u){if(r.length<4)return u.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const f=[];for(let y=1;y<r.length-1;y+=2){const b=r[y];if(typeof b!="string")return u.error(`Expected string, but found ${typeof b} instead.`,y);if(/[^a-zA-Z0-9_]/.test(b))return u.error("Variable names must contain only alphanumeric characters or '_'.",y);const T=u.parse(r[y+1],y+1);if(!T)return null;f.push([b,T])}const g=u.parse(r[r.length-1],r.length-1,u.expectedType,f);return g?new Xl(f,g):null}outputDefined(){return this.result.outputDefined()}}class Iu{constructor(r,u,f){this.type=r,this.index=u,this.input=f}static parse(r,u){if(r.length!==3)return u.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const f=u.parse(r[1],1,He),g=u.parse(r[2],2,oi(u.expectedType||At));return f&&g?new Iu(g.type.itemType,f,g):null}evaluate(r){const u=this.index.evaluate(r),f=this.input.evaluate(r);if(u<0)throw new Ye(`Array index out of bounds: ${u} < 0.`);if(u>=f.length)throw new Ye(`Array index out of bounds: ${u} > ${f.length-1}.`);if(u!==Math.floor(u))throw new Ye(`Array index must be an integer, but found ${u} instead.`);return f[u]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}}class Cu{constructor(r,u){this.type=Pt,this.needle=r,this.haystack=u}static parse(r,u){if(r.length!==3)return u.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const f=u.parse(r[1],1,At),g=u.parse(r[2],2,At);return f&&g?br(f.type,[Pt,It,He,ss,At])?new Cu(f,g):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qt(f.type)} instead`):null}evaluate(r){const u=this.needle.evaluate(r),f=this.haystack.evaluate(r);if(!f)return!1;if(!ws(u,["boolean","string","number","null"]))throw new Ye(`Expected first argument to be of type boolean, string, number or null, but found ${Qt(Pe(u))} instead.`);if(!ws(f,["string","array"]))throw new Ye(`Expected second argument to be of type array or string, but found ${Qt(Pe(f))} instead.`);return f.indexOf(u)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}}class Yl{constructor(r,u,f){this.type=He,this.needle=r,this.haystack=u,this.fromIndex=f}static parse(r,u){if(r.length<=2||r.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const f=u.parse(r[1],1,At),g=u.parse(r[2],2,At);if(!f||!g)return null;if(!br(f.type,[Pt,It,He,ss,At]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qt(f.type)} instead`);if(r.length===4){const y=u.parse(r[3],3,He);return y?new Yl(f,g,y):null}return new Yl(f,g)}evaluate(r){const u=this.needle.evaluate(r),f=this.haystack.evaluate(r);if(!ws(u,["boolean","string","number","null"]))throw new Ye(`Expected first argument to be of type boolean, string, number or null, but found ${Qt(Pe(u))} instead.`);if(!ws(f,["string","array"]))throw new Ye(`Expected second argument to be of type array or string, but found ${Qt(Pe(f))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(r);return f.indexOf(u,g)}return f.indexOf(u)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}}class Mu{constructor(r,u,f,g,y,b){this.inputType=r,this.type=u,this.input=f,this.cases=g,this.outputs=y,this.otherwise=b}static parse(r,u){if(r.length<5)return u.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return u.error("Expected an even number of arguments.");let f,g;u.expectedType&&u.expectedType.kind!=="value"&&(g=u.expectedType);const y={},b=[];for(let M=2;M<r.length-1;M+=2){let D=r[M];const O=r[M+1];Array.isArray(D)||(D=[D]);const U=u.concat(M);if(D.length===0)return U.error("Expected at least one branch label.");for(const H of D){if(typeof H!="number"&&typeof H!="string")return U.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return U.error("Numeric branch labels must be integer values.");if(f){if(U.checkSubtype(f,Pe(H)))return null}else f=Pe(H);if(y[String(H)]!==void 0)return U.error("Branch labels must be unique.");y[String(H)]=b.length}const $=u.parse(O,M,g);if(!$)return null;g=g||$.type,b.push($)}const T=u.parse(r[1],1,At);if(!T)return null;const S=u.parse(r[r.length-1],r.length-1,g);return S?T.type.kind!=="value"&&u.concat(1).checkSubtype(f,T.type)?null:new Mu(f,g,T,y,b,S):null}evaluate(r){const u=this.input.evaluate(r);return(Pe(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}}class Lu{constructor(r,u,f){this.type=r,this.branches=u,this.otherwise=f}static parse(r,u){if(r.length<4)return u.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return u.error("Expected an odd number of arguments.");let f;u.expectedType&&u.expectedType.kind!=="value"&&(f=u.expectedType);const g=[];for(let b=1;b<r.length-1;b+=2){const T=u.parse(r[b],b,Pt);if(!T)return null;const S=u.parse(r[b+1],b+1,f);if(!S)return null;g.push([T,S]),f=f||S.type}const y=u.parse(r[r.length-1],r.length-1,f);if(!y)return null;if(!f)throw new Error("Can't infer output type");return new Lu(f,g,y)}evaluate(r){for(const[u,f]of this.branches)if(u.evaluate(r))return f.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[u,f]of this.branches)r(u),r(f);r(this.otherwise)}outputDefined(){return this.branches.every(([r,u])=>u.outputDefined())&&this.otherwise.outputDefined()}}class Kl{constructor(r,u,f,g){this.type=r,this.input=u,this.beginIndex=f,this.endIndex=g}static parse(r,u){if(r.length<=2||r.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const f=u.parse(r[1],1,At),g=u.parse(r[2],2,He);if(!f||!g)return null;if(!br(f.type,[oi(At),It,At]))return u.error(`Expected first argument to be of type array or string, but found ${Qt(f.type)} instead`);if(r.length===4){const y=u.parse(r[3],3,He);return y?new Kl(f.type,f,g,y):null}return new Kl(f.type,f,g)}evaluate(r){const u=this.input.evaluate(r),f=this.beginIndex.evaluate(r);if(!ws(u,["string","array"]))throw new Ye(`Expected first argument to be of type array or string, but found ${Qt(Pe(u))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(r);return u.slice(f,g)}return u.slice(f)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}}function Ud(a,r){return a==="=="||a==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function Vd(a,r,u,f){return f.compare(r,u)===0}function na(a,r,u){const f=a!=="=="&&a!=="!=";return class vS{constructor(y,b,T){this.type=Pt,this.lhs=y,this.rhs=b,this.collator=T,this.hasUntypedArgument=y.type.kind==="value"||b.type.kind==="value"}static parse(y,b){if(y.length!==3&&y.length!==4)return b.error("Expected two or three arguments.");const T=y[0];let S=b.parse(y[1],1,At);if(!S)return null;if(!Ud(T,S.type))return b.concat(1).error(`"${T}" comparisons are not supported for type '${Qt(S.type)}'.`);let M=b.parse(y[2],2,At);if(!M)return null;if(!Ud(T,M.type))return b.concat(2).error(`"${T}" comparisons are not supported for type '${Qt(M.type)}'.`);if(S.type.kind!==M.type.kind&&S.type.kind!=="value"&&M.type.kind!=="value")return b.error(`Cannot compare types '${Qt(S.type)}' and '${Qt(M.type)}'.`);f&&(S.type.kind==="value"&&M.type.kind!=="value"?S=new ft(M.type,[S]):S.type.kind!=="value"&&M.type.kind==="value"&&(M=new ft(S.type,[M])));let D=null;if(y.length===4){if(S.type.kind!=="string"&&M.type.kind!=="string"&&S.type.kind!=="value"&&M.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(D=b.parse(y[3],3,ir),!D)return null}return new vS(S,M,D)}evaluate(y){const b=this.lhs.evaluate(y),T=this.rhs.evaluate(y);if(f&&this.hasUntypedArgument){const S=Pe(b),M=Pe(T);if(S.kind!==M.kind||S.kind!=="string"&&S.kind!=="number")throw new Ye(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${S.kind}, ${M.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const S=Pe(b),M=Pe(T);if(S.kind!=="string"||M.kind!=="string")return r(y,b,T)}return this.collator?u(y,b,T,this.collator.evaluate(y)):r(y,b,T)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}const sg=na("==",function(a,r,u){return r===u},Vd),og=na("!=",function(a,r,u){return r!==u},function(a,r,u,f){return!Vd(0,r,u,f)}),ag=na("<",function(a,r,u){return r<u},function(a,r,u,f){return f.compare(r,u)<0}),lg=na(">",function(a,r,u){return r>u},function(a,r,u,f){return f.compare(r,u)>0}),cg=na("<=",function(a,r,u){return r<=u},function(a,r,u,f){return f.compare(r,u)<=0}),ug=na(">=",function(a,r,u){return r>=u},function(a,r,u,f){return f.compare(r,u)>=0});class ku{constructor(r,u,f,g,y){this.type=It,this.number=r,this.locale=u,this.currency=f,this.minFractionDigits=g,this.maxFractionDigits=y}static parse(r,u){if(r.length!==3)return u.error("Expected two arguments.");const f=u.parse(r[1],1,He);if(!f)return null;const g=r[2];if(typeof g!="object"||Array.isArray(g))return u.error("NumberFormat options argument must be an object.");let y=null;if(g.locale&&(y=u.parse(g.locale,1,It),!y))return null;let b=null;if(g.currency&&(b=u.parse(g.currency,1,It),!b))return null;let T=null;if(g["min-fraction-digits"]&&(T=u.parse(g["min-fraction-digits"],1,He),!T))return null;let S=null;return g["max-fraction-digits"]&&(S=u.parse(g["max-fraction-digits"],1,He),!S)?null:new ku(f,y,b,T,S)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}}class Jl{constructor(r){this.type=$n,this.sections=r}static parse(r,u){if(r.length<2)return u.error("Expected at least one argument.");const f=r[1];if(!Array.isArray(f)&&typeof f=="object")return u.error("First argument must be an image or text section.");const g=[];let y=!1;for(let b=1;b<=r.length-1;++b){const T=r[b];if(y&&typeof T=="object"&&!Array.isArray(T)){y=!1;let S=null;if(T["font-scale"]&&(S=u.parse(T["font-scale"],1,He),!S))return null;let M=null;if(T["text-font"]&&(M=u.parse(T["text-font"],1,oi(It)),!M))return null;let D=null;if(T["text-color"]&&(D=u.parse(T["text-color"],1,Kn),!D))return null;const O=g[g.length-1];O.scale=S,O.font=M,O.textColor=D}else{const S=u.parse(r[b],1,At);if(!S)return null;const M=S.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,g.push({content:S,scale:null,font:null,textColor:null})}}return new Jl(g)}evaluate(r){return new he(this.sections.map(u=>{const f=u.content.evaluate(r);return Pe(f)===Ln?new fe("",f,null,null,null):new fe(rt(f),null,u.scale?u.scale.evaluate(r):null,u.font?u.font.evaluate(r).join(","):null,u.textColor?u.textColor.evaluate(r):null)}))}eachChild(r){for(const u of this.sections)r(u.content),u.scale&&r(u.scale),u.font&&r(u.font),u.textColor&&r(u.textColor)}outputDefined(){return!1}}class Ru{constructor(r){this.type=Ln,this.input=r}static parse(r,u){if(r.length!==2)return u.error("Expected two arguments.");const f=u.parse(r[1],1,It);return f?new Ru(f):u.error("No image name provided.")}evaluate(r){const u=this.input.evaluate(r),f=pe.fromString(u);return f&&r.availableImages&&(f.available=r.availableImages.indexOf(u)>-1),f}eachChild(r){r(this.input)}outputDefined(){return!1}}class Du{constructor(r){this.type=He,this.input=r}static parse(r,u){if(r.length!==2)return u.error(`Expected 1 argument, but found ${r.length-1} instead.`);const f=u.parse(r[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${Qt(f.type)} instead.`):new Du(f):null}evaluate(r){const u=this.input.evaluate(r);if(typeof u=="string"||Array.isArray(u))return u.length;throw new Ye(`Expected value to be of type string or array, but found ${Qt(Pe(u))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}}const ia={"==":sg,"!=":og,">":lg,"<":ag,">=":ug,"<=":cg,array:ft,at:Iu,boolean:ft,case:Lu,coalesce:Zl,collator:hn,format:Jl,image:Ru,in:Cu,"index-of":Yl,interpolate:sr,"interpolate-hcl":sr,"interpolate-lab":sr,length:Du,let:Xl,literal:lt,match:Mu,number:ft,"number-format":ku,object:ft,slice:Kl,step:En,string:ft,"to-boolean":xt,"to-color":xt,"to-number":xt,"to-string":xt,var:Ae,within:Es};function jd(a,[r,u,f,g]){r=r.evaluate(a),u=u.evaluate(a),f=f.evaluate(a);const y=g?g.evaluate(a):1,b=Ie(r,u,f,y);if(b)throw new Ye(b);return new K(r/255*y,u/255*y,f/255*y,y)}function Gd(a,r){return a in r}function Ql(a,r){const u=r[a];return u===void 0?null:u}function xo(a){return{type:a}}function $d(a){return{result:"success",value:a}}function ra(a){return{result:"error",value:a}}function mn(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function Hd(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function jt(a){return!!a.expression&&a.expression.interpolated}function Jt(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function fn(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function vn(a){return a}function Ka(a,r){const u=r.type==="color",f=a.stops&&typeof a.stops[0][0]=="object",g=f||!(f||a.property!==void 0),y=a.type||(jt(r)?"exponential":"interval");if(u||r.type==="padding"){const M=u?K.parse:le.parse;(a=Ei({},a)).stops&&(a.stops=a.stops.map(D=>[D[0],M(D[1])])),a.default=M(a.default?a.default:r.default)}if(a.colorSpace&&a.colorSpace!=="rgb"&&!Nd[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let b,T,S;if(y==="exponential")b=Wd;else if(y==="interval")b=dg;else if(y==="categorical"){b=hg,T=Object.create(null);for(const M of a.stops)T[M[0]]=M[1];S=typeof a.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);b=fg}if(f){const M={},D=[];for(let $=0;$<a.stops.length;$++){const H=a.stops[$],ae=H[0].zoom;M[ae]===void 0&&(M[ae]={zoom:ae,type:a.type,property:a.property,default:a.default,stops:[]},D.push(ae)),M[ae].stops.push([H[0].value,H[1]])}const O=[];for(const $ of D)O.push([M[$].zoom,Ka(M[$],r)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:sr.interpolationFactor.bind(void 0,U),zoomStops:O.map($=>$[0]),evaluate:({zoom:$},H)=>Wd({stops:O,base:a.base},r,$).evaluate($,H)}}if(g){const M=y==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:sr.interpolationFactor.bind(void 0,M),zoomStops:a.stops.map(D=>D[0]),evaluate:({zoom:D})=>b(a,r,D,T,S)}}return{kind:"source",evaluate(M,D){const O=D&&D.properties?D.properties[a.property]:void 0;return O===void 0?sa(a.default,r.default):b(a,r,O,T,S)}}}function sa(a,r,u){return a!==void 0?a:r!==void 0?r:u!==void 0?u:void 0}function hg(a,r,u,f,g){return sa(typeof u===g?f[u]:void 0,a.default,r.default)}function dg(a,r,u){if(Jt(u)!=="number")return sa(a.default,r.default);const f=a.stops.length;if(f===1||u<=a.stops[0][0])return a.stops[0][1];if(u>=a.stops[f-1][0])return a.stops[f-1][1];const g=Ot(a.stops.map(y=>y[0]),u);return a.stops[g][1]}function Wd(a,r,u){const f=a.base!==void 0?a.base:1;if(Jt(u)!=="number")return sa(a.default,r.default);const g=a.stops.length;if(g===1||u<=a.stops[0][0])return a.stops[0][1];if(u>=a.stops[g-1][0])return a.stops[g-1][1];const y=Ot(a.stops.map(D=>D[0]),u),b=function(D,O,U,$){const H=$-U,ae=D-U;return H===0?0:O===1?ae/H:(Math.pow(O,ae)-1)/(Math.pow(O,H)-1)}(u,f,a.stops[y][0],a.stops[y+1][0]),T=a.stops[y][1],S=a.stops[y+1][1];let M=Bn[r.type]||vn;if(a.colorSpace&&a.colorSpace!=="rgb"){const D=Nd[a.colorSpace];M=(O,U)=>D.reverse(D.interpolate(D.forward(O),D.forward(U),b))}return typeof T.evaluate=="function"?{evaluate(...D){const O=T.evaluate.apply(void 0,D),U=S.evaluate.apply(void 0,D);if(O!==void 0&&U!==void 0)return M(O,U,b)}}:M(T,S,b)}function fg(a,r,u){switch(r.type){case"color":u=K.parse(u);break;case"formatted":u=he.fromString(u.toString());break;case"resolvedImage":u=pe.fromString(u.toString());break;case"padding":u=le.parse(u);break;default:Jt(u)===r.type||r.type==="enum"&&r.values[u]||(u=void 0)}return sa(u,a.default,r.default)}Nt.register(ia,{error:[{kind:"error"},[It],(a,[r])=>{throw new Ye(r.evaluate(a))}],typeof:[It,[At],(a,[r])=>Qt(Pe(r.evaluate(a)))],"to-rgba":[oi(He,4),[Kn],(a,[r])=>r.evaluate(a).toArray()],rgb:[Kn,[He,He,He],jd],rgba:[Kn,[He,He,He,He],jd],has:{type:Pt,overloads:[[[It],(a,[r])=>Gd(r.evaluate(a),a.properties())],[[It,Dr],(a,[r,u])=>Gd(r.evaluate(a),u.evaluate(a))]]},get:{type:At,overloads:[[[It],(a,[r])=>Ql(r.evaluate(a),a.properties())],[[It,Dr],(a,[r,u])=>Ql(r.evaluate(a),u.evaluate(a))]]},"feature-state":[At,[It],(a,[r])=>Ql(r.evaluate(a),a.featureState||{})],properties:[Dr,[],a=>a.properties()],"geometry-type":[It,[],a=>a.geometryType()],id:[At,[],a=>a.id()],zoom:[He,[],a=>a.globals.zoom],"heatmap-density":[He,[],a=>a.globals.heatmapDensity||0],"line-progress":[He,[],a=>a.globals.lineProgress||0],accumulated:[At,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[He,xo(He),(a,r)=>{let u=0;for(const f of r)u+=f.evaluate(a);return u}],"*":[He,xo(He),(a,r)=>{let u=1;for(const f of r)u*=f.evaluate(a);return u}],"-":{type:He,overloads:[[[He,He],(a,[r,u])=>r.evaluate(a)-u.evaluate(a)],[[He],(a,[r])=>-r.evaluate(a)]]},"/":[He,[He,He],(a,[r,u])=>r.evaluate(a)/u.evaluate(a)],"%":[He,[He,He],(a,[r,u])=>r.evaluate(a)%u.evaluate(a)],ln2:[He,[],()=>Math.LN2],pi:[He,[],()=>Math.PI],e:[He,[],()=>Math.E],"^":[He,[He,He],(a,[r,u])=>Math.pow(r.evaluate(a),u.evaluate(a))],sqrt:[He,[He],(a,[r])=>Math.sqrt(r.evaluate(a))],log10:[He,[He],(a,[r])=>Math.log(r.evaluate(a))/Math.LN10],ln:[He,[He],(a,[r])=>Math.log(r.evaluate(a))],log2:[He,[He],(a,[r])=>Math.log(r.evaluate(a))/Math.LN2],sin:[He,[He],(a,[r])=>Math.sin(r.evaluate(a))],cos:[He,[He],(a,[r])=>Math.cos(r.evaluate(a))],tan:[He,[He],(a,[r])=>Math.tan(r.evaluate(a))],asin:[He,[He],(a,[r])=>Math.asin(r.evaluate(a))],acos:[He,[He],(a,[r])=>Math.acos(r.evaluate(a))],atan:[He,[He],(a,[r])=>Math.atan(r.evaluate(a))],min:[He,xo(He),(a,r)=>Math.min(...r.map(u=>u.evaluate(a)))],max:[He,xo(He),(a,r)=>Math.max(...r.map(u=>u.evaluate(a)))],abs:[He,[He],(a,[r])=>Math.abs(r.evaluate(a))],round:[He,[He],(a,[r])=>{const u=r.evaluate(a);return u<0?-Math.round(-u):Math.round(u)}],floor:[He,[He],(a,[r])=>Math.floor(r.evaluate(a))],ceil:[He,[He],(a,[r])=>Math.ceil(r.evaluate(a))],"filter-==":[Pt,[It,At],(a,[r,u])=>a.properties()[r.value]===u.value],"filter-id-==":[Pt,[At],(a,[r])=>a.id()===r.value],"filter-type-==":[Pt,[It],(a,[r])=>a.geometryType()===r.value],"filter-<":[Pt,[It,At],(a,[r,u])=>{const f=a.properties()[r.value],g=u.value;return typeof f==typeof g&&f<g}],"filter-id-<":[Pt,[At],(a,[r])=>{const u=a.id(),f=r.value;return typeof u==typeof f&&u<f}],"filter->":[Pt,[It,At],(a,[r,u])=>{const f=a.properties()[r.value],g=u.value;return typeof f==typeof g&&f>g}],"filter-id->":[Pt,[At],(a,[r])=>{const u=a.id(),f=r.value;return typeof u==typeof f&&u>f}],"filter-<=":[Pt,[It,At],(a,[r,u])=>{const f=a.properties()[r.value],g=u.value;return typeof f==typeof g&&f<=g}],"filter-id-<=":[Pt,[At],(a,[r])=>{const u=a.id(),f=r.value;return typeof u==typeof f&&u<=f}],"filter->=":[Pt,[It,At],(a,[r,u])=>{const f=a.properties()[r.value],g=u.value;return typeof f==typeof g&&f>=g}],"filter-id->=":[Pt,[At],(a,[r])=>{const u=a.id(),f=r.value;return typeof u==typeof f&&u>=f}],"filter-has":[Pt,[At],(a,[r])=>r.value in a.properties()],"filter-has-id":[Pt,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Pt,[oi(It)],(a,[r])=>r.value.indexOf(a.geometryType())>=0],"filter-id-in":[Pt,[oi(At)],(a,[r])=>r.value.indexOf(a.id())>=0],"filter-in-small":[Pt,[It,oi(At)],(a,[r,u])=>u.value.indexOf(a.properties()[r.value])>=0],"filter-in-large":[Pt,[It,oi(At)],(a,[r,u])=>function(f,g,y,b){for(;y<=b;){const T=y+b>>1;if(g[T]===f)return!0;g[T]>f?b=T-1:y=T+1}return!1}(a.properties()[r.value],u.value,0,u.value.length-1)],all:{type:Pt,overloads:[[[Pt,Pt],(a,[r,u])=>r.evaluate(a)&&u.evaluate(a)],[xo(Pt),(a,r)=>{for(const u of r)if(!u.evaluate(a))return!1;return!0}]]},any:{type:Pt,overloads:[[[Pt,Pt],(a,[r,u])=>r.evaluate(a)||u.evaluate(a)],[xo(Pt),(a,r)=>{for(const u of r)if(u.evaluate(a))return!0;return!1}]]},"!":[Pt,[Pt],(a,[r])=>!r.evaluate(a)],"is-supported-script":[Pt,[It],(a,[r])=>{const u=a.globals&&a.globals.isSupportedScript;return!u||u(r.evaluate(a))}],upcase:[It,[It],(a,[r])=>r.evaluate(a).toUpperCase()],downcase:[It,[It],(a,[r])=>r.evaluate(a).toLowerCase()],concat:[It,xo(At),(a,r)=>r.map(u=>rt(u.evaluate(a))).join("")],"resolved-locale":[It,[ir],(a,[r])=>r.evaluate(a).resolvedLocale()]});class ec{constructor(r,u){this.expression=r,this._warningHistory={},this._evaluator=new zt,this._defaultValue=u?function(f){return f.type==="color"&&fn(f.default)?new K(0,0,0,0):f.type==="color"?K.parse(f.default)||null:f.type==="padding"?le.parse(f.default)||null:f.default===void 0?null:f.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(r,u,f,g,y,b){return this._evaluator.globals=r,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(r,u,f,g,y,b){this._evaluator.globals=r,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Ye(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Ja(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in ia}function Qa(a,r){const u=new Ne(ia,[],r?function(g){const y={color:Kn,string:It,number:He,enum:It,boolean:Pt,formatted:$n,padding:$s,resolvedImage:Ln};return g.type==="array"?oi(y[g.value]||At,g.length):y[g.type]}(r):void 0),f=u.parse(a,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?$d(new ec(f,r)):ra(u.errors)}class el{constructor(r,u){this.kind=r,this._styleExpression=u,this.isStateDependent=r!=="constant"&&!J(u.expression)}evaluateWithoutErrorHandling(r,u,f,g,y,b){return this._styleExpression.evaluateWithoutErrorHandling(r,u,f,g,y,b)}evaluate(r,u,f,g,y,b){return this._styleExpression.evaluate(r,u,f,g,y,b)}}class zu{constructor(r,u,f,g){this.kind=r,this.zoomStops=f,this._styleExpression=u,this.isStateDependent=r!=="camera"&&!J(u.expression),this.interpolationType=g}evaluateWithoutErrorHandling(r,u,f,g,y,b){return this._styleExpression.evaluateWithoutErrorHandling(r,u,f,g,y,b)}evaluate(r,u,f,g,y,b){return this._styleExpression.evaluate(r,u,f,g,y,b)}interpolationFactor(r,u,f){return this.interpolationType?sr.interpolationFactor(this.interpolationType,r,u,f):0}}function qd(a,r){const u=Qa(a,r);if(u.result==="error")return u;const f=u.value.expression,g=G(f);if(!g&&!mn(r))return ra([new Ri("","data expressions not supported")]);const y=ue(f,["zoom"]);if(!y&&!Hd(r))return ra([new Ri("","zoom expressions not supported")]);const b=nc(f);return b||y?b instanceof Ri?ra([b]):b instanceof sr&&!jt(r)?ra([new Ri("",'"interpolate" expressions cannot be used with this property')]):$d(b?new zu(g?"camera":"composite",u.value,b.labels,b instanceof sr?b.interpolation:void 0):new el(g?"constant":"source",u.value)):ra([new Ri("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class tc{constructor(r,u){this._parameters=r,this._specification=u,Ei(this,Ka(this._parameters,this._specification))}static deserialize(r){return new tc(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function nc(a){let r=null;if(a instanceof Xl)r=nc(a.result);else if(a instanceof Zl){for(const u of a.args)if(r=nc(u),r)break}else(a instanceof En||a instanceof sr)&&a.input instanceof Nt&&a.input.name==="zoom"&&(r=a);return r instanceof Ri||a.eachChild(u=>{const f=nc(u);f instanceof Ri?r=f:!r&&f?r=new Ri("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&f&&r!==f&&(r=new Ri("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function Fr(a){const r=a.key,u=a.value,f=a.valueSpec||{},g=a.objectElementValidators||{},y=a.style,b=a.styleSpec;let T=[];const S=Jt(u);if(S!=="object")return[new We(r,u,`object expected, ${S} found`)];for(const M in u){const D=M.split(".")[0],O=f[D]||f["*"];let U;if(g[D])U=g[D];else if(f[D])U=ar;else if(g["*"])U=g["*"];else{if(!f["*"]){T.push(new We(r,u[M],`unknown property "${M}"`));continue}U=ar}T=T.concat(U({key:(r&&`${r}.`)+M,value:u[M],valueSpec:O,style:y,styleSpec:b,object:u,objectKey:M},u))}for(const M in f)g[M]||f[M].required&&f[M].default===void 0&&u[M]===void 0&&T.push(new We(r,u,`missing required property "${M}"`));return T}function Zd(a){const r=a.value,u=a.valueSpec,f=a.style,g=a.styleSpec,y=a.key,b=a.arrayElementValidator||ar;if(Jt(r)!=="array")return[new We(y,r,`array expected, ${Jt(r)} found`)];if(u.length&&r.length!==u.length)return[new We(y,r,`array length ${u.length} expected, length ${r.length} found`)];if(u["min-length"]&&r.length<u["min-length"])return[new We(y,r,`array length at least ${u["min-length"]} expected, length ${r.length} found`)];let T={type:u.value,values:u.values};g.$version<7&&(T.function=u.function),Jt(u.value)==="object"&&(T=u.value);let S=[];for(let M=0;M<r.length;M++)S=S.concat(b({array:r,arrayIndex:M,value:r[M],valueSpec:T,style:f,styleSpec:g,key:`${y}[${M}]`}));return S}function Ou(a){const r=a.key,u=a.value,f=a.valueSpec;let g=Jt(u);return g==="number"&&u!=u&&(g="NaN"),g!=="number"?[new We(r,u,`number expected, ${g} found`)]:"minimum"in f&&u<f.minimum?[new We(r,u,`${u} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&u>f.maximum?[new We(r,u,`${u} is greater than the maximum value ${f.maximum}`)]:[]}function Xd(a){const r=a.valueSpec,u=Bt(a.value.type);let f,g,y,b={};const T=u!=="categorical"&&a.value.property===void 0,S=!T,M=Jt(a.value.stops)==="array"&&Jt(a.value.stops[0])==="array"&&Jt(a.value.stops[0][0])==="object",D=Fr({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function($){if(u==="identity")return[new We($.key,$.value,'identity function may not have a "stops" property')];let H=[];const ae=$.value;return H=H.concat(Zd({key:$.key,value:ae,valueSpec:$.valueSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:O})),Jt(ae)==="array"&&ae.length===0&&H.push(new We($.key,ae,"array must have at least one stop")),H},default:function($){return ar({key:$.key,value:$.value,valueSpec:r,style:$.style,styleSpec:$.styleSpec})}}});return u==="identity"&&T&&D.push(new We(a.key,a.value,'missing required property "property"')),u==="identity"||a.value.stops||D.push(new We(a.key,a.value,'missing required property "stops"')),u==="exponential"&&a.valueSpec.expression&&!jt(a.valueSpec)&&D.push(new We(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(S&&!mn(a.valueSpec)?D.push(new We(a.key,a.value,"property functions not supported")):T&&!Hd(a.valueSpec)&&D.push(new We(a.key,a.value,"zoom functions not supported"))),u!=="categorical"&&!M||a.value.property!==void 0||D.push(new We(a.key,a.value,'"property" property is required')),D;function O($){let H=[];const ae=$.value,se=$.key;if(Jt(ae)!=="array")return[new We(se,ae,`array expected, ${Jt(ae)} found`)];if(ae.length!==2)return[new We(se,ae,`array length 2 expected, length ${ae.length} found`)];if(M){if(Jt(ae[0])!=="object")return[new We(se,ae,`object expected, ${Jt(ae[0])} found`)];if(ae[0].zoom===void 0)return[new We(se,ae,"object stop key must have zoom")];if(ae[0].value===void 0)return[new We(se,ae,"object stop key must have value")];if(y&&y>Bt(ae[0].zoom))return[new We(se,ae[0].zoom,"stop zoom values must appear in ascending order")];Bt(ae[0].zoom)!==y&&(y=Bt(ae[0].zoom),g=void 0,b={}),H=H.concat(Fr({key:`${se}[0]`,value:ae[0],valueSpec:{zoom:{}},style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:Ou,value:U}}))}else H=H.concat(U({key:`${se}[0]`,value:ae[0],valueSpec:{},style:$.style,styleSpec:$.styleSpec},ae));return Ja($i(ae[1]))?H.concat([new We(`${se}[1]`,ae[1],"expressions are not allowed in function stops.")]):H.concat(ar({key:`${se}[1]`,value:ae[1],valueSpec:r,style:$.style,styleSpec:$.styleSpec}))}function U($,H){const ae=Jt($.value),se=Bt($.value),ve=$.value!==null?$.value:H;if(f){if(ae!==f)return[new We($.key,ve,`${ae} stop domain type must match previous stop domain type ${f}`)]}else f=ae;if(ae!=="number"&&ae!=="string"&&ae!=="boolean")return[new We($.key,ve,"stop domain value must be a number, string, or boolean")];if(ae!=="number"&&u!=="categorical"){let Te=`number expected, ${ae} found`;return mn(r)&&u===void 0&&(Te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new We($.key,ve,Te)]}return u!=="categorical"||ae!=="number"||isFinite(se)&&Math.floor(se)===se?u!=="categorical"&&ae==="number"&&g!==void 0&&se<g?[new We($.key,ve,"stop domain values must appear in ascending order")]:(g=se,u==="categorical"&&se in b?[new We($.key,ve,"stop domain values must be unique")]:(b[se]=!0,[])):[new We($.key,ve,`integer expected, found ${se}`)]}}function bo(a){const r=(a.expressionContext==="property"?qd:Qa)($i(a.value),a.valueSpec);if(r.result==="error")return r.value.map(f=>new We(`${a.key}${f.key}`,a.value,f.message));const u=r.value.expression||r.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!u.outputDefined())return[new We(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!J(u))return[new We(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!J(u))return[new We(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!ue(u,["zoom","feature-state"]))return[new We(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!G(u))return[new We(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function tl(a){const r=a.key,u=a.value,f=a.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(Bt(u))===-1&&g.push(new We(r,u,`expected one of [${f.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(f.values).indexOf(Bt(u))===-1&&g.push(new We(r,u,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(u)} found`)),g}function oa(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const r of a.slice(1))if(!oa(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}const pg={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ic(a){if(a==null)return{filter:()=>!0,needGeometry:!1};oa(a)||(a=nl(a));const r=Qa(a,pg);if(r.result==="error")throw new Error(r.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,f,g)=>r.value.evaluate(u,f,{},g),needGeometry:Kd(a)}}function Yd(a,r){return a<r?-1:a>r?1:0}function Kd(a){if(!Array.isArray(a))return!1;if(a[0]==="within")return!0;for(let r=1;r<a.length;r++)if(Kd(a[r]))return!0;return!1}function nl(a){if(!a)return!0;const r=a[0];return a.length<=1?r!=="any":r==="=="?Fu(a[1],a[2],"=="):r==="!="?aa(Fu(a[1],a[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Fu(a[1],a[2],r):r==="any"?(u=a.slice(1),["any"].concat(u.map(nl))):r==="all"?["all"].concat(a.slice(1).map(nl)):r==="none"?["all"].concat(a.slice(1).map(nl).map(aa)):r==="in"?rc(a[1],a.slice(2)):r==="!in"?aa(rc(a[1],a.slice(2))):r==="has"?il(a[1]):r==="!has"?aa(il(a[1])):r!=="within"||a;var u}function Fu(a,r,u){switch(a){case"$type":return[`filter-type-${u}`,r];case"$id":return[`filter-id-${u}`,r];default:return[`filter-${u}`,a,r]}}function rc(a,r){if(r.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(u=>typeof u!=typeof r[0])?["filter-in-large",a,["literal",r.sort(Yd)]]:["filter-in-small",a,["literal",r]]}}function il(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function aa(a){return["!",a]}function rl(a){return oa($i(a.value))?bo(Ei({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Jd(a)}function Jd(a){const r=a.value,u=a.key;if(Jt(r)!=="array")return[new We(u,r,`array expected, ${Jt(r)} found`)];const f=a.styleSpec;let g,y=[];if(r.length<1)return[new We(u,r,"filter array must have at least 1 element")];switch(y=y.concat(tl({key:`${u}[0]`,value:r[0],valueSpec:f.filter_operator,style:a.style,styleSpec:a.styleSpec})),Bt(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&Bt(r[1])==="$type"&&y.push(new We(u,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&y.push(new We(u,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(g=Jt(r[1]),g!=="string"&&y.push(new We(`${u}[1]`,r[1],`string expected, ${g} found`)));for(let b=2;b<r.length;b++)g=Jt(r[b]),Bt(r[1])==="$type"?y=y.concat(tl({key:`${u}[${b}]`,value:r[b],valueSpec:f.geometry_type,style:a.style,styleSpec:a.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&y.push(new We(`${u}[${b}]`,r[b],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let b=1;b<r.length;b++)y=y.concat(Jd({key:`${u}[${b}]`,value:r[b],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":g=Jt(r[1]),r.length!==2?y.push(new We(u,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="string"&&y.push(new We(`${u}[1]`,r[1],`string expected, ${g} found`));break;case"within":g=Jt(r[1]),r.length!==2?y.push(new We(u,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="object"&&y.push(new We(`${u}[1]`,r[1],`object expected, ${g} found`))}return y}function sl(a,r){const u=a.key,f=a.style,g=a.styleSpec,y=a.value,b=a.objectKey,T=g[`${r}_${a.layerType}`];if(!T)return[];const S=b.match(/^(.*)-transition$/);if(r==="paint"&&S&&T[S[1]]&&T[S[1]].transition)return ar({key:u,value:y,valueSpec:g.transition,style:f,styleSpec:g});const M=a.valueSpec||T[b];if(!M)return[new We(u,y,`unknown property "${b}"`)];let D;if(Jt(y)==="string"&&mn(M)&&!M.tokens&&(D=/^{([^}]+)}$/.exec(y)))return[new We(u,y,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(D[1])} }\`.`)];const O=[];return a.layerType==="symbol"&&(b==="text-field"&&f&&!f.glyphs&&O.push(new We(u,y,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&fn($i(y))&&Bt(y.type)==="identity"&&O.push(new We(u,y,'"text-font" does not support identity functions'))),O.concat(ar({key:a.key,value:y,valueSpec:M,style:f,styleSpec:g,expressionContext:"property",propertyType:r,propertyKey:b}))}function Qd(a){return sl(a,"paint")}function ef(a){return sl(a,"layout")}function tf(a){let r=[];const u=a.value,f=a.key,g=a.style,y=a.styleSpec;u.type||u.ref||r.push(new We(f,u,'either "type" or "ref" is required'));let b=Bt(u.type);const T=Bt(u.ref);if(u.id){const S=Bt(u.id);for(let M=0;M<a.arrayIndex;M++){const D=g.layers[M];Bt(D.id)===S&&r.push(new We(f,u.id,`duplicate layer id "${u.id}", previously used at line ${D.id.__line__}`))}}if("ref"in u){let S;["type","source","source-layer","filter","layout"].forEach(M=>{M in u&&r.push(new We(f,u[M],`"${M}" is prohibited for ref layers`))}),g.layers.forEach(M=>{Bt(M.id)===T&&(S=M)}),S?S.ref?r.push(new We(f,u.ref,"ref cannot reference another ref layer")):b=Bt(S.type):r.push(new We(f,u.ref,`ref layer "${T}" not found`))}else if(b!=="background")if(u.source){const S=g.sources&&g.sources[u.source],M=S&&Bt(S.type);S?M==="vector"&&b==="raster"?r.push(new We(f,u.source,`layer "${u.id}" requires a raster source`)):M==="raster"&&b!=="raster"?r.push(new We(f,u.source,`layer "${u.id}" requires a vector source`)):M!=="vector"||u["source-layer"]?M==="raster-dem"&&b!=="hillshade"?r.push(new We(f,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):b!=="line"||!u.paint||!u.paint["line-gradient"]||M==="geojson"&&S.lineMetrics||r.push(new We(f,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new We(f,u,`layer "${u.id}" must specify a "source-layer"`)):r.push(new We(f,u.source,`source "${u.source}" not found`))}else r.push(new We(f,u,'missing required property "source"'));return r=r.concat(Fr({key:f,value:u,valueSpec:y.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ar({key:`${f}.type`,value:u.type,valueSpec:y.layer.type,style:a.style,styleSpec:a.styleSpec,object:u,objectKey:"type"}),filter:rl,layout:S=>Fr({layer:u,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":M=>ef(Ei({layerType:b},M))}}),paint:S=>Fr({layer:u,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":M=>Qd(Ei({layerType:b},M))}})}})),r}function la(a){const r=a.value,u=a.key,f=Jt(r);return f!=="string"?[new We(u,r,`string expected, ${f} found`)]:[]}const nf={promoteId:function({key:a,value:r}){if(Jt(r)==="string")return la({key:a,value:r});{const u=[];for(const f in r)u.push(...la({key:`${a}.${f}`,value:r[f]}));return u}}};function ol(a){const r=a.value,u=a.key,f=a.styleSpec,g=a.style;if(!r.type)return[new We(u,r,'"type" is required')];const y=Bt(r.type);let b;switch(y){case"vector":case"raster":case"raster-dem":return b=Fr({key:u,value:r,valueSpec:f[`source_${y.replace("-","_")}`],style:a.style,styleSpec:f,objectElementValidators:nf}),b;case"geojson":if(b=Fr({key:u,value:r,valueSpec:f.source_geojson,style:g,styleSpec:f,objectElementValidators:nf}),r.cluster)for(const T in r.clusterProperties){const[S,M]=r.clusterProperties[T],D=typeof S=="string"?[S,["accumulated"],["get",T]]:S;b.push(...bo({key:`${u}.${T}.map`,value:M,expressionContext:"cluster-map"})),b.push(...bo({key:`${u}.${T}.reduce`,value:D,expressionContext:"cluster-reduce"}))}return b;case"video":return Fr({key:u,value:r,valueSpec:f.source_video,style:g,styleSpec:f});case"image":return Fr({key:u,value:r,valueSpec:f.source_image,style:g,styleSpec:f});case"canvas":return[new We(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return tl({key:`${u}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:f})}}function al(a){const r=a.value,u=a.styleSpec,f=u.light,g=a.style;let y=[];const b=Jt(r);if(r===void 0)return y;if(b!=="object")return y=y.concat([new We("light",r,`object expected, ${b} found`)]),y;for(const T in r){const S=T.match(/^(.*)-transition$/);y=y.concat(S&&f[S[1]]&&f[S[1]].transition?ar({key:T,value:r[T],valueSpec:u.transition,style:g,styleSpec:u}):f[T]?ar({key:T,value:r[T],valueSpec:f[T],style:g,styleSpec:u}):[new We(T,r[T],`unknown property "${T}"`)])}return y}function or(a){const r=a.value,u=a.styleSpec,f=u.terrain,g=a.style;let y=[];const b=Jt(r);if(r===void 0)return y;if(b!=="object")return y=y.concat([new We("terrain",r,`object expected, ${b} found`)]),y;for(const T in r)y=y.concat(f[T]?ar({key:T,value:r[T],valueSpec:f[T],style:g,styleSpec:u}):[new We(T,r[T],`unknown property "${T}"`)]);return y}const ll={"*":()=>[],array:Zd,boolean:function(a){const r=a.value,u=a.key,f=Jt(r);return f!=="boolean"?[new We(u,r,`boolean expected, ${f} found`)]:[]},number:Ou,color:function(a){const r=a.key,u=a.value,f=Jt(u);return f!=="string"?[new We(r,u,`color expected, ${f} found`)]:Ws(u)===null?[new We(r,u,`color expected, "${u}" found`)]:[]},constants:rs,enum:tl,filter:rl,function:Xd,layer:tf,object:Fr,source:ol,light:al,terrain:or,string:la,formatted:function(a){return la(a).length===0?[]:bo(a)},resolvedImage:function(a){return la(a).length===0?[]:bo(a)},padding:function(a){const r=a.key,u=a.value;if(Jt(u)==="array"){if(u.length<1||u.length>4)return[new We(r,u,`padding requires 1 to 4 values; ${u.length} values found`)];const f={type:"number"};let g=[];for(let y=0;y<u.length;y++)g=g.concat(ar({key:`${r}[${y}]`,value:u[y],valueSpec:f}));return g}return Ou({key:r,value:u,valueSpec:{}})}};function ar(a){const r=a.value,u=a.valueSpec,f=a.styleSpec;return u.expression&&fn(Bt(r))?Xd(a):u.expression&&Ja($i(r))?bo(a):u.type&&ll[u.type]?ll[u.type](a):Fr(Ei({},a,{valueSpec:u.type?f[u.type]:u}))}function mg(a){const r=a.value,u=a.key,f=la(a);return f.length||(r.indexOf("{fontstack}")===-1&&f.push(new We(u,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&f.push(new We(u,r,'"glyphs" url must include a "{range}" token'))),f}function Zs(a,r=Me){let u=[];return u=u.concat(ar({key:"",value:a,valueSpec:r.$root,styleSpec:r,style:a,objectElementValidators:{glyphs:mg,"*":()=>[]}})),a.constants&&(u=u.concat(rs({key:"constants",value:a.constants,style:a,styleSpec:r}))),rf(u)}function rf(a){return[].concat(a).sort((r,u)=>r.line-u.line)}function Ts(a){return function(...r){return rf(a.apply(this,r))}}Zs.source=Ts(ol),Zs.light=Ts(al),Zs.terrain=Ts(or),Zs.layer=Ts(tf),Zs.filter=Ts(rl),Zs.paintProperty=Ts(Qd),Zs.layoutProperty=Ts(ef);const cl=Zs,Bu=cl.light,gg=cl.paintProperty,_g=cl.layoutProperty;function sc(a,r){let u=!1;if(r&&r.length)for(const f of r)a.fire(new Gs(new Error(f.message))),u=!0;return u}class ul{constructor(r,u,f){const g=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const b=new Int32Array(this.arrayBuffer);r=b[0],this.d=(u=b[1])+2*(f=b[2]);for(let S=0;S<this.d*this.d;S++){const M=b[3+S],D=b[3+S+1];g.push(M===D?null:b.subarray(M,D))}const T=b[3+g.length+1];this.keys=b.subarray(b[3+g.length],T),this.bboxes=b.subarray(T),this.insert=this._insertReadonly}else{this.d=u+2*f;for(let b=0;b<this.d*this.d;b++)g.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=r,this.padding=f,this.scale=u/r,this.uid=0;const y=f/u*r;this.min=-y,this.max=r+y}insert(r,u,f,g,y){this._forEachCell(u,f,g,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,u,f,g,y,b){this.cells[y].push(b)}query(r,u,f,g,y){const b=this.min,T=this.max;if(r<=b&&u<=b&&T<=f&&T<=g&&!y)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(r,u,f,g,this._queryCell,S,{},y),S}}_queryCell(r,u,f,g,y,b,T,S){const M=this.cells[y];if(M!==null){const D=this.keys,O=this.bboxes;for(let U=0;U<M.length;U++){const $=M[U];if(T[$]===void 0){const H=4*$;(S?S(O[H+0],O[H+1],O[H+2],O[H+3]):r<=O[H+2]&&u<=O[H+3]&&f>=O[H+0]&&g>=O[H+1])?(T[$]=!0,b.push(D[$])):T[$]=!1}}}}_forEachCell(r,u,f,g,y,b,T,S){const M=this._convertToCellCoord(r),D=this._convertToCellCoord(u),O=this._convertToCellCoord(f),U=this._convertToCellCoord(g);for(let $=M;$<=O;$++)for(let H=D;H<=U;H++){const ae=this.d*H+$;if((!S||S(this._convertFromCellCoord($),this._convertFromCellCoord(H),this._convertFromCellCoord($+1),this._convertFromCellCoord(H+1)))&&y.call(this,r,u,f,g,ae,b,T,S))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,u=3+this.cells.length+1+1;let f=0;for(let b=0;b<this.cells.length;b++)f+=this.cells[b].length;const g=new Int32Array(u+f+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let y=u;for(let b=0;b<r.length;b++){const T=r[b];g[3+b]=y,g.set(T,y),y+=T.length}return g[3+r.length]=y,g.set(this.keys,y),y+=this.keys.length,g[3+r.length+1]=y,g.set(this.bboxes,y),y+=this.bboxes.length,g.buffer}static serialize(r,u){const f=r.toArrayBuffer();return u&&u.push(f),{buffer:f}}static deserialize(r){return new ul(r.buffer)}}const Ss={};function st(a,r,u={}){if(Ss[a])throw new Error(`${a} is already registered.`);Object.defineProperty(r,"_classRegistryKey",{value:a,writeable:!1}),Ss[a]={klass:r,omit:u.omit||[],shallow:u.shallow||[]}}st("Object",Object),st("TransferableGridIndex",ul),st("Color",K),st("Error",Error),st("AJAXError",Yn),st("ResolvedImage",pe),st("StylePropertyFunction",tc),st("StyleExpression",ec,{omit:["_evaluator"]}),st("ZoomDependentExpression",zu),st("ZoomConstantExpression",el),st("CompoundExpression",Nt,{omit:["_evaluate"]});for(const a in ia)ia[a]._classRegistryKey||st(`Expression_${a}`,ia[a]);function sf(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function wo(a,r){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob)return a;if(sf(a)||Mt(a))return r&&r.push(a),a;if(ArrayBuffer.isView(a)){const u=a;return r&&r.push(u.buffer),u}if(a instanceof ImageData)return r&&r.push(a.data.buffer),a;if(Array.isArray(a)){const u=[];for(const f of a)u.push(wo(f,r));return u}if(typeof a=="object"){const u=a.constructor,f=u._classRegistryKey;if(!f)throw new Error("can't serialize object of unregistered class");if(!Ss[f])throw new Error(`${f} is not registered.`);const g=u.serialize?u.serialize(a,r):{};if(u.serialize){if(r&&g===r[r.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const y in a){if(!a.hasOwnProperty(y)||Ss[f].omit.indexOf(y)>=0)continue;const b=a[y];g[y]=Ss[f].shallow.indexOf(y)>=0?b:wo(b,r)}a instanceof Error&&(g.message=a.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(g.$name=f),g}throw new Error("can't serialize object of type "+typeof a)}function Xs(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||sf(a)||Mt(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(Xs);if(typeof a=="object"){const r=a.$name||"Object";if(!Ss[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:u}=Ss[r];if(!u)throw new Error(`can't deserialize unregistered class ${r}`);if(u.deserialize)return u.deserialize(a);const f=Object.create(u.prototype);for(const g of Object.keys(a)){if(g==="$name")continue;const y=a[g];f[g]=Ss[r].shallow.indexOf(g)>=0?y:Xs(y)}return f}throw new Error("can't deserialize object of type "+typeof a)}class Nu{constructor(){this.first=!0}update(r,u){const f=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=u),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=f,!0))}}const Ke={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function oc(a){for(const r of a)if(Vu(r.charCodeAt(0)))return!0;return!1}function yg(a){for(const r of a)if(!Uu(r.charCodeAt(0)))return!1;return!0}function Uu(a){return!(Ke.Arabic(a)||Ke["Arabic Supplement"](a)||Ke["Arabic Extended-A"](a)||Ke["Arabic Presentation Forms-A"](a)||Ke["Arabic Presentation Forms-B"](a))}function Vu(a){return!(a!==746&&a!==747&&(a<4352||!(Ke["Bopomofo Extended"](a)||Ke.Bopomofo(a)||Ke["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Ke["CJK Compatibility Ideographs"](a)||Ke["CJK Compatibility"](a)||Ke["CJK Radicals Supplement"](a)||Ke["CJK Strokes"](a)||!(!Ke["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Ke["CJK Unified Ideographs Extension A"](a)||Ke["CJK Unified Ideographs"](a)||Ke["Enclosed CJK Letters and Months"](a)||Ke["Hangul Compatibility Jamo"](a)||Ke["Hangul Jamo Extended-A"](a)||Ke["Hangul Jamo Extended-B"](a)||Ke["Hangul Jamo"](a)||Ke["Hangul Syllables"](a)||Ke.Hiragana(a)||Ke["Ideographic Description Characters"](a)||Ke.Kanbun(a)||Ke["Kangxi Radicals"](a)||Ke["Katakana Phonetic Extensions"](a)||Ke.Katakana(a)&&a!==12540||!(!Ke["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Ke["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Ke["Unified Canadian Aboriginal Syllabics"](a)||Ke["Unified Canadian Aboriginal Syllabics Extended"](a)||Ke["Vertical Forms"](a)||Ke["Yijing Hexagram Symbols"](a)||Ke["Yi Syllables"](a)||Ke["Yi Radicals"](a))))}function of(a){return!(Vu(a)||function(r){return!!(Ke["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||Ke["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||Ke["Letterlike Symbols"](r)||Ke["Number Forms"](r)||Ke["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||Ke["Control Pictures"](r)&&r!==9251||Ke["Optical Character Recognition"](r)||Ke["Enclosed Alphanumerics"](r)||Ke["Geometric Shapes"](r)||Ke["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||Ke["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Ke["CJK Symbols and Punctuation"](r)||Ke.Katakana(r)||Ke["Private Use Area"](r)||Ke["CJK Compatibility Forms"](r)||Ke["Small Form Variants"](r)||Ke["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(a))}function af(a){return a>=1424&&a<=2303||Ke["Arabic Presentation Forms-A"](a)||Ke["Arabic Presentation Forms-B"](a)}function vg(a,r){return!(!r&&af(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Ke.Khmer(a))}function lf(a){for(const r of a)if(af(r.charCodeAt(0)))return!0;return!1}const ju="deferred",Gu="loading",$u="loaded";let Hu=null,Hi="unavailable",Ys=null;const cf=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Hi="error"),Hu&&Hu(a)};function ca(){Wu.fire(new Rr("pluginStateChange",{pluginStatus:Hi,pluginURL:Ys}))}const Wu=new vr,hl=function(){return Hi},uf=function(){if(Hi!==ju||!Ys)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Hi=Gu,ca(),Ys&&Gi({url:Ys},a=>{a?cf(a):(Hi=$u,ca())})},wr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Hi===$u||wr.applyArabicShaping!=null,isLoading:()=>Hi===Gu,setState(a){if(!Fe())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Hi=a.pluginStatus,Ys=a.pluginURL},isParsed(){if(!Fe())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return wr.applyArabicShaping!=null&&wr.processBidirectionalText!=null&&wr.processStyledBidirectionalText!=null},getPluginURL(){if(!Fe())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Ys}};class xn{constructor(r,u){this.zoom=r,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Nu,this.transition={})}isSupportedScript(r){return function(u,f){for(const g of u)if(!vg(g.charCodeAt(0),f))return!1;return!0}(r,wr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,u=r-Math.floor(r),f=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*u}}}class dl{constructor(r,u){this.property=r,this.value=u,this.expression=function(f,g){if(fn(f))return new tc(f,g);if(Ja(f)){const y=qd(f,g);if(y.result==="error")throw new Error(y.value.map(b=>`${b.key}: ${b.message}`).join(", "));return y.value}{let y=f;return g.type==="color"&&typeof f=="string"?y=K.parse(f):g.type!=="padding"||typeof f!="number"&&!Array.isArray(f)||(y=le.parse(f)),{kind:"constant",evaluate:()=>y}}}(u===void 0?r.specification.default:u,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,u,f){return this.property.possiblyEvaluate(this,r,u,f)}}class ac{constructor(r){this.property=r,this.value=new dl(r,void 0)}transitioned(r,u){return new df(this.property,this.value,u,X({},r.transition,this.transition),r.now)}untransitioned(){return new df(this.property,this.value,null,{},0)}}class hf{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return q(this._values[r].value.value)}setValue(r,u){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new ac(this._values[r].property)),this._values[r].value=new dl(this._values[r].property,u===null?void 0:q(u))}getTransition(r){return q(this._values[r].transition)}setTransition(r,u){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new ac(this._values[r].property)),this._values[r].transition=q(u)||void 0}serialize(){const r={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(r[u]=f);const g=this.getTransition(u);g!==void 0&&(r[`${u}-transition`]=g)}return r}transitioned(r,u){const f=new ff(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].transitioned(r,u._values[g]);return f}untransitioned(){const r=new ff(this._properties);for(const u of Object.keys(this._values))r._values[u]=this._values[u].untransitioned();return r}}class df{constructor(r,u,f,g,y){this.property=r,this.value=u,this.begin=y+g.delay||0,this.end=this.begin+g.duration||0,r.specification.transition&&(g.delay||g.duration)&&(this.prior=f)}possiblyEvaluate(r,u,f){const g=r.now||0,y=this.value.possiblyEvaluate(r,u,f),b=this.prior;if(b){if(g>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(g<this.begin)return b.possiblyEvaluate(r,u,f);{const T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(r,u,f),y,function(S){if(S<=0)return 0;if(S>=1)return 1;const M=S*S,D=M*S;return 4*(S<.5?D:3*(S-M)+D-.75)}(T))}}return y}}class ff{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,u,f){const g=new fl(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].possiblyEvaluate(r,u,f);return g}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class xg{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return q(this._values[r].value)}setValue(r,u){this._values[r]=new dl(this._values[r].property,u===null?void 0:q(u))}serialize(){const r={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(r[u]=f)}return r}possiblyEvaluate(r,u,f){const g=new fl(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].possiblyEvaluate(r,u,f);return g}}class as{constructor(r,u,f){this.property=r,this.value=u,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,u,f,g){return this.property.evaluate(this.value,this.parameters,r,u,f,g)}}class fl{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class dt{constructor(r){this.specification=r}possiblyEvaluate(r,u){if(r.isDataDriven())throw new Error("Value should not be data driven");return r.expression.evaluate(u)}interpolate(r,u,f){const g=Bn[this.specification.type];return g?g(r,u,f):r}}class bt{constructor(r,u){this.specification=r,this.overrides=u}possiblyEvaluate(r,u,f,g){return new as(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(u,null,{},f,g)}:r.expression,u)}interpolate(r,u,f){if(r.value.kind!=="constant"||u.value.kind!=="constant")return r;if(r.value.value===void 0||u.value.value===void 0)return new as(this,{kind:"constant",value:void 0},r.parameters);const g=Bn[this.specification.type];return g?new as(this,{kind:"constant",value:g(r.value.value,u.value.value,f)},r.parameters):r}evaluate(r,u,f,g,y,b){return r.kind==="constant"?r.value:r.evaluate(u,f,g,y,b)}}class ua extends bt{possiblyEvaluate(r,u,f,g){if(r.value===void 0)return new as(this,{kind:"constant",value:void 0},u);if(r.expression.kind==="constant"){const y=r.expression.evaluate(u,null,{},f,g),b=r.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,T=this._calculate(b,b,b,u);return new as(this,{kind:"constant",value:T},u)}if(r.expression.kind==="camera"){const y=this._calculate(r.expression.evaluate({zoom:u.zoom-1}),r.expression.evaluate({zoom:u.zoom}),r.expression.evaluate({zoom:u.zoom+1}),u);return new as(this,{kind:"constant",value:y},u)}return new as(this,r.expression,u)}evaluate(r,u,f,g,y,b){if(r.kind==="source"){const T=r.evaluate(u,f,g,y,b);return this._calculate(T,T,T,u)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(u.zoom)-1},f,g),r.evaluate({zoom:Math.floor(u.zoom)},f,g),r.evaluate({zoom:Math.floor(u.zoom)+1},f,g),u):r.value}_calculate(r,u,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:u}:{from:f,to:u}}interpolate(r){return r}}class qu{constructor(r){this.specification=r}possiblyEvaluate(r,u,f,g){if(r.value!==void 0){if(r.expression.kind==="constant"){const y=r.expression.evaluate(u,null,{},f,g);return this._calculate(y,y,y,u)}return this._calculate(r.expression.evaluate(new xn(Math.floor(u.zoom-1),u)),r.expression.evaluate(new xn(Math.floor(u.zoom),u)),r.expression.evaluate(new xn(Math.floor(u.zoom+1),u)),u)}}_calculate(r,u,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:u}:{from:f,to:u}}interpolate(r){return r}}class Ks{constructor(r){this.specification=r}possiblyEvaluate(r,u,f,g){return!!r.expression.evaluate(u,null,{},f,g)}interpolate(){return!1}}class mi{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in r){const f=r[u];f.specification.overridable&&this.overridableProperties.push(u);const g=this.defaultPropertyValues[u]=new dl(f,void 0),y=this.defaultTransitionablePropertyValues[u]=new ac(f);this.defaultTransitioningPropertyValues[u]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=g.possiblyEvaluate({})}}}st("DataDrivenProperty",bt),st("DataConstantProperty",dt),st("CrossFadedDataDrivenProperty",ua),st("CrossFadedProperty",qu),st("ColorRampProperty",Ks);const Js="-transition";class ls extends vr{constructor(r,u){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1},r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),u.layout&&(this._unevaluatedLayout=new xg(u.layout)),u.paint)){this._transitionablePaint=new hf(u.paint);for(const f in r.paint)this.setPaintProperty(f,r.paint[f],{validate:!1});for(const f in r.layout)this.setLayoutProperty(f,r.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fl(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,u,f={}){u!=null&&this._validate(_g,`layers.${this.id}.layout.${r}`,r,u,f)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,u):this.visibility=u)}getPaintProperty(r){return r.endsWith(Js)?this._transitionablePaint.getTransition(r.slice(0,-Js.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,u,f={}){if(u!=null&&this._validate(gg,`layers.${this.id}.paint.${r}`,r,u,f))return!1;if(r.endsWith(Js))return this._transitionablePaint.setTransition(r.slice(0,-Js.length),u||void 0),!1;{const g=this._transitionablePaint._values[r],y=g.property.specification["property-type"]==="cross-faded-data-driven",b=g.value.isDataDriven(),T=g.value;this._transitionablePaint.setValue(r,u),this._handleSpecialPaintPropertyUpdate(r);const S=this._transitionablePaint._values[r].value;return S.isDataDriven()||b||y||this._handleOverridablePaintPropertyUpdate(r,T,S)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,u,f){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,u){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,u)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),W(r,(u,f)=>!(u===void 0||f==="layout"&&!Object.keys(u).length||f==="paint"&&!Object.keys(u).length))}_validate(r,u,f,g,y={}){return(!y||y.validate!==!1)&&sc(this,r.call(cl,{key:u,layerType:this.type,objectKey:f,value:g,styleSpec:Me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const u=this.paint.get(r);if(u instanceof as&&mn(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const pf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Qs{constructor(r,u){this._structArray=r,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class kn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,u){return r._trim(),u&&(r.isTransferred=!0,u.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const u=Object.create(this.prototype);return u.arrayBuffer=r.arrayBuffer,u.length=r.length,u.capacity=r.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Hn(a,r=1){let u=0,f=0;return{members:a.map(g=>{const y=pf[g.type].BYTES_PER_ELEMENT,b=u=Zu(u,Math.max(r,y)),T=g.components||1;return f=Math.max(f,y),u+=y*T,{name:g.name,type:g.type,components:T,offset:b}}),size:Zu(u,Math.max(f,r)),alignment:r}}function Zu(a,r){return Math.ceil(a/r)*r}class Eo extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u){const f=this.length;return this.resize(f+1),this.emplace(f,r,u)}emplace(r,u,f){const g=2*r;return this.int16[g+0]=u,this.int16[g+1]=f,r}}Eo.prototype.bytesPerElement=4,st("StructArrayLayout2i4",Eo);class m extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,u,f,g)}emplace(r,u,f,g,y){const b=4*r;return this.int16[b+0]=u,this.int16[b+1]=f,this.int16[b+2]=g,this.int16[b+3]=y,r}}m.prototype.bytesPerElement=8,st("StructArrayLayout4i8",m);class s extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,u,f,g,y,b)}emplace(r,u,f,g,y,b,T){const S=6*r;return this.int16[S+0]=u,this.int16[S+1]=f,this.int16[S+2]=g,this.int16[S+3]=y,this.int16[S+4]=b,this.int16[S+5]=T,r}}s.prototype.bytesPerElement=12,st("StructArrayLayout2i4i12",s);class h extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,u,f,g,y,b)}emplace(r,u,f,g,y,b,T){const S=4*r,M=8*r;return this.int16[S+0]=u,this.int16[S+1]=f,this.uint8[M+4]=g,this.uint8[M+5]=y,this.uint8[M+6]=b,this.uint8[M+7]=T,r}}h.prototype.bytesPerElement=8,st("StructArrayLayout2i4ub8",h);class p extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u){const f=this.length;return this.resize(f+1),this.emplace(f,r,u)}emplace(r,u,f){const g=2*r;return this.float32[g+0]=u,this.float32[g+1]=f,r}}p.prototype.bytesPerElement=8,st("StructArrayLayout2f8",p);class _ extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,y,b,T,S,M,D){const O=this.length;return this.resize(O+1),this.emplace(O,r,u,f,g,y,b,T,S,M,D)}emplace(r,u,f,g,y,b,T,S,M,D,O){const U=10*r;return this.uint16[U+0]=u,this.uint16[U+1]=f,this.uint16[U+2]=g,this.uint16[U+3]=y,this.uint16[U+4]=b,this.uint16[U+5]=T,this.uint16[U+6]=S,this.uint16[U+7]=M,this.uint16[U+8]=D,this.uint16[U+9]=O,r}}_.prototype.bytesPerElement=20,st("StructArrayLayout10ui20",_);class x extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,y,b,T,S,M,D,O,U){const $=this.length;return this.resize($+1),this.emplace($,r,u,f,g,y,b,T,S,M,D,O,U)}emplace(r,u,f,g,y,b,T,S,M,D,O,U,$){const H=12*r;return this.int16[H+0]=u,this.int16[H+1]=f,this.int16[H+2]=g,this.int16[H+3]=y,this.uint16[H+4]=b,this.uint16[H+5]=T,this.uint16[H+6]=S,this.uint16[H+7]=M,this.int16[H+8]=D,this.int16[H+9]=O,this.int16[H+10]=U,this.int16[H+11]=$,r}}x.prototype.bytesPerElement=24,st("StructArrayLayout4i4ui4i24",x);class E extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,u,f)}emplace(r,u,f,g){const y=3*r;return this.float32[y+0]=u,this.float32[y+1]=f,this.float32[y+2]=g,r}}E.prototype.bytesPerElement=12,st("StructArrayLayout3f12",E);class A extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const u=this.length;return this.resize(u+1),this.emplace(u,r)}emplace(r,u){return this.uint32[1*r+0]=u,r}}A.prototype.bytesPerElement=4,st("StructArrayLayout1ul4",A);class I extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,y,b,T,S,M){const D=this.length;return this.resize(D+1),this.emplace(D,r,u,f,g,y,b,T,S,M)}emplace(r,u,f,g,y,b,T,S,M,D){const O=10*r,U=5*r;return this.int16[O+0]=u,this.int16[O+1]=f,this.int16[O+2]=g,this.int16[O+3]=y,this.int16[O+4]=b,this.int16[O+5]=T,this.uint32[U+3]=S,this.uint16[O+8]=M,this.uint16[O+9]=D,r}}I.prototype.bytesPerElement=20,st("StructArrayLayout6i1ul2ui20",I);class k extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,y,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,u,f,g,y,b)}emplace(r,u,f,g,y,b,T){const S=6*r;return this.int16[S+0]=u,this.int16[S+1]=f,this.int16[S+2]=g,this.int16[S+3]=y,this.int16[S+4]=b,this.int16[S+5]=T,r}}k.prototype.bytesPerElement=12,st("StructArrayLayout2i2i2i12",k);class z extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,r,u,f,g,y)}emplace(r,u,f,g,y,b){const T=4*r,S=8*r;return this.float32[T+0]=u,this.float32[T+1]=f,this.float32[T+2]=g,this.int16[S+6]=y,this.int16[S+7]=b,r}}z.prototype.bytesPerElement=16,st("StructArrayLayout2f1f2i16",z);class B extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,u,f,g)}emplace(r,u,f,g,y){const b=12*r,T=3*r;return this.uint8[b+0]=u,this.uint8[b+1]=f,this.float32[T+1]=g,this.float32[T+2]=y,r}}B.prototype.bytesPerElement=12,st("StructArrayLayout2ub2f12",B);class j extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,u,f)}emplace(r,u,f,g){const y=3*r;return this.uint16[y+0]=u,this.uint16[y+1]=f,this.uint16[y+2]=g,r}}j.prototype.bytesPerElement=6,st("StructArrayLayout3ui6",j);class ie extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,f,g,y,b,T,S,M,D,O,U,$,H,ae,se,ve){const Te=this.length;return this.resize(Te+1),this.emplace(Te,r,u,f,g,y,b,T,S,M,D,O,U,$,H,ae,se,ve)}emplace(r,u,f,g,y,b,T,S,M,D,O,U,$,H,ae,se,ve,Te){const _e=24*r,we=12*r,De=48*r;return this.int16[_e+0]=u,this.int16[_e+1]=f,this.uint16[_e+2]=g,this.uint16[_e+3]=y,this.uint32[we+2]=b,this.uint32[we+3]=T,this.uint32[we+4]=S,this.uint16[_e+10]=M,this.uint16[_e+11]=D,this.uint16[_e+12]=O,this.float32[we+7]=U,this.float32[we+8]=$,this.uint8[De+36]=H,this.uint8[De+37]=ae,this.uint8[De+38]=se,this.uint32[we+10]=ve,this.int16[_e+22]=Te,r}}ie.prototype.bytesPerElement=48,st("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ie);class te extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,f,g,y,b,T,S,M,D,O,U,$,H,ae,se,ve,Te,_e,we,De,Re,it,ct,Je,Ze,$e,Qe){const Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,r,u,f,g,y,b,T,S,M,D,O,U,$,H,ae,se,ve,Te,_e,we,De,Re,it,ct,Je,Ze,$e,Qe)}emplace(r,u,f,g,y,b,T,S,M,D,O,U,$,H,ae,se,ve,Te,_e,we,De,Re,it,ct,Je,Ze,$e,Qe,Xe){const Ue=34*r,yt=17*r;return this.int16[Ue+0]=u,this.int16[Ue+1]=f,this.int16[Ue+2]=g,this.int16[Ue+3]=y,this.int16[Ue+4]=b,this.int16[Ue+5]=T,this.int16[Ue+6]=S,this.int16[Ue+7]=M,this.uint16[Ue+8]=D,this.uint16[Ue+9]=O,this.uint16[Ue+10]=U,this.uint16[Ue+11]=$,this.uint16[Ue+12]=H,this.uint16[Ue+13]=ae,this.uint16[Ue+14]=se,this.uint16[Ue+15]=ve,this.uint16[Ue+16]=Te,this.uint16[Ue+17]=_e,this.uint16[Ue+18]=we,this.uint16[Ue+19]=De,this.uint16[Ue+20]=Re,this.uint16[Ue+21]=it,this.uint16[Ue+22]=ct,this.uint32[yt+12]=Je,this.float32[yt+13]=Ze,this.float32[yt+14]=$e,this.float32[yt+15]=Qe,this.float32[yt+16]=Xe,r}}te.prototype.bytesPerElement=68,st("StructArrayLayout8i15ui1ul4f68",te);class ne extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const u=this.length;return this.resize(u+1),this.emplace(u,r)}emplace(r,u){return this.float32[1*r+0]=u,r}}ne.prototype.bytesPerElement=4,st("StructArrayLayout1f4",ne);class de extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,u,f)}emplace(r,u,f,g){const y=3*r;return this.int16[y+0]=u,this.int16[y+1]=f,this.int16[y+2]=g,r}}de.prototype.bytesPerElement=6,st("StructArrayLayout3i6",de);class ge extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,u,f)}emplace(r,u,f,g){const y=4*r;return this.uint32[2*r+0]=u,this.uint16[y+2]=f,this.uint16[y+3]=g,r}}ge.prototype.bytesPerElement=8,st("StructArrayLayout1ul2ui8",ge);class xe extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,u){const f=this.length;return this.resize(f+1),this.emplace(f,r,u)}emplace(r,u,f){const g=2*r;return this.uint16[g+0]=u,this.uint16[g+1]=f,r}}xe.prototype.bytesPerElement=4,st("StructArrayLayout2ui4",xe);class re extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const u=this.length;return this.resize(u+1),this.emplace(u,r)}emplace(r,u){return this.uint16[1*r+0]=u,r}}re.prototype.bytesPerElement=2,st("StructArrayLayout1ui2",re);class Ee extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,u,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,u,f,g)}emplace(r,u,f,g,y){const b=4*r;return this.float32[b+0]=u,this.float32[b+1]=f,this.float32[b+2]=g,this.float32[b+3]=y,r}}Ee.prototype.bytesPerElement=16,st("StructArrayLayout4f16",Ee);class be extends Qs{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new vt(this.anchorPointX,this.anchorPointY)}}be.prototype.size=20;class Le extends I{get(r){return new be(this,r)}}st("CollisionBoxArray",Le);class ke extends Qs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ke.prototype.size=48;class Be extends ie{get(r){return new ke(this,r)}}st("PlacedSymbolArray",Be);class Ce extends Qs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Ce.prototype.size=68;class et extends te{get(r){return new Ce(this,r)}}st("SymbolInstanceArray",et);class qe extends ne{getoffsetX(r){return this.float32[1*r+0]}}st("GlyphOffsetArray",qe);class nt extends de{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}st("SymbolLineVertexArray",nt);class Ct extends Qs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ct.prototype.size=8;class Rt extends ge{get(r){return new Ct(this,r)}}st("FeatureIndexArray",Rt);class _t extends Eo{}class sn extends Eo{}class on extends Eo{}class $t extends s{}class Ht extends h{}class ln extends p{}class ai extends _{}class cs extends x{}class Br extends E{}class us extends A{}class eo extends k{}class Er extends B{}class Wi extends j{}class As extends xe{}const lc=Hn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Qn}=lc;class Ft{constructor(r=[]){this.segments=r}prepareSegment(r,u,f,g){let y=this.segments[this.segments.length-1];return r>Ft.MAX_VERTEX_ARRAY_LENGTH&&ye(`Max vertices per segment is ${Ft.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!y||y.vertexLength+r>Ft.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==g)&&(y={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},g!==void 0&&(y.sortKey=g),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const r of this.segments)for(const u in r.vaos)r.vaos[u].destroy()}static simpleSegment(r,u,f,g){return new Ft([{vertexOffset:r,primitiveOffset:u,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])}}function en(a,r){return 256*(a=P(Math.floor(a),0,255))+P(Math.floor(r),0,255)}Ft.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,st("SegmentVector",Ft);const li=Hn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ci={exports:{}},bn={exports:{}};bn.exports=function(a,r){var u,f,g,y,b,T,S,M;for(f=a.length-(u=3&a.length),g=r,b=3432918353,T=461845907,M=0;M<f;)S=255&a.charCodeAt(M)|(255&a.charCodeAt(++M))<<8|(255&a.charCodeAt(++M))<<16|(255&a.charCodeAt(++M))<<24,++M,g=27492+(65535&(y=5*(65535&(g=(g^=S=(65535&(S=(S=(65535&S)*b+(((S>>>16)*b&65535)<<16)&4294967295)<<15|S>>>17))*T+(((S>>>16)*T&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(S=0,u){case 3:S^=(255&a.charCodeAt(M+2))<<16;case 2:S^=(255&a.charCodeAt(M+1))<<8;case 1:g^=S=(65535&(S=(S=(65535&(S^=255&a.charCodeAt(M)))*b+(((S>>>16)*b&65535)<<16)&4294967295)<<15|S>>>17))*T+(((S>>>16)*T&65535)<<16)&4294967295}return g^=a.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Tr={exports:{}};Tr.exports=function(a,r){for(var u,f=a.length,g=r^f,y=0;f>=4;)u=1540483477*(65535&(u=255&a.charCodeAt(y)|(255&a.charCodeAt(++y))<<8|(255&a.charCodeAt(++y))<<16|(255&a.charCodeAt(++y))<<24))+((1540483477*(u>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++y;switch(f){case 3:g^=(255&a.charCodeAt(y+2))<<16;case 2:g^=(255&a.charCodeAt(y+1))<<8;case 1:g=1540483477*(65535&(g^=255&a.charCodeAt(y)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var To=bn.exports,Xu=Tr.exports;ci.exports=To,ci.exports.murmur3=To,ci.exports.murmur2=Xu;class ha{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,u,f,g){this.ids.push(mf(r)),this.positions.push(u,f,g)}getPositions(r){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=mf(r);let f=0,g=this.ids.length-1;for(;f<g;){const b=f+g>>1;this.ids[b]>=u?g=b:f=b+1}const y=[];for(;this.ids[f]===u;)y.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return y}static serialize(r,u){const f=new Float64Array(r.ids),g=new Uint32Array(r.positions);return Yu(f,g,0,f.length-1),u&&u.push(f.buffer,g.buffer),{ids:f,positions:g}}static deserialize(r){const u=new ha;return u.ids=r.ids,u.positions=r.positions,u.indexed=!0,u}}function mf(a){const r=+a;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:ci.exports(String(a))}function Yu(a,r,u,f){for(;u<f;){const g=a[u+f>>1];let y=u-1,b=f+1;for(;;){do y++;while(a[y]<g);do b--;while(a[b]>g);if(y>=b)break;to(a,y,b),to(r,3*y,3*b),to(r,3*y+1,3*b+1),to(r,3*y+2,3*b+2)}b-u<f-b?(Yu(a,r,u,b),u=b+1):(Yu(a,r,b+1,f),f=b)}}function to(a,r,u){const f=a[r];a[r]=a[u],a[u]=f}st("FeaturePositionMap",ha);class So{constructor(r,u){this.gl=r.gl,this.location=u}}class Ao extends So{constructor(r,u){super(r,u),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class cc extends So{constructor(r,u){super(r,u),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class gx extends So{constructor(r,u){super(r,u),this.current=K.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const AP=new Float32Array(16);function bg(a){return[en(255*a.r,255*a.g),en(255*a.b,255*a.a)]}class Ku{constructor(r,u,f){this.value=r,this.uniformNames=u.map(g=>`u_${g}`),this.type=f}setUniform(r,u,f){r.set(f.constantOr(this.value))}getBinding(r,u,f){return this.type==="color"?new gx(r,u):new Ao(r,u)}}class uc{constructor(r,u){this.uniformNames=u.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=r.tlbr}setUniform(r,u,f,g){const y=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&r.set(y)}getBinding(r,u,f){return f.substr(0,9)==="u_pattern"?new cc(r,u):new Ao(r,u)}}class Po{constructor(r,u,f,g){this.expression=r,this.type=f,this.maxValue=0,this.paintVertexAttributes=u.map(y=>({name:`a_${y}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(r,u,f,g,y){const b=this.paintVertexArray.length,T=this.expression.evaluate(new xn(0),u,{},g,[],y);this.paintVertexArray.resize(r),this._setPaintValue(b,r,T)}updatePaintArray(r,u,f,g){const y=this.expression.evaluate({zoom:0},f,g);this._setPaintValue(r,u,y)}_setPaintValue(r,u,f){if(this.type==="color"){const g=bg(f);for(let y=r;y<u;y++)this.paintVertexArray.emplace(y,g[0],g[1])}else{for(let g=r;g<u;g++)this.paintVertexArray.emplace(g,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ps{constructor(r,u,f,g,y,b){this.expression=r,this.uniformNames=u.map(T=>`u_${T}_t`),this.type=f,this.useIntegerZoom=g,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=u.map(T=>({name:`a_${T}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(r,u,f,g,y){const b=this.expression.evaluate(new xn(this.zoom),u,{},g,[],y),T=this.expression.evaluate(new xn(this.zoom+1),u,{},g,[],y),S=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(S,r,b,T)}updatePaintArray(r,u,f,g){const y=this.expression.evaluate({zoom:this.zoom},f,g),b=this.expression.evaluate({zoom:this.zoom+1},f,g);this._setPaintValue(r,u,y,b)}_setPaintValue(r,u,f,g){if(this.type==="color"){const y=bg(f),b=bg(g);for(let T=r;T<u;T++)this.paintVertexArray.emplace(T,y[0],y[1],b[0],b[1])}else{for(let y=r;y<u;y++)this.paintVertexArray.emplace(y,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,u){const f=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,g=P(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);r.set(g)}getBinding(r,u,f){return new Ao(r,u)}}class da{constructor(r,u,f,g,y,b){this.expression=r,this.type=u,this.useIntegerZoom=f,this.zoom=g,this.layerId=b,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(r,u,f){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(g,r,u.patterns&&u.patterns[this.layerId],f)}updatePaintArray(r,u,f,g,y){this._setPaintValues(r,u,f.patterns&&f.patterns[this.layerId],y)}_setPaintValues(r,u,f,g){if(!g||!f)return;const{min:y,mid:b,max:T}=f,S=g[y],M=g[b],D=g[T];if(S&&M&&D)for(let O=r;O<u;O++)this.zoomInPaintVertexArray.emplace(O,M.tl[0],M.tl[1],M.br[0],M.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],M.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,M.tl[0],M.tl[1],M.br[0],M.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],M.pixelRatio,D.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,li.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,li.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class _x{constructor(r,u,f){this.binders={},this._buffers=[];const g=[];for(const y in r.paint._values){if(!f(y))continue;const b=r.paint.get(y);if(!(b instanceof as&&mn(b.property.specification)))continue;const T=PP(y,r.type),S=b.value,M=b.property.specification.type,D=b.property.useIntegerZoom,O=b.property.specification["property-type"],U=O==="cross-faded"||O==="cross-faded-data-driven";if(S.kind==="constant")this.binders[y]=U?new uc(S.value,T):new Ku(S.value,T,M),g.push(`/u_${y}`);else if(S.kind==="source"||U){const $=yx(y,M,"source");this.binders[y]=U?new da(S,M,D,u,$,r.id):new Po(S,T,M,$),g.push(`/a_${y}`)}else{const $=yx(y,M,"composite");this.binders[y]=new Ps(S,T,M,D,u,$),g.push(`/z_${y}`)}}this.cacheKey=g.sort().join("")}getMaxValue(r){const u=this.binders[r];return u instanceof Po||u instanceof Ps?u.maxValue:0}populatePaintArrays(r,u,f,g,y){for(const b in this.binders){const T=this.binders[b];(T instanceof Po||T instanceof Ps||T instanceof da)&&T.populatePaintArray(r,u,f,g,y)}}setConstantPatternPositions(r,u){for(const f in this.binders){const g=this.binders[f];g instanceof uc&&g.setConstantPatternPositions(r,u)}}updatePaintArrays(r,u,f,g,y){let b=!1;for(const T in r){const S=u.getPositions(T);for(const M of S){const D=f.feature(M.index);for(const O in this.binders){const U=this.binders[O];if((U instanceof Po||U instanceof Ps||U instanceof da)&&U.expression.isStateDependent===!0){const $=g.paint.get(O);U.expression=$.value,U.updatePaintArray(M.start,M.end,D,r[T],y),b=!0}}}}return b}defines(){const r=[];for(const u in this.binders){const f=this.binders[u];(f instanceof Ku||f instanceof uc)&&r.push(...f.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return r}getBinderAttributes(){const r=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Po||f instanceof Ps)for(let g=0;g<f.paintVertexAttributes.length;g++)r.push(f.paintVertexAttributes[g].name);else if(f instanceof da)for(let g=0;g<li.members.length;g++)r.push(li.members[g].name)}return r}getBinderUniforms(){const r=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Ku||f instanceof uc||f instanceof Ps)for(const g of f.uniformNames)r.push(g)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,u){const f=[];for(const g in this.binders){const y=this.binders[g];if(y instanceof Ku||y instanceof uc||y instanceof Ps){for(const b of y.uniformNames)if(u[b]){const T=y.getBinding(r,u[b],b);f.push({name:b,property:g,binding:T})}}}return f}setUniforms(r,u,f,g){for(const{name:y,property:b,binding:T}of u)this.binders[b].setUniform(T,g,f.get(b),y)}updatePaintBuffers(r){this._buffers=[];for(const u in this.binders){const f=this.binders[u];if(r&&f instanceof da){const g=r.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof Po||f instanceof Ps)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(r){for(const u in this.binders){const f=this.binders[u];(f instanceof Po||f instanceof Ps||f instanceof da)&&f.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const u=this.binders[r];(u instanceof Po||u instanceof Ps||u instanceof da)&&u.destroy()}}}class pl{constructor(r,u,f=()=>!0){this.programConfigurations={};for(const g of r)this.programConfigurations[g.id]=new _x(g,u,f);this.needsUpload=!1,this._featureMap=new ha,this._bufferOffset=0}populatePaintArrays(r,u,f,g,y,b){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(r,u,g,y,b);u.id!==void 0&&this._featureMap.add(u.id,f,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,u,f,g){for(const y of f)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(r,this._featureMap,u,y,g)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function PP(a,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${r}-`,"").replace(/-/g,"_")]}function yx(a,r,u){const f={color:{source:p,composite:Ee},number:{source:ne,composite:p}},g=function(y){return{"line-pattern":{source:ai,composite:ai},"fill-pattern":{source:ai,composite:ai},"fill-extrusion-pattern":{source:ai,composite:ai}}[y]}(a);return g&&g[u]||f[r][u]}st("ConstantBinder",Ku),st("CrossFadedConstantBinder",uc),st("SourceExpressionBinder",Po),st("CrossFadedCompositeBinder",da),st("CompositeExpressionBinder",Ps),st("ProgramConfiguration",_x,{omit:["_buffers"]}),st("ProgramConfigurationSet",pl);var ei=8192;const wg=Math.pow(2,14)-1,vx=-wg-1;function ml(a){const r=ei/a.extent,u=a.loadGeometry();for(let f=0;f<u.length;f++){const g=u[f];for(let y=0;y<g.length;y++){const b=g[y],T=Math.round(b.x*r),S=Math.round(b.y*r);b.x=P(T,vx,wg),b.y=P(S,vx,wg),(T<b.x||T>b.x+1||S<b.y||S>b.y+1)&&ye("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function gl(a,r){return{type:a.type,id:a.id,properties:a.properties,geometry:r?ml(a):[]}}function gf(a,r,u,f,g){a.emplaceBack(2*r+(f+1)/2,2*u+(g+1)/2)}class Eg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(u=>u.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new sn,this.indexArray=new Wi,this.segments=new Ft,this.programConfigurations=new pl(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(r,u,f){const g=this.layers[0],y=[];let b=null,T=!1;g.type==="circle"&&(b=g.layout.get("circle-sort-key"),T=!b.isConstant());for(const{feature:S,id:M,index:D,sourceLayerIndex:O}of r){const U=this.layers[0]._featureFilter.needGeometry,$=gl(S,U);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom),$,f))continue;const H=T?b.evaluate($,{},f):void 0,ae={id:M,properties:S.properties,type:S.type,sourceLayerIndex:O,index:D,geometry:U?$.geometry:ml(S),patterns:{},sortKey:H};y.push(ae)}T&&y.sort((S,M)=>S.sortKey-M.sortKey);for(const S of y){const{geometry:M,index:D,sourceLayerIndex:O}=S,U=r[D].feature;this.addFeature(S,M,D,f),u.featureIndex.insert(U,M,D,O,this.index)}}update(r,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Qn),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,u,f,g){for(const y of u)for(const b of y){const T=b.x,S=b.y;if(T<0||T>=ei||S<0||S>=ei)continue;const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),D=M.vertexLength;gf(this.layoutVertexArray,T,S,-1,-1),gf(this.layoutVertexArray,T,S,1,-1),gf(this.layoutVertexArray,T,S,1,1),gf(this.layoutVertexArray,T,S,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+3,D+2),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,f,{},g)}}function xx(a,r){for(let u=0;u<a.length;u++)if(hc(r,a[u]))return!0;for(let u=0;u<r.length;u++)if(hc(a,r[u]))return!0;return!!Tg(a,r)}function IP(a,r,u){return!!hc(a,r)||!!Sg(r,a,u)}function bx(a,r){if(a.length===1)return Ex(r,a[0]);for(let u=0;u<r.length;u++){const f=r[u];for(let g=0;g<f.length;g++)if(hc(a,f[g]))return!0}for(let u=0;u<a.length;u++)if(Ex(r,a[u]))return!0;for(let u=0;u<r.length;u++)if(Tg(a,r[u]))return!0;return!1}function CP(a,r,u){if(a.length>1){if(Tg(a,r))return!0;for(let f=0;f<r.length;f++)if(Sg(r[f],a,u))return!0}for(let f=0;f<a.length;f++)if(Sg(a[f],r,u))return!0;return!1}function Tg(a,r){if(a.length===0||r.length===0)return!1;for(let u=0;u<a.length-1;u++){const f=a[u],g=a[u+1];for(let y=0;y<r.length-1;y++)if(MP(f,g,r[y],r[y+1]))return!0}return!1}function MP(a,r,u,f){return Se(a,u,f)!==Se(r,u,f)&&Se(a,r,u)!==Se(a,r,f)}function Sg(a,r,u){const f=u*u;if(r.length===1)return a.distSqr(r[0])<f;for(let g=1;g<r.length;g++)if(wx(a,r[g-1],r[g])<f)return!0;return!1}function wx(a,r,u){const f=r.distSqr(u);if(f===0)return a.distSqr(r);const g=((a.x-r.x)*(u.x-r.x)+(a.y-r.y)*(u.y-r.y))/f;return a.distSqr(g<0?r:g>1?u:u.sub(r)._mult(g)._add(r))}function Ex(a,r){let u,f,g,y=!1;for(let b=0;b<a.length;b++){u=a[b];for(let T=0,S=u.length-1;T<u.length;S=T++)f=u[T],g=u[S],f.y>r.y!=g.y>r.y&&r.x<(g.x-f.x)*(r.y-f.y)/(g.y-f.y)+f.x&&(y=!y)}return y}function hc(a,r){let u=!1;for(let f=0,g=a.length-1;f<a.length;g=f++){const y=a[f],b=a[g];y.y>r.y!=b.y>r.y&&r.x<(b.x-y.x)*(r.y-y.y)/(b.y-y.y)+y.x&&(u=!u)}return u}function LP(a,r,u){const f=u[0],g=u[2];if(a.x<f.x&&r.x<f.x||a.x>g.x&&r.x>g.x||a.y<f.y&&r.y<f.y||a.y>g.y&&r.y>g.y)return!1;const y=Se(a,r,u[0]);return y!==Se(a,r,u[1])||y!==Se(a,r,u[2])||y!==Se(a,r,u[3])}function Ju(a,r,u){const f=r.paint.get(a).value;return f.kind==="constant"?f.value:u.programConfigurations.get(r.id).getMaxValue(a)}function _f(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function yf(a,r,u,f,g){if(!r[0]&&!r[1])return a;const y=vt.convert(r)._mult(g);u==="viewport"&&y._rotate(-f);const b=[];for(let T=0;T<a.length;T++)b.push(a[T].sub(y));return b}st("CircleBucket",Eg,{omit:["layers"]});const kP=new mi({"circle-sort-key":new bt(Me.layout_circle["circle-sort-key"])});var RP={paint:new mi({"circle-radius":new bt(Me.paint_circle["circle-radius"]),"circle-color":new bt(Me.paint_circle["circle-color"]),"circle-blur":new bt(Me.paint_circle["circle-blur"]),"circle-opacity":new bt(Me.paint_circle["circle-opacity"]),"circle-translate":new dt(Me.paint_circle["circle-translate"]),"circle-translate-anchor":new dt(Me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new dt(Me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new dt(Me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new bt(Me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new bt(Me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new bt(Me.paint_circle["circle-stroke-opacity"])}),layout:kP},qi=1e-6,Zi=typeof Float32Array<"u"?Float32Array:Array;function Tx(){var a=new Zi(9);return Zi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function Ag(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Sx(a,r,u){var f=r[0],g=r[1],y=r[2],b=r[3],T=r[4],S=r[5],M=r[6],D=r[7],O=r[8],U=r[9],$=r[10],H=r[11],ae=r[12],se=r[13],ve=r[14],Te=r[15],_e=u[0],we=u[1],De=u[2],Re=u[3];return a[0]=_e*f+we*T+De*O+Re*ae,a[1]=_e*g+we*S+De*U+Re*se,a[2]=_e*y+we*M+De*$+Re*ve,a[3]=_e*b+we*D+De*H+Re*Te,a[4]=(_e=u[4])*f+(we=u[5])*T+(De=u[6])*O+(Re=u[7])*ae,a[5]=_e*g+we*S+De*U+Re*se,a[6]=_e*y+we*M+De*$+Re*ve,a[7]=_e*b+we*D+De*H+Re*Te,a[8]=(_e=u[8])*f+(we=u[9])*T+(De=u[10])*O+(Re=u[11])*ae,a[9]=_e*g+we*S+De*U+Re*se,a[10]=_e*y+we*M+De*$+Re*ve,a[11]=_e*b+we*D+De*H+Re*Te,a[12]=(_e=u[12])*f+(we=u[13])*T+(De=u[14])*O+(Re=u[15])*ae,a[13]=_e*g+we*S+De*U+Re*se,a[14]=_e*y+we*M+De*$+Re*ve,a[15]=_e*b+we*D+De*H+Re*Te,a}Math.hypot||(Math.hypot=function(){for(var a=0,r=arguments.length;r--;)a+=arguments[r]*arguments[r];return Math.sqrt(a)});var Qu,DP=Sx;function Ax(){var a=new Zi(3);return Zi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Px(a,r,u){var f=new Zi(3);return f[0]=a,f[1]=r,f[2]=u,f}function vf(a,r,u){var f=r[0],g=r[1],y=r[2],b=r[3];return a[0]=u[0]*f+u[4]*g+u[8]*y+u[12]*b,a[1]=u[1]*f+u[5]*g+u[9]*y+u[13]*b,a[2]=u[2]*f+u[6]*g+u[10]*y+u[14]*b,a[3]=u[3]*f+u[7]*g+u[11]*y+u[15]*b,a}function Ix(){var a=new Zi(4);return Zi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Cx(a,r){const u=vf([],[a.x,a.y,0,1],r);return new vt(u[0]/u[3],u[1]/u[3])}Ax(),Qu=new Zi(4),Zi!=Float32Array&&(Qu[0]=0,Qu[1]=0,Qu[2]=0,Qu[3]=0),Ax(),Px(1,0,0),Px(0,1,0),Ix(),Ix(),Tx(),function(){var a;a=new Zi(2),Zi!=Float32Array&&(a[0]=0,a[1]=0)}();class Mx extends Eg{}st("HeatmapBucket",Mx,{omit:["layers"]});var zP={paint:new mi({"heatmap-radius":new bt(Me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new bt(Me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new dt(Me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ks(Me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new dt(Me.paint_heatmap["heatmap-opacity"])})};function Pg(a,{width:r,height:u},f,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==r*u*f)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${r*u*f}`)}else g=new Uint8Array(r*u*f);return a.width=r,a.height=u,a.data=g,a}function Lx(a,{width:r,height:u},f){if(r===a.width&&u===a.height)return;const g=Pg({},{width:r,height:u},f);Ig(a,g,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,r),height:Math.min(a.height,u)},f),a.width=r,a.height=u,a.data=g.data}function Ig(a,r,u,f,g,y){if(g.width===0||g.height===0)return r;if(g.width>a.width||g.height>a.height||u.x>a.width-g.width||u.y>a.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>r.width||g.height>r.height||f.x>r.width-g.width||f.y>r.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const b=a.data,T=r.data;if(b===T)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<g.height;S++){const M=((u.y+S)*a.width+u.x)*y,D=((f.y+S)*r.width+f.x)*y;for(let O=0;O<g.width*y;O++)T[D+O]=b[M+O]}return r}class eh{constructor(r,u){Pg(this,r,1,u)}resize(r){Lx(this,r,1)}clone(){return new eh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,u,f,g,y){Ig(r,u,f,g,y,1)}}class Nr{constructor(r,u){Pg(this,r,4,u)}resize(r){Lx(this,r,4)}replace(r,u){u?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Nr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,u,f,g,y){Ig(r,u,f,g,y,4)}}function kx(a){const r={},u=a.resolution||256,f=a.clips?a.clips.length:1,g=a.image||new Nr({width:u,height:f});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const y=(b,T,S)=>{r[a.evaluationKey]=S;const M=a.expression.evaluate(r);g.data[b+T+0]=Math.floor(255*M.r/M.a),g.data[b+T+1]=Math.floor(255*M.g/M.a),g.data[b+T+2]=Math.floor(255*M.b/M.a),g.data[b+T+3]=Math.floor(255*M.a)};if(a.clips)for(let b=0,T=0;b<f;++b,T+=4*u)for(let S=0,M=0;S<u;S++,M+=4){const D=S/(u-1),{start:O,end:U}=a.clips[b];y(T,M,O*(1-D)+U*D)}else for(let b=0,T=0;b<u;b++,T+=4)y(0,T,b/(u-1));return g}st("AlphaImage",eh),st("RGBAImage",Nr);var OP={paint:new mi({"hillshade-illumination-direction":new dt(Me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new dt(Me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new dt(Me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new dt(Me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new dt(Me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new dt(Me.paint_hillshade["hillshade-accent-color"])})};const FP=Hn([{name:"a_pos",components:2,type:"Int16"}],4),{members:BP}=FP;var xf={exports:{}};function bf(a,r,u){u=u||2;var f,g,y,b,T,S,M,D=r&&r.length,O=D?r[0]*u:a.length,U=Rx(a,0,O,u,!0),$=[];if(!U||U.next===U.prev)return $;if(D&&(U=function(ae,se,ve,Te){var _e,we,De,Re=[];for(_e=0,we=se.length;_e<we;_e++)(De=Rx(ae,se[_e]*Te,_e<we-1?se[_e+1]*Te:ae.length,Te,!1))===De.next&&(De.steiner=!0),Re.push(WP(De));for(Re.sort(GP),_e=0;_e<Re.length;_e++)ve=$P(Re[_e],ve);return ve}(a,r,U,u)),a.length>80*u){f=y=a[0],g=b=a[1];for(var H=u;H<O;H+=u)(T=a[H])<f&&(f=T),(S=a[H+1])<g&&(g=S),T>y&&(y=T),S>b&&(b=S);M=(M=Math.max(y-f,b-g))!==0?32767/M:0}return th(U,$,u,f,g,M,0),$}function Rx(a,r,u,f,g){var y,b;if(g===Lg(a,r,u,f)>0)for(y=r;y<u;y+=f)b=Ox(y,a[y],a[y+1],b);else for(y=u-f;y>=r;y-=f)b=Ox(y,a[y],a[y+1],b);return b&&wf(b,b.next)&&(ih(b),b=b.next),b}function _l(a,r){if(!a)return a;r||(r=a);var u,f=a;do if(u=!1,f.steiner||!wf(f,f.next)&&Nn(f.prev,f,f.next)!==0)f=f.next;else{if(ih(f),(f=r=f.prev)===f.next)break;u=!0}while(u||f!==r);return r}function th(a,r,u,f,g,y,b){if(a){!b&&y&&function(D,O,U,$){var H=D;do H.z===0&&(H.z=Cg(H.x,H.y,O,U,$)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next;while(H!==D);H.prevZ.nextZ=null,H.prevZ=null,function(ae){var se,ve,Te,_e,we,De,Re,it,ct=1;do{for(ve=ae,ae=null,we=null,De=0;ve;){for(De++,Te=ve,Re=0,se=0;se<ct&&(Re++,Te=Te.nextZ);se++);for(it=ct;Re>0||it>0&&Te;)Re!==0&&(it===0||!Te||ve.z<=Te.z)?(_e=ve,ve=ve.nextZ,Re--):(_e=Te,Te=Te.nextZ,it--),we?we.nextZ=_e:ae=_e,_e.prevZ=we,we=_e;ve=Te}we.nextZ=null,ct*=2}while(De>1)}(H)}(a,f,g,y);for(var T,S,M=a;a.prev!==a.next;)if(T=a.prev,S=a.next,y?UP(a,f,g,y):NP(a))r.push(T.i/u|0),r.push(a.i/u|0),r.push(S.i/u|0),ih(a),a=S.next,M=S.next;else if((a=S)===M){b?b===1?th(a=VP(_l(a),r,u),r,u,f,g,y,2):b===2&&jP(a,r,u,f,g,y):th(_l(a),r,u,f,g,y,1);break}}}function NP(a){var r=a.prev,u=a,f=a.next;if(Nn(r,u,f)>=0)return!1;for(var g=r.x,y=u.x,b=f.x,T=r.y,S=u.y,M=f.y,D=g<y?g<b?g:b:y<b?y:b,O=T<S?T<M?T:M:S<M?S:M,U=g>y?g>b?g:b:y>b?y:b,$=T>S?T>M?T:M:S>M?S:M,H=f.next;H!==r;){if(H.x>=D&&H.x<=U&&H.y>=O&&H.y<=$&&dc(g,T,y,S,b,M,H.x,H.y)&&Nn(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function UP(a,r,u,f){var g=a.prev,y=a,b=a.next;if(Nn(g,y,b)>=0)return!1;for(var T=g.x,S=y.x,M=b.x,D=g.y,O=y.y,U=b.y,$=T<S?T<M?T:M:S<M?S:M,H=D<O?D<U?D:U:O<U?O:U,ae=T>S?T>M?T:M:S>M?S:M,se=D>O?D>U?D:U:O>U?O:U,ve=Cg($,H,r,u,f),Te=Cg(ae,se,r,u,f),_e=a.prevZ,we=a.nextZ;_e&&_e.z>=ve&&we&&we.z<=Te;){if(_e.x>=$&&_e.x<=ae&&_e.y>=H&&_e.y<=se&&_e!==g&&_e!==b&&dc(T,D,S,O,M,U,_e.x,_e.y)&&Nn(_e.prev,_e,_e.next)>=0||(_e=_e.prevZ,we.x>=$&&we.x<=ae&&we.y>=H&&we.y<=se&&we!==g&&we!==b&&dc(T,D,S,O,M,U,we.x,we.y)&&Nn(we.prev,we,we.next)>=0))return!1;we=we.nextZ}for(;_e&&_e.z>=ve;){if(_e.x>=$&&_e.x<=ae&&_e.y>=H&&_e.y<=se&&_e!==g&&_e!==b&&dc(T,D,S,O,M,U,_e.x,_e.y)&&Nn(_e.prev,_e,_e.next)>=0)return!1;_e=_e.prevZ}for(;we&&we.z<=Te;){if(we.x>=$&&we.x<=ae&&we.y>=H&&we.y<=se&&we!==g&&we!==b&&dc(T,D,S,O,M,U,we.x,we.y)&&Nn(we.prev,we,we.next)>=0)return!1;we=we.nextZ}return!0}function VP(a,r,u){var f=a;do{var g=f.prev,y=f.next.next;!wf(g,y)&&Dx(g,f,f.next,y)&&nh(g,y)&&nh(y,g)&&(r.push(g.i/u|0),r.push(f.i/u|0),r.push(y.i/u|0),ih(f),ih(f.next),f=a=y),f=f.next}while(f!==a);return _l(f)}function jP(a,r,u,f,g,y){var b=a;do{for(var T=b.next.next;T!==b.prev;){if(b.i!==T.i&&qP(b,T)){var S=zx(b,T);return b=_l(b,b.next),S=_l(S,S.next),th(b,r,u,f,g,y,0),void th(S,r,u,f,g,y,0)}T=T.next}b=b.next}while(b!==a)}function GP(a,r){return a.x-r.x}function $P(a,r){var u=function(g,y){var b,T=y,S=g.x,M=g.y,D=-1/0;do{if(M<=T.y&&M>=T.next.y&&T.next.y!==T.y){var O=T.x+(M-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(O<=S&&O>D&&(D=O,b=T.x<T.next.x?T:T.next,O===S))return b}T=T.next}while(T!==y);if(!b)return null;var U,$=b,H=b.x,ae=b.y,se=1/0;T=b;do S>=T.x&&T.x>=H&&S!==T.x&&dc(M<ae?S:D,M,H,ae,M<ae?D:S,M,T.x,T.y)&&(U=Math.abs(M-T.y)/(S-T.x),nh(T,g)&&(U<se||U===se&&(T.x>b.x||T.x===b.x&&HP(b,T)))&&(b=T,se=U)),T=T.next;while(T!==$);return b}(a,r);if(!u)return r;var f=zx(u,a);return _l(f,f.next),_l(u,u.next)}function HP(a,r){return Nn(a.prev,a,r.prev)<0&&Nn(r.next,a,a.next)<0}function Cg(a,r,u,f,g){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-u)*g|0)|a<<8))|a<<4))|a<<2))|a<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-f)*g|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function WP(a){var r=a,u=a;do(r.x<u.x||r.x===u.x&&r.y<u.y)&&(u=r),r=r.next;while(r!==a);return u}function dc(a,r,u,f,g,y,b,T){return(g-b)*(r-T)>=(a-b)*(y-T)&&(a-b)*(f-T)>=(u-b)*(r-T)&&(u-b)*(y-T)>=(g-b)*(f-T)}function qP(a,r){return a.next.i!==r.i&&a.prev.i!==r.i&&!function(u,f){var g=u;do{if(g.i!==u.i&&g.next.i!==u.i&&g.i!==f.i&&g.next.i!==f.i&&Dx(g,g.next,u,f))return!0;g=g.next}while(g!==u);return!1}(a,r)&&(nh(a,r)&&nh(r,a)&&function(u,f){var g=u,y=!1,b=(u.x+f.x)/2,T=(u.y+f.y)/2;do g.y>T!=g.next.y>T&&g.next.y!==g.y&&b<(g.next.x-g.x)*(T-g.y)/(g.next.y-g.y)+g.x&&(y=!y),g=g.next;while(g!==u);return y}(a,r)&&(Nn(a.prev,a,r.prev)||Nn(a,r.prev,r))||wf(a,r)&&Nn(a.prev,a,a.next)>0&&Nn(r.prev,r,r.next)>0)}function Nn(a,r,u){return(r.y-a.y)*(u.x-r.x)-(r.x-a.x)*(u.y-r.y)}function wf(a,r){return a.x===r.x&&a.y===r.y}function Dx(a,r,u,f){var g=Tf(Nn(a,r,u)),y=Tf(Nn(a,r,f)),b=Tf(Nn(u,f,a)),T=Tf(Nn(u,f,r));return g!==y&&b!==T||!(g!==0||!Ef(a,u,r))||!(y!==0||!Ef(a,f,r))||!(b!==0||!Ef(u,a,f))||!(T!==0||!Ef(u,r,f))}function Ef(a,r,u){return r.x<=Math.max(a.x,u.x)&&r.x>=Math.min(a.x,u.x)&&r.y<=Math.max(a.y,u.y)&&r.y>=Math.min(a.y,u.y)}function Tf(a){return a>0?1:a<0?-1:0}function nh(a,r){return Nn(a.prev,a,a.next)<0?Nn(a,r,a.next)>=0&&Nn(a,a.prev,r)>=0:Nn(a,r,a.prev)<0||Nn(a,a.next,r)<0}function zx(a,r){var u=new Mg(a.i,a.x,a.y),f=new Mg(r.i,r.x,r.y),g=a.next,y=r.prev;return a.next=r,r.prev=a,u.next=g,g.prev=u,f.next=u,u.prev=f,y.next=f,f.prev=y,f}function Ox(a,r,u,f){var g=new Mg(a,r,u);return f?(g.next=f.next,g.prev=f,f.next.prev=g,f.next=g):(g.prev=g,g.next=g),g}function ih(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Mg(a,r,u){this.i=a,this.x=r,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Lg(a,r,u,f){for(var g=0,y=r,b=u-f;y<u;y+=f)g+=(a[b]-a[y])*(a[y+1]+a[b+1]),b=y;return g}function ZP(a,r,u,f,g){Fx(a,r,u||0,f||a.length-1,g||XP)}function Fx(a,r,u,f,g){for(;f>u;){if(f-u>600){var y=f-u+1,b=r-u+1,T=Math.log(y),S=.5*Math.exp(2*T/3),M=.5*Math.sqrt(T*S*(y-S)/y)*(b-y/2<0?-1:1);Fx(a,r,Math.max(u,Math.floor(r-b*S/y+M)),Math.min(f,Math.floor(r+(y-b)*S/y+M)),g)}var D=a[r],O=u,U=f;for(rh(a,u,r),g(a[f],D)>0&&rh(a,u,f);O<U;){for(rh(a,O,U),O++,U--;g(a[O],D)<0;)O++;for(;g(a[U],D)>0;)U--}g(a[u],D)===0?rh(a,u,U):rh(a,++U,f),U<=r&&(u=U+1),r<=U&&(f=U-1)}}function rh(a,r,u){var f=a[r];a[r]=a[u],a[u]=f}function XP(a,r){return a<r?-1:a>r?1:0}function kg(a,r){const u=a.length;if(u<=1)return[a];const f=[];let g,y;for(let b=0;b<u;b++){const T=Oe(a[b]);T!==0&&(a[b].area=Math.abs(T),y===void 0&&(y=T<0),y===T<0?(g&&f.push(g),g=[a[b]]):g.push(a[b]))}if(g&&f.push(g),r>1)for(let b=0;b<f.length;b++)f[b].length<=r||(ZP(f[b],r,1,f[b].length-1,YP),f[b]=f[b].slice(0,r));return f}function YP(a,r){return r.area-a.area}function Rg(a,r,u){const f=u.patternDependencies;let g=!1;for(const y of r){const b=y.paint.get(`${a}-pattern`);b.isConstant()||(g=!0);const T=b.constantOr(null);T&&(g=!0,f[T.to]=!0,f[T.from]=!0)}return g}function Dg(a,r,u,f,g){const y=g.patternDependencies;for(const b of r){const T=b.paint.get(`${a}-pattern`).value;if(T.kind!=="constant"){let S=T.evaluate({zoom:f-1},u,{},g.availableImages),M=T.evaluate({zoom:f},u,{},g.availableImages),D=T.evaluate({zoom:f+1},u,{},g.availableImages);S=S&&S.name?S.name:S,M=M&&M.name?M.name:M,D=D&&D.name?D.name:D,y[S]=!0,y[M]=!0,y[D]=!0,u.patterns[b.id]={min:S,mid:M,max:D}}}return u}xf.exports=bf,xf.exports.default=bf,bf.deviation=function(a,r,u,f){var g=r&&r.length,y=Math.abs(Lg(a,0,g?r[0]*u:a.length,u));if(g)for(var b=0,T=r.length;b<T;b++)y-=Math.abs(Lg(a,r[b]*u,b<T-1?r[b+1]*u:a.length,u));var S=0;for(b=0;b<f.length;b+=3){var M=f[b]*u,D=f[b+1]*u,O=f[b+2]*u;S+=Math.abs((a[M]-a[O])*(a[D+1]-a[M+1])-(a[M]-a[D])*(a[O+1]-a[M+1]))}return y===0&&S===0?0:Math.abs((S-y)/y)},bf.flatten=function(a){for(var r=a[0][0].length,u={vertices:[],holes:[],dimensions:r},f=0,g=0;g<a.length;g++){for(var y=0;y<a[g].length;y++)for(var b=0;b<r;b++)u.vertices.push(a[g][y][b]);g>0&&u.holes.push(f+=a[g-1].length)}return u};class zg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(u=>u.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new on,this.indexArray=new Wi,this.indexArray2=new As,this.programConfigurations=new pl(r.layers,r.zoom),this.segments=new Ft,this.segments2=new Ft,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(r,u,f){this.hasPattern=Rg("fill",this.layers,u);const g=this.layers[0].layout.get("fill-sort-key"),y=!g.isConstant(),b=[];for(const{feature:T,id:S,index:M,sourceLayerIndex:D}of r){const O=this.layers[0]._featureFilter.needGeometry,U=gl(T,O);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom),U,f))continue;const $=y?g.evaluate(U,{},f,u.availableImages):void 0,H={id:S,properties:T.properties,type:T.type,sourceLayerIndex:D,index:M,geometry:O?U.geometry:ml(T),patterns:{},sortKey:$};b.push(H)}y&&b.sort((T,S)=>T.sortKey-S.sortKey);for(const T of b){const{geometry:S,index:M,sourceLayerIndex:D}=T;if(this.hasPattern){const O=Dg("fill",this.layers,T,this.zoom,u);this.patternFeatures.push(O)}else this.addFeature(T,S,M,f,{});u.featureIndex.insert(r[M].feature,S,M,D,this.index)}}update(r,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,u,this.stateDependentLayers,f)}addFeatures(r,u,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,BP),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,u,f,g,y){for(const b of kg(u,500)){let T=0;for(const $ of b)T+=$.length;const S=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),M=S.vertexLength,D=[],O=[];for(const $ of b){if($.length===0)continue;$!==b[0]&&O.push(D.length/2);const H=this.segments2.prepareSegment($.length,this.layoutVertexArray,this.indexArray2),ae=H.vertexLength;this.layoutVertexArray.emplaceBack($[0].x,$[0].y),this.indexArray2.emplaceBack(ae+$.length-1,ae),D.push($[0].x),D.push($[0].y);for(let se=1;se<$.length;se++)this.layoutVertexArray.emplaceBack($[se].x,$[se].y),this.indexArray2.emplaceBack(ae+se-1,ae+se),D.push($[se].x),D.push($[se].y);H.vertexLength+=$.length,H.primitiveLength+=$.length}const U=xf.exports(D,O);for(let $=0;$<U.length;$+=3)this.indexArray.emplaceBack(M+U[$],M+U[$+1],M+U[$+2]);S.vertexLength+=T,S.primitiveLength+=U.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,f,y,g)}}st("FillBucket",zg,{omit:["layers","patternFeatures"]});const KP=new mi({"fill-sort-key":new bt(Me.layout_fill["fill-sort-key"])});var JP={paint:new mi({"fill-antialias":new dt(Me.paint_fill["fill-antialias"]),"fill-opacity":new bt(Me.paint_fill["fill-opacity"]),"fill-color":new bt(Me.paint_fill["fill-color"]),"fill-outline-color":new bt(Me.paint_fill["fill-outline-color"]),"fill-translate":new dt(Me.paint_fill["fill-translate"]),"fill-translate-anchor":new dt(Me.paint_fill["fill-translate-anchor"]),"fill-pattern":new ua(Me.paint_fill["fill-pattern"])}),layout:KP};const QP=Hn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),eI=Hn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:tI}=QP;var fa={},nI=vt,Bx=fc;function fc(a,r,u,f,g){this.properties={},this.extent=u,this.type=0,this._pbf=a,this._geometry=-1,this._keys=f,this._values=g,a.readFields(iI,this,r)}function iI(a,r,u){a==1?r.id=u.readVarint():a==2?function(f,g){for(var y=f.readVarint()+f.pos;f.pos<y;){var b=g._keys[f.readVarint()],T=g._values[f.readVarint()];g.properties[b]=T}}(u,r):a==3?r.type=u.readVarint():a==4&&(r._geometry=u.pos)}function rI(a){for(var r,u,f=0,g=0,y=a.length,b=y-1;g<y;b=g++)f+=((u=a[b]).x-(r=a[g]).x)*(r.y+u.y);return f}fc.types=["Unknown","Point","LineString","Polygon"],fc.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var r,u=a.readVarint()+a.pos,f=1,g=0,y=0,b=0,T=[];a.pos<u;){if(g<=0){var S=a.readVarint();f=7&S,g=S>>3}if(g--,f===1||f===2)y+=a.readSVarint(),b+=a.readSVarint(),f===1&&(r&&T.push(r),r=[]),r.push(new nI(y,b));else{if(f!==7)throw new Error("unknown command "+f);r&&r.push(r[0].clone())}}return r&&T.push(r),T},fc.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var r=a.readVarint()+a.pos,u=1,f=0,g=0,y=0,b=1/0,T=-1/0,S=1/0,M=-1/0;a.pos<r;){if(f<=0){var D=a.readVarint();u=7&D,f=D>>3}if(f--,u===1||u===2)(g+=a.readSVarint())<b&&(b=g),g>T&&(T=g),(y+=a.readSVarint())<S&&(S=y),y>M&&(M=y);else if(u!==7)throw new Error("unknown command "+u)}return[b,S,T,M]},fc.prototype.toGeoJSON=function(a,r,u){var f,g,y=this.extent*Math.pow(2,u),b=this.extent*a,T=this.extent*r,S=this.loadGeometry(),M=fc.types[this.type];function D($){for(var H=0;H<$.length;H++){var ae=$[H];$[H]=[360*(ae.x+b)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(ae.y+T)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(f=0;f<S.length;f++)O[f]=S[f][0];D(S=O);break;case 2:for(f=0;f<S.length;f++)D(S[f]);break;case 3:for(S=function($){var H=$.length;if(H<=1)return[$];for(var ae,se,ve=[],Te=0;Te<H;Te++){var _e=rI($[Te]);_e!==0&&(se===void 0&&(se=_e<0),se===_e<0?(ae&&ve.push(ae),ae=[$[Te]]):ae.push($[Te]))}return ae&&ve.push(ae),ve}(S),f=0;f<S.length;f++)for(g=0;g<S[f].length;g++)D(S[f][g])}S.length===1?S=S[0]:M="Multi"+M;var U={type:"Feature",geometry:{type:M,coordinates:S},properties:this.properties};return"id"in this&&(U.id=this.id),U};var sI=Bx,Nx=Ux;function Ux(a,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(oI,this,r),this.length=this._features.length}function oI(a,r,u){a===15?r.version=u.readVarint():a===1?r.name=u.readString():a===5?r.extent=u.readVarint():a===2?r._features.push(u.pos):a===3?r._keys.push(u.readString()):a===4&&r._values.push(function(f){for(var g=null,y=f.readVarint()+f.pos;f.pos<y;){var b=f.readVarint()>>3;g=b===1?f.readString():b===2?f.readFloat():b===3?f.readDouble():b===4?f.readVarint64():b===5?f.readVarint():b===6?f.readSVarint():b===7?f.readBoolean():null}return g}(u))}Ux.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var r=this._pbf.readVarint()+this._pbf.pos;return new sI(this._pbf,r,this.extent,this._keys,this._values)};var aI=Nx;function lI(a,r,u){if(a===3){var f=new aI(u,u.readVarint()+u.pos);f.length&&(r[f.name]=f)}}fa.VectorTile=function(a,r){this.layers=a.readFields(lI,{},r)},fa.VectorTileFeature=Bx,fa.VectorTileLayer=Nx;const cI=fa.VectorTileFeature.types,Og=Math.pow(2,13);function sh(a,r,u,f,g,y,b,T){a.emplaceBack(r,u,2*Math.floor(f*Og)+b,g*Og*2,y*Og*2,Math.round(T))}class Fg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(u=>u.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new $t,this.centroidVertexArray=new _t,this.indexArray=new Wi,this.programConfigurations=new pl(r.layers,r.zoom),this.segments=new Ft,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(r,u,f){this.features=[],this.hasPattern=Rg("fill-extrusion",this.layers,u);for(const{feature:g,id:y,index:b,sourceLayerIndex:T}of r){const S=this.layers[0]._featureFilter.needGeometry,M=gl(g,S);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom),M,f))continue;const D={id:y,sourceLayerIndex:T,index:b,geometry:S?M.geometry:ml(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(Dg("fill-extrusion",this.layers,D,this.zoom,u)):this.addFeature(D,D.geometry,b,f,{}),u.featureIndex.insert(g,D.geometry,b,T,this.index,!0)}}addFeatures(r,u,f){for(const g of this.features){const{geometry:y}=g;this.addFeature(g,y,g.index,u,f)}}update(r,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,tI),this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,eI.members,!0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(r,u,f,g,y){const b={x:0,y:0,vertexCount:0};for(const T of kg(u,500)){let S=0;for(const H of T)S+=H.length;let M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const H of T){if(H.length===0||hI(H))continue;let ae=0;for(let se=0;se<H.length;se++){const ve=H[se];if(se>=1){const Te=H[se-1];if(!uI(ve,Te)){M.vertexLength+4>Ft.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const _e=ve.sub(Te)._perp()._unit(),we=Te.dist(ve);ae+we>32768&&(ae=0),sh(this.layoutVertexArray,ve.x,ve.y,_e.x,_e.y,0,0,ae),sh(this.layoutVertexArray,ve.x,ve.y,_e.x,_e.y,0,1,ae),b.x+=2*ve.x,b.y+=2*ve.y,b.vertexCount+=2,ae+=we,sh(this.layoutVertexArray,Te.x,Te.y,_e.x,_e.y,0,0,ae),sh(this.layoutVertexArray,Te.x,Te.y,_e.x,_e.y,0,1,ae),b.x+=2*Te.x,b.y+=2*Te.y,b.vertexCount+=2;const De=M.vertexLength;this.indexArray.emplaceBack(De,De+2,De+1),this.indexArray.emplaceBack(De+1,De+2,De+3),M.vertexLength+=4,M.primitiveLength+=2}}}}if(M.vertexLength+S>Ft.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),cI[r.type]!=="Polygon")continue;const D=[],O=[],U=M.vertexLength;for(const H of T)if(H.length!==0){H!==T[0]&&O.push(D.length/2);for(let ae=0;ae<H.length;ae++){const se=H[ae];sh(this.layoutVertexArray,se.x,se.y,0,0,1,1,0),b.x+=se.x,b.y+=se.y,b.vertexCount+=1,D.push(se.x),D.push(se.y)}}const $=xf.exports(D,O);for(let H=0;H<$.length;H+=3)this.indexArray.emplaceBack(U+$[H],U+$[H+2],U+$[H+1]);M.primitiveLength+=$.length/3,M.vertexLength+=S}for(let T=0;T<b.vertexCount;T++)this.centroidVertexArray.emplaceBack(Math.floor(b.x/b.vertexCount),Math.floor(b.y/b.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,f,y,g)}}function uI(a,r){return a.x===r.x&&(a.x<0||a.x>ei)||a.y===r.y&&(a.y<0||a.y>ei)}function hI(a){return a.every(r=>r.x<0)||a.every(r=>r.x>ei)||a.every(r=>r.y<0)||a.every(r=>r.y>ei)}st("FillExtrusionBucket",Fg,{omit:["layers","features"]});var dI={paint:new mi({"fill-extrusion-opacity":new dt(Me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new bt(Me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new dt(Me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new dt(Me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ua(Me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new bt(Me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new bt(Me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new dt(Me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function oh(a,r){return a.x*r.x+a.y*r.y}function Vx(a,r){if(a.length===1){let u=0;const f=r[u++];let g;for(;!g||f.equals(g);)if(g=r[u++],!g)return 1/0;for(;u<r.length;u++){const y=r[u],b=a[0],T=g.sub(f),S=y.sub(f),M=b.sub(f),D=oh(T,T),O=oh(T,S),U=oh(S,S),$=oh(M,T),H=oh(M,S),ae=D*U-O*O,se=(U*$-O*H)/ae,ve=(D*H-O*$)/ae,Te=f.z*(1-se-ve)+g.z*se+y.z*ve;if(isFinite(Te))return Te}return 1/0}{let u=1/0;for(const f of r)u=Math.min(u,f.z);return u}}const fI=Hn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:pI}=fI,mI=Hn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:gI}=mI,_I=fa.VectorTileFeature.types,yI=Math.cos(Math.PI/180*37.5),jx=Math.pow(2,14)/.5;class Bg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(u=>u.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new Ht,this.layoutVertexArray2=new ln,this.indexArray=new Wi,this.programConfigurations=new pl(r.layers,r.zoom),this.segments=new Ft,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(r,u,f){this.hasPattern=Rg("line",this.layers,u);const g=this.layers[0].layout.get("line-sort-key"),y=!g.isConstant(),b=[];for(const{feature:T,id:S,index:M,sourceLayerIndex:D}of r){const O=this.layers[0]._featureFilter.needGeometry,U=gl(T,O);if(!this.layers[0]._featureFilter.filter(new xn(this.zoom),U,f))continue;const $=y?g.evaluate(U,{},f):void 0,H={id:S,properties:T.properties,type:T.type,sourceLayerIndex:D,index:M,geometry:O?U.geometry:ml(T),patterns:{},sortKey:$};b.push(H)}y&&b.sort((T,S)=>T.sortKey-S.sortKey);for(const T of b){const{geometry:S,index:M,sourceLayerIndex:D}=T;if(this.hasPattern){const O=Dg("line",this.layers,T,this.zoom,u);this.patternFeatures.push(O)}else this.addFeature(T,S,M,f,{});u.featureIndex.insert(r[M].feature,S,M,D,this.index)}}update(r,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,u,this.stateDependentLayers,f)}addFeatures(r,u,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,gI)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,pI),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,u,f,g,y){const b=this.layers[0].layout,T=b.get("line-join").evaluate(r,{}),S=b.get("line-cap"),M=b.get("line-miter-limit"),D=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const O of u)this.addLine(O,r,T,S,M,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,f,y,g)}addLine(r,u,f,g,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ve=0;ve<r.length-1;ve++)this.totalDistance+=r[ve].dist(r[ve+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=_I[u.type]==="Polygon";let S=r.length;for(;S>=2&&r[S-1].equals(r[S-2]);)S--;let M=0;for(;M<S-1&&r[M].equals(r[M+1]);)M++;if(S<(T?3:2))return;f==="bevel"&&(y=1.05);const D=this.overscaling<=16?122880/(512*this.overscaling):0,O=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let U,$,H,ae,se;this.e1=this.e2=-1,T&&(U=r[S-2],se=r[M].sub(U)._unit()._perp());for(let ve=M;ve<S;ve++){if(H=ve===S-1?T?r[M+1]:void 0:r[ve+1],H&&r[ve].equals(H))continue;se&&(ae=se),U&&($=U),U=r[ve],se=H?H.sub(U)._unit()._perp():ae,ae=ae||se;let Te=ae.add(se);Te.x===0&&Te.y===0||Te._unit();const _e=ae.x*se.x+ae.y*se.y,we=Te.x*se.x+Te.y*se.y,De=we!==0?1/we:1/0,Re=2*Math.sqrt(2-2*we),it=we<yI&&$&&H,ct=ae.x*se.y-ae.y*se.x>0;if(it&&ve>M){const $e=U.dist($);if($e>2*D){const Qe=U.sub(U.sub($)._mult(D/$e)._round());this.updateDistance($,Qe),this.addCurrentVertex(Qe,ae,0,0,O),$=Qe}}const Je=$&&H;let Ze=Je?f:T?"butt":g;if(Je&&Ze==="round"&&(De<b?Ze="miter":De<=2&&(Ze="fakeround")),Ze==="miter"&&De>y&&(Ze="bevel"),Ze==="bevel"&&(De>2&&(Ze="flipbevel"),De<y&&(Ze="miter")),$&&this.updateDistance($,U),Ze==="miter")Te._mult(De),this.addCurrentVertex(U,Te,0,0,O);else if(Ze==="flipbevel"){if(De>100)Te=se.mult(-1);else{const $e=De*ae.add(se).mag()/ae.sub(se).mag();Te._perp()._mult($e*(ct?-1:1))}this.addCurrentVertex(U,Te,0,0,O),this.addCurrentVertex(U,Te.mult(-1),0,0,O)}else if(Ze==="bevel"||Ze==="fakeround"){const $e=-Math.sqrt(De*De-1),Qe=ct?$e:0,Xe=ct?0:$e;if($&&this.addCurrentVertex(U,ae,Qe,Xe,O),Ze==="fakeround"){const Ue=Math.round(180*Re/Math.PI/20);for(let yt=1;yt<Ue;yt++){let pt=yt/Ue;if(pt!==.5){const gn=pt-.5;pt+=pt*gn*(pt-1)*((1.0904+_e*(_e*(3.55645-1.43519*_e)-3.2452))*gn*gn+(.848013+_e*(.215638*_e-1.06021)))}const Dt=se.sub(ae)._mult(pt)._add(ae)._unit()._mult(ct?-1:1);this.addHalfVertex(U,Dt.x,Dt.y,!1,ct,0,O)}}H&&this.addCurrentVertex(U,se,-Qe,-Xe,O)}else if(Ze==="butt")this.addCurrentVertex(U,Te,0,0,O);else if(Ze==="square"){const $e=$?1:-1;this.addCurrentVertex(U,Te,$e,$e,O)}else Ze==="round"&&($&&(this.addCurrentVertex(U,ae,0,0,O),this.addCurrentVertex(U,ae,1,1,O,!0)),H&&(this.addCurrentVertex(U,se,-1,-1,O,!0),this.addCurrentVertex(U,se,0,0,O)));if(it&&ve<S-1){const $e=U.dist(H);if($e>2*D){const Qe=U.add(H.sub(U)._mult(D/$e)._round());this.updateDistance(U,Qe),this.addCurrentVertex(Qe,se,0,0,O),U=Qe}}}}addCurrentVertex(r,u,f,g,y,b=!1){const T=u.y*g-u.x,S=-u.y-u.x*g;this.addHalfVertex(r,u.x+u.y*f,u.y-u.x*f,b,!1,f,y),this.addHalfVertex(r,T,S,b,!0,-g,y),this.distance>jx/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(r,u,f,g,y,b))}addHalfVertex({x:r,y:u},f,g,y,b,T,S){const M=.5*(this.lineClips?this.scaledDistance*(jx-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((r<<1)+(y?1:0),(u<<1)+(b?1:0),Math.round(63*f)+128,Math.round(63*g)+128,1+(T===0?0:T<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const D=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),S.primitiveLength++),b?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,u){this.distance+=r.dist(u),this.updateScaledDistance()}}st("LineBucket",Bg,{omit:["layers","patternFeatures"]});const vI=new mi({"line-cap":new dt(Me.layout_line["line-cap"]),"line-join":new bt(Me.layout_line["line-join"]),"line-miter-limit":new dt(Me.layout_line["line-miter-limit"]),"line-round-limit":new dt(Me.layout_line["line-round-limit"]),"line-sort-key":new bt(Me.layout_line["line-sort-key"])});var Gx={paint:new mi({"line-opacity":new bt(Me.paint_line["line-opacity"]),"line-color":new bt(Me.paint_line["line-color"]),"line-translate":new dt(Me.paint_line["line-translate"]),"line-translate-anchor":new dt(Me.paint_line["line-translate-anchor"]),"line-width":new bt(Me.paint_line["line-width"]),"line-gap-width":new bt(Me.paint_line["line-gap-width"]),"line-offset":new bt(Me.paint_line["line-offset"]),"line-blur":new bt(Me.paint_line["line-blur"]),"line-dasharray":new qu(Me.paint_line["line-dasharray"]),"line-pattern":new ua(Me.paint_line["line-pattern"]),"line-gradient":new Ks(Me.paint_line["line-gradient"])}),layout:vI};const $x=new class extends bt{possiblyEvaluate(a,r){return r=new xn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(a,r)}evaluate(a,r,u,f){return r=X({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(a,r,u,f)}}(Gx.paint.properties["line-width"].specification);function Hx(a,r){return r>0?r+2*a:a}$x.useIntegerZoom=!0;const xI=Hn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),bI=Hn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Hn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const wI=Hn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Hn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Wx=Hn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),EI=Hn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function TI(a,r,u){return a.sections.forEach(f=>{f.text=function(g,y,b){const T=y.layout.get("text-transform").evaluate(b,{});return T==="uppercase"?g=g.toLocaleUpperCase():T==="lowercase"&&(g=g.toLocaleLowerCase()),wr.applyArabicShaping&&(g=wr.applyArabicShaping(g)),g}(f.text,r,u)}),a}Hn([{name:"triangle",components:3,type:"Uint16"}]),Hn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Hn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Hn([{type:"Float32",name:"offsetX"}]),Hn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const ah={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var gi=24,Ng=un,qx=function(a,r,u,f,g){var y,b,T=8*g-f-1,S=(1<<T)-1,M=S>>1,D=-7,O=u?g-1:0,U=u?-1:1,$=a[r+O];for(O+=U,y=$&(1<<-D)-1,$>>=-D,D+=T;D>0;y=256*y+a[r+O],O+=U,D-=8);for(b=y&(1<<-D)-1,y>>=-D,D+=f;D>0;b=256*b+a[r+O],O+=U,D-=8);if(y===0)y=1-M;else{if(y===S)return b?NaN:1/0*($?-1:1);b+=Math.pow(2,f),y-=M}return($?-1:1)*b*Math.pow(2,y-f)},Zx=function(a,r,u,f,g,y){var b,T,S,M=8*y-g-1,D=(1<<M)-1,O=D>>1,U=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,$=f?0:y-1,H=f?1:-1,ae=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(T=isNaN(r)?1:0,b=D):(b=Math.floor(Math.log(r)/Math.LN2),r*(S=Math.pow(2,-b))<1&&(b--,S*=2),(r+=b+O>=1?U/S:U*Math.pow(2,1-O))*S>=2&&(b++,S/=2),b+O>=D?(T=0,b=D):b+O>=1?(T=(r*S-1)*Math.pow(2,g),b+=O):(T=r*Math.pow(2,O-1)*Math.pow(2,g),b=0));g>=8;a[u+$]=255&T,$+=H,T/=256,g-=8);for(b=b<<g|T,M+=g;M>0;a[u+$]=255&b,$+=H,b/=256,M-=8);a[u+$-H]|=128*ae};function un(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}un.Varint=0,un.Fixed64=1,un.Bytes=2,un.Fixed32=5;var pa,Ug=4294967296,Xx=1/Ug,Yx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Io(a){return a.type===un.Bytes?a.readVarint()+a.pos:a.pos+1}function pc(a,r,u){return u?4294967296*r+(a>>>0):4294967296*(r>>>0)+(a>>>0)}function Kx(a,r,u){var f=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));u.realloc(f);for(var g=u.pos-1;g>=a;g--)u.buf[g+f]=u.buf[g]}function SI(a,r){for(var u=0;u<a.length;u++)r.writeVarint(a[u])}function AI(a,r){for(var u=0;u<a.length;u++)r.writeSVarint(a[u])}function PI(a,r){for(var u=0;u<a.length;u++)r.writeFloat(a[u])}function II(a,r){for(var u=0;u<a.length;u++)r.writeDouble(a[u])}function CI(a,r){for(var u=0;u<a.length;u++)r.writeBoolean(a[u])}function MI(a,r){for(var u=0;u<a.length;u++)r.writeFixed32(a[u])}function LI(a,r){for(var u=0;u<a.length;u++)r.writeSFixed32(a[u])}function kI(a,r){for(var u=0;u<a.length;u++)r.writeFixed64(a[u])}function RI(a,r){for(var u=0;u<a.length;u++)r.writeSFixed64(a[u])}function Sf(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+16777216*a[r+3]}function mc(a,r,u){a[u]=r,a[u+1]=r>>>8,a[u+2]=r>>>16,a[u+3]=r>>>24}function Jx(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+(a[r+3]<<24)}function DI(a,r,u){a===1&&u.readMessage(zI,r)}function zI(a,r,u){if(a===3){const{id:f,bitmap:g,width:y,height:b,left:T,top:S,advance:M}=u.readMessage(OI,{});r.push({id:f,bitmap:new eh({width:y+6,height:b+6},g),metrics:{width:y,height:b,left:T,top:S,advance:M}})}}function OI(a,r,u){a===1?r.id=u.readVarint():a===2?r.bitmap=u.readBytes():a===3?r.width=u.readVarint():a===4?r.height=u.readVarint():a===5?r.left=u.readSVarint():a===6?r.top=u.readSVarint():a===7&&(r.advance=u.readVarint())}function Qx(a){let r=0,u=0;for(const b of a)r+=b.w*b.h,u=Math.max(u,b.w);a.sort((b,T)=>T.h-b.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),u),h:1/0}];let g=0,y=0;for(const b of a)for(let T=f.length-1;T>=0;T--){const S=f[T];if(!(b.w>S.w||b.h>S.h)){if(b.x=S.x,b.y=S.y,y=Math.max(y,b.y+b.h),g=Math.max(g,b.x+b.w),b.w===S.w&&b.h===S.h){const M=f.pop();T<f.length&&(f[T]=M)}else b.h===S.h?(S.x+=b.w,S.w-=b.w):b.w===S.w?(S.y+=b.h,S.h-=b.h):(f.push({x:S.x+b.w,y:S.y,w:S.w-b.w,h:b.h}),S.y+=b.h,S.h-=b.h);break}}return{w:g,h:y,fill:r/(g*y)||0}}un.prototype={destroy:function(){this.buf=null},readFields:function(a,r,u){for(u=u||this.length;this.pos<u;){var f=this.readVarint(),g=f>>3,y=this.pos;this.type=7&f,a(g,r,this),this.pos===y&&this.skip(f)}return r},readMessage:function(a,r){return this.readFields(a,r,this.readVarint()+this.pos)},readFixed32:function(){var a=Sf(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Jx(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Sf(this.buf,this.pos)+Sf(this.buf,this.pos+4)*Ug;return this.pos+=8,a},readSFixed64:function(){var a=Sf(this.buf,this.pos)+Jx(this.buf,this.pos+4)*Ug;return this.pos+=8,a},readFloat:function(){var a=qx(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=qx(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var r,u,f=this.buf;return r=127&(u=f[this.pos++]),u<128?r:(r|=(127&(u=f[this.pos++]))<<7,u<128?r:(r|=(127&(u=f[this.pos++]))<<14,u<128?r:(r|=(127&(u=f[this.pos++]))<<21,u<128?r:function(g,y,b){var T,S,M=b.buf;if(T=(112&(S=M[b.pos++]))>>4,S<128||(T|=(127&(S=M[b.pos++]))<<3,S<128)||(T|=(127&(S=M[b.pos++]))<<10,S<128)||(T|=(127&(S=M[b.pos++]))<<17,S<128)||(T|=(127&(S=M[b.pos++]))<<24,S<128)||(T|=(1&(S=M[b.pos++]))<<31,S<128))return pc(g,T,y);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(u=f[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,r=this.pos;return this.pos=a,a-r>=12&&Yx?function(u,f,g){return Yx.decode(u.subarray(f,g))}(this.buf,r,a):function(u,f,g){for(var y="",b=f;b<g;){var T,S,M,D=u[b],O=null,U=D>239?4:D>223?3:D>191?2:1;if(b+U>g)break;U===1?D<128&&(O=D):U===2?(192&(T=u[b+1]))==128&&(O=(31&D)<<6|63&T)<=127&&(O=null):U===3?(S=u[b+2],(192&(T=u[b+1]))==128&&(192&S)==128&&((O=(15&D)<<12|(63&T)<<6|63&S)<=2047||O>=55296&&O<=57343)&&(O=null)):U===4&&(S=u[b+2],M=u[b+3],(192&(T=u[b+1]))==128&&(192&S)==128&&(192&M)==128&&((O=(15&D)<<18|(63&T)<<12|(63&S)<<6|63&M)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,U=1):O>65535&&(O-=65536,y+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),y+=String.fromCharCode(O),b+=U}return y}(this.buf,r,a)},readBytes:function(){var a=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,a);return this.pos=a,r},readPackedVarint:function(a,r){if(this.type!==un.Bytes)return a.push(this.readVarint(r));var u=Io(this);for(a=a||[];this.pos<u;)a.push(this.readVarint(r));return a},readPackedSVarint:function(a){if(this.type!==un.Bytes)return a.push(this.readSVarint());var r=Io(this);for(a=a||[];this.pos<r;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==un.Bytes)return a.push(this.readBoolean());var r=Io(this);for(a=a||[];this.pos<r;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==un.Bytes)return a.push(this.readFloat());var r=Io(this);for(a=a||[];this.pos<r;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==un.Bytes)return a.push(this.readDouble());var r=Io(this);for(a=a||[];this.pos<r;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==un.Bytes)return a.push(this.readFixed32());var r=Io(this);for(a=a||[];this.pos<r;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==un.Bytes)return a.push(this.readSFixed32());var r=Io(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==un.Bytes)return a.push(this.readFixed64());var r=Io(this);for(a=a||[];this.pos<r;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==un.Bytes)return a.push(this.readSFixed64());var r=Io(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed64());return a},skip:function(a){var r=7&a;if(r===un.Varint)for(;this.buf[this.pos++]>127;);else if(r===un.Bytes)this.pos=this.readVarint()+this.pos;else if(r===un.Fixed32)this.pos+=4;else{if(r!==un.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(a,r){this.writeVarint(a<<3|r)},realloc:function(a){for(var r=this.length||16;r<this.pos+a;)r*=2;if(r!==this.length){var u=new Uint8Array(r);u.set(this.buf),this.buf=u,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),mc(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),mc(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),mc(this.buf,-1&a,this.pos),mc(this.buf,Math.floor(a*Xx),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),mc(this.buf,-1&a,this.pos),mc(this.buf,Math.floor(a*Xx),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(r,u){var f,g;if(r>=0?(f=r%4294967296|0,g=r/4294967296|0):(g=~(-r/4294967296),4294967295^(f=~(-r%4294967296))?f=f+1|0:(f=0,g=g+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(y,b,T){T.buf[T.pos++]=127&y|128,y>>>=7,T.buf[T.pos++]=127&y|128,y>>>=7,T.buf[T.pos++]=127&y|128,y>>>=7,T.buf[T.pos++]=127&y|128,T.buf[T.pos]=127&(y>>>=7)}(f,0,u),function(y,b){var T=(7&y)<<4;b.buf[b.pos++]|=T|((y>>>=3)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y)))))}(g,u)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var r=this.pos;this.pos=function(f,g,y){for(var b,T,S=0;S<g.length;S++){if((b=g.charCodeAt(S))>55295&&b<57344){if(!T){b>56319||S+1===g.length?(f[y++]=239,f[y++]=191,f[y++]=189):T=b;continue}if(b<56320){f[y++]=239,f[y++]=191,f[y++]=189,T=b;continue}b=T-55296<<10|b-56320|65536,T=null}else T&&(f[y++]=239,f[y++]=191,f[y++]=189,T=null);b<128?f[y++]=b:(b<2048?f[y++]=b>>6|192:(b<65536?f[y++]=b>>12|224:(f[y++]=b>>18|240,f[y++]=b>>12&63|128),f[y++]=b>>6&63|128),f[y++]=63&b|128)}return y}(this.buf,a,this.pos);var u=this.pos-r;u>=128&&Kx(r,u,this),this.pos=r-1,this.writeVarint(u),this.pos+=u},writeFloat:function(a){this.realloc(4),Zx(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),Zx(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var r=a.length;this.writeVarint(r),this.realloc(r);for(var u=0;u<r;u++)this.buf[this.pos++]=a[u]},writeRawMessage:function(a,r){this.pos++;var u=this.pos;a(r,this);var f=this.pos-u;f>=128&&Kx(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f},writeMessage:function(a,r,u){this.writeTag(a,un.Bytes),this.writeRawMessage(r,u)},writePackedVarint:function(a,r){r.length&&this.writeMessage(a,SI,r)},writePackedSVarint:function(a,r){r.length&&this.writeMessage(a,AI,r)},writePackedBoolean:function(a,r){r.length&&this.writeMessage(a,CI,r)},writePackedFloat:function(a,r){r.length&&this.writeMessage(a,PI,r)},writePackedDouble:function(a,r){r.length&&this.writeMessage(a,II,r)},writePackedFixed32:function(a,r){r.length&&this.writeMessage(a,MI,r)},writePackedSFixed32:function(a,r){r.length&&this.writeMessage(a,LI,r)},writePackedFixed64:function(a,r){r.length&&this.writeMessage(a,kI,r)},writePackedSFixed64:function(a,r){r.length&&this.writeMessage(a,RI,r)},writeBytesField:function(a,r){this.writeTag(a,un.Bytes),this.writeBytes(r)},writeFixed32Field:function(a,r){this.writeTag(a,un.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(a,r){this.writeTag(a,un.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(a,r){this.writeTag(a,un.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(a,r){this.writeTag(a,un.Fixed64),this.writeSFixed64(r)},writeVarintField:function(a,r){this.writeTag(a,un.Varint),this.writeVarint(r)},writeSVarintField:function(a,r){this.writeTag(a,un.Varint),this.writeSVarint(r)},writeStringField:function(a,r){this.writeTag(a,un.Bytes),this.writeString(r)},writeFloatField:function(a,r){this.writeTag(a,un.Fixed32),this.writeFloat(r)},writeDoubleField:function(a,r){this.writeTag(a,un.Fixed64),this.writeDouble(r)},writeBooleanField:function(a,r){this.writeVarintField(a,!!r)}};class Vg{constructor(r,{pixelRatio:u,version:f,stretchX:g,stretchY:y,content:b}){this.paddedRect=r,this.pixelRatio=u,this.stretchX=g,this.stretchY=y,this.content=b,this.version=f}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class e1{constructor(r,u){const f={},g={};this.haveRenderCallbacks=[];const y=[];this.addImages(r,f,y),this.addImages(u,g,y);const{w:b,h:T}=Qx(y),S=new Nr({width:b||1,height:T||1});for(const M in r){const D=r[M],O=f[M].paddedRect;Nr.copy(D.data,S,{x:0,y:0},{x:O.x+1,y:O.y+1},D.data)}for(const M in u){const D=u[M],O=g[M].paddedRect,U=O.x+1,$=O.y+1,H=D.data.width,ae=D.data.height;Nr.copy(D.data,S,{x:0,y:0},{x:U,y:$},D.data),Nr.copy(D.data,S,{x:0,y:ae-1},{x:U,y:$-1},{width:H,height:1}),Nr.copy(D.data,S,{x:0,y:0},{x:U,y:$+ae},{width:H,height:1}),Nr.copy(D.data,S,{x:H-1,y:0},{x:U-1,y:$},{width:1,height:ae}),Nr.copy(D.data,S,{x:0,y:0},{x:U+H,y:$},{width:1,height:ae})}this.image=S,this.iconPositions=f,this.patternPositions=g}addImages(r,u,f){for(const g in r){const y=r[g],b={x:0,y:0,w:y.data.width+2,h:y.data.height+2};f.push(b),u[g]=new Vg(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(r,u){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in r.updatedImages)this.patchUpdatedImage(this.iconPositions[f],r.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],r.getImage(f),u)}patchUpdatedImage(r,u,f){if(!r||!u||r.version===u.version)return;r.version=u.version;const[g,y]=r.tl;f.update(u.data,void 0,{x:g,y})}}st("ImagePosition",Vg),st("ImageAtlas",e1),l.WritingMode=void 0,(pa=l.WritingMode||(l.WritingMode={}))[pa.none=0]="none",pa[pa.horizontal=1]="horizontal",pa[pa.vertical=2]="vertical",pa[pa.horizontalOnly=3]="horizontalOnly";const Af=-17;class lh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,u){const f=new lh;return f.scale=r||1,f.fontStack=u,f}static forImage(r){const u=new lh;return u.imageName=r,u}}class gc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,u){const f=new gc;for(let g=0;g<r.sections.length;g++){const y=r.sections[g];y.image?f.addImageSection(y):f.addTextSection(y,u)}return f}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(){this.text=function(r){let u="";for(let f=0;f<r.length;f++){const g=r.charCodeAt(f+1)||null,y=r.charCodeAt(f-1)||null;u+=g&&of(g)&&!ah[r[f+1]]||y&&of(y)&&!ah[r[f-1]]||!ah[r[f]]?r[f]:ah[r[f]]}return u}(this.text)}trim(){let r=0;for(let f=0;f<this.text.length&&If[this.text.charCodeAt(f)];f++)r++;let u=this.text.length;for(let f=this.text.length-1;f>=0&&f>=r&&If[this.text.charCodeAt(f)];f--)u--;this.text=this.text.substring(r,u),this.sectionIndex=this.sectionIndex.slice(r,u)}substring(r,u){const f=new gc;return f.text=this.text.substring(r,u),f.sectionIndex=this.sectionIndex.slice(r,u),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,u)=>Math.max(r,this.sections[u].scale),0)}addTextSection(r,u){this.text+=r.text,this.sections.push(lh.forText(r.scale,r.fontStack||u));const f=this.sections.length-1;for(let g=0;g<r.text.length;++g)this.sectionIndex.push(f)}addImageSection(r){const u=r.image?r.image.name:"";if(u.length===0)return void ye("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(lh.forImage(u)),this.sectionIndex.push(this.sections.length-1)):ye("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Pf(a,r,u,f,g,y,b,T,S,M,D,O,U,$,H,ae){const se=gc.fromFeature(a,g);let ve;O===l.WritingMode.vertical&&se.verticalizePunctuation();const{processBidirectionalText:Te,processStyledBidirectionalText:_e}=wr;if(Te&&se.sections.length===1){ve=[];const Re=Te(se.toString(),jg(se,M,y,r,f,$,H));for(const it of Re){const ct=new gc;ct.text=it,ct.sections=se.sections;for(let Je=0;Je<it.length;Je++)ct.sectionIndex.push(0);ve.push(ct)}}else if(_e){ve=[];const Re=_e(se.text,se.sectionIndex,jg(se,M,y,r,f,$,H));for(const it of Re){const ct=new gc;ct.text=it[0],ct.sectionIndex=it[1],ct.sections=se.sections,ve.push(ct)}}else ve=function(Re,it){const ct=[],Je=Re.text;let Ze=0;for(const $e of it)ct.push(Re.substring(Ze,$e)),Ze=$e;return Ze<Je.length&&ct.push(Re.substring(Ze,Je.length)),ct}(se,jg(se,M,y,r,f,$,H));const we=[],De={positionedLines:we,text:se.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(Re,it,ct,Je,Ze,$e,Qe,Xe,Ue,yt,pt,Dt){let gn=0,wn=Af,ti=0,Vr=0;const Ti=Xe==="right"?1:Xe==="left"?0:.5;let Wn=0;for(const qn of Ze){qn.trim();const Ai=qn.getMaxScale(),Oi=(Ai-1)*gi,Xi={positionedGlyphs:[],lineOffset:0};Re.positionedLines[Wn]=Xi;const cr=Xi.positionedGlyphs;let ur=0;if(!qn.length()){wn+=$e,++Wn;continue}for(let hi=0;hi<qn.length();hi++){const Ut=qn.getSection(hi),Sr=qn.getSectionIndex(hi),Pi=qn.getCharCode(hi);let Fi=0,hs=null,Is=null,Cs=null,Mo=gi;const ds=!(Ue===l.WritingMode.horizontal||!pt&&!Vu(Pi)||pt&&(If[Pi]||(ui=Pi,Ke.Arabic(ui)||Ke["Arabic Supplement"](ui)||Ke["Arabic Extended-A"](ui)||Ke["Arabic Presentation Forms-A"](ui)||Ke["Arabic Presentation Forms-B"](ui))));if(Ut.imageName){const jr=Je[Ut.imageName];if(!jr)continue;Cs=Ut.imageName,Re.iconsInText=Re.iconsInText||!0,Is=jr.paddedRect;const hr=jr.displaySize;Ut.scale=Ut.scale*gi/Dt,hs={width:hr[0],height:hr[1],left:1,top:-3,advance:ds?hr[1]:hr[0]},Fi=Oi+(gi-hr[1]*Ut.scale),Mo=hs.advance;const Lo=ds?hr[0]*Ut.scale-gi*Ai:hr[1]*Ut.scale-gi*Ai;Lo>0&&Lo>ur&&(ur=Lo)}else{const jr=ct[Ut.fontStack],hr=jr&&jr[Pi];if(hr&&hr.rect)Is=hr.rect,hs=hr.metrics;else{const Lo=it[Ut.fontStack],hh=Lo&&Lo[Pi];if(!hh)continue;hs=hh.metrics}Fi=(Ai-Ut.scale)*gi}ds?(Re.verticalizable=!0,cr.push({glyph:Pi,imageName:Cs,x:gn,y:wn+Fi,vertical:ds,scale:Ut.scale,fontStack:Ut.fontStack,sectionIndex:Sr,metrics:hs,rect:Is}),gn+=Mo*Ut.scale+yt):(cr.push({glyph:Pi,imageName:Cs,x:gn,y:wn+Fi,vertical:ds,scale:Ut.scale,fontStack:Ut.fontStack,sectionIndex:Sr,metrics:hs,rect:Is}),gn+=hs.advance*Ut.scale+yt)}cr.length!==0&&(ti=Math.max(gn-yt,ti),NI(cr,0,cr.length-1,Ti,ur)),gn=0;const Tn=$e*Ai+ur;Xi.lineOffset=Math.max(ur,Oi),wn+=Tn,Vr=Math.max(Tn,Vr),++Wn}var ui;const Si=wn-Af,{horizontalAlign:zi,verticalAlign:lr}=Gg(Qe);(function(qn,Ai,Oi,Xi,cr,ur,Tn,hi,Ut){const Sr=(Ai-Oi)*cr;let Pi=0;Pi=ur!==Tn?-hi*Xi-Af:(-Xi*Ut+.5)*Tn;for(const Fi of qn)for(const hs of Fi.positionedGlyphs)hs.x+=Sr,hs.y+=Pi})(Re.positionedLines,Ti,zi,lr,ti,Vr,$e,Si,Ze.length),Re.top+=-lr*Si,Re.bottom=Re.top+Si,Re.left+=-zi*ti,Re.right=Re.left+ti}(De,r,u,f,ve,b,T,S,O,M,U,ae),!function(Re){for(const it of Re)if(it.positionedGlyphs.length!==0)return!1;return!0}(we)&&De}const If={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},FI={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function t1(a,r,u,f,g,y){if(r.imageName){const b=f[r.imageName];return b?b.displaySize[0]*r.scale*gi/y+g:0}{const b=u[r.fontStack],T=b&&b[a];return T?T.metrics.advance*r.scale+g:0}}function n1(a,r,u,f){const g=Math.pow(a-r,2);return f?a<r?g/2:2*g:g+Math.abs(u)*u}function BI(a,r,u){let f=0;return a===10&&(f-=1e4),u&&(f+=150),a!==40&&a!==65288||(f+=50),r!==41&&r!==65289||(f+=50),f}function i1(a,r,u,f,g,y){let b=null,T=n1(r,u,g,y);for(const S of f){const M=n1(r-S.x,u,g,y)+S.badness;M<=T&&(b=S,T=M)}return{index:a,x:r,priorBreak:b,badness:T}}function r1(a){return a?r1(a.priorBreak).concat(a.index):[]}function jg(a,r,u,f,g,y,b){if(y!=="point")return[];if(!a)return[];const T=[],S=function(U,$,H,ae,se,ve){let Te=0;for(let _e=0;_e<U.length();_e++){const we=U.getSection(_e);Te+=t1(U.getCharCode(_e),we,ae,se,$,ve)}return Te/Math.max(1,Math.ceil(Te/H))}(a,r,u,f,g,b),M=a.text.indexOf("​")>=0;let D=0;for(let U=0;U<a.length();U++){const $=a.getSection(U),H=a.getCharCode(U);if(If[H]||(D+=t1(H,$,f,g,r,b)),U<a.length()-1){const ae=!((O=H)<11904||!(Ke["Bopomofo Extended"](O)||Ke.Bopomofo(O)||Ke["CJK Compatibility Forms"](O)||Ke["CJK Compatibility Ideographs"](O)||Ke["CJK Compatibility"](O)||Ke["CJK Radicals Supplement"](O)||Ke["CJK Strokes"](O)||Ke["CJK Symbols and Punctuation"](O)||Ke["CJK Unified Ideographs Extension A"](O)||Ke["CJK Unified Ideographs"](O)||Ke["Enclosed CJK Letters and Months"](O)||Ke["Halfwidth and Fullwidth Forms"](O)||Ke.Hiragana(O)||Ke["Ideographic Description Characters"](O)||Ke["Kangxi Radicals"](O)||Ke["Katakana Phonetic Extensions"](O)||Ke.Katakana(O)||Ke["Vertical Forms"](O)||Ke["Yi Radicals"](O)||Ke["Yi Syllables"](O)));(FI[H]||ae||$.imageName)&&T.push(i1(U+1,D,S,T,BI(H,a.getCharCode(U+1),ae&&M),!1))}}var O;return r1(i1(a.length(),D,S,T,0,!0))}function Gg(a){let r=.5,u=.5;switch(a){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:r,verticalAlign:u}}function NI(a,r,u,f,g){if(!f&&!g)return;const y=a[u],b=(a[u].x+y.metrics.advance*y.scale)*f;for(let T=r;T<=u;T++)a[T].x-=b,a[T].y+=g}function UI(a,r,u){const{horizontalAlign:f,verticalAlign:g}=Gg(u),y=r[0]-a.displaySize[0]*f,b=r[1]-a.displaySize[1]*g;return{image:a,top:b,bottom:b+a.displaySize[1],left:y,right:y+a.displaySize[0]}}function s1(a,r,u,f,g,y){const b=a.image;let T;if(b.content){const se=b.content,ve=b.pixelRatio||1;T=[se[0]/ve,se[1]/ve,b.displaySize[0]-se[2]/ve,b.displaySize[1]-se[3]/ve]}const S=r.left*y,M=r.right*y;let D,O,U,$;u==="width"||u==="both"?($=g[0]+S-f[3],O=g[0]+M+f[1]):($=g[0]+(S+M-b.displaySize[0])/2,O=$+b.displaySize[0]);const H=r.top*y,ae=r.bottom*y;return u==="height"||u==="both"?(D=g[1]+H-f[0],U=g[1]+ae+f[2]):(D=g[1]+(H+ae-b.displaySize[1])/2,U=D+b.displaySize[1]),{image:b,top:D,right:O,bottom:U,left:$,collisionPadding:T}}const Co=128;function o1(a,r){const{expression:u}=r;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new xn(a+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:g}=u;let y=0;for(;y<f.length&&f[y]<=a;)y++;y=Math.max(0,y-1);let b=y;for(;b<f.length&&f[b]<a+1;)b++;b=Math.min(f.length-1,b);const T=f[y],S=f[b];return u.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:S,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:S,minSize:u.evaluate(new xn(T)),maxSize:u.evaluate(new xn(S)),interpolationType:g}}}class ma extends vt{constructor(r,u,f,g){super(r,u),this.angle=f,g!==void 0&&(this.segment=g)}clone(){return new ma(this.x,this.y,this.angle,this.segment)}}function a1(a,r,u,f,g){if(r.segment===void 0)return!0;let y=r,b=r.segment+1,T=0;for(;T>-u/2;){if(b--,b<0)return!1;T-=a[b].dist(y),y=a[b]}T+=a[b].dist(a[b+1]),b++;const S=[];let M=0;for(;T<u/2;){const D=a[b],O=a[b+1];if(!O)return!1;let U=a[b-1].angleTo(D)-D.angleTo(O);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:T,angleDelta:U}),M+=U;T-S[0].distance>f;)M-=S.shift().angleDelta;if(M>g)return!1;b++,T+=D.dist(O)}return!0}function l1(a){let r=0;for(let u=0;u<a.length-1;u++)r+=a[u].dist(a[u+1]);return r}function c1(a,r,u){return a?.6*r*u:0}function u1(a,r){return Math.max(a?a.right-a.left:0,r?r.right-r.left:0)}function VI(a,r,u,f,g,y){const b=c1(u,g,y),T=u1(u,f)*y;let S=0;const M=l1(a)/2;for(let D=0;D<a.length-1;D++){const O=a[D],U=a[D+1],$=O.dist(U);if(S+$>M){const H=(M-S)/$,ae=kt(O.x,U.x,H),se=kt(O.y,U.y,H),ve=new ma(ae,se,U.angleTo(O),D);return ve._round(),!b||a1(a,ve,T,b,r)?ve:void 0}S+=$}}function jI(a,r,u,f,g,y,b,T,S){const M=c1(f,y,b),D=u1(f,g),O=D*b,U=a[0].x===0||a[0].x===S||a[0].y===0||a[0].y===S;return r-O<r/4&&(r=O+r/4),h1(a,U?r/2*T%r:(D/2+2*y)*b*T%r,r,M,u,O,U,!1,S)}function h1(a,r,u,f,g,y,b,T,S){const M=y/2,D=l1(a);let O=0,U=r-u,$=[];for(let H=0;H<a.length-1;H++){const ae=a[H],se=a[H+1],ve=ae.dist(se),Te=se.angleTo(ae);for(;U+u<O+ve;){U+=u;const _e=(U-O)/ve,we=kt(ae.x,se.x,_e),De=kt(ae.y,se.y,_e);if(we>=0&&we<S&&De>=0&&De<S&&U-M>=0&&U+M<=D){const Re=new ma(we,De,Te,H);Re._round(),f&&!a1(a,Re,y,f,g)||$.push(Re)}}O+=ve}return T||$.length||b||($=h1(a,O/2,u,f,g,y,b,!0,S)),$}function d1(a,r,u,f,g){const y=[];for(let b=0;b<a.length;b++){const T=a[b];let S;for(let M=0;M<T.length-1;M++){let D=T[M],O=T[M+1];D.x<r&&O.x<r||(D.x<r?D=new vt(r,D.y+(r-D.x)/(O.x-D.x)*(O.y-D.y))._round():O.x<r&&(O=new vt(r,D.y+(r-D.x)/(O.x-D.x)*(O.y-D.y))._round()),D.y<u&&O.y<u||(D.y<u?D=new vt(D.x+(u-D.y)/(O.y-D.y)*(O.x-D.x),u)._round():O.y<u&&(O=new vt(D.x+(u-D.y)/(O.y-D.y)*(O.x-D.x),u)._round()),D.x>=f&&O.x>=f||(D.x>=f?D=new vt(f,D.y+(f-D.x)/(O.x-D.x)*(O.y-D.y))._round():O.x>=f&&(O=new vt(f,D.y+(f-D.x)/(O.x-D.x)*(O.y-D.y))._round()),D.y>=g&&O.y>=g||(D.y>=g?D=new vt(D.x+(g-D.y)/(O.y-D.y)*(O.x-D.x),g)._round():O.y>=g&&(O=new vt(D.x+(g-D.y)/(O.y-D.y)*(O.x-D.x),g)._round()),S&&D.equals(S[S.length-1])||(S=[D],y.push(S)),S.push(O)))))}}return y}function f1(a,r,u,f){const g=[],y=a.image,b=y.pixelRatio,T=y.paddedRect.w-2,S=y.paddedRect.h-2,M=a.right-a.left,D=a.bottom-a.top,O=y.stretchX||[[0,T]],U=y.stretchY||[[0,S]],$=($e,Qe)=>$e+Qe[1]-Qe[0],H=O.reduce($,0),ae=U.reduce($,0),se=T-H,ve=S-ae;let Te=0,_e=H,we=0,De=ae,Re=0,it=se,ct=0,Je=ve;if(y.content&&f){const $e=y.content;Te=Cf(O,0,$e[0]),we=Cf(U,0,$e[1]),_e=Cf(O,$e[0],$e[2]),De=Cf(U,$e[1],$e[3]),Re=$e[0]-Te,ct=$e[1]-we,it=$e[2]-$e[0]-_e,Je=$e[3]-$e[1]-De}const Ze=($e,Qe,Xe,Ue)=>{const yt=Mf($e.stretch-Te,_e,M,a.left),pt=Lf($e.fixed-Re,it,$e.stretch,H),Dt=Mf(Qe.stretch-we,De,D,a.top),gn=Lf(Qe.fixed-ct,Je,Qe.stretch,ae),wn=Mf(Xe.stretch-Te,_e,M,a.left),ti=Lf(Xe.fixed-Re,it,Xe.stretch,H),Vr=Mf(Ue.stretch-we,De,D,a.top),Ti=Lf(Ue.fixed-ct,Je,Ue.stretch,ae),Wn=new vt(yt,Dt),ui=new vt(wn,Dt),Si=new vt(wn,Vr),zi=new vt(yt,Vr),lr=new vt(pt/b,gn/b),qn=new vt(ti/b,Ti/b),Ai=r*Math.PI/180;if(Ai){const cr=Math.sin(Ai),ur=Math.cos(Ai),Tn=[ur,-cr,cr,ur];Wn._matMult(Tn),ui._matMult(Tn),zi._matMult(Tn),Si._matMult(Tn)}const Oi=$e.stretch+$e.fixed,Xi=Qe.stretch+Qe.fixed;return{tl:Wn,tr:ui,bl:zi,br:Si,tex:{x:y.paddedRect.x+1+Oi,y:y.paddedRect.y+1+Xi,w:Xe.stretch+Xe.fixed-Oi,h:Ue.stretch+Ue.fixed-Xi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:lr,pixelOffsetBR:qn,minFontScaleX:it/b/M,minFontScaleY:Je/b/D,isSDF:u}};if(f&&(y.stretchX||y.stretchY)){const $e=p1(O,se,H),Qe=p1(U,ve,ae);for(let Xe=0;Xe<$e.length-1;Xe++){const Ue=$e[Xe],yt=$e[Xe+1];for(let pt=0;pt<Qe.length-1;pt++)g.push(Ze(Ue,Qe[pt],yt,Qe[pt+1]))}}else g.push(Ze({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:S+1}));return g}function Cf(a,r,u){let f=0;for(const g of a)f+=Math.max(r,Math.min(u,g[1]))-Math.max(r,Math.min(u,g[0]));return f}function p1(a,r,u){const f=[{fixed:-1,stretch:0}];for(const[g,y]of a){const b=f[f.length-1];f.push({fixed:g-b.stretch,stretch:b.stretch}),f.push({fixed:g-b.stretch,stretch:b.stretch+(y-g)})}return f.push({fixed:r+1,stretch:u}),f}function Mf(a,r,u,f){return a/r*u+f}function Lf(a,r,u,f){return a-r*u/f}st("Anchor",ma);class kf{constructor(r,u,f,g,y,b,T,S,M,D){if(this.boxStartIndex=r.length,M){let O=b.top,U=b.bottom;const $=b.collisionPadding;$&&(O-=$[1],U+=$[3]);let H=U-O;H>0&&(H=Math.max(10,H),this.circleDiameter=H)}else{let O=b.top*T-S[0],U=b.bottom*T+S[2],$=b.left*T-S[3],H=b.right*T+S[1];const ae=b.collisionPadding;if(ae&&($-=ae[0]*T,O-=ae[1]*T,H+=ae[2]*T,U+=ae[3]*T),D){const se=new vt($,O),ve=new vt(H,O),Te=new vt($,U),_e=new vt(H,U),we=D*Math.PI/180;se._rotate(we),ve._rotate(we),Te._rotate(we),_e._rotate(we),$=Math.min(se.x,ve.x,Te.x,_e.x),H=Math.max(se.x,ve.x,Te.x,_e.x),O=Math.min(se.y,ve.y,Te.y,_e.y),U=Math.max(se.y,ve.y,Te.y,_e.y)}r.emplaceBack(u.x,u.y,$,O,H,U,f,g,y)}this.boxEndIndex=r.length}}class GI{constructor(r=[],u=$I){if(this.data=r,this.length=this.data.length,this.compare=u,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:u,compare:f}=this,g=u[r];for(;r>0;){const y=r-1>>1,b=u[y];if(f(g,b)>=0)break;u[r]=b,r=y}u[r]=g}_down(r){const{data:u,compare:f}=this,g=this.length>>1,y=u[r];for(;r<g;){let b=1+(r<<1),T=u[b];const S=b+1;if(S<this.length&&f(u[S],T)<0&&(b=S,T=u[S]),f(T,y)>=0)break;u[r]=T,r=b}u[r]=y}}function $I(a,r){return a<r?-1:a>r?1:0}function HI(a,r=1,u=!1){let f=1/0,g=1/0,y=-1/0,b=-1/0;const T=a[0];for(let $=0;$<T.length;$++){const H=T[$];(!$||H.x<f)&&(f=H.x),(!$||H.y<g)&&(g=H.y),(!$||H.x>y)&&(y=H.x),(!$||H.y>b)&&(b=H.y)}const S=Math.min(y-f,b-g);let M=S/2;const D=new GI([],WI);if(S===0)return new vt(f,g);for(let $=f;$<y;$+=S)for(let H=g;H<b;H+=S)D.push(new _c($+M,H+M,M,a));let O=function($){let H=0,ae=0,se=0;const ve=$[0];for(let Te=0,_e=ve.length,we=_e-1;Te<_e;we=Te++){const De=ve[Te],Re=ve[we],it=De.x*Re.y-Re.x*De.y;ae+=(De.x+Re.x)*it,se+=(De.y+Re.y)*it,H+=3*it}return new _c(ae/H,se/H,0,$)}(a),U=D.length;for(;D.length;){const $=D.pop();($.d>O.d||!O.d)&&(O=$,u&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,U)),$.max-O.d<=r||(M=$.h/2,D.push(new _c($.p.x-M,$.p.y-M,M,a)),D.push(new _c($.p.x+M,$.p.y-M,M,a)),D.push(new _c($.p.x-M,$.p.y+M,M,a)),D.push(new _c($.p.x+M,$.p.y+M,M,a)),U+=4)}return u&&(console.log(`num probes: ${U}`),console.log(`best distance: ${O.d}`)),O.p}function WI(a,r){return r.max-a.max}function _c(a,r,u,f){this.p=new vt(a,r),this.h=u,this.d=function(g,y){let b=!1,T=1/0;for(let S=0;S<y.length;S++){const M=y[S];for(let D=0,O=M.length,U=O-1;D<O;U=D++){const $=M[D],H=M[U];$.y>g.y!=H.y>g.y&&g.x<(H.x-$.x)*(g.y-$.y)/(H.y-$.y)+$.x&&(b=!b),T=Math.min(T,wx(g,$,H))}}return(b?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}const $g=Number.POSITIVE_INFINITY;function m1(a,r){return r[1]!==$g?function(u,f,g){let y=0,b=0;switch(f=Math.abs(f),g=Math.abs(g),u){case"top-right":case"top-left":case"top":b=g-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-g}switch(u){case"top-right":case"bottom-right":case"right":y=-f;break;case"top-left":case"bottom-left":case"left":y=f}return[y,b]}(a,r[0],r[1]):function(u,f){let g=0,y=0;f<0&&(f=0);const b=f/Math.sqrt(2);switch(u){case"top-right":case"top-left":y=b-7;break;case"bottom-right":case"bottom-left":y=7-b;break;case"bottom":y=7-f;break;case"top":y=f-7}switch(u){case"top-right":case"bottom-right":g=-b;break;case"top-left":case"bottom-left":g=b;break;case"left":g=f;break;case"right":g=-f}return[g,y]}(a,r[0])}function Hg(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function qI(a,r,u,f,g,y,b,T,S,M,D){let O=y.textMaxSize.evaluate(r,{});O===void 0&&(O=b);const U=a.layers[0].layout,$=U.get("icon-offset").evaluate(r,{},D),H=_1(u.horizontal),ae=b/24,se=a.tilePixelRatio*ae,ve=a.tilePixelRatio*O/24,Te=a.tilePixelRatio*T,_e=a.tilePixelRatio*U.get("symbol-spacing"),we=U.get("text-padding")*a.tilePixelRatio,De=function(Ue,yt,pt,Dt=1){const gn=Ue.get("icon-padding").evaluate(yt,{},pt),wn=gn&&gn.values;return[wn[0]*Dt,wn[1]*Dt,wn[2]*Dt,wn[3]*Dt]}(U,r,D,a.tilePixelRatio),Re=U.get("text-max-angle")/180*Math.PI,it=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point",ct=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",Je=U.get("symbol-placement"),Ze=_e/2,$e=U.get("icon-text-fit");let Qe;f&&$e!=="none"&&(a.allowVerticalPlacement&&u.vertical&&(Qe=s1(f,u.vertical,$e,U.get("icon-text-fit-padding"),$,ae)),H&&(f=s1(f,H,$e,U.get("icon-text-fit-padding"),$,ae)));const Xe=(Ue,yt)=>{yt.x<0||yt.x>=ei||yt.y<0||yt.y>=ei||function(pt,Dt,gn,wn,ti,Vr,Ti,Wn,ui,Si,zi,lr,qn,Ai,Oi,Xi,cr,ur,Tn,hi,Ut,Sr,Pi,Fi,hs){const Is=pt.addToLineVertexArray(Dt,gn);let Cs,Mo,ds,jr,hr=0,Lo=0,hh=0,R1=0,t_=-1,n_=-1;const ko={};let D1=ci.exports(""),i_=0,r_=0;if(Wn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[i_,r_]=Wn.layout.get("text-offset").evaluate(Ut,{},Fi).map(dr=>dr*gi):(i_=Wn.layout.get("text-radial-offset").evaluate(Ut,{},Fi)*gi,r_=$g),pt.allowVerticalPlacement&&wn.vertical){const dr=Wn.layout.get("text-rotate").evaluate(Ut,{},Fi)+90;ds=new kf(ui,Dt,Si,zi,lr,wn.vertical,qn,Ai,Oi,dr),Ti&&(jr=new kf(ui,Dt,Si,zi,lr,Ti,cr,ur,Oi,dr))}if(ti){const dr=Wn.layout.get("icon-rotate").evaluate(Ut,{}),no=Wn.layout.get("icon-text-fit")!=="none",dh=f1(ti,dr,Pi,no),fh=Ti?f1(Ti,dr,Pi,no):void 0;Mo=new kf(ui,Dt,Si,zi,lr,ti,cr,ur,!1,dr),hr=4*dh.length;const F1=pt.iconSizeData;let vl=null;F1.kind==="source"?(vl=[Co*Wn.layout.get("icon-size").evaluate(Ut,{})],vl[0]>ga&&ye(`${pt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):F1.kind==="composite"&&(vl=[Co*Sr.compositeIconSizes[0].evaluate(Ut,{},Fi),Co*Sr.compositeIconSizes[1].evaluate(Ut,{},Fi)],(vl[0]>ga||vl[1]>ga)&&ye(`${pt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),pt.addSymbols(pt.icon,dh,vl,hi,Tn,Ut,l.WritingMode.none,Dt,Is.lineStartIndex,Is.lineLength,-1,Fi),t_=pt.icon.placedSymbolArray.length-1,fh&&(Lo=4*fh.length,pt.addSymbols(pt.icon,fh,vl,hi,Tn,Ut,l.WritingMode.vertical,Dt,Is.lineStartIndex,Is.lineLength,-1,Fi),n_=pt.icon.placedSymbolArray.length-1)}const z1=Object.keys(wn.horizontal);for(const dr of z1){const no=wn.horizontal[dr];if(!Cs){D1=ci.exports(no.text);const fh=Wn.layout.get("text-rotate").evaluate(Ut,{},Fi);Cs=new kf(ui,Dt,Si,zi,lr,no,qn,Ai,Oi,fh)}const dh=no.positionedLines.length===1;if(hh+=g1(pt,Dt,no,Vr,Wn,Oi,Ut,Xi,Is,wn.vertical?l.WritingMode.horizontal:l.WritingMode.horizontalOnly,dh?z1:[dr],ko,t_,Sr,Fi),dh)break}wn.vertical&&(R1+=g1(pt,Dt,wn.vertical,Vr,Wn,Oi,Ut,Xi,Is,l.WritingMode.vertical,["vertical"],ko,n_,Sr,Fi));const oC=Cs?Cs.boxStartIndex:pt.collisionBoxArray.length,aC=Cs?Cs.boxEndIndex:pt.collisionBoxArray.length,lC=ds?ds.boxStartIndex:pt.collisionBoxArray.length,cC=ds?ds.boxEndIndex:pt.collisionBoxArray.length,uC=Mo?Mo.boxStartIndex:pt.collisionBoxArray.length,hC=Mo?Mo.boxEndIndex:pt.collisionBoxArray.length,dC=jr?jr.boxStartIndex:pt.collisionBoxArray.length,fC=jr?jr.boxEndIndex:pt.collisionBoxArray.length;let Ms=-1;const Ff=(dr,no)=>dr&&dr.circleDiameter?Math.max(dr.circleDiameter,no):no;Ms=Ff(Cs,Ms),Ms=Ff(ds,Ms),Ms=Ff(Mo,Ms),Ms=Ff(jr,Ms);const O1=Ms>-1?1:0;O1&&(Ms*=hs/gi),pt.glyphOffsetArray.length>=yc.MAX_GLYPHS&&ye("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ut.sortKey!==void 0&&pt.addToSortKeyRanges(pt.symbolInstances.length,Ut.sortKey),pt.symbolInstances.emplaceBack(Dt.x,Dt.y,ko.right>=0?ko.right:-1,ko.center>=0?ko.center:-1,ko.left>=0?ko.left:-1,ko.vertical||-1,t_,n_,D1,oC,aC,lC,cC,uC,hC,dC,fC,Si,hh,R1,hr,Lo,O1,0,qn,i_,r_,Ms)}(a,yt,Ue,u,f,g,Qe,a.layers[0],a.collisionBoxArray,r.index,r.sourceLayerIndex,a.index,se,[we,we,we,we],it,S,Te,De,ct,$,r,y,M,D,b)};if(Je==="line")for(const Ue of d1(r.geometry,0,0,ei,ei)){const yt=jI(Ue,_e,Re,u.vertical||H,f,24,ve,a.overscaling,ei);for(const pt of yt){const Dt=H;Dt&&ZI(a,Dt.text,Ze,pt)||Xe(Ue,pt)}}else if(Je==="line-center"){for(const Ue of r.geometry)if(Ue.length>1){const yt=VI(Ue,Re,u.vertical||H,f,24,ve);yt&&Xe(Ue,yt)}}else if(r.type==="Polygon")for(const Ue of kg(r.geometry,0)){const yt=HI(Ue,16);Xe(Ue[0],new ma(yt.x,yt.y,0))}else if(r.type==="LineString")for(const Ue of r.geometry)Xe(Ue,new ma(Ue[0].x,Ue[0].y,0));else if(r.type==="Point")for(const Ue of r.geometry)for(const yt of Ue)Xe([yt],new ma(yt.x,yt.y,0))}const ga=32640;function g1(a,r,u,f,g,y,b,T,S,M,D,O,U,$,H){const ae=function(Te,_e,we,De,Re,it,ct,Je){const Ze=De.layout.get("text-rotate").evaluate(it,{})*Math.PI/180,$e=[];for(const Qe of _e.positionedLines)for(const Xe of Qe.positionedGlyphs){if(!Xe.rect)continue;const Ue=Xe.rect||{};let yt=4,pt=!0,Dt=1,gn=0;const wn=(Re||Je)&&Xe.vertical,ti=Xe.metrics.advance*Xe.scale/2;if(Je&&_e.verticalizable){const Tn=(Xe.scale-1)*gi,hi=(gi-Xe.metrics.width*Xe.scale)/2;gn=Qe.lineOffset/2-(Xe.imageName?-hi:Tn)}if(Xe.imageName){const Tn=ct[Xe.imageName];pt=Tn.sdf,Dt=Tn.pixelRatio,yt=1/Dt}const Vr=Re?[Xe.x+ti,Xe.y]:[0,0];let Ti=Re?[0,0]:[Xe.x+ti+we[0],Xe.y+we[1]-gn],Wn=[0,0];wn&&(Wn=Ti,Ti=[0,0]);const ui=(Xe.metrics.left-yt)*Xe.scale-ti+Ti[0],Si=(-Xe.metrics.top-yt)*Xe.scale+Ti[1],zi=ui+Ue.w*Xe.scale/Dt,lr=Si+Ue.h*Xe.scale/Dt,qn=new vt(ui,Si),Ai=new vt(zi,Si),Oi=new vt(ui,lr),Xi=new vt(zi,lr);if(wn){const Tn=new vt(-ti,ti-Af),hi=-Math.PI/2,Ut=12-ti,Sr=new vt(22-Ut,-(Xe.imageName?Ut:0)),Pi=new vt(...Wn);qn._rotateAround(hi,Tn)._add(Sr)._add(Pi),Ai._rotateAround(hi,Tn)._add(Sr)._add(Pi),Oi._rotateAround(hi,Tn)._add(Sr)._add(Pi),Xi._rotateAround(hi,Tn)._add(Sr)._add(Pi)}if(Ze){const Tn=Math.sin(Ze),hi=Math.cos(Ze),Ut=[hi,-Tn,Tn,hi];qn._matMult(Ut),Ai._matMult(Ut),Oi._matMult(Ut),Xi._matMult(Ut)}const cr=new vt(0,0),ur=new vt(0,0);$e.push({tl:qn,tr:Ai,bl:Oi,br:Xi,tex:Ue,writingMode:_e.writingMode,glyphOffset:Vr,sectionIndex:Xe.sectionIndex,isSDF:pt,pixelOffsetTL:cr,pixelOffsetBR:ur,minFontScaleX:0,minFontScaleY:0})}return $e}(0,u,T,g,y,b,f,a.allowVerticalPlacement),se=a.textSizeData;let ve=null;se.kind==="source"?(ve=[Co*g.layout.get("text-size").evaluate(b,{})],ve[0]>ga&&ye(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):se.kind==="composite"&&(ve=[Co*$.compositeTextSizes[0].evaluate(b,{},H),Co*$.compositeTextSizes[1].evaluate(b,{},H)],(ve[0]>ga||ve[1]>ga)&&ye(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,ae,ve,T,y,b,M,r,S.lineStartIndex,S.lineLength,U,H);for(const Te of D)O[Te]=a.text.placedSymbolArray.length-1;return 4*ae.length}function _1(a){for(const r in a)return a[r];return null}function ZI(a,r,u,f){const g=a.compareText;if(r in g){const y=g[r];for(let b=y.length-1;b>=0;b--)if(f.dist(y[b])<u)return!0}else g[r]=[];return g[r].push(f),!1}const XI=fa.VectorTileFeature.types,YI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Rf(a,r,u,f,g,y,b,T,S,M,D,O,U){const $=T?Math.min(ga,Math.round(T[0])):0,H=T?Math.min(ga,Math.round(T[1])):0;a.emplaceBack(r,u,Math.round(32*f),Math.round(32*g),y,b,($<<1)+(S?1:0),H,16*M,16*D,256*O,256*U)}function Wg(a,r,u){a.emplaceBack(r.x,r.y,u),a.emplaceBack(r.x,r.y,u),a.emplaceBack(r.x,r.y,u),a.emplaceBack(r.x,r.y,u)}function KI(a){for(const r of a.sections)if(lf(r.text))return!0;return!1}class qg{constructor(r){this.layoutVertexArray=new cs,this.indexArray=new Wi,this.programConfigurations=r,this.segments=new Ft,this.dynamicLayoutVertexArray=new Br,this.opacityVertexArray=new us,this.placedSymbolArray=new Be}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,u,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,xI.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,bI.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,YI,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}st("SymbolBuffers",qg);class Zg{constructor(r,u,f){this.layoutVertexArray=new r,this.layoutAttributes=u,this.indexArray=new f,this.segments=new Ft,this.collisionVertexArray=new Er}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,wI.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}st("CollisionBuffers",Zg);class yc{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(b=>b.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ag([]),this.placementViewportMatrix=Ag([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=o1(this.zoom,u["text-size"]),this.iconSizeData=o1(this.zoom,u["icon-size"]);const f=this.layers[0].layout,g=f.get("symbol-sort-key"),y=f.get("symbol-z-order");this.canOverlap=Yg(f,"text-overlap","text-allow-overlap")!=="never"||Yg(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(b=>l.WritingMode[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=r.sourceID}createArrays(){this.text=new qg(new pl(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new qg(new pl(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new qe,this.lineVertexArray=new nt,this.symbolInstances=new et}calculateGlyphDependencies(r,u,f,g,y){for(let b=0;b<r.length;b++)if(u[r.charCodeAt(b)]=!0,(f||g)&&y){const T=ah[r.charAt(b)];T&&(u[T.charCodeAt(0)]=!0)}}populate(r,u,f){const g=this.layers[0],y=g.layout,b=y.get("text-font"),T=y.get("text-field"),S=y.get("icon-image"),M=(T.value.kind!=="constant"||T.value.value instanceof he&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),D=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,O=y.get("symbol-sort-key");if(this.features=[],!M&&!D)return;const U=u.iconDependencies,$=u.glyphDependencies,H=u.availableImages,ae=new xn(this.zoom);for(const{feature:se,id:ve,index:Te,sourceLayerIndex:_e}of r){const we=g._featureFilter.needGeometry,De=gl(se,we);if(!g._featureFilter.filter(ae,De,f))continue;let Re,it;if(we||(De.geometry=ml(se)),M){const Je=g.getValueAndResolveTokens("text-field",De,f,H),Ze=he.factory(Je);KI(Ze)&&(this.hasRTLText=!0),(!this.hasRTLText||hl()==="unavailable"||this.hasRTLText&&wr.isParsed())&&(Re=TI(Ze,g,De))}if(D){const Je=g.getValueAndResolveTokens("icon-image",De,f,H);it=Je instanceof pe?Je:pe.fromString(Je)}if(!Re&&!it)continue;const ct=this.sortFeaturesByKey?O.evaluate(De,{},f):void 0;if(this.features.push({id:ve,text:Re,icon:it,index:Te,sourceLayerIndex:_e,geometry:De.geometry,properties:se.properties,type:XI[se.type],sortKey:ct}),it&&(U[it.name]=!0),Re){const Je=b.evaluate(De,{},f).join(","),Ze=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.WritingMode.vertical)>=0;for(const $e of Re.sections)if($e.image)U[$e.image.name]=!0;else{const Qe=oc(Re.toString()),Xe=$e.fontStack||Je,Ue=$[Xe]=$[Xe]||{};this.calculateGlyphDependencies($e.text,Ue,Ze,this.allowVerticalPlacement,Qe)}}}y.get("symbol-placement")==="line"&&(this.features=function(se){const ve={},Te={},_e=[];let we=0;function De(Je){_e.push(se[Je]),we++}function Re(Je,Ze,$e){const Qe=Te[Je];return delete Te[Je],Te[Ze]=Qe,_e[Qe].geometry[0].pop(),_e[Qe].geometry[0]=_e[Qe].geometry[0].concat($e[0]),Qe}function it(Je,Ze,$e){const Qe=ve[Ze];return delete ve[Ze],ve[Je]=Qe,_e[Qe].geometry[0].shift(),_e[Qe].geometry[0]=$e[0].concat(_e[Qe].geometry[0]),Qe}function ct(Je,Ze,$e){const Qe=$e?Ze[0][Ze[0].length-1]:Ze[0][0];return`${Je}:${Qe.x}:${Qe.y}`}for(let Je=0;Je<se.length;Je++){const Ze=se[Je],$e=Ze.geometry,Qe=Ze.text?Ze.text.toString():null;if(!Qe){De(Je);continue}const Xe=ct(Qe,$e),Ue=ct(Qe,$e,!0);if(Xe in Te&&Ue in ve&&Te[Xe]!==ve[Ue]){const yt=it(Xe,Ue,$e),pt=Re(Xe,Ue,_e[yt].geometry);delete ve[Xe],delete Te[Ue],Te[ct(Qe,_e[pt].geometry,!0)]=pt,_e[yt].geometry=null}else Xe in Te?Re(Xe,Ue,$e):Ue in ve?it(Xe,Ue,$e):(De(Je),ve[Xe]=we-1,Te[Ue]=we-1)}return _e.filter(Je=>Je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((se,ve)=>se.sortKey-ve.sortKey)}update(r,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,u,this.layers,f),this.icon.programConfigurations.updatePaintArrays(r,u,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,u){const f=this.lineVertexArray.length;if(r.segment!==void 0){let g=r.dist(u[r.segment+1]),y=r.dist(u[r.segment]);const b={};for(let T=r.segment+1;T<u.length;T++)b[T]={x:u[T].x,y:u[T].y,tileUnitDistanceFromAnchor:g},T<u.length-1&&(g+=u[T+1].dist(u[T]));for(let T=r.segment||0;T>=0;T--)b[T]={x:u[T].x,y:u[T].y,tileUnitDistanceFromAnchor:y},T>0&&(y+=u[T-1].dist(u[T]));for(let T=0;T<u.length;T++){const S=b[T];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(r,u,f,g,y,b,T,S,M,D,O,U){const $=r.indexArray,H=r.layoutVertexArray,ae=r.segments.prepareSegment(4*u.length,H,$,this.canOverlap?b.sortKey:void 0),se=this.glyphOffsetArray.length,ve=ae.vertexLength,Te=this.allowVerticalPlacement&&T===l.WritingMode.vertical?Math.PI/2:0,_e=b.text&&b.text.sections;for(let we=0;we<u.length;we++){const{tl:De,tr:Re,bl:it,br:ct,tex:Je,pixelOffsetTL:Ze,pixelOffsetBR:$e,minFontScaleX:Qe,minFontScaleY:Xe,glyphOffset:Ue,isSDF:yt,sectionIndex:pt}=u[we],Dt=ae.vertexLength,gn=Ue[1];Rf(H,S.x,S.y,De.x,gn+De.y,Je.x,Je.y,f,yt,Ze.x,Ze.y,Qe,Xe),Rf(H,S.x,S.y,Re.x,gn+Re.y,Je.x+Je.w,Je.y,f,yt,$e.x,Ze.y,Qe,Xe),Rf(H,S.x,S.y,it.x,gn+it.y,Je.x,Je.y+Je.h,f,yt,Ze.x,$e.y,Qe,Xe),Rf(H,S.x,S.y,ct.x,gn+ct.y,Je.x+Je.w,Je.y+Je.h,f,yt,$e.x,$e.y,Qe,Xe),Wg(r.dynamicLayoutVertexArray,S,Te),$.emplaceBack(Dt,Dt+1,Dt+2),$.emplaceBack(Dt+1,Dt+2,Dt+3),ae.vertexLength+=4,ae.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ue[0]),we!==u.length-1&&pt===u[we+1].sectionIndex||r.programConfigurations.populatePaintArrays(H.length,b,b.index,{},U,_e&&_e[pt])}r.placedSymbolArray.emplaceBack(S.x,S.y,se,this.glyphOffsetArray.length-se,ve,M,D,S.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],T,0,!1,0,O)}_addCollisionDebugVertex(r,u,f,g,y,b){return u.emplaceBack(0,0),r.emplaceBack(f.x,f.y,g,y,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(r,u,f,g,y,b,T){const S=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),M=S.vertexLength,D=y.layoutVertexArray,O=y.collisionVertexArray,U=T.anchorX,$=T.anchorY;this._addCollisionDebugVertex(D,O,b,U,$,new vt(r,u)),this._addCollisionDebugVertex(D,O,b,U,$,new vt(f,u)),this._addCollisionDebugVertex(D,O,b,U,$,new vt(f,g)),this._addCollisionDebugVertex(D,O,b,U,$,new vt(r,g)),S.vertexLength+=4;const H=y.indexArray;H.emplaceBack(M,M+1),H.emplaceBack(M+1,M+2),H.emplaceBack(M+2,M+3),H.emplaceBack(M+3,M),S.primitiveLength+=4}addDebugCollisionBoxes(r,u,f,g){for(let y=r;y<u;y++){const b=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,g?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Zg(eo,Wx.members,As),this.iconCollisionBox=new Zg(eo,Wx.members,As);for(let r=0;r<this.symbolInstances.length;r++){const u=this.symbolInstances.get(r);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(r,u,f,g,y,b,T,S,M){const D={};for(let O=u;O<f;O++){const U=r.get(O);D.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},D.textFeatureIndex=U.featureIndex;break}for(let O=g;O<y;O++){const U=r.get(O);D.verticalTextBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},D.verticalTextFeatureIndex=U.featureIndex;break}for(let O=b;O<T;O++){const U=r.get(O);D.iconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},D.iconFeatureIndex=U.featureIndex;break}for(let O=S;O<M;O++){const U=r.get(O);D.verticalIconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},D.verticalIconFeatureIndex=U.featureIndex;break}return D}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,u){const f=r.placedSymbolArray.get(u),g=f.vertexStartIndex+4*f.numGlyphs;for(let y=f.vertexStartIndex;y<g;y+=4)r.indexArray.emplaceBack(y,y+1,y+2),r.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(r),f=Math.cos(r),g=[],y=[],b=[];for(let T=0;T<this.symbolInstances.length;++T){b.push(T);const S=this.symbolInstances.get(T);g.push(0|Math.round(u*S.anchorX+f*S.anchorY)),y.push(S.featureIndex)}return b.sort((T,S)=>g[T]-g[S]||y[S]-y[T]),b}addToSortKeyRanges(r,u){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const f=this.symbolInstances.get(u);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((g,y,b)=>{g>=0&&b.indexOf(g)===y&&this.addIndicesForPlacedSymbol(this.text,g)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}st("SymbolBucket",yc,{omit:["layers","collisionBoxArray","features","compareText"]}),yc.MAX_GLYPHS=65535,yc.addDynamicAttributes=Wg;const JI=new mi({"symbol-placement":new dt(Me.layout_symbol["symbol-placement"]),"symbol-spacing":new dt(Me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new dt(Me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new bt(Me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new dt(Me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new dt(Me.layout_symbol["icon-allow-overlap"]),"icon-overlap":new dt(Me.layout_symbol["icon-overlap"]),"icon-ignore-placement":new dt(Me.layout_symbol["icon-ignore-placement"]),"icon-optional":new dt(Me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new dt(Me.layout_symbol["icon-rotation-alignment"]),"icon-size":new bt(Me.layout_symbol["icon-size"]),"icon-text-fit":new dt(Me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new dt(Me.layout_symbol["icon-text-fit-padding"]),"icon-image":new bt(Me.layout_symbol["icon-image"]),"icon-rotate":new bt(Me.layout_symbol["icon-rotate"]),"icon-padding":new bt(Me.layout_symbol["icon-padding"]),"icon-keep-upright":new dt(Me.layout_symbol["icon-keep-upright"]),"icon-offset":new bt(Me.layout_symbol["icon-offset"]),"icon-anchor":new bt(Me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new dt(Me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new dt(Me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new dt(Me.layout_symbol["text-rotation-alignment"]),"text-field":new bt(Me.layout_symbol["text-field"]),"text-font":new bt(Me.layout_symbol["text-font"]),"text-size":new bt(Me.layout_symbol["text-size"]),"text-max-width":new bt(Me.layout_symbol["text-max-width"]),"text-line-height":new dt(Me.layout_symbol["text-line-height"]),"text-letter-spacing":new bt(Me.layout_symbol["text-letter-spacing"]),"text-justify":new bt(Me.layout_symbol["text-justify"]),"text-radial-offset":new bt(Me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new dt(Me.layout_symbol["text-variable-anchor"]),"text-anchor":new bt(Me.layout_symbol["text-anchor"]),"text-max-angle":new dt(Me.layout_symbol["text-max-angle"]),"text-writing-mode":new dt(Me.layout_symbol["text-writing-mode"]),"text-rotate":new bt(Me.layout_symbol["text-rotate"]),"text-padding":new dt(Me.layout_symbol["text-padding"]),"text-keep-upright":new dt(Me.layout_symbol["text-keep-upright"]),"text-transform":new bt(Me.layout_symbol["text-transform"]),"text-offset":new bt(Me.layout_symbol["text-offset"]),"text-allow-overlap":new dt(Me.layout_symbol["text-allow-overlap"]),"text-overlap":new dt(Me.layout_symbol["text-overlap"]),"text-ignore-placement":new dt(Me.layout_symbol["text-ignore-placement"]),"text-optional":new dt(Me.layout_symbol["text-optional"])});var Xg={paint:new mi({"icon-opacity":new bt(Me.paint_symbol["icon-opacity"]),"icon-color":new bt(Me.paint_symbol["icon-color"]),"icon-halo-color":new bt(Me.paint_symbol["icon-halo-color"]),"icon-halo-width":new bt(Me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new bt(Me.paint_symbol["icon-halo-blur"]),"icon-translate":new dt(Me.paint_symbol["icon-translate"]),"icon-translate-anchor":new dt(Me.paint_symbol["icon-translate-anchor"]),"text-opacity":new bt(Me.paint_symbol["text-opacity"]),"text-color":new bt(Me.paint_symbol["text-color"],{runtimeType:Kn,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new bt(Me.paint_symbol["text-halo-color"]),"text-halo-width":new bt(Me.paint_symbol["text-halo-width"]),"text-halo-blur":new bt(Me.paint_symbol["text-halo-blur"]),"text-translate":new dt(Me.paint_symbol["text-translate"]),"text-translate-anchor":new dt(Me.paint_symbol["text-translate-anchor"])}),layout:JI};class y1{constructor(r){if(r.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=r.property.overrides?r.property.overrides.runtimeType:ss,this.defaultValue=r}evaluate(r){if(r.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(r.formattedSection))return u.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}st("FormatSectionOverride",y1,{omit:["defaultValue"]});class Df extends ls{constructor(r){super(r,Xg)}recalculate(r,u){if(super.recalculate(r,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const g=[];for(const y of f)g.indexOf(y)<0&&g.push(y);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,u,f,g){const y=this.layout.get(r).evaluate(u,{},f,g),b=this._unevaluatedLayout._values[r];return b.isDataDriven()||Ja(b.value)||!y?y:function(T,S){return S.replace(/{([^{}]+)}/g,(M,D)=>D in T?String(T[D]):"")}(u.properties,y)}createBucket(r){return new yc(r)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const r of Xg.paint.overridableProperties){if(!Df.hasPaintOverride(this.layout,r))continue;const u=this.paint.get(r),f=new y1(u),g=new ec(f,u.property.specification);let y=null;y=u.value.kind==="constant"||u.value.kind==="source"?new el("source",g):new zu("composite",g,u.value.zoomStops),this.paint._values[r]=new as(u.property,y,u.parameters)}}_handleOverridablePaintPropertyUpdate(r,u,f){return!(!this.layout||u.isDataDriven()||f.isDataDriven())&&Df.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,u){const f=r.get("text-field"),g=Xg.paint.properties[u];let y=!1;const b=T=>{for(const S of T)if(g.overrides&&g.overrides.hasOverride(S))return void(y=!0)};if(f.value.kind==="constant"&&f.value.value instanceof he)b(f.value.value.sections);else if(f.value.kind==="source"){const T=M=>{y||(M instanceof lt&&Pe(M.value)===$n?b(M.value.sections):M instanceof Jl?b(M.sections):M.eachChild(T))},S=f.value;S._styleExpression&&T(S._styleExpression.expression)}return y}}function Yg(a,r,u){let f="never";const g=a.get(r);return g?f=g:a.get(u)&&(f="always"),f}var QI={paint:new mi({"background-color":new dt(Me.paint_background["background-color"]),"background-pattern":new qu(Me.paint_background["background-pattern"]),"background-opacity":new dt(Me.paint_background["background-opacity"])})},eC={paint:new mi({"raster-opacity":new dt(Me.paint_raster["raster-opacity"]),"raster-hue-rotate":new dt(Me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new dt(Me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new dt(Me.paint_raster["raster-brightness-max"]),"raster-saturation":new dt(Me.paint_raster["raster-saturation"]),"raster-contrast":new dt(Me.paint_raster["raster-contrast"]),"raster-resampling":new dt(Me.paint_raster["raster-resampling"]),"raster-fade-duration":new dt(Me.paint_raster["raster-fade-duration"])})};class tC extends ls{constructor(r){super(r,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const nC={circle:class extends ls{constructor(a){super(a,RP)}createBucket(a){return new Eg(a)}queryRadius(a){const r=a;return Ju("circle-radius",this,r)+Ju("circle-stroke-width",this,r)+_f(this.paint.get("circle-translate"))}queryIntersectsFeature(a,r,u,f,g,y,b,T){const S=yf(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,b),M=this.paint.get("circle-radius").evaluate(r,u)+this.paint.get("circle-stroke-width").evaluate(r,u),D=this.paint.get("circle-pitch-alignment")==="map",O=D?S:function($,H){return $.map(ae=>Cx(ae,H))}(S,T),U=D?M*b:M;for(const $ of f)for(const H of $){const ae=D?H:Cx(H,T);let se=U;const ve=vf([],[H.x,H.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?se*=ve[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(se*=y.cameraToCenterDistance/ve[3]),IP(O,ae,se))return!0}return!1}},heatmap:class extends ls{constructor(a){super(a,zP),this._updateColorRamp()}createBucket(a){return new Mx(a)}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=kx({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends ls{constructor(a){super(a,OP)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends ls{constructor(a){super(a,JP)}recalculate(a,r){super.recalculate(a,r);const u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new zg(a)}queryRadius(){return _f(this.paint.get("fill-translate"))}queryIntersectsFeature(a,r,u,f,g,y,b){return bx(yf(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,b),f)}isTileClipped(){return!0}},"fill-extrusion":class extends ls{constructor(a){super(a,dI)}createBucket(a){return new Fg(a)}queryRadius(){return _f(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(a,r,u,f,g,y,b,T){const S=yf(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,b),M=this.paint.get("fill-extrusion-height").evaluate(r,u),D=this.paint.get("fill-extrusion-base").evaluate(r,u),O=function($,H,ae,se){const ve=[];for(const Te of $){const _e=[Te.x,Te.y,0,1];vf(_e,_e,H),ve.push(new vt(_e[0]/_e[3],_e[1]/_e[3]))}return ve}(S,T),U=function($,H,ae,se){const ve=[],Te=[],_e=se[8]*H,we=se[9]*H,De=se[10]*H,Re=se[11]*H,it=se[8]*ae,ct=se[9]*ae,Je=se[10]*ae,Ze=se[11]*ae;for(const $e of $){const Qe=[],Xe=[];for(const Ue of $e){const yt=Ue.x,pt=Ue.y,Dt=se[0]*yt+se[4]*pt+se[12],gn=se[1]*yt+se[5]*pt+se[13],wn=se[2]*yt+se[6]*pt+se[14],ti=se[3]*yt+se[7]*pt+se[15],Vr=wn+De,Ti=ti+Re,Wn=Dt+it,ui=gn+ct,Si=wn+Je,zi=ti+Ze,lr=new vt((Dt+_e)/Ti,(gn+we)/Ti);lr.z=Vr/Ti,Qe.push(lr);const qn=new vt(Wn/zi,ui/zi);qn.z=Si/zi,Xe.push(qn)}ve.push(Qe),Te.push(Xe)}return[ve,Te]}(f,D,M,T);return function($,H,ae){let se=1/0;bx(ae,H)&&(se=Vx(ae,H[0]));for(let ve=0;ve<H.length;ve++){const Te=H[ve],_e=$[ve];for(let we=0;we<Te.length-1;we++){const De=Te[we],Re=[De,Te[we+1],_e[we+1],_e[we],De];xx(ae,Re)&&(se=Math.min(se,Vx(ae,Re)))}}return se!==1/0&&se}(U[0],U[1],O)}},line:class extends ls{constructor(a){super(a,Gx),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){a==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof En,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,r){super.recalculate(a,r),this.paint._values["line-floorwidth"]=$x.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Bg(a)}queryRadius(a){const r=a,u=Hx(Ju("line-width",this,r),Ju("line-gap-width",this,r)),f=Ju("line-offset",this,r);return u/2+Math.abs(f)+_f(this.paint.get("line-translate"))}queryIntersectsFeature(a,r,u,f,g,y,b){const T=yf(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,b),S=b/2*Hx(this.paint.get("line-width").evaluate(r,u),this.paint.get("line-gap-width").evaluate(r,u)),M=this.paint.get("line-offset").evaluate(r,u);return M&&(f=function(D,O){const U=[];for(let $=0;$<D.length;$++){const H=D[$],ae=[];for(let se=0;se<H.length;se++){const ve=H[se-1],Te=H[se],_e=H[se+1],we=se===0?new vt(0,0):Te.sub(ve)._unit()._perp(),De=se===H.length-1?new vt(0,0):_e.sub(Te)._unit()._perp(),Re=we._add(De)._unit(),it=Re.x*De.x+Re.y*De.y;it!==0&&Re._mult(1/it),ae.push(Re._mult(O)._add(Te))}U.push(ae)}return U}(f,M*b)),function(D,O,U){for(let $=0;$<O.length;$++){const H=O[$];if(D.length>=3){for(let ae=0;ae<H.length;ae++)if(hc(D,H[ae]))return!0}if(CP(D,H,U))return!0}return!1}(T,f,S)}isTileClipped(){return!0}},symbol:Df,background:class extends ls{constructor(a){super(a,QI)}},raster:class extends ls{constructor(a){super(a,eC)}}};class iC{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const v1=63710088e-1;class Rn{constructor(r,u){if(isNaN(r)||isNaN(u))throw new Error(`Invalid LngLat object: (${r}, ${u})`);if(this.lng=+r,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Rn(N(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const u=Math.PI/180,f=this.lat*u,g=r.lat*u,y=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((r.lng-this.lng)*u);return v1*Math.acos(Math.min(y,1))}toBounds(r=0){const u=360*r/40075017,f=u/Math.cos(Math.PI/180*this.lat);return new yl(new Rn(this.lng-f,this.lat-u),new Rn(this.lng+f,this.lat+u))}static convert(r){if(r instanceof Rn)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Rn(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Rn(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class yl{constructor(r,u){r&&(u?this.setSouthWest(r).setNorthEast(u):r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof Rn?new Rn(r.lng,r.lat):Rn.convert(r),this}setSouthWest(r){return this._sw=r instanceof Rn?new Rn(r.lng,r.lat):Rn.convert(r),this}extend(r){const u=this._sw,f=this._ne;let g,y;if(r instanceof Rn)g=r,y=r;else{if(!(r instanceof yl))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(yl.convert(r)):this.extend(Rn.convert(r)):this;if(g=r._sw,y=r._ne,!g||!y)return this}return u||f?(u.lng=Math.min(g.lng,u.lng),u.lat=Math.min(g.lat,u.lat),f.lng=Math.max(y.lng,f.lng),f.lat=Math.max(y.lat,f.lat)):(this._sw=new Rn(g.lng,g.lat),this._ne=new Rn(y.lng,y.lat)),this}getCenter(){return new Rn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Rn(this.getWest(),this.getNorth())}getSouthEast(){return new Rn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:u,lat:f}=Rn.convert(r);let g=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&g}static convert(r){return r instanceof yl?r:r&&new yl(r)}}const x1=2*Math.PI*v1;function b1(a){return x1*Math.cos(a*Math.PI/180)}function w1(a){return(180+a)/360}function E1(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function T1(a,r){return a/b1(r)}function Kg(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}class zf{constructor(r,u,f=0){this.x=+r,this.y=+u,this.z=+f}static fromLngLat(r,u=0){const f=Rn.convert(r);return new zf(w1(f.lng),E1(f.lat),T1(u,f.lat))}toLngLat(){return new Rn(360*this.x-180,Kg(this.y))}toAltitude(){return this.z*b1(Kg(this.y))}meterInMercatorCoordinateUnits(){return 1/x1*(r=Kg(this.y),1/Math.cos(r*Math.PI/180));var r}}function S1(a,r,u){var f=2*Math.PI*6378137/256/Math.pow(2,u);return[a*f-2*Math.PI*6378137/2,r*f-2*Math.PI*6378137/2]}class Jg{constructor(r,u,f){if(r<0||r>25||f<0||f>=Math.pow(2,r)||u<0||u>=Math.pow(2,r))throw new Error(`x=${u}, y=${f}, z=${r} outside of bounds. 0<=x<${Math.pow(2,r)}, 0<=y<${Math.pow(2,r)} 0<=z<=25 `);this.z=r,this.x=u,this.y=f,this.key=ch(0,r,r,u,f)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,u,f){const g=(b=this.y,T=this.z,S=S1(256*(y=this.x),256*(b=Math.pow(2,T)-b-1),T),M=S1(256*(y+1),256*(b+1),T),S[0]+","+S[1]+","+M[0]+","+M[1]);var y,b,T,S,M;const D=function(O,U,$){let H,ae="";for(let se=O;se>0;se--)H=1<<se-1,ae+=(U&H?1:0)+($&H?2:0);return ae}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,D).replace(/{bbox-epsg-3857}/g,g)}isChildOf(r){const u=this.z-r.z;return u>0&&r.x===this.x>>u&&r.y===this.y>>u}getTilePoint(r){const u=Math.pow(2,this.z);return new vt((r.x*u-this.x)*ei,(r.y*u-this.y)*ei)}toString(){return`${this.z}/${this.x}/${this.y}`}}class A1{constructor(r,u){this.wrap=r,this.canonical=u,this.key=ch(r,u.z,u.z,u.x,u.y)}}class Ur{constructor(r,u,f,g,y){if(r<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${r}; z = ${f}`);this.overscaledZ=r,this.wrap=u,this.canonical=new Jg(f,+g,+y),this.key=ch(u,r,f,g,y)}clone(){return new Ur(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-r;return r>this.canonical.z?new Ur(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ur(r,this.wrap,r,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(r,u){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-r;return r>this.canonical.z?ch(this.wrap*+u,r,this.canonical.z,this.canonical.x,this.canonical.y):ch(this.wrap*+u,r,r,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(r){if(r.wrap!==this.wrap)return!1;const u=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>u&&r.canonical.y===this.canonical.y>>u}children(r){if(this.overscaledZ>=r)return[new Ur(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new Ur(u,this.wrap,u,f,g),new Ur(u,this.wrap,u,f+1,g),new Ur(u,this.wrap,u,f,g+1),new Ur(u,this.wrap,u,f+1,g+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Ur(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Ur(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new A1(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new zf(r.x-this.wrap,r.y))}}function ch(a,r,u,f,g){(a*=2)<0&&(a=-1*a-1);const y=1<<u;return(y*y*a+y*g+f).toString(36)+u.toString(36)+r.toString(36)}st("CanonicalTileID",Jg),st("OverscaledTileID",Ur,{omit:["posMatrix"]});class P1{constructor(r,u,f){if(this.uid=r,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(f&&f!=="mapbox"&&f!=="terrarium")return void ye(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=u.height;const g=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=f||"mapbox";for(let y=0;y<g;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(g,y)]=this.data[this._idx(g-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,g)]=this.data[this._idx(y,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let y=0;y<g;y++)for(let b=0;b<g;b++){const T=this.get(y,b);T>this.max&&(this.max=T),T<this.min&&(this.min=T)}}get(r,u){const f=new Uint8Array(this.data.buffer),g=4*this._idx(r,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(f[g],f[g+1],f[g+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(r,u){if(r<-1||r>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(r+1)}_unpackMapbox(r,u,f){return(256*r*256+256*u+f)/10-1e4}_unpackTerrarium(r,u,f){return 256*r+u+f/256-32768}getPixels(){return new Nr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,u,f){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let g=u*this.dim,y=u*this.dim+this.dim,b=f*this.dim,T=f*this.dim+this.dim;switch(u){case-1:g=y-1;break;case 1:y=g+1}switch(f){case-1:b=T-1;break;case 1:T=b+1}const S=-u*this.dim,M=-f*this.dim;for(let D=b;D<T;D++)for(let O=g;O<y;O++)this.data[this._idx(O,D)]=r.data[this._idx(O+S,D+M)]}}st("DEMData",P1);class I1{constructor(r){this._stringToNumber={},this._numberToString=[];for(let u=0;u<r.length;u++){const f=r[u];this._stringToNumber[f]=u,this._numberToString[u]=f}}encode(r){return this._stringToNumber[r]}decode(r){if(r>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${r} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[r]}}class C1{constructor(r,u,f,g,y){this.type="Feature",this._vectorTileFeature=r,r._z=u,r._x=f,r._y=g,this.properties=r.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(r[u]=this[u]);return r}}class M1{constructor(r,u){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new ul(ei,16,0),this.grid3D=new ul(ei,16,0),this.featureIndexArray=new Rt,this.promoteId=u}insert(r,u,f,g,y,b){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,y);const S=b?this.grid3D:this.grid;for(let M=0;M<u.length;M++){const D=u[M],O=[1/0,1/0,-1/0,-1/0];for(let U=0;U<D.length;U++){const $=D[U];O[0]=Math.min(O[0],$.x),O[1]=Math.min(O[1],$.y),O[2]=Math.max(O[2],$.x),O[3]=Math.max(O[3],$.y)}O[0]<ei&&O[1]<ei&&O[2]>=0&&O[3]>=0&&S.insert(T,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new fa.VectorTile(new Ng(this.rawTileData)).layers,this.sourceLayerCoder=new I1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,u,f,g){this.loadVTLayers();const y=r.params||{},b=ei/r.tileSize/r.scale,T=ic(y.filter),S=r.queryGeometry,M=r.queryPadding*b,D=k1(S),O=this.grid.query(D.minX-M,D.minY-M,D.maxX+M,D.maxY+M),U=k1(r.cameraQueryGeometry),$=this.grid3D.query(U.minX-M,U.minY-M,U.maxX+M,U.maxY+M,(se,ve,Te,_e)=>function(we,De,Re,it,ct){for(const Ze of we)if(De<=Ze.x&&Re<=Ze.y&&it>=Ze.x&&ct>=Ze.y)return!0;const Je=[new vt(De,Re),new vt(De,ct),new vt(it,ct),new vt(it,Re)];if(we.length>2){for(const Ze of Je)if(hc(we,Ze))return!0}for(let Ze=0;Ze<we.length-1;Ze++)if(LP(we[Ze],we[Ze+1],Je))return!0;return!1}(r.cameraQueryGeometry,se-M,ve-M,Te+M,_e+M));for(const se of $)O.push(se);O.sort(rC);const H={};let ae;for(let se=0;se<O.length;se++){const ve=O[se];if(ve===ae)continue;ae=ve;const Te=this.featureIndexArray.get(ve);let _e=null;this.loadMatchingFeature(H,Te.bucketIndex,Te.sourceLayerIndex,Te.featureIndex,T,y.layers,y.availableImages,u,f,g,(we,De,Re)=>(_e||(_e=ml(we)),De.queryIntersectsFeature(S,we,Re,_e,this.z,r.transform,b,r.pixelPosMatrix)))}return H}loadMatchingFeature(r,u,f,g,y,b,T,S,M,D,O){const U=this.bucketLayerIDs[u];if(b&&!function(se,ve){for(let Te=0;Te<se.length;Te++)if(ve.indexOf(se[Te])>=0)return!0;return!1}(b,U))return;const $=this.sourceLayerCoder.decode(f),H=this.vtLayers[$].feature(g);if(y.needGeometry){const se=gl(H,!0);if(!y.filter(new xn(this.tileID.overscaledZ),se,this.tileID.canonical))return}else if(!y.filter(new xn(this.tileID.overscaledZ),H))return;const ae=this.getId(H,$);for(let se=0;se<U.length;se++){const ve=U[se];if(b&&b.indexOf(ve)<0)continue;const Te=S[ve];if(!Te)continue;let _e={};ae&&D&&(_e=D.getState(Te.sourceLayer||"_geojsonTileLayer",ae));const we=X({},M[ve]);we.paint=L1(we.paint,Te.paint,H,_e,T),we.layout=L1(we.layout,Te.layout,H,_e,T);const De=!O||O(H,Te,_e);if(!De)continue;const Re=new C1(H,this.z,this.x,this.y,ae);Re.layer=we;let it=r[ve];it===void 0&&(it=r[ve]=[]),it.push({featureIndex:g,feature:Re,intersectionZ:De})}}lookupSymbolFeatures(r,u,f,g,y,b,T,S){const M={};this.loadVTLayers();const D=ic(y);for(const O of r)this.loadMatchingFeature(M,f,g,O,D,b,T,S,u);return M}hasLayer(r){for(const u of this.bucketLayerIDs)for(const f of u)if(r===f)return!0;return!1}getId(r,u){let f=r.id;return this.promoteId&&(f=r.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof f=="boolean"&&(f=Number(f))),f}}function L1(a,r,u,f,g){return Y(a,(y,b)=>{const T=r instanceof fl?r.get(b):null;return T&&T.evaluate?T.evaluate(u,f,g):T})}function k1(a){let r=1/0,u=1/0,f=-1/0,g=-1/0;for(const y of a)r=Math.min(r,y.x),u=Math.min(u,y.y),f=Math.max(f,y.x),g=Math.max(g,y.y);return{minX:r,minY:u,maxX:f,maxY:g}}function rC(a,r){return r-a}var Qg;st("FeatureIndex",M1,{omit:["rawTileData","sourceLayerCoder"]}),l.PerformanceMarkers=void 0,(Qg=l.PerformanceMarkers||(l.PerformanceMarkers={})).create="create",Qg.load="load",Qg.fullLoad="fullLoad";let Of=null,uh=[];const e_=1e3/30,sC={mark(a){performance.mark(a)},frame(a){const r=a;Of!=null&&uh.push(r-Of),Of=r},clearMetrics(){Of=null,uh=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const a in l.PerformanceMarkers)performance.clearMarks(l.PerformanceMarkers[a])},getPerformanceMetrics(){performance.measure("loadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.load),performance.measure("fullLoadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.fullLoad);const a=performance.getEntriesByName("loadTime")[0].duration,r=performance.getEntriesByName("fullLoadTime")[0].duration,u=uh.length,f=1/(uh.reduce((y,b)=>y+b,0)/u/1e3),g=uh.filter(y=>y>e_).reduce((y,b)=>y+(b-e_)/e_,0);return{loadTime:a,fullLoadTime:r,fps:f,percentDroppedFrames:g/(u+g)*100}}};l.AJAXError=Yn,l.ARRAY_TYPE=Zi,l.Actor=class{constructor(a,r,u){this.target=a,this.parent=r,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},me(["receive","process"],this),this.invoker=new iC(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Fe()?a:window}send(a,r,u,f,g=!1){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[y]=u);const b=Yt(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:a,hasCallback:!!u,targetMapId:f,mustQueue:g,sourceMapId:this.mapId,data:wo(r,b)},b),{cancel:()=>{u&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(a){const r=a.data,u=r.id;if(u&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){delete this.tasks[u];const f=this.cancelCallbacks[u];delete this.cancelCallbacks[u],f&&f()}else Fe()||r.mustQueue?(this.tasks[u]=r,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,r)}process(){if(!this.taskQueue.length)return;const a=this.taskQueue.shift(),r=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),r&&this.processTask(a,r)}processTask(a,r){if(r.type==="<response>"){const u=this.callbacks[a];delete this.callbacks[a],u&&(r.error?u(Xs(r.error)):u(null,Xs(r.data)))}else{let u=!1;const f=Yt(this.globalScope)?void 0:[],g=r.hasCallback?(T,S)=>{u=!0,delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:T?wo(T):null,data:wo(S,f)},f)}:T=>{u=!0};let y=null;const b=Xs(r.data);if(this.parent[r.type])y=this.parent[r.type](r.sourceMapId,b,g);else if(this.parent.getWorkerSource){const T=r.type.split(".");y=this.parent.getWorkerSource(r.sourceMapId,T[0],b.source)[T[1]](b,g)}else g(new Error(`Could not find function ${r.type}`));!u&&y&&y.cancel&&(this.cancelCallbacks[a]=y.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.AlphaImage=eh,l.CanonicalTileID=Jg,l.CollisionBoxArray=Le,l.CollisionCircleLayoutArray=class extends z{},l.Color=K,l.DEMData=P1,l.DataConstantProperty=dt,l.DictionaryCoder=I1,l.EXTENT=ei,l.ErrorEvent=Gs,l.EvaluationParameters=xn,l.Event=Rr,l.Evented=vr,l.FeatureIndex=M1,l.FillBucket=zg,l.FillExtrusionBucket=Fg,l.GeoJSONFeature=C1,l.ImageAtlas=e1,l.ImagePosition=Vg,l.LineBucket=Bg,l.LineStripIndexArray=class extends re{},l.LngLat=Rn,l.LngLatBounds=yl,l.MercatorCoordinate=zf,l.ONE_EM=gi,l.OverscaledTileID=Ur,l.PerformanceUtils=sC,l.PosArray=_t,l.Properties=mi,l.QuadTriangleArray=class extends j{},l.RGBAImage=Nr,l.RasterBoundsArray=class extends m{},l.RequestPerformance=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},l.ResourceType=Li,l.SegmentVector=Ft,l.SymbolBucket=yc,l.Transitionable=hf,l.TriangleIndexArray=Wi,l.Uniform1f=Ao,l.Uniform1i=class extends So{constructor(a,r){super(a,r),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},l.Uniform2f=class extends So{constructor(a,r){super(a,r),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},l.Uniform3f=class extends So{constructor(a,r){super(a,r),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},l.Uniform4f=cc,l.UniformColor=gx,l.UniformMatrix4f=class extends So{constructor(a,r){super(a,r),this.current=AP}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let r=1;r<16;r++)if(a[r]!==this.current[r]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},l.UnwrappedTileID=A1,l.ValidationError=We,l.ZoomHistory=Nu,l.add=function(a,r,u){return a[0]=r[0]+u[0],a[1]=r[1]+u[1],a[2]=r[2]+u[2],a},l.addDynamicAttributes=Wg,l.asyncAll=function(a,r,u){if(!a.length)return u(null,[]);let f=a.length;const g=new Array(a.length);let y=null;a.forEach((b,T)=>{r(b,(S,M)=>{S&&(y=S),g[T]=M,--f==0&&u(y,g)})})},l.bezier=C,l.bindAll=me,l.cacheEntryPossiblyAdded=function(a){bi++,bi>nr&&(a.getActor().send("enforceCacheSizeLimit",rn),bi=0)},l.clamp=P,l.clearTileCache=function(a){const r=caches.delete(wt);a&&r.catch(a).then(()=>a())},l.clipLine=d1,l.clone=function(a){var r=new Zi(16);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=a[3],r[4]=a[4],r[5]=a[5],r[6]=a[6],r[7]=a[7],r[8]=a[8],r[9]=a[9],r[10]=a[10],r[11]=a[11],r[12]=a[12],r[13]=a[13],r[14]=a[14],r[15]=a[15],r},l.clone$1=q,l.clone$2=function(a){var r=new Zi(3);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r},l.collisionCircleLayout=EI,l.config=tt,l.copy=function(a,r){return a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a},l.create=function(){var a=new Zi(16);return Zi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},l.create$1=Tx,l.createExpression=Qa,l.createFilter=ic,l.createLayout=Hn,l.createStyleLayer=function(a){return a.type==="custom"?new tC(a):new nC[a.type](a)},l.cross=function(a,r,u){var f=r[0],g=r[1],y=r[2],b=u[0],T=u[1],S=u[2];return a[0]=g*S-y*T,a[1]=y*b-f*S,a[2]=f*T-g*b,a},l.dot=function(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]},l.dot$1=function(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]+a[3]*r[3]},l.ease=L,l.emitValidationErrors=sc,l.enforceCacheSizeLimit=function(a){ri(),St&&St.then(r=>{r.keys().then(u=>{for(let f=0;f<u.length-a;f++)r.delete(u[f])})})},l.equals=function(a,r){var u=a[0],f=a[1],g=a[2],y=a[3],b=a[4],T=a[5],S=a[6],M=a[7],D=a[8],O=a[9],U=a[10],$=a[11],H=a[12],ae=a[13],se=a[14],ve=a[15],Te=r[0],_e=r[1],we=r[2],De=r[3],Re=r[4],it=r[5],ct=r[6],Je=r[7],Ze=r[8],$e=r[9],Qe=r[10],Xe=r[11],Ue=r[12],yt=r[13],pt=r[14],Dt=r[15];return Math.abs(u-Te)<=qi*Math.max(1,Math.abs(u),Math.abs(Te))&&Math.abs(f-_e)<=qi*Math.max(1,Math.abs(f),Math.abs(_e))&&Math.abs(g-we)<=qi*Math.max(1,Math.abs(g),Math.abs(we))&&Math.abs(y-De)<=qi*Math.max(1,Math.abs(y),Math.abs(De))&&Math.abs(b-Re)<=qi*Math.max(1,Math.abs(b),Math.abs(Re))&&Math.abs(T-it)<=qi*Math.max(1,Math.abs(T),Math.abs(it))&&Math.abs(S-ct)<=qi*Math.max(1,Math.abs(S),Math.abs(ct))&&Math.abs(M-Je)<=qi*Math.max(1,Math.abs(M),Math.abs(Je))&&Math.abs(D-Ze)<=qi*Math.max(1,Math.abs(D),Math.abs(Ze))&&Math.abs(O-$e)<=qi*Math.max(1,Math.abs(O),Math.abs($e))&&Math.abs(U-Qe)<=qi*Math.max(1,Math.abs(U),Math.abs(Qe))&&Math.abs($-Xe)<=qi*Math.max(1,Math.abs($),Math.abs(Xe))&&Math.abs(H-Ue)<=qi*Math.max(1,Math.abs(H),Math.abs(Ue))&&Math.abs(ae-yt)<=qi*Math.max(1,Math.abs(ae),Math.abs(yt))&&Math.abs(se-pt)<=qi*Math.max(1,Math.abs(se),Math.abs(pt))&&Math.abs(ve-Dt)<=qi*Math.max(1,Math.abs(ve),Math.abs(Dt))},l.evaluateSizeForFeature=function(a,{uSize:r,uSizeT:u},{lowerSize:f,upperSize:g}){return a.kind==="source"?f/Co:a.kind==="composite"?kt(f/Co,g/Co,u):r},l.evaluateSizeForZoom=function(a,r){let u=0,f=0;if(a.kind==="constant")f=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:g,minZoom:y,maxZoom:b}=a,T=g?P(sr.interpolationFactor(g,r,y,b),0,1):0;a.kind==="camera"?f=kt(a.minSize,a.maxSize,T):u=T}return{uSizeT:u,uSize:f}},l.evaluateVariableOffset=m1,l.evented=Wu,l.exported=zn,l.exported$1=si,l.extend=X,l.filterObject=W,l.fromRotation=function(a,r){var u=Math.sin(r),f=Math.cos(r);return a[0]=f,a[1]=u,a[2]=0,a[3]=-u,a[4]=f,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},l.fromScaling=function(a,r){return a[0]=r[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=r[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=r[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},l.getAnchorAlignment=Gg,l.getAnchorJustification=Hg,l.getArrayBuffer=Gi,l.getImage=is,l.getJSON=function(a,r){return fi(X(a,{type:"json"}),r)},l.getOverlapMode=Yg,l.getRTLTextPluginStatus=hl,l.getReferrer=Lr,l.getVideo=function(a,r){const u=window.document.createElement("video");u.muted=!0,u.onloadstart=function(){r(null,u)};for(let f=0;f<a.length;f++){const g=window.document.createElement("source");js(a[f])||(u.crossOrigin="Anonymous"),g.src=a[f],u.appendChild(g)}return{cancel:()=>{}}},l.identity=Ag,l.invert=function(a,r){var u=r[0],f=r[1],g=r[2],y=r[3],b=r[4],T=r[5],S=r[6],M=r[7],D=r[8],O=r[9],U=r[10],$=r[11],H=r[12],ae=r[13],se=r[14],ve=r[15],Te=u*T-f*b,_e=u*S-g*b,we=u*M-y*b,De=f*S-g*T,Re=f*M-y*T,it=g*M-y*S,ct=D*ae-O*H,Je=D*se-U*H,Ze=D*ve-$*H,$e=O*se-U*ae,Qe=O*ve-$*ae,Xe=U*ve-$*se,Ue=Te*Xe-_e*Qe+we*$e+De*Ze-Re*Je+it*ct;return Ue?(a[0]=(T*Xe-S*Qe+M*$e)*(Ue=1/Ue),a[1]=(g*Qe-f*Xe-y*$e)*Ue,a[2]=(ae*it-se*Re+ve*De)*Ue,a[3]=(U*Re-O*it-$*De)*Ue,a[4]=(S*Ze-b*Xe-M*Je)*Ue,a[5]=(u*Xe-g*Ze+y*Je)*Ue,a[6]=(se*we-H*it-ve*_e)*Ue,a[7]=(D*it-U*we+$*_e)*Ue,a[8]=(b*Qe-T*Ze+M*ct)*Ue,a[9]=(f*Ze-u*Qe-y*ct)*Ue,a[10]=(H*Re-ae*we+ve*Te)*Ue,a[11]=(O*we-D*Re-$*Te)*Ue,a[12]=(T*Je-b*$e-S*ct)*Ue,a[13]=(u*$e-f*Je+g*ct)*Ue,a[14]=(ae*_e-H*De-se*Te)*Ue,a[15]=(D*De-O*_e+U*Te)*Ue,a):null},l.isImageBitmap=Mt,l.isSafari=Yt,l.isWorker=Fe,l.keysDifference=function(a,r){const u=[];for(const f in a)f in r||u.push(f);return u},l.lazyLoadRTLTextPlugin=function(){wr.isLoading()||wr.isLoaded()||hl()!=="deferred"||uf()},l.makeRequest=fi,l.mapObject=Y,l.mercatorXfromLng=w1,l.mercatorYfromLat=E1,l.mercatorZfromAltitude=T1,l.mul=DP,l.mul$1=function(a,r,u){return a[0]=r[0]*u[0],a[1]=r[1]*u[1],a[2]=r[2]*u[2],a[3]=r[3]*u[3],a},l.multiply=Sx,l.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},l.normalize=function(a,r){var u=r[0],f=r[1],g=r[2],y=u*u+f*f+g*g;return y>0&&(y=1/Math.sqrt(y)),a[0]=r[0]*y,a[1]=r[1]*y,a[2]=r[2]*y,a},l.number=kt,l.ortho=function(a,r,u,f,g,y,b){var T=1/(r-u),S=1/(f-g),M=1/(y-b);return a[0]=-2*T,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*S,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*M,a[11]=0,a[12]=(r+u)*T,a[13]=(g+f)*S,a[14]=(b+y)*M,a[15]=1,a},l.parseCacheControl=Ve,l.parseGlyphPbf=function(a){return new Ng(a).readFields(DI,[])},l.pbf=Ng,l.performSymbolLayout=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=ei/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const r=a.bucket.layers[0].layout,u=a.bucket.layers[0]._unevaluatedLayout._values,f={layoutIconSize:u["icon-size"].possiblyEvaluate(new xn(a.bucket.zoom+1),a.canonical),layoutTextSize:u["text-size"].possiblyEvaluate(new xn(a.bucket.zoom+1),a.canonical),textMaxSize:u["text-size"].possiblyEvaluate(new xn(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:S,maxZoom:M}=a.bucket.textSizeData;f.compositeTextSizes=[u["text-size"].possiblyEvaluate(new xn(S),a.canonical),u["text-size"].possiblyEvaluate(new xn(M),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:S,maxZoom:M}=a.bucket.iconSizeData;f.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new xn(S),a.canonical),u["icon-size"].possiblyEvaluate(new xn(M),a.canonical)]}const g=r.get("text-line-height")*gi,y=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",b=r.get("text-keep-upright"),T=r.get("text-size");for(const S of a.bucket.features){const M=r.get("text-font").evaluate(S,{},a.canonical).join(","),D=T.evaluate(S,{},a.canonical),O=f.layoutTextSize.evaluate(S,{},a.canonical),U=f.layoutIconSize.evaluate(S,{},a.canonical),$={horizontal:{},vertical:void 0},H=S.text;let ae,se=[0,0];if(H){const _e=H.toString(),we=r.get("text-letter-spacing").evaluate(S,{},a.canonical)*gi,De=yg(_e)?we:0,Re=r.get("text-anchor").evaluate(S,{},a.canonical),it=r.get("text-variable-anchor");if(!it){const Qe=r.get("text-radial-offset").evaluate(S,{},a.canonical);se=Qe?m1(Re,[Qe*gi,$g]):r.get("text-offset").evaluate(S,{},a.canonical).map(Xe=>Xe*gi)}let ct=y?"center":r.get("text-justify").evaluate(S,{},a.canonical);const Je=r.get("symbol-placement"),Ze=Je==="point"?r.get("text-max-width").evaluate(S,{},a.canonical)*gi:0,$e=()=>{a.bucket.allowVerticalPlacement&&oc(_e)&&($.vertical=Pf(H,a.glyphMap,a.glyphPositions,a.imagePositions,M,Ze,g,Re,"left",De,se,l.WritingMode.vertical,!0,Je,O,D))};if(!y&&it){const Qe=ct==="auto"?it.map(Ue=>Hg(Ue)):[ct];let Xe=!1;for(let Ue=0;Ue<Qe.length;Ue++){const yt=Qe[Ue];if(!$.horizontal[yt])if(Xe)$.horizontal[yt]=$.horizontal[0];else{const pt=Pf(H,a.glyphMap,a.glyphPositions,a.imagePositions,M,Ze,g,"center",yt,De,se,l.WritingMode.horizontal,!1,Je,O,D);pt&&($.horizontal[yt]=pt,Xe=pt.positionedLines.length===1)}}$e()}else{ct==="auto"&&(ct=Hg(Re));const Qe=Pf(H,a.glyphMap,a.glyphPositions,a.imagePositions,M,Ze,g,Re,ct,De,se,l.WritingMode.horizontal,!1,Je,O,D);Qe&&($.horizontal[ct]=Qe),$e(),oc(_e)&&y&&b&&($.vertical=Pf(H,a.glyphMap,a.glyphPositions,a.imagePositions,M,Ze,g,Re,ct,De,se,l.WritingMode.vertical,!1,Je,O,D))}}let ve=!1;if(S.icon&&S.icon.name){const _e=a.imageMap[S.icon.name];_e&&(ae=UI(a.imagePositions[S.icon.name],r.get("icon-offset").evaluate(S,{},a.canonical),r.get("icon-anchor").evaluate(S,{},a.canonical)),ve=!!_e.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=ve:a.bucket.sdfIcons!==ve&&ye("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_e.pixelRatio!==a.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const Te=_1($.horizontal)||$.vertical;a.bucket.iconsInText=!!Te&&Te.iconsInText,(Te||ae)&&qI(a.bucket,S,$,ae,a.imageMap,f,O,U,se,ve,a.canonical)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},l.perspective=function(a,r,u,f,g){var y,b=1/Math.tan(r/2);return a[0]=b/u,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,g!=null&&g!==1/0?(a[10]=(g+f)*(y=1/(f-g)),a[14]=2*g*f*y):(a[10]=-1,a[14]=-2*f),a},l.pick=function(a,r){const u={};for(let f=0;f<r.length;f++){const g=r[f];g in a&&(u[g]=a[g])}return u},l.plugin=wr,l.pointGeometry=vt,l.polygonIntersectsPolygon=xx,l.potpack=Qx,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.register=st,l.registerForPluginStateChange=function(a){return a({pluginStatus:Hi,pluginURL:Ys}),Wu.on("pluginStateChange",a),a},l.renderColorRamp=kx,l.rotateX=function(a,r,u){var f=Math.sin(u),g=Math.cos(u),y=r[4],b=r[5],T=r[6],S=r[7],M=r[8],D=r[9],O=r[10],U=r[11];return r!==a&&(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[4]=y*g+M*f,a[5]=b*g+D*f,a[6]=T*g+O*f,a[7]=S*g+U*f,a[8]=M*g-y*f,a[9]=D*g-b*f,a[10]=O*g-T*f,a[11]=U*g-S*f,a},l.rotateZ=function(a,r,u){var f=Math.sin(u),g=Math.cos(u),y=r[0],b=r[1],T=r[2],S=r[3],M=r[4],D=r[5],O=r[6],U=r[7];return r!==a&&(a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[0]=y*g+M*f,a[1]=b*g+D*f,a[2]=T*g+O*f,a[3]=S*g+U*f,a[4]=M*g-y*f,a[5]=D*g-b*f,a[6]=O*g-T*f,a[7]=U*g-S*f,a},l.scale=function(a,r,u){var f=u[0],g=u[1],y=u[2];return a[0]=r[0]*f,a[1]=r[1]*f,a[2]=r[2]*f,a[3]=r[3]*f,a[4]=r[4]*g,a[5]=r[5]*g,a[6]=r[6]*g,a[7]=r[7]*g,a[8]=r[8]*y,a[9]=r[9]*y,a[10]=r[10]*y,a[11]=r[11]*y,a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a},l.scale$1=function(a,r,u){return a[0]=r[0]*u,a[1]=r[1]*u,a[2]=r[2]*u,a},l.setCacheLimits=function(a,r){rn=a,nr=r},l.setRTLTextPlugin=function(a,r,u=!1){if(Hi===ju||Hi===Gu||Hi===$u)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ys=zn.resolveURL(a),Hi=ju,Hu=r,ca(),u||uf()},l.spec=Me,l.sphericalToCartesian=function([a,r,u]){return r+=90,r*=Math.PI/180,u*=Math.PI/180,{x:a*Math.cos(r)*Math.sin(u),y:a*Math.sin(r)*Math.sin(u),z:a*Math.cos(u)}},l.sqrLen=function(a){var r=a[0],u=a[1];return r*r+u*u},l.sub=function(a,r,u){return a[0]=r[0]-u[0],a[1]=r[1]-u[1],a[2]=r[2]-u[2],a},l.toEvaluationFeature=gl,l.transformMat3=function(a,r,u){var f=r[0],g=r[1],y=r[2];return a[0]=f*u[0]+g*u[3]+y*u[6],a[1]=f*u[1]+g*u[4]+y*u[7],a[2]=f*u[2]+g*u[5]+y*u[8],a},l.transformMat4=vf,l.transformMat4$1=function(a,r,u){var f=r[0],g=r[1];return a[0]=u[0]*f+u[4]*g+u[12],a[1]=u[1]*f+u[5]*g+u[13],a},l.translate=function(a,r,u){var f,g,y,b,T,S,M,D,O,U,$,H,ae=u[0],se=u[1],ve=u[2];return r===a?(a[12]=r[0]*ae+r[4]*se+r[8]*ve+r[12],a[13]=r[1]*ae+r[5]*se+r[9]*ve+r[13],a[14]=r[2]*ae+r[6]*se+r[10]*ve+r[14],a[15]=r[3]*ae+r[7]*se+r[11]*ve+r[15]):(g=r[1],y=r[2],b=r[3],T=r[4],S=r[5],M=r[6],D=r[7],O=r[8],U=r[9],$=r[10],H=r[11],a[0]=f=r[0],a[1]=g,a[2]=y,a[3]=b,a[4]=T,a[5]=S,a[6]=M,a[7]=D,a[8]=O,a[9]=U,a[10]=$,a[11]=H,a[12]=f*ae+T*se+O*ve+r[12],a[13]=g*ae+S*se+U*ve+r[13],a[14]=y*ae+M*se+$*ve+r[14],a[15]=b*ae+D*se+H*ve+r[15]),a},l.triggerPluginCompletionEvent=cf,l.unicodeBlockLookup=Ke,l.uniqueId=function(){return ee++},l.validateCustomStyleLayer=function(a){const r=[],u=a.id;return u===void 0&&r.push({message:`layers.${u}: missing required property "id"`}),a.render===void 0&&r.push({message:`layers.${u}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&r.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),r},l.validateLight=Bu,l.validateStyle=cl,l.vectorTile=fa,l.warnOnce=ye,l.wrap=N}),c(["./shared"],function(l){function v(Q){const R=typeof Q;if(R==="number"||R==="boolean"||R==="string"||Q==null)return JSON.stringify(Q);if(Array.isArray(Q)){let K="[";for(const ce of Q)K+=`${v(ce)},`;return`${K}]`}const F=Object.keys(Q).sort();let Z="{";for(let K=0;K<F.length;K++)Z+=`${JSON.stringify(F[K])}:${v(Q[F[K]])},`;return`${Z}}`}function w(Q){let R="";for(const F of l.refProperties)R+=`/${v(Q[F])}`;return R}class C{constructor(R){this.keyCache={},R&&this.replace(R)}replace(R){this._layerConfigs={},this._layers={},this.update(R,[])}update(R,F){for(const K of R){this._layerConfigs[K.id]=K;const ce=this._layers[K.id]=l.createStyleLayer(K);ce._featureFilter=l.createFilter(ce.filter),this.keyCache[K.id]&&delete this.keyCache[K.id]}for(const K of F)delete this.keyCache[K],delete this._layerConfigs[K],delete this._layers[K];this.familiesBySource={};const Z=function(K,ce){const fe={};for(let le=0;le<K.length;le++){const pe=ce&&ce[K[le].id]||w(K[le]);ce&&(ce[K[le].id]=pe);let Ie=fe[pe];Ie||(Ie=fe[pe]=[]),Ie.push(K[le])}const he=[];for(const le in fe)he.push(fe[le]);return he}(Object.values(this._layerConfigs),this.keyCache);for(const K of Z){const ce=K.map(ze=>this._layers[ze.id]),fe=ce[0];if(fe.visibility==="none")continue;const he=fe.source||"";let le=this.familiesBySource[he];le||(le=this.familiesBySource[he]={});const pe=fe.sourceLayer||"_geojsonTileLayer";let Ie=le[pe];Ie||(Ie=le[pe]=[]),Ie.push(ce)}}}class L{constructor(R){const F={},Z=[];for(const he in R){const le=R[he],pe=F[he]={};for(const Ie in le){const ze=le[+Ie];if(!ze||ze.bitmap.width===0||ze.bitmap.height===0)continue;const Pe={x:0,y:0,w:ze.bitmap.width+2,h:ze.bitmap.height+2};Z.push(Pe),pe[Ie]={rect:Pe,metrics:ze.metrics}}}const{w:K,h:ce}=l.potpack(Z),fe=new l.AlphaImage({width:K||1,height:ce||1});for(const he in R){const le=R[he];for(const pe in le){const Ie=le[+pe];if(!Ie||Ie.bitmap.width===0||Ie.bitmap.height===0)continue;const ze=F[he][pe].rect;l.AlphaImage.copy(Ie.bitmap,fe,{x:0,y:0},{x:ze.x+1,y:ze.y+1},Ie.bitmap)}}this.image=fe,this.positions=F}}l.register("GlyphAtlas",L);class P{constructor(R){this.tileID=new l.OverscaledTileID(R.tileID.overscaledZ,R.tileID.wrap,R.tileID.canonical.z,R.tileID.canonical.x,R.tileID.canonical.y),this.uid=R.uid,this.zoom=R.zoom,this.pixelRatio=R.pixelRatio,this.tileSize=R.tileSize,this.source=R.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=R.showCollisionBoxes,this.collectResourceTiming=!!R.collectResourceTiming,this.returnDependencies=!!R.returnDependencies,this.promoteId=R.promoteId}parse(R,F,Z,K,ce){this.status="parsing",this.data=R,this.collisionBoxArray=new l.CollisionBoxArray;const fe=new l.DictionaryCoder(Object.keys(R.layers).sort()),he=new l.FeatureIndex(this.tileID,this.promoteId);he.bucketLayerIDs=[];const le={},pe={featureIndex:he,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Z},Ie=F.familiesBySource[this.source];for(const xt in Ie){const Tt=R.layers[xt];if(!Tt)continue;Tt.version===1&&l.warnOnce(`Vector tile source "${this.source}" layer "${xt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const zt=fe.encode(xt),Nt=[];for(let hn=0;hn<Tt.length;hn++){const dn=Tt.feature(hn),Jn=he.getId(dn,xt);Nt.push({feature:dn,id:Jn,index:hn,sourceLayerIndex:zt})}for(const hn of Ie[xt]){const dn=hn[0];dn.source!==this.source&&l.warnOnce(`layer.source = ${dn.source} does not equal this.source = ${this.source}`),dn.minzoom&&this.zoom<Math.floor(dn.minzoom)||dn.maxzoom&&this.zoom>=dn.maxzoom||dn.visibility!=="none"&&(N(hn,this.zoom,Z),(le[dn.id]=dn.createBucket({index:he.bucketLayerIDs.length,layers:hn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:zt,sourceID:this.source})).populate(Nt,pe,this.tileID.canonical),he.bucketLayerIDs.push(hn.map(Jn=>Jn.id)))}}let ze,Pe,rt,lt;const Ye=l.mapObject(pe.glyphDependencies,xt=>Object.keys(xt).map(Number));Object.keys(Ye).length?K.send("getGlyphs",{uid:this.uid,stacks:Ye},(xt,Tt)=>{ze||(ze=xt,Pe=Tt,Lt.call(this))}):Pe={};const gt=Object.keys(pe.iconDependencies);gt.length?K.send("getImages",{icons:gt,source:this.source,tileID:this.tileID,type:"icons"},(xt,Tt)=>{ze||(ze=xt,rt=Tt,Lt.call(this))}):rt={};const ft=Object.keys(pe.patternDependencies);function Lt(){if(ze)return ce(ze);if(Pe&&rt&&lt){const xt=new L(Pe),Tt=new l.ImageAtlas(rt,lt);for(const zt in le){const Nt=le[zt];Nt instanceof l.SymbolBucket?(N(Nt.layers,this.zoom,Z),l.performSymbolLayout({bucket:Nt,glyphMap:Pe,glyphPositions:xt.positions,imageMap:rt,imagePositions:Tt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Nt.hasPattern&&(Nt instanceof l.LineBucket||Nt instanceof l.FillBucket||Nt instanceof l.FillExtrusionBucket)&&(N(Nt.layers,this.zoom,Z),Nt.addFeatures(pe,this.tileID.canonical,Tt.patternPositions))}this.status="done",ce(null,{buckets:Object.values(le).filter(zt=>!zt.isEmpty()),featureIndex:he,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xt.image,imageAtlas:Tt,glyphMap:this.returnDependencies?Pe:null,iconMap:this.returnDependencies?rt:null,glyphPositions:this.returnDependencies?xt.positions:null})}}ft.length?K.send("getImages",{icons:ft,source:this.source,tileID:this.tileID,type:"patterns"},(xt,Tt)=>{ze||(ze=xt,lt=Tt,Lt.call(this))}):lt={},Lt.call(this)}}function N(Q,R,F){const Z=new l.EvaluationParameters(R);for(const K of Q)K.recalculate(Z,F)}function X(Q,R){const F=l.getArrayBuffer(Q.request,(Z,K,ce,fe)=>{Z?R(Z):K&&R(null,{vectorTile:new l.vectorTile.VectorTile(new l.pbf(K)),rawData:K,cacheControl:ce,expires:fe})});return()=>{F.cancel(),R()}}class ee{constructor(R,F,Z,K){this.actor=R,this.layerIndex=F,this.availableImages=Z,this.loadVectorData=K||X,this.loading={},this.loaded={}}loadTile(R,F){const Z=R.uid;this.loading||(this.loading={});const K=!!(R&&R.request&&R.request.collectResourceTiming)&&new l.RequestPerformance(R.request),ce=this.loading[Z]=new P(R);ce.abort=this.loadVectorData(R,(fe,he)=>{if(delete this.loading[Z],fe||!he)return ce.status="done",this.loaded[Z]=ce,F(fe);const le=he.rawData,pe={};he.expires&&(pe.expires=he.expires),he.cacheControl&&(pe.cacheControl=he.cacheControl);const Ie={};if(K){const ze=K.finish();ze&&(Ie.resourceTiming=JSON.parse(JSON.stringify(ze)))}ce.vectorTile=he.vectorTile,ce.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor,(ze,Pe)=>{if(ze||!Pe)return F(ze);F(null,l.extend({rawTileData:le.slice(0)},Pe,pe,Ie))}),this.loaded=this.loaded||{},this.loaded[Z]=ce})}reloadTile(R,F){const Z=this.loaded,K=R.uid,ce=this;if(Z&&Z[K]){const fe=Z[K];fe.showCollisionBoxes=R.showCollisionBoxes;const he=(le,pe)=>{const Ie=fe.reloadCallback;Ie&&(delete fe.reloadCallback,fe.parse(fe.vectorTile,ce.layerIndex,this.availableImages,ce.actor,Ie)),F(le,pe)};fe.status==="parsing"?fe.reloadCallback=he:fe.status==="done"&&(fe.vectorTile?fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,he):he())}}abortTile(R,F){const Z=this.loading,K=R.uid;Z&&Z[K]&&Z[K].abort&&(Z[K].abort(),delete Z[K]),F()}removeTile(R,F){const Z=this.loaded,K=R.uid;Z&&Z[K]&&delete Z[K],F()}}class me{constructor(){this.loaded={}}loadTile(R,F){const{uid:Z,encoding:K,rawImageData:ce}=R,fe=l.isImageBitmap(ce)?this.getImageData(ce):ce,he=new l.DEMData(Z,fe,K);this.loaded=this.loaded||{},this.loaded[Z]=he,F(null,he)}getImageData(R){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(R.width,R.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=R.width,this.offscreenCanvas.height=R.height,this.offscreenCanvasContext.drawImage(R,0,0,R.width,R.height);const F=this.offscreenCanvasContext.getImageData(-1,-1,R.width+2,R.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:F.width,height:F.height},F.data)}removeTile(R){const F=this.loaded,Z=R.uid;F&&F[Z]&&delete F[Z]}}var Y=function Q(R,F){var Z,K=R&&R.type;if(K==="FeatureCollection")for(Z=0;Z<R.features.length;Z++)Q(R.features[Z],F);else if(K==="GeometryCollection")for(Z=0;Z<R.geometries.length;Z++)Q(R.geometries[Z],F);else if(K==="Feature")Q(R.geometry,F);else if(K==="Polygon")W(R.coordinates,F);else if(K==="MultiPolygon")for(Z=0;Z<R.coordinates.length;Z++)W(R.coordinates[Z],F);return R};function W(Q,R){if(Q.length!==0){q(Q[0],R);for(var F=1;F<Q.length;F++)q(Q[F],!R)}}function q(Q,R){for(var F=0,Z=0,K=0,ce=Q.length,fe=ce-1;K<ce;fe=K++){var he=(Q[K][0]-Q[fe][0])*(Q[fe][1]+Q[K][1]),le=F+he;Z+=Math.abs(F)>=Math.abs(he)?F-le+he:he-le+F,F=le}F+Z>=0!=!!R&&Q.reverse()}const oe=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ye{constructor(R){this._feature=R,this.extent=l.EXTENT,this.type=R.type,this.properties=R.tags,"id"in R&&!isNaN(R.id)&&(this.id=parseInt(R.id,10))}loadGeometry(){if(this._feature.type===1){const R=[];for(const F of this._feature.geometry)R.push([new l.pointGeometry(F[0],F[1])]);return R}{const R=[];for(const F of this._feature.geometry){const Z=[];for(const K of F)Z.push(new l.pointGeometry(K[0],K[1]));R.push(Z)}return R}}toGeoJSON(R,F,Z){return oe.call(this,R,F,Z)}}class Se{constructor(R){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=R.length,this._features=R}feature(R){return new ye(this._features[R])}}var Oe={exports:{}},Fe=l.pointGeometry,Ve=l.vectorTile.VectorTileFeature,je=ut;function ut(Q,R){this.options=R||{},this.features=Q,this.length=Q.length}function Gt(Q,R){this.id=typeof Q.id=="number"?Q.id:void 0,this.type=Q.type,this.rawGeometry=Q.type===1?[Q.geometry]:Q.geometry,this.properties=Q.tags,this.extent=R||4096}ut.prototype.feature=function(Q){return new Gt(this.features[Q],this.options.extent)},Gt.prototype.loadGeometry=function(){var Q=this.rawGeometry;this.geometry=[];for(var R=0;R<Q.length;R++){for(var F=Q[R],Z=[],K=0;K<F.length;K++)Z.push(new Fe(F[K][0],F[K][1]));this.geometry.push(Z)}return this.geometry},Gt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Q=this.geometry,R=1/0,F=-1/0,Z=1/0,K=-1/0,ce=0;ce<Q.length;ce++)for(var fe=Q[ce],he=0;he<fe.length;he++){var le=fe[he];R=Math.min(R,le.x),F=Math.max(F,le.x),Z=Math.min(Z,le.y),K=Math.max(K,le.y)}return[R,Z,F,K]},Gt.prototype.toGeoJSON=Ve.prototype.toGeoJSON;var Yt=l.pbf,Mt=je;function zn(Q){var R=new Yt;return function(F,Z){for(var K in F.layers)Z.writeMessage(3,vt,F.layers[K])}(Q,R),R.finish()}function vt(Q,R){var F;R.writeVarintField(15,Q.version||1),R.writeStringField(1,Q.name||""),R.writeVarintField(5,Q.extent||4096);var Z={keys:[],values:[],keycache:{},valuecache:{}};for(F=0;F<Q.length;F++)Z.feature=Q.feature(F),R.writeMessage(2,ii,Z);var K=Z.keys;for(F=0;F<K.length;F++)R.writeStringField(3,K[F]);var ce=Z.values;for(F=0;F<ce.length;F++)R.writeMessage(4,rn,ce[F])}function ii(Q,R){var F=Q.feature;F.id!==void 0&&R.writeVarintField(1,F.id),R.writeMessage(2,tt,Q),R.writeVarintField(3,F.type),R.writeMessage(4,nn,F)}function tt(Q,R){var F=Q.feature,Z=Q.keys,K=Q.values,ce=Q.keycache,fe=Q.valuecache;for(var he in F.properties){var le=F.properties[he],pe=ce[he];if(le!==null){pe===void 0&&(Z.push(he),ce[he]=pe=Z.length-1),R.writeVarint(pe);var Ie=typeof le;Ie!=="string"&&Ie!=="boolean"&&Ie!=="number"&&(le=JSON.stringify(le));var ze=Ie+":"+le,Pe=fe[ze];Pe===void 0&&(K.push(le),fe[ze]=Pe=K.length-1),R.writeVarint(Pe)}}}function wt(Q,R){return(R<<3)+(7&Q)}function St(Q){return Q<<1^Q>>31}function nn(Q,R){for(var F=Q.loadGeometry(),Z=Q.type,K=0,ce=0,fe=F.length,he=0;he<fe;he++){var le=F[he],pe=1;Z===1&&(pe=le.length),R.writeVarint(wt(1,pe));for(var Ie=Z===3?le.length-1:le.length,ze=0;ze<Ie;ze++){ze===1&&Z!==1&&R.writeVarint(wt(2,Ie-1));var Pe=le[ze].x-K,rt=le[ze].y-ce;R.writeVarint(St(Pe)),R.writeVarint(St(rt)),K+=Pe,ce+=rt}Z===3&&R.writeVarint(wt(7,1))}}function rn(Q,R){var F=typeof Q;F==="string"?R.writeStringField(1,Q):F==="boolean"?R.writeBooleanField(7,Q):F==="number"&&(Q%1!=0?R.writeDoubleField(3,Q):Q<0?R.writeSVarintField(6,Q):R.writeVarintField(5,Q))}function nr(Q,R,F,Z,K,ce){if(K-Z<=F)return;const fe=Z+K>>1;ri(Q,R,fe,Z,K,ce%2),nr(Q,R,F,Z,fe-1,ce+1),nr(Q,R,F,fe+1,K,ce+1)}function ri(Q,R,F,Z,K,ce){for(;K>Z;){if(K-Z>600){const pe=K-Z+1,Ie=F-Z+1,ze=Math.log(pe),Pe=.5*Math.exp(2*ze/3),rt=.5*Math.sqrt(ze*Pe*(pe-Pe)/pe)*(Ie-pe/2<0?-1:1);ri(Q,R,F,Math.max(Z,Math.floor(F-Ie*Pe/pe+rt)),Math.min(K,Math.floor(F+(pe-Ie)*Pe/pe+rt)),ce)}const fe=R[2*F+ce];let he=Z,le=K;for(bi(Q,R,Z,F),R[2*K+ce]>fe&&bi(Q,R,Z,K);he<le;){for(bi(Q,R,he,le),he++,le--;R[2*he+ce]<fe;)he++;for(;R[2*le+ce]>fe;)le--}R[2*Z+ce]===fe?bi(Q,R,Z,le):(le++,bi(Q,R,le,K)),le<=F&&(Z=le+1),F<=le&&(K=le-1)}}function bi(Q,R,F,Z){si(Q,F,Z),si(R,2*F,2*Z),si(R,2*F+1,2*Z+1)}function si(Q,R,F){const Z=Q[R];Q[R]=Q[F],Q[F]=Z}function cn(Q,R,F,Z){const K=Q-F,ce=R-Z;return K*K+ce*ce}Oe.exports=zn,Oe.exports.fromVectorTileJs=zn,Oe.exports.fromGeojsonVt=function(Q,R){R=R||{};var F={};for(var Z in Q)F[Z]=new Mt(Q[Z].features,R),F[Z].name=Z,F[Z].version=R.version,F[Z].extent=R.extent;return zn({layers:F})},Oe.exports.GeoJSONWrapper=Mt;const wi=Q=>Q[0],Wt=Q=>Q[1];class On{constructor(R,F=wi,Z=Wt,K=64,ce=Float64Array){this.nodeSize=K,this.points=R;const fe=R.length<65536?Uint16Array:Uint32Array,he=this.ids=new fe(R.length),le=this.coords=new ce(2*R.length);for(let pe=0;pe<R.length;pe++)he[pe]=pe,le[2*pe]=F(R[pe]),le[2*pe+1]=Z(R[pe]);nr(he,le,K,0,he.length-1,0)}range(R,F,Z,K){return function(ce,fe,he,le,pe,Ie,ze){const Pe=[0,ce.length-1,0],rt=[];let lt,Ye;for(;Pe.length;){const gt=Pe.pop(),ft=Pe.pop(),Lt=Pe.pop();if(ft-Lt<=ze){for(let zt=Lt;zt<=ft;zt++)lt=fe[2*zt],Ye=fe[2*zt+1],lt>=he&&lt<=pe&&Ye>=le&&Ye<=Ie&&rt.push(ce[zt]);continue}const xt=Math.floor((Lt+ft)/2);lt=fe[2*xt],Ye=fe[2*xt+1],lt>=he&&lt<=pe&&Ye>=le&&Ye<=Ie&&rt.push(ce[xt]);const Tt=(gt+1)%2;(gt===0?he<=lt:le<=Ye)&&(Pe.push(Lt),Pe.push(xt-1),Pe.push(Tt)),(gt===0?pe>=lt:Ie>=Ye)&&(Pe.push(xt+1),Pe.push(ft),Pe.push(Tt))}return rt}(this.ids,this.coords,R,F,Z,K,this.nodeSize)}within(R,F,Z){return function(K,ce,fe,he,le,pe){const Ie=[0,K.length-1,0],ze=[],Pe=le*le;for(;Ie.length;){const rt=Ie.pop(),lt=Ie.pop(),Ye=Ie.pop();if(lt-Ye<=pe){for(let Tt=Ye;Tt<=lt;Tt++)cn(ce[2*Tt],ce[2*Tt+1],fe,he)<=Pe&&ze.push(K[Tt]);continue}const gt=Math.floor((Ye+lt)/2),ft=ce[2*gt],Lt=ce[2*gt+1];cn(ft,Lt,fe,he)<=Pe&&ze.push(K[gt]);const xt=(rt+1)%2;(rt===0?fe-le<=ft:he-le<=Lt)&&(Ie.push(Ye),Ie.push(gt-1),Ie.push(xt)),(rt===0?fe+le>=ft:he+le>=Lt)&&(Ie.push(gt+1),Ie.push(lt),Ie.push(xt))}return ze}(this.ids,this.coords,R,F,Z,this.nodeSize)}}const ns={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Q=>Q},Li=Math.fround||(Yn=new Float32Array(1),Q=>(Yn[0]=+Q,Yn[0]));var Yn;class Lr{constructor(R){this.options=is(Object.create(ns),R),this.trees=new Array(this.options.maxZoom+1)}load(R){const{log:F,minZoom:Z,maxZoom:K,nodeSize:ce}=this.options;F&&console.time("total time");const fe=`prepare ${R.length} points`;F&&console.time(fe),this.points=R;let he=[];for(let le=0;le<R.length;le++)R[le].geometry&&he.push(fi(R[le],le));this.trees[K+1]=new On(he,_o,kr,ce,Float32Array),F&&console.timeEnd(fe);for(let le=K;le>=Z;le--){const pe=+Date.now();he=this._cluster(he,le),this.trees[le]=new On(he,_o,kr,ce,Float32Array),F&&console.log("z%d: %d clusters in %dms",le,he.length,+Date.now()-pe)}return F&&console.timeEnd("total time"),this}getClusters(R,F){let Z=((R[0]+180)%360+360)%360-180;const K=Math.max(-90,Math.min(90,R[1]));let ce=R[2]===180?180:((R[2]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)Z=-180,ce=180;else if(Z>ce){const Ie=this.getClusters([Z,K,180,fe],F),ze=this.getClusters([-180,K,ce,fe],F);return Ie.concat(ze)}const he=this.trees[this._limitZoom(F)],le=he.range(Vt(Z),ki(fe),Vt(ce),ki(K)),pe=[];for(const Ie of le){const ze=he.points[Ie];pe.push(ze.numPoints?Gi(ze):this.points[ze.index])}return pe}getChildren(R){const F=this._getOriginId(R),Z=this._getOriginZoom(R),K="No cluster with the specified id.",ce=this.trees[Z];if(!ce)throw new Error(K);const fe=ce.points[F];if(!fe)throw new Error(K);const he=this.options.radius/(this.options.extent*Math.pow(2,Z-1)),le=ce.within(fe.x,fe.y,he),pe=[];for(const Ie of le){const ze=ce.points[Ie];ze.parentId===R&&pe.push(ze.numPoints?Gi(ze):this.points[ze.index])}if(pe.length===0)throw new Error(K);return pe}getLeaves(R,F,Z){const K=[];return this._appendLeaves(K,R,F=F||10,Z=Z||0,0),K}getTile(R,F,Z){const K=this.trees[this._limitZoom(R)],ce=Math.pow(2,R),{extent:fe,radius:he}=this.options,le=he/fe,pe=(Z-le)/ce,Ie=(Z+1+le)/ce,ze={features:[]};return this._addTileFeatures(K.range((F-le)/ce,pe,(F+1+le)/ce,Ie),K.points,F,Z,ce,ze),F===0&&this._addTileFeatures(K.range(1-le/ce,pe,1,Ie),K.points,ce,Z,ce,ze),F===ce-1&&this._addTileFeatures(K.range(0,pe,le/ce,Ie),K.points,-1,Z,ce,ze),ze.features.length?ze:null}getClusterExpansionZoom(R){let F=this._getOriginZoom(R)-1;for(;F<=this.options.maxZoom;){const Z=this.getChildren(R);if(F++,Z.length!==1)break;R=Z[0].properties.cluster_id}return F}_appendLeaves(R,F,Z,K,ce){const fe=this.getChildren(F);for(const he of fe){const le=he.properties;if(le&&le.cluster?ce+le.point_count<=K?ce+=le.point_count:ce=this._appendLeaves(R,le.cluster_id,Z,K,ce):ce<K?ce++:R.push(he),R.length===Z)break}return ce}_addTileFeatures(R,F,Z,K,ce,fe){for(const he of R){const le=F[he],pe=le.numPoints;let Ie,ze,Pe;if(pe)Ie=js(le),ze=le.x,Pe=le.y;else{const Ye=this.points[le.index];Ie=Ye.properties,ze=Vt(Ye.geometry.coordinates[0]),Pe=ki(Ye.geometry.coordinates[1])}const rt={type:1,geometry:[[Math.round(this.options.extent*(ze*ce-Z)),Math.round(this.options.extent*(Pe*ce-K))]],tags:Ie};let lt;pe?lt=le.id:this.options.generateId?lt=le.index:this.points[le.index].id&&(lt=this.points[le.index].id),lt!==void 0&&(rt.id=lt),fe.features.push(rt)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(Math.floor(+R),this.options.maxZoom+1))}_cluster(R,F){const Z=[],{radius:K,extent:ce,reduce:fe,minPoints:he}=this.options,le=K/(ce*Math.pow(2,F));for(let pe=0;pe<R.length;pe++){const Ie=R[pe];if(Ie.zoom<=F)continue;Ie.zoom=F;const ze=this.trees[F+1],Pe=ze.within(Ie.x,Ie.y,le),rt=Ie.numPoints||1;let lt=rt;for(const Ye of Pe){const gt=ze.points[Ye];gt.zoom>F&&(lt+=gt.numPoints||1)}if(lt>rt&&lt>=he){let Ye=Ie.x*rt,gt=Ie.y*rt,ft=fe&&rt>1?this._map(Ie,!0):null;const Lt=(pe<<5)+(F+1)+this.points.length;for(const xt of Pe){const Tt=ze.points[xt];if(Tt.zoom<=F)continue;Tt.zoom=F;const zt=Tt.numPoints||1;Ye+=Tt.x*zt,gt+=Tt.y*zt,Tt.parentId=Lt,fe&&(ft||(ft=this._map(Ie,!0)),fe(ft,this._map(Tt)))}Ie.parentId=Lt,Z.push(ji(Ye/lt,gt/lt,Lt,lt,ft))}else if(Z.push(Ie),lt>1)for(const Ye of Pe){const gt=ze.points[Ye];gt.zoom<=F||(gt.zoom=F,Z.push(gt))}}return Z}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,F){if(R.numPoints)return F?is({},R.properties):R.properties;const Z=this.points[R.index].properties,K=this.options.map(Z);return F&&K===Z?is({},K):K}}function ji(Q,R,F,Z,K){return{x:Li(Q),y:Li(R),zoom:1/0,id:F,parentId:-1,numPoints:Z,properties:K}}function fi(Q,R){const[F,Z]=Q.geometry.coordinates;return{x:Li(Vt(F)),y:Li(ki(Z)),zoom:1/0,index:R,parentId:-1}}function Gi(Q){return{type:"Feature",id:Q.id,properties:js(Q),geometry:{type:"Point",coordinates:[(R=Q.x,360*(R-.5)),Fn(Q.y)]}};var R}function js(Q){const R=Q.numPoints,F=R>=1e4?`${Math.round(R/1e3)}k`:R>=1e3?Math.round(R/100)/10+"k":R;return is(is({},Q.properties),{cluster:!0,cluster_id:Q.id,point_count:R,point_count_abbreviated:F})}function Vt(Q){return Q/360+.5}function ki(Q){const R=Math.sin(Q*Math.PI/180),F=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return F<0?0:F>1?1:F}function Fn(Q){const R=(180-360*Q)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function is(Q,R){for(const F in R)Q[F]=R[F];return Q}function _o(Q){return Q.x}function kr(Q){return Q.y}function Rr(Q,R,F,Z){for(var K,ce=Z,fe=F-R>>1,he=F-R,le=Q[R],pe=Q[R+1],Ie=Q[F],ze=Q[F+1],Pe=R+3;Pe<F;Pe+=3){var rt=Gs(Q[Pe],Q[Pe+1],le,pe,Ie,ze);if(rt>ce)K=Pe,ce=rt;else if(rt===ce){var lt=Math.abs(Pe-fe);lt<he&&(K=Pe,he=lt)}}ce>Z&&(K-R>3&&Rr(Q,R,K,Z),Q[K+2]=ce,F-K>3&&Rr(Q,K,F,Z))}function Gs(Q,R,F,Z,K,ce){var fe=K-F,he=ce-Z;if(fe!==0||he!==0){var le=((Q-F)*fe+(R-Z)*he)/(fe*fe+he*he);le>1?(F=K,Z=ce):le>0&&(F+=fe*le,Z+=he*le)}return(fe=Q-F)*fe+(he=R-Z)*he}function vr(Q,R,F,Z){var K={id:Q===void 0?null:Q,type:R,geometry:F,tags:Z,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ce){var fe=ce.geometry,he=ce.type;if(he==="Point"||he==="MultiPoint"||he==="LineString")Me(ce,fe);else if(he==="Polygon"||he==="MultiLineString")for(var le=0;le<fe.length;le++)Me(ce,fe[le]);else if(he==="MultiPolygon")for(le=0;le<fe.length;le++)for(var pe=0;pe<fe[le].length;pe++)Me(ce,fe[le][pe])}(K),K}function Me(Q,R){for(var F=0;F<R.length;F+=3)Q.minX=Math.min(Q.minX,R[F]),Q.minY=Math.min(Q.minY,R[F+1]),Q.maxX=Math.max(Q.maxX,R[F]),Q.maxY=Math.max(Q.maxY,R[F+1])}function We(Q,R,F,Z){if(R.geometry){var K=R.geometry.coordinates,ce=R.geometry.type,fe=Math.pow(F.tolerance/((1<<F.maxZoom)*F.extent),2),he=[],le=R.id;if(F.promoteId?le=R.properties[F.promoteId]:F.generateId&&(le=Z||0),ce==="Point")rs(K,he);else if(ce==="MultiPoint")for(var pe=0;pe<K.length;pe++)rs(K[pe],he);else if(ce==="LineString")Ei(K,he,fe,!1);else if(ce==="MultiLineString"){if(F.lineMetrics){for(pe=0;pe<K.length;pe++)Ei(K[pe],he=[],fe,!1),Q.push(vr(le,"LineString",he,R.properties));return}Bt(K,he,fe,!1)}else if(ce==="Polygon")Bt(K,he,fe,!0);else{if(ce!=="MultiPolygon"){if(ce==="GeometryCollection"){for(pe=0;pe<R.geometry.geometries.length;pe++)We(Q,{id:le,geometry:R.geometry.geometries[pe],properties:R.properties},F,Z);return}throw new Error("Input data is not a valid GeoJSON object.")}for(pe=0;pe<K.length;pe++){var Ie=[];Bt(K[pe],Ie,fe,!0),he.push(Ie)}}Q.push(vr(le,ce,he,R.properties))}}function rs(Q,R){R.push($i(Q[0])),R.push(Ri(Q[1])),R.push(0)}function Ei(Q,R,F,Z){for(var K,ce,fe=0,he=0;he<Q.length;he++){var le=$i(Q[he][0]),pe=Ri(Q[he][1]);R.push(le),R.push(pe),R.push(0),he>0&&(fe+=Z?(K*pe-le*ce)/2:Math.sqrt(Math.pow(le-K,2)+Math.pow(pe-ce,2))),K=le,ce=pe}var Ie=R.length-3;R[2]=1,Rr(R,0,Ie,F),R[Ie+2]=1,R.size=Math.abs(fe),R.start=0,R.end=R.size}function Bt(Q,R,F,Z){for(var K=0;K<Q.length;K++){var ce=[];Ei(Q[K],ce,F,Z),R.push(ce)}}function $i(Q){return Q/360+.5}function Ri(Q){var R=Math.sin(Q*Math.PI/180),F=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return F<0?0:F>1?1:F}function Di(Q,R,F,Z,K,ce,fe,he){if(Z/=R,ce>=(F/=R)&&fe<Z)return Q;if(fe<F||ce>=Z)return null;for(var le=[],pe=0;pe<Q.length;pe++){var Ie=Q[pe],ze=Ie.geometry,Pe=Ie.type,rt=K===0?Ie.minX:Ie.minY,lt=K===0?Ie.maxX:Ie.maxY;if(rt>=F&&lt<Z)le.push(Ie);else if(!(lt<F||rt>=Z)){var Ye=[];if(Pe==="Point"||Pe==="MultiPoint")ss(ze,Ye,F,Z,K);else if(Pe==="LineString")He(ze,Ye,F,Z,K,!1,he.lineMetrics);else if(Pe==="MultiLineString")Pt(ze,Ye,F,Z,K,!1);else if(Pe==="Polygon")Pt(ze,Ye,F,Z,K,!0);else if(Pe==="MultiPolygon")for(var gt=0;gt<ze.length;gt++){var ft=[];Pt(ze[gt],ft,F,Z,K,!0),ft.length&&Ye.push(ft)}if(Ye.length){if(he.lineMetrics&&Pe==="LineString"){for(gt=0;gt<Ye.length;gt++)le.push(vr(Ie.id,Pe,Ye[gt],Ie.tags));continue}Pe!=="LineString"&&Pe!=="MultiLineString"||(Ye.length===1?(Pe="LineString",Ye=Ye[0]):Pe="MultiLineString"),Pe!=="Point"&&Pe!=="MultiPoint"||(Pe=Ye.length===3?"Point":"MultiPoint"),le.push(vr(Ie.id,Pe,Ye,Ie.tags))}}}return le.length?le:null}function ss(Q,R,F,Z,K){for(var ce=0;ce<Q.length;ce+=3){var fe=Q[ce+K];fe>=F&&fe<=Z&&(R.push(Q[ce]),R.push(Q[ce+1]),R.push(Q[ce+2]))}}function He(Q,R,F,Z,K,ce,fe){for(var he,le,pe=It(Q),Ie=K===0?Dr:At,ze=Q.start,Pe=0;Pe<Q.length-3;Pe+=3){var rt=Q[Pe],lt=Q[Pe+1],Ye=Q[Pe+2],gt=Q[Pe+3],ft=Q[Pe+4],Lt=K===0?rt:lt,xt=K===0?gt:ft,Tt=!1;fe&&(he=Math.sqrt(Math.pow(rt-gt,2)+Math.pow(lt-ft,2))),Lt<F?xt>F&&(le=Ie(pe,rt,lt,gt,ft,F),fe&&(pe.start=ze+he*le)):Lt>Z?xt<Z&&(le=Ie(pe,rt,lt,gt,ft,Z),fe&&(pe.start=ze+he*le)):Kn(pe,rt,lt,Ye),xt<F&&Lt>=F&&(le=Ie(pe,rt,lt,gt,ft,F),Tt=!0),xt>Z&&Lt<=Z&&(le=Ie(pe,rt,lt,gt,ft,Z),Tt=!0),!ce&&Tt&&(fe&&(pe.end=ze+he*le),R.push(pe),pe=It(Q)),fe&&(ze+=he)}var zt=Q.length-3;rt=Q[zt],lt=Q[zt+1],Ye=Q[zt+2],(Lt=K===0?rt:lt)>=F&&Lt<=Z&&Kn(pe,rt,lt,Ye),zt=pe.length-3,ce&&zt>=3&&(pe[zt]!==pe[0]||pe[zt+1]!==pe[1])&&Kn(pe,pe[0],pe[1],pe[2]),pe.length&&R.push(pe)}function It(Q){var R=[];return R.size=Q.size,R.start=Q.start,R.end=Q.end,R}function Pt(Q,R,F,Z,K,ce){for(var fe=0;fe<Q.length;fe++)He(Q[fe],R,F,Z,K,ce,!1)}function Kn(Q,R,F,Z){Q.push(R),Q.push(F),Q.push(Z)}function Dr(Q,R,F,Z,K,ce){var fe=(ce-R)/(Z-R);return Q.push(ce),Q.push(F+(K-F)*fe),Q.push(1),fe}function At(Q,R,F,Z,K,ce){var fe=(ce-F)/(K-F);return Q.push(R+(Z-R)*fe),Q.push(ce),Q.push(1),fe}function ir(Q,R){for(var F=[],Z=0;Z<Q.length;Z++){var K,ce=Q[Z],fe=ce.type;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")K=$n(ce.geometry,R);else if(fe==="MultiLineString"||fe==="Polygon"){K=[];for(var he=0;he<ce.geometry.length;he++)K.push($n(ce.geometry[he],R))}else if(fe==="MultiPolygon")for(K=[],he=0;he<ce.geometry.length;he++){for(var le=[],pe=0;pe<ce.geometry[he].length;pe++)le.push($n(ce.geometry[he][pe],R));K.push(le)}F.push(vr(ce.id,fe,K,ce.tags))}return F}function $n(Q,R){var F=[];F.size=Q.size,Q.start!==void 0&&(F.start=Q.start,F.end=Q.end);for(var Z=0;Z<Q.length;Z+=3)F.push(Q[Z]+R,Q[Z+1],Q[Z+2]);return F}function $s(Q,R){if(Q.transformed)return Q;var F,Z,K,ce=1<<Q.z,fe=Q.x,he=Q.y;for(F=0;F<Q.features.length;F++){var le=Q.features[F],pe=le.geometry,Ie=le.type;if(le.geometry=[],Ie===1)for(Z=0;Z<pe.length;Z+=2)le.geometry.push(Ln(pe[Z],pe[Z+1],R,ce,fe,he));else for(Z=0;Z<pe.length;Z++){var ze=[];for(K=0;K<pe[Z].length;K+=2)ze.push(Ln(pe[Z][K],pe[Z][K+1],R,ce,fe,he));le.geometry.push(ze)}}return Q.transformed=!0,Q}function Ln(Q,R,F,Z,K,ce){return[Math.round(F*(Q*Z-K)),Math.round(F*(R*Z-ce))]}function oi(Q,R,F,Z,K){for(var ce=R===K.maxZoom?0:K.tolerance/((1<<R)*K.extent),fe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:F,y:Z,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},he=0;he<Q.length;he++){fe.numFeatures++,Qt(fe,Q[he],ce,K);var le=Q[he].minX,pe=Q[he].minY,Ie=Q[he].maxX,ze=Q[he].maxY;le<fe.minX&&(fe.minX=le),pe<fe.minY&&(fe.minY=pe),Ie>fe.maxX&&(fe.maxX=Ie),ze>fe.maxY&&(fe.maxY=ze)}return fe}function Qt(Q,R,F,Z){var K=R.geometry,ce=R.type,fe=[];if(ce==="Point"||ce==="MultiPoint")for(var he=0;he<K.length;he+=3)fe.push(K[he]),fe.push(K[he+1]),Q.numPoints++,Q.numSimplified++;else if(ce==="LineString")Hs(fe,K,Q,F,!1,!1);else if(ce==="MultiLineString"||ce==="Polygon")for(he=0;he<K.length;he++)Hs(fe,K[he],Q,F,ce==="Polygon",he===0);else if(ce==="MultiPolygon")for(var le=0;le<K.length;le++){var pe=K[le];for(he=0;he<pe.length;he++)Hs(fe,pe[he],Q,F,!0,he===0)}if(fe.length){var Ie=R.tags||null;if(ce==="LineString"&&Z.lineMetrics){for(var ze in Ie={},R.tags)Ie[ze]=R.tags[ze];Ie.mapbox_clip_start=K.start/K.size,Ie.mapbox_clip_end=K.end/K.size}var Pe={geometry:fe,type:ce==="Polygon"||ce==="MultiPolygon"?3:ce==="LineString"||ce==="MultiLineString"?2:1,tags:Ie};R.id!==null&&(Pe.id=R.id),Q.features.push(Pe)}}function Hs(Q,R,F,Z,K,ce){var fe=Z*Z;if(Z>0&&R.size<(K?fe:Z))F.numPoints+=R.length/3;else{for(var he=[],le=0;le<R.length;le+=3)(Z===0||R[le+2]>fe)&&(F.numSimplified++,he.push(R[le]),he.push(R[le+1])),F.numPoints++;K&&function(pe,Ie){for(var ze=0,Pe=0,rt=pe.length,lt=rt-2;Pe<rt;lt=Pe,Pe+=2)ze+=(pe[Pe]-pe[lt])*(pe[Pe+1]+pe[lt+1]);if(ze>0===Ie)for(Pe=0,rt=pe.length;Pe<rt/2;Pe+=2){var Ye=pe[Pe],gt=pe[Pe+1];pe[Pe]=pe[rt-2-Pe],pe[Pe+1]=pe[rt-1-Pe],pe[rt-2-Pe]=Ye,pe[rt-1-Pe]=gt}}(he,ce),Q.push(he)}}function xr(Q,R){var F=(R=this.options=function(K,ce){for(var fe in ce)K[fe]=ce[fe];return K}(Object.create(this.options),R)).debug;if(F&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");var Z=function(K,ce){var fe=[];if(K.type==="FeatureCollection")for(var he=0;he<K.features.length;he++)We(fe,K.features[he],ce,he);else We(fe,K.type==="Feature"?K:{geometry:K},ce);return fe}(Q,R);this.tiles={},this.tileCoords=[],F&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Z=function(K,ce){var fe=ce.buffer/ce.extent,he=K,le=Di(K,1,-1-fe,fe,0,-1,2,ce),pe=Di(K,1,1-fe,2+fe,0,-1,2,ce);return(le||pe)&&(he=Di(K,1,-fe,1+fe,0,-1,2,ce)||[],le&&(he=ir(le,1).concat(he)),pe&&(he=he.concat(ir(pe,-1)))),he}(Z,R),Z.length&&this.splitTile(Z,0,0,0),F&&(Z.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function br(Q,R,F){return 32*((1<<Q)*F+R)+Q}function ws(Q,R){const F=Q.tileID.canonical;if(!this._geoJSONIndex)return R(null,null);const Z=this._geoJSONIndex.getTile(F.z,F.x,F.y);if(!Z)return R(null,null);const K=new Se(Z.features);let ce=Oe.exports(K);ce.byteOffset===0&&ce.byteLength===ce.buffer.byteLength||(ce=new Uint8Array(ce)),R(null,{vectorTile:K,rawData:ce.buffer})}xr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},xr.prototype.splitTile=function(Q,R,F,Z,K,ce,fe){for(var he=[Q,R,F,Z],le=this.options,pe=le.debug;he.length;){Z=he.pop(),F=he.pop(),R=he.pop(),Q=he.pop();var Ie=1<<R,ze=br(R,F,Z),Pe=this.tiles[ze];if(!Pe&&(pe>1&&console.time("creation"),Pe=this.tiles[ze]=oi(Q,R,F,Z,le),this.tileCoords.push({z:R,x:F,y:Z}),pe)){pe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,F,Z,Pe.numFeatures,Pe.numPoints,Pe.numSimplified),console.timeEnd("creation"));var rt="z"+R;this.stats[rt]=(this.stats[rt]||0)+1,this.total++}if(Pe.source=Q,K){if(R===le.maxZoom||R===K)continue;var lt=1<<K-R;if(F!==Math.floor(ce/lt)||Z!==Math.floor(fe/lt))continue}else if(R===le.indexMaxZoom||Pe.numPoints<=le.indexMaxPoints)continue;if(Pe.source=null,Q.length!==0){pe>1&&console.time("clipping");var Ye,gt,ft,Lt,xt,Tt,zt=.5*le.buffer/le.extent,Nt=.5-zt,hn=.5+zt,dn=1+zt;Ye=gt=ft=Lt=null,xt=Di(Q,Ie,F-zt,F+hn,0,Pe.minX,Pe.maxX,le),Tt=Di(Q,Ie,F+Nt,F+dn,0,Pe.minX,Pe.maxX,le),Q=null,xt&&(Ye=Di(xt,Ie,Z-zt,Z+hn,1,Pe.minY,Pe.maxY,le),gt=Di(xt,Ie,Z+Nt,Z+dn,1,Pe.minY,Pe.maxY,le),xt=null),Tt&&(ft=Di(Tt,Ie,Z-zt,Z+hn,1,Pe.minY,Pe.maxY,le),Lt=Di(Tt,Ie,Z+Nt,Z+dn,1,Pe.minY,Pe.maxY,le),Tt=null),pe>1&&console.timeEnd("clipping"),he.push(Ye||[],R+1,2*F,2*Z),he.push(gt||[],R+1,2*F,2*Z+1),he.push(ft||[],R+1,2*F+1,2*Z),he.push(Lt||[],R+1,2*F+1,2*Z+1)}}},xr.prototype.getTile=function(Q,R,F){var Z=this.options,K=Z.extent,ce=Z.debug;if(Q<0||Q>24)return null;var fe=1<<Q,he=br(Q,R=(R%fe+fe)%fe,F);if(this.tiles[he])return $s(this.tiles[he],K);ce>1&&console.log("drilling down to z%d-%d-%d",Q,R,F);for(var le,pe=Q,Ie=R,ze=F;!le&&pe>0;)pe--,Ie=Math.floor(Ie/2),ze=Math.floor(ze/2),le=this.tiles[br(pe,Ie,ze)];return le&&le.source?(ce>1&&console.log("found parent tile z%d-%d-%d",pe,Ie,ze),ce>1&&console.time("drilling down"),this.splitTile(le.source,pe,Ie,ze,Q,R,F),ce>1&&console.timeEnd("drilling down"),this.tiles[he]?$s(this.tiles[he],K):null):null};class Ws extends ee{constructor(R,F,Z,K){super(R,F,Z,ws),K&&(this.loadGeoJSON=K)}loadData(R,F){var Z;(Z=this._pendingRequest)===null||Z===void 0||Z.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const K=!!(R&&R.request&&R.request.collectResourceTiming)&&new l.RequestPerformance(R.request);this._pendingCallback=F,this._pendingRequest=this.loadGeoJSON(R,(ce,fe)=>{if(delete this._pendingCallback,delete this._pendingRequest,ce||!fe)return F(ce);if(typeof fe!="object")return F(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));{Y(fe,!0);try{if(R.filter){const le=l.createExpression(R.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(le.result==="error")throw new Error(le.value.map(Ie=>`${Ie.key}: ${Ie.message}`).join(", "));fe={type:"FeatureCollection",features:fe.features.filter(Ie=>le.value.evaluate({zoom:0},Ie))}}this._geoJSONIndex=R.cluster?new Lr(function({superclusterOptions:le,clusterProperties:pe}){if(!pe||!le)return le;const Ie={},ze={},Pe={accumulated:null,zoom:0},rt={properties:null},lt=Object.keys(pe);for(const Ye of lt){const[gt,ft]=pe[Ye],Lt=l.createExpression(ft),xt=l.createExpression(typeof gt=="string"?[gt,["accumulated"],["get",Ye]]:gt);Ie[Ye]=Lt.value,ze[Ye]=xt.value}return le.map=Ye=>{rt.properties=Ye;const gt={};for(const ft of lt)gt[ft]=Ie[ft].evaluate(Pe,rt);return gt},le.reduce=(Ye,gt)=>{rt.properties=gt;for(const ft of lt)Pe.accumulated=Ye[ft],Ye[ft]=ze[ft].evaluate(Pe,rt)},le}(R)).load(fe.features):function(le,pe){return new xr(le,pe)}(fe,R.geojsonVtOptions)}catch(le){return F(le)}this.loaded={};const he={};if(K){const le=K.finish();le&&(he.resourceTiming={},he.resourceTiming[R.source]=JSON.parse(JSON.stringify(le)))}F(null,he)}})}reloadTile(R,F){const Z=this.loaded;return Z&&Z[R.uid]?super.reloadTile(R,F):this.loadTile(R,F)}loadGeoJSON(R,F){if(R.request)return l.getJSON(R.request,F);if(typeof R.data=="string")try{F(null,JSON.parse(R.data))}catch{F(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`))}else F(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(R,F){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),F()}getClusterExpansionZoom(R,F){try{F(null,this._geoJSONIndex.getClusterExpansionZoom(R.clusterId))}catch(Z){F(Z)}}getClusterChildren(R,F){try{F(null,this._geoJSONIndex.getChildren(R.clusterId))}catch(Z){F(Z)}}getClusterLeaves(R,F){try{F(null,this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset))}catch(Z){F(Z)}}}class os{constructor(R){this.self=R,this.actor=new l.Actor(R,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ee,geojson:Ws},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(F,Z)=>{if(this.workerSourceTypes[F])throw new Error(`Worker source with name "${F}" already registered.`);this.workerSourceTypes[F]=Z},this.self.registerRTLTextPlugin=F=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=F.applyArabicShaping,l.plugin.processBidirectionalText=F.processBidirectionalText,l.plugin.processStyledBidirectionalText=F.processStyledBidirectionalText}}setReferrer(R,F){this.referrer=F}setImages(R,F,Z){this.availableImages[R]=F;for(const K in this.workerSources[R]){const ce=this.workerSources[R][K];for(const fe in ce)ce[fe].availableImages=F}Z()}setLayers(R,F,Z){this.getLayerIndex(R).replace(F),Z()}updateLayers(R,F,Z){this.getLayerIndex(R).update(F.layers,F.removedIds),Z()}loadTile(R,F,Z){this.getWorkerSource(R,F.type,F.source).loadTile(F,Z)}loadDEMTile(R,F,Z){this.getDEMWorkerSource(R,F.source).loadTile(F,Z)}reloadTile(R,F,Z){this.getWorkerSource(R,F.type,F.source).reloadTile(F,Z)}abortTile(R,F,Z){this.getWorkerSource(R,F.type,F.source).abortTile(F,Z)}removeTile(R,F,Z){this.getWorkerSource(R,F.type,F.source).removeTile(F,Z)}removeDEMTile(R,F){this.getDEMWorkerSource(R,F.source).removeTile(F)}removeSource(R,F,Z){if(!this.workerSources[R]||!this.workerSources[R][F.type]||!this.workerSources[R][F.type][F.source])return;const K=this.workerSources[R][F.type][F.source];delete this.workerSources[R][F.type][F.source],K.removeSource!==void 0?K.removeSource(F,Z):Z()}loadWorkerSource(R,F,Z){try{this.self.importScripts(F.url),Z()}catch(K){Z(K.toString())}}syncRTLPluginState(R,F,Z){try{l.plugin.setState(F);const K=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&K!=null){this.self.importScripts(K);const ce=l.plugin.isParsed();Z(ce?void 0:new Error(`RTL Text Plugin failed to import scripts from ${K}`),ce)}}catch(K){Z(K.toString())}}getAvailableImages(R){let F=this.availableImages[R];return F||(F=[]),F}getLayerIndex(R){let F=this.layerIndexes[R];return F||(F=this.layerIndexes[R]=new C),F}getWorkerSource(R,F,Z){if(this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][F]||(this.workerSources[R][F]={}),!this.workerSources[R][F][Z]){const K={send:(ce,fe,he)=>{this.actor.send(ce,fe,he,R)}};this.workerSources[R][F][Z]=new this.workerSourceTypes[F](K,this.getLayerIndex(R),this.getAvailableImages(R))}return this.workerSources[R][F][Z]}getDEMWorkerSource(R,F){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][F]||(this.demWorkerSources[R][F]=new me),this.demWorkerSources[R][F]}enforceCacheSizeLimit(R,F){l.enforceCacheSizeLimit(F)}}return l.isWorker()&&(self.worker=new os(self)),os}),c(["./shared"],function(l){var v=w;function w(m){return!function(s){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,x=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(x);try{_=new Worker(E),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(E),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var x=_.getImageData(0,0,1,1);return x&&x.width===p.width}()?(C[h=s&&s.failIfMajorPerformanceCaveat]===void 0&&(C[h]=function(p){var _,x=function(E){var A=document.createElement("canvas"),I=Object.create(w.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=E,A.getContext("webgl",I)||A.getContext("experimental-webgl",I)}(p);if(!x)return!1;try{_=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!_||x.isContextLost())&&(x.shaderSource(_,"void main() {}"),x.compileShader(_),x.getShaderParameter(_,x.COMPILE_STATUS)===!0)}(h)),C[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var h}(m)}var C={};function L(m,s){if(Array.isArray(m)){if(!Array.isArray(s)||m.length!==s.length)return!1;for(let h=0;h<m.length;h++)if(!L(m[h],s[h]))return!1;return!0}if(typeof m=="object"&&m!==null&&s!==null){if(typeof s!="object"||Object.keys(m).length!==Object.keys(s).length)return!1;for(const h in m)if(!L(m[h],s[h]))return!1;return!0}return m===s}w.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class P{static testProp(s){if(!P.docStyle)return s[0];for(let h=0;h<s.length;h++)if(s[h]in P.docStyle)return s[h];return s[0]}static create(s,h,p){const _=window.document.createElement(s);return h!==void 0&&(_.className=h),p&&p.appendChild(_),_}static createNS(s,h){return window.document.createElementNS(s,h)}static disableDrag(){P.docStyle&&P.selectProp&&(P.userSelect=P.docStyle[P.selectProp],P.docStyle[P.selectProp]="none")}static enableDrag(){P.docStyle&&P.selectProp&&(P.docStyle[P.selectProp]=P.userSelect)}static setTransform(s,h){s.style[P.transformProp]=h}static addEventListener(s,h,p,_={}){s.addEventListener(h,p,"passive"in _?_:_.capture)}static removeEventListener(s,h,p,_={}){s.removeEventListener(h,p,"passive"in _?_:_.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",P.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",P.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",P.suppressClickInternal,!0)},0)}static mousePos(s,h){const p=s.getBoundingClientRect();return new l.pointGeometry(h.clientX-p.left-s.clientLeft,h.clientY-p.top-s.clientTop)}static touchPos(s,h){const p=s.getBoundingClientRect(),_=[];for(let x=0;x<h.length;x++)_.push(new l.pointGeometry(h[x].clientX-p.left-s.clientLeft,h[x].clientY-p.top-s.clientTop));return _}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}P.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,P.selectProp=P.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),P.transformProp=P.testProp(["transform","WebkitTransform"]);class N{constructor(s){this._transformRequestFn=s}transformRequest(s,h){return this._transformRequestFn&&this._transformRequestFn(s,h)||{url:s}}normalizeSpriteURL(s,h,p){const _=function(x){const E=x.match(X);if(!E)throw new Error(`Unable to parse URL "${x}"`);return{protocol:E[1],authority:E[2],path:E[3]||"/",params:E[4]?E[4].split("&"):[]}}(s);return _.path+=`${h}${p}`,function(x){const E=x.params.length?`?${x.params.join("&")}`:"";return`${x.protocol}://${x.authority}${x.path}${E}`}(_)}setTransformRequest(s){this._transformRequestFn=s}}const X=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class ee{constructor(s,h,p,_){this.context=s,this.format=p,this.texture=s.gl.createTexture(),this.update(h,_)}update(s,h,p){const{width:_,height:x}=s,E=!(this.size&&this.size[0]===_&&this.size[1]===x||p),{context:A}=this,{gl:I}=A;if(this.useMipmap=!!(h&&h.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!h||h.premultiply!==!1)),E)this.size=[_,x],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||l.isImageBitmap(s)?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,s):I.texImage2D(I.TEXTURE_2D,0,this.format,_,x,0,this.format,I.UNSIGNED_BYTE,s.data);else{const{x:k,y:z}=p||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||l.isImageBitmap(s)?I.texSubImage2D(I.TEXTURE_2D,0,k,z,I.RGBA,I.UNSIGNED_BYTE,s):I.texSubImage2D(I.TEXTURE_2D,0,k,z,_,x,I.RGBA,I.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)}bind(s,h,p){const{context:_}=this,{gl:x}=_;x.bindTexture(x.TEXTURE_2D,this.texture),p!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=x.LINEAR),s!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,s),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,p||s),this.filter=s),h!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,h),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function me(m){const{userImage:s}=m;return!!(s&&s.render&&s.render())&&(m.data.replace(new Uint8Array(s.data.buffer)),!0)}class Y extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:h,callback:p}of this.requestors)this._notify(h,p);this.requestors=[]}}getImage(s){return this.images[s]}addImage(s,h){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,h)&&(this.images[s]=h)}_validate(s,h){let p=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${s}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${s}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new l.ErrorEvent(new Error(`Image "${s}" has invalid "content" value`))),p=!1),p}_validateStretch(s,h){if(!s)return!0;let p=0;for(const _ of s){if(_[0]<p||_[1]<_[0]||h<_[1])return!1;p=_[1]}return!0}_validateContent(s,h){return!(s&&(s.length!==4||s[0]<0||h.data.width<s[0]||s[1]<0||h.data.height<s[1]||s[2]<0||h.data.width<s[2]||s[3]<0||h.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,h){const p=this.images[s];if(p.data.width!==h.data.width||p.data.height!==h.data.height)throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=p.version+1,this.images[s]=h,this.updatedImages[s]=!0}removeImage(s){const h=this.images[s];delete this.images[s],delete this.patterns[s],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,h){let p=!0;if(!this.isLoaded())for(const _ of s)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(s,h):this.requestors.push({ids:s,callback:h})}_notify(s,h){const p={};for(const _ of s){this.images[_]||this.fire(new l.Event("styleimagemissing",{id:_}));const x=this.images[_];x?p[_]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:l.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,p)}getPixelSize(){const{width:s,height:h}=this.atlasImage;return{width:s,height:h}}getPattern(s){const h=this.patterns[s],p=this.getImage(s);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},x=new l.ImagePosition(_,p);this.patterns[s]={bin:_,position:x}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const h=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ee(s,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const x in this.patterns)s.push(this.patterns[x].bin);const{w:h,h:p}=l.potpack(s),_=this.atlasImage;_.resize({width:h||1,height:p||1});for(const x in this.patterns){const{bin:E}=this.patterns[x],A=E.x+1,I=E.y+1,k=this.images[x].data,z=k.width,B=k.height;l.RGBAImage.copy(k,_,{x:0,y:0},{x:A,y:I},{width:z,height:B}),l.RGBAImage.copy(k,_,{x:0,y:B-1},{x:A,y:I-1},{width:z,height:1}),l.RGBAImage.copy(k,_,{x:0,y:0},{x:A,y:I+B},{width:z,height:1}),l.RGBAImage.copy(k,_,{x:z-1,y:0},{x:A-1,y:I},{width:1,height:B}),l.RGBAImage.copy(k,_,{x:0,y:0},{x:A+z,y:I},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const h of s){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.images[h];p||l.warnOnce(`Image with ID: "${h}" was not found`),me(p)&&this.updateImage(h,p)}}}const W=1e20;function q(m,s,h,p,_,x,E,A,I){for(let k=s;k<s+p;k++)oe(m,h*x+k,x,_,E,A,I);for(let k=h;k<h+_;k++)oe(m,k*x+s,1,p,E,A,I)}function oe(m,s,h,p,_,x,E){x[0]=0,E[0]=-W,E[1]=W,_[0]=m[s];for(let A=1,I=0,k=0;A<p;A++){_[A]=m[s+A*h];const z=A*A;do{const B=x[I];k=(_[A]-_[B]+z-B*B)/(A-B)/2}while(k<=E[I]&&--I>-1);I++,x[I]=A,E[I]=k,E[I+1]=W}for(let A=0,I=0;A<p;A++){for(;E[I+1]<A;)I++;const k=x[I],z=A-k;m[s+A*h]=_[k]+z*z}}class ye{constructor(s,h){this.requestManager=s,this.localIdeographFontFamily=h,this.entries={}}setURL(s){this.url=s}getGlyphs(s,h){const p=[];for(const _ in s)for(const x of s[_])p.push({stack:_,id:x});l.asyncAll(p,({stack:_,id:x},E)=>{let A=this.entries[_];A||(A=this.entries[_]={glyphs:{},requests:{},ranges:{}});let I=A.glyphs[x];if(I!==void 0)return void E(null,{stack:_,id:x,glyph:I});if(I=this._tinySDF(A,_,x),I)return A.glyphs[x]=I,void E(null,{stack:_,id:x,glyph:I});const k=Math.floor(x/256);if(256*k>65535)return void E(new Error("glyphs > 65535 not supported"));if(A.ranges[k])return void E(null,{stack:_,id:x,glyph:I});let z=A.requests[k];z||(z=A.requests[k]=[],ye.loadGlyphRange(_,k,this.url,this.requestManager,(B,j)=>{if(j){for(const ie in j)this._doesCharSupportLocalGlyph(+ie)||(A.glyphs[+ie]=j[+ie]);A.ranges[k]=!0}for(const ie of z)ie(B,j);delete A.requests[k]})),z.push((B,j)=>{B?E(B):j&&E(null,{stack:_,id:x,glyph:j[x]||null})})},(_,x)=>{if(_)h(_);else if(x){const E={};for(const{stack:A,id:I,glyph:k}of x)(E[A]||(E[A]={}))[I]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics};h(null,E)}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(l.unicodeBlockLookup["CJK Unified Ideographs"](s)||l.unicodeBlockLookup["Hangul Syllables"](s)||l.unicodeBlockLookup.Hiragana(s)||l.unicodeBlockLookup.Katakana(s))}_tinySDF(s,h,p){const _=this.localIdeographFontFamily;if(!_||!this._doesCharSupportLocalGlyph(p))return;let x=s.tinySDF;if(!x){let A="400";/bold/i.test(h)?A="900":/medium/i.test(h)?A="500":/light/i.test(h)&&(A="200"),x=s.tinySDF=new ye.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:_,fontWeight:A})}const E=x.draw(String.fromCharCode(p));return{id:p,bitmap:new l.AlphaImage({width:E.width||30,height:E.height||30},E.data),metrics:{width:E.glyphWidth||24,height:E.glyphHeight||24,left:E.glyphLeft||0,top:E.glyphTop-27||-8,advance:E.glyphAdvance||24}}}}ye.loadGlyphRange=function(m,s,h,p,_){const x=256*s,E=x+255,A=p.transformRequest(h.replace("{fontstack}",m).replace("{range}",`${x}-${E}`),l.ResourceType.Glyphs);l.getArrayBuffer(A,(I,k)=>{if(I)_(I);else if(k){const z={};for(const B of l.parseGlyphPbf(k))z[B.id]=B;_(null,z)}})},ye.TinySDF=class{constructor({fontSize:m=24,buffer:s=3,radius:h=8,cutoff:p=.25,fontFamily:_="sans-serif",fontWeight:x="normal",fontStyle:E="normal"}={}){this.buffer=s,this.cutoff=p,this.radius=h;const A=this.size=m+4*s,I=this._createCanvas(A),k=this.ctx=I.getContext("2d",{willReadFrequently:!0});k.font=`${E} ${x} ${m}px ${_}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(m){const s=document.createElement("canvas");return s.width=s.height=m,s}draw(m){const{width:s,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:_,actualBoundingBoxRight:x}=this.ctx.measureText(m),E=Math.ceil(h),A=Math.min(this.size-this.buffer,Math.ceil(x-_)),I=Math.min(this.size-this.buffer,E+Math.ceil(p)),k=A+2*this.buffer,z=I+2*this.buffer,B=Math.max(k*z,0),j=new Uint8ClampedArray(B),ie={data:j,width:k,height:z,glyphWidth:A,glyphHeight:I,glyphTop:E,glyphLeft:0,glyphAdvance:s};if(A===0||I===0)return ie;const{ctx:te,buffer:ne,gridInner:de,gridOuter:ge}=this;te.clearRect(ne,ne,A,I),te.fillText(m,ne,ne+E);const xe=te.getImageData(ne,ne,A,I);ge.fill(W,0,B),de.fill(0,0,B);for(let re=0;re<I;re++)for(let Ee=0;Ee<A;Ee++){const be=xe.data[4*(re*A+Ee)+3]/255;if(be===0)continue;const Le=(re+ne)*k+Ee+ne;if(be===1)ge[Le]=0,de[Le]=W;else{const ke=.5-be;ge[Le]=ke>0?ke*ke:0,de[Le]=ke<0?ke*ke:0}}q(ge,0,0,k,z,k,this.f,this.v,this.z),q(de,ne,ne,A,I,k,this.f,this.v,this.z);for(let re=0;re<B;re++){const Ee=Math.sqrt(ge[re])-Math.sqrt(de[re]);j[re]=Math.round(255-255*(Ee/this.radius+this.cutoff))}return ie}};const Se=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(m,s){return l.sphericalToCartesian(m.expression.evaluate(s))}interpolate(m,s,h){return{x:l.number(m.x,s.x,h),y:l.number(m.y,s.y,h),z:l.number(m.z,s.z,h)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)}),Oe="-transition";class Fe extends l.Evented{constructor(s){super(),this._transitionable=new l.Transitionable(Se),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h={}){if(!this._validate(l.validateLight,s,h))for(const p in s){const _=s[p];p.endsWith(Oe)?this._transitionable.setTransition(p.slice(0,-Oe.length),_):this._transitionable.setValue(p,_)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,p){return(!p||p.validate!==!1)&&l.emitValidationErrors(this,s.call(l.validateStyle,l.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class Ve{constructor(s,h){this.width=s,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,h){const p=s.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(s,h)),this.dashEntry[p]}getDashRanges(s,h,p){const _=[];let x=s.length%2==1?-s[s.length-1]*p:0,E=s[0]*p,A=!0;_.push({left:x,right:E,isDash:A,zeroLength:s[0]===0});let I=s[0];for(let k=1;k<s.length;k++){A=!A;const z=s[k];x=I*p,I+=z,E=I*p,_.push({left:x,right:E,isDash:A,zeroLength:z===0})}return _}addRoundDash(s,h,p){const _=h/2;for(let x=-p;x<=p;x++){const E=this.width*(this.nextRow+p+x);let A=0,I=s[A];for(let k=0;k<this.width;k++){k/I.right>1&&(I=s[++A]);const z=Math.abs(k-I.left),B=Math.abs(k-I.right),j=Math.min(z,B);let ie;const te=x/p*(_+1);if(I.isDash){const ne=_-Math.abs(te);ie=Math.sqrt(j*j+ne*ne)}else ie=_-Math.sqrt(j*j+te*te);this.data[E+k]=Math.max(0,Math.min(255,ie+128))}}}addRegularDash(s){for(let A=s.length-1;A>=0;--A){const I=s[A],k=s[A+1];I.zeroLength?s.splice(A,1):k&&k.isDash===I.isDash&&(k.left=I.left,s.splice(A,1))}const h=s[0],p=s[s.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const _=this.width*this.nextRow;let x=0,E=s[x];for(let A=0;A<this.width;A++){A/E.right>1&&(E=s[++x]);const I=Math.abs(A-E.left),k=Math.abs(A-E.right),z=Math.min(I,k);this.data[_+A]=Math.max(0,Math.min(255,(E.isDash?z:-z)+128))}}addDash(s,h){const p=h?7:0,_=2*p+1;if(this.nextRow+_>this.height)return l.warnOnce("LineAtlas out of space"),null;let x=0;for(let A=0;A<s.length;A++)x+=s[A];if(x!==0){const A=this.width/x,I=this.getDashRanges(s,this.width,A);h?this.addRoundDash(I,A,p):this.addRegularDash(I)}const E={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:x};return this.nextRow+=_,this.dirty=!0,E}bind(s){const h=s.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}class je{constructor(s,h){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const x=new je.Actor(p[_],h,this.id);x.name=`Worker ${_}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,h,p){l.asyncAll(this.actors,(_,x)=>{_.send(s,h,x)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}function ut(m,s,h){const p=function(_,x){if(_)return h(_);if(x){const E=l.pick(l.extend(x,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(E.vectorLayers=x.vector_layers,E.vectorLayerIds=E.vectorLayers.map(A=>A.id)),h(null,E)}};return m.url?l.getJSON(s.transformRequest(m.url,l.ResourceType.Source),p):l.exported.frame(()=>p(null,m))}je.Actor=l.Actor;class Gt{constructor(s,h,p){this.bounds=l.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const h=Math.pow(2,s.z),p=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*h),_=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*h),x=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*h),E=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*h);return s.x>=p&&s.x<x&&s.y>=_&&s.y<E}}class Yt extends l.Evented{constructor(s,h,p,_){if(super(),this.id=s,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(h,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_)}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ut(this._options,this.map._requestManager,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),s?this.fire(new l.ErrorEvent(s)):h&&(l.extend(this,h),h.bounds&&(this.tileBounds=new Gt(h.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.cancel(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}loadTile(s,h){const p=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(p,l.ResourceType.Tile),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function x(E,A){return delete s.request,s.aborted?h(null):E&&E.status!==404?h(E):(A&&A.resourceTiming&&(s.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&s.setExpiryData(A),s.loadVectorData(A,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}_.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired"?s.state==="loading"?s.reloadCallback=h:s.request=s.actor.send("reloadTile",_,x.bind(this)):(s.actor=this.dispatcher.getActor(),s.request=s.actor.send("loadTile",_,x.bind(this)))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id},void 0)}unloadTile(s){s.unloadVectorData(),s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Mt extends l.Evented{constructor(s,h,p,_){super(),this.id=s,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},h),l.extend(this,l.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ut(this._options,this.map._requestManager,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new l.ErrorEvent(s)):h&&(l.extend(this,h),h.bounds&&(this.tileBounds=new Gt(h.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){const p=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.request=l.getImage(this.map._requestManager.transformRequest(p,l.ResourceType.Tile),(_,x,E)=>{if(delete s.request,s.aborted)s.state="unloaded",h(null);else if(_)s.state="errored",h(_);else if(x){this.map._refreshExpiredTiles&&s.setExpiryData(E);const A=this.map.painter.context,I=A.gl;s.texture=this.map.painter.getTileTexture(x.width),s.texture?s.texture.update(x,{useMipmap:!0}):(s.texture=new ee(A,x,I.RGBA,{useMipmap:!0}),s.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),A.extTextureFilterAnisotropic&&I.texParameterf(I.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax)),s.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),h(null)}})}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h()}unloadTile(s,h){s.texture&&this.map.painter.saveTileTexture(s.texture),h()}hasTransition(){return!1}}let zn;class vt extends Mt{constructor(s,h,p,_){super(s,h,p,_),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(s,h){const p=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function _(x,E){x&&(s.state="errored",h(x)),E&&(s.dem=E,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded",h(null))}s.request=l.getImage(this.map._requestManager.transformRequest(p,l.ResourceType.Tile),(function(x,E){if(delete s.request,s.aborted)s.state="unloaded",h(null);else if(x)s.state="errored",h(x);else if(E){this.map._refreshExpiredTiles&&s.setExpiryData(E),delete E.cacheControl,delete E.expires;const A=l.isImageBitmap(E)&&(zn==null&&(zn=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),zn)?E:l.exported.getImageData(E,1),I={uid:s.uid,coord:s.tileID,source:this.id,rawImageData:A,encoding:this.encoding};s.actor&&s.state!=="expired"||(s.actor=this.dispatcher.getActor(),s.actor.send("loadDEMTile",I,_.bind(this)))}}).bind(this)),s.neighboringTiles=this._getNeighboringTiles(s.tileID)}_getNeighboringTiles(s){const h=s.canonical,p=Math.pow(2,h.z),_=(h.x-1+p)%p,x=h.x===0?s.wrap-1:s.wrap,E=(h.x+1+p)%p,A=h.x+1===p?s.wrap+1:s.wrap,I={};return I[new l.OverscaledTileID(s.overscaledZ,x,h.z,_,h.y).key]={backfilled:!1},I[new l.OverscaledTileID(s.overscaledZ,A,h.z,E,h.y).key]={backfilled:!1},h.y>0&&(I[new l.OverscaledTileID(s.overscaledZ,x,h.z,_,h.y-1).key]={backfilled:!1},I[new l.OverscaledTileID(s.overscaledZ,s.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},I[new l.OverscaledTileID(s.overscaledZ,A,h.z,E,h.y-1).key]={backfilled:!1}),h.y+1<p&&(I[new l.OverscaledTileID(s.overscaledZ,x,h.z,_,h.y+1).key]={backfilled:!1},I[new l.OverscaledTileID(s.overscaledZ,s.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},I[new l.OverscaledTileID(s.overscaledZ,A,h.z,E,h.y+1).key]={backfilled:!1}),I}unloadTile(s){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&s.actor.send("removeDEMTile",{uid:s.uid,source:this.id})}}class ii extends l.Evented{constructor(s,h,p,_){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(_),this._data=h.data,this._options=l.extend({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const x=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*x,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*x,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:l.EXTENT,radius:(h.clusterRadius||50)*x,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData("content"),this}getClusterExpansionZoom(s,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:s,source:this.id},h),this}getClusterChildren(s,h){return this.actor.send("geojson.getClusterChildren",{clusterId:s,source:this.id},h),this}getClusterLeaves(s,h,p,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:s,limit:h,offset:p},_),this}_updateWorkerData(s){const h=l.extend({},this.workerOptions),p=this._data;typeof p=="string"?(h.request=this.map._requestManager.transformRequest(l.exported.resolveURL(p),l.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(p),this._pendingLoads++,this.fire(new l.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,h,(_,x)=>{if(this._pendingLoads--,this._removed||x&&x.abandoned)return void this.fire(new l.Event("dataabort",{dataType:"source",sourceDataType:s}));let E=null;if(x&&x.resourceTiming&&x.resourceTiming[this.id]&&(E=x.resourceTiming[this.id].slice(0)),_)return void this.fire(new l.ErrorEvent(_));const A={dataType:"source",sourceDataType:s};this._collectResourceTiming&&E&&E.length>0&&l.extend(A,{resourceTiming:E}),this.fire(new l.Event("data",A))})}loaded(){return this._pendingLoads===0}loadTile(s,h){const p=s.actor?"reloadTile":"loadTile";s.actor=this.actor;const _={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.request=this.actor.send(p,_,(x,E)=>(delete s.request,s.unloadVectorData(),s.aborted?h(null):x?h(x):(s.loadVectorData(E,this.map.painter,p==="reloadTile"),h(null))))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.aborted=!0}unloadTile(s){s.unloadVectorData(),this.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var tt=l.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class wt extends l.Evented{constructor(s,h,p,_){super(),this.id=s,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=h}load(s,h){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(p,_)=>{this._loaded=!0,p?this.fire(new l.ErrorEvent(p)):_&&(this.image=_,s&&(this.coordinates=s),h&&h(),this._finishLoading())})}loaded(){return this._loaded}updateImage(s){return this.image&&s.url?(this.options.url=s.url,this.load(s.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}setCoordinates(s){this.coordinates=s;const h=s.map(l.MercatorCoordinate.fromLngLat);this.tileID=function(_){let x=1/0,E=1/0,A=-1/0,I=-1/0;for(const j of _)x=Math.min(x,j.x),E=Math.min(E,j.y),A=Math.max(A,j.x),I=Math.max(I,j.y);const k=Math.max(A-x,I-E),z=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),B=Math.pow(2,z);return new l.CanonicalTileID(z,Math.floor((x+A)/2*B),Math.floor((E+I)/2*B))}(h),this.minzoom=this.maxzoom=this.tileID.z;const p=h.map(_=>this.tileID.getTilePoint(_)._round());return this._boundsArray=new l.RasterBoundsArray,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,l.EXTENT,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,l.EXTENT),this._boundsArray.emplaceBack(p[2].x,p[2].y,l.EXTENT,l.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,h=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ee(s,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}loadTile(s,h){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},h(null)):(s.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class St extends wt{constructor(s,h,p,_){super(s,h,p,_),this.roundZoom=!0,this.type="video",this.options=h}load(){this._loaded=!1;const s=this.options;this.urls=[];for(const h of s.urls)this.urls.push(this.map._requestManager.transformRequest(h,l.ResourceType.Source).url);l.getVideo(this.urls,(h,p)=>{this._loaded=!0,h?this.fire(new l.ErrorEvent(h)):p&&(this.video=p,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const h=this.video.seekable;s<h.start(0)||s>h.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const s=this.map.painter.context,h=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new ee(s,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class nn extends wt{constructor(s,h,p,_){super(s,h,p,_),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(E=>typeof E!="number"))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${s}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${s}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,p=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ee(h,this.canvas,p.RGBA,{premultiply:!0});for(const _ in this.tiles){const x=this.tiles[_];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const rn={vector:Yt,raster:Mt,"raster-dem":vt,geojson:ii,video:St,image:wt,canvas:nn};function nr(m,s){const h=l.create();return l.translate(h,h,[1,1,0]),l.scale(h,h,[.5*m.width,.5*m.height,1]),l.multiply(h,h,m.calculatePosMatrix(s.toUnwrapped()))}function ri(m,s,h,p,_,x){const E=function(B,j,ie){if(B)for(const te of B){const ne=j[te];if(ne&&ne.source===ie&&ne.type==="fill-extrusion")return!0}else for(const te in j){const ne=j[te];if(ne.source===ie&&ne.type==="fill-extrusion")return!0}return!1}(_&&_.layers,s,m.id),A=x.maxPitchScaleFactor(),I=m.tilesIn(p,A,E);I.sort(bi);const k=[];for(const B of I)k.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(s,h,m._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,_,x,A,nr(m.transform,B.tileID))});const z=function(B){const j={},ie={};for(const te of B){const ne=te.queryResults,de=te.wrappedTileID,ge=ie[de]=ie[de]||{};for(const xe in ne){const re=ne[xe],Ee=ge[xe]=ge[xe]||{},be=j[xe]=j[xe]||[];for(const Le of re)Ee[Le.featureIndex]||(Ee[Le.featureIndex]=!0,be.push(Le))}}return j}(k);for(const B in z)z[B].forEach(j=>{const ie=j.feature,te=m.getFeatureState(ie.layer["source-layer"],ie.id);ie.source=ie.layer.source,ie.layer["source-layer"]&&(ie.sourceLayer=ie.layer["source-layer"]),ie.state=te});return z}function bi(m,s){const h=m.tileID,p=s.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}class si{constructor(s,h){this.tileID=s,this.uid=l.uniqueId(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const h=s+this.timeAdded;h<l.exported.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.textures.forEach(h=>s.saveTileTexture(h)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(s,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(_,x){const E={};if(!x)return E;for(const A of _){const I=A.layerIds.map(k=>x.getLayer(k)).filter(Boolean);if(I.length!==0){A.layers=I,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map(k=>I.filter(z=>z.id===k)[0]));for(const k of I)E[k.id]=A}}return E}(s.buckets,h.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof l.SymbolBucket){if(this.hasSymbolBuckets=!0,!p)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof l.SymbolBucket&&x.hasRTLText){this.hasRTLText=!0,l.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const _ in this.buckets){const x=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(_).queryRadius(x))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new l.CollisionBoxArray}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const p in this.buckets){const _=this.buckets[p];_.uploadPending()&&_.upload(s)}const h=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ee(s,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ee(s,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,h,p,_,x,E,A,I,k,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:x,scale:E,tileSize:this.tileSize,pixelPosMatrix:z,transform:I,params:A,queryPadding:this.queryPadding*k},s,h,p):{}}querySourceFeatures(s,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const _=p.loadVTLayers(),x=h?h.sourceLayer:"",E=_._geojsonTileLayer||_[x];if(!E)return;const A=l.createFilter(h&&h.filter),{z:I,x:k,y:z}=this.tileID.canonical,B={z:I,x:k,y:z};for(let j=0;j<E.length;j++){const ie=E.feature(j);if(A.needGeometry){const de=l.toEvaluationFeature(ie,!0);if(!A.filter(new l.EvaluationParameters(this.tileID.overscaledZ),de,this.tileID.canonical))continue}else if(!A.filter(new l.EvaluationParameters(this.tileID.overscaledZ),ie))continue;const te=p.getId(ie,x),ne=new l.GeoJSONFeature(ie,I,k,z,te);ne.tile=B,s.push(ne)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const h=this.expirationTime;if(s.cacheControl){const p=l.parseCacheControl(s.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const p=Date.now();let _=!1;if(this.expirationTime>p)_=!1;else if(h)if(this.expirationTime<h)_=!0;else{const x=this.expirationTime-h;x?this.expirationTime=p+Math.max(x,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const _ in this.buckets){if(!h.style.hasLayer(_))continue;const x=this.buckets[_],E=x.layers[0].sourceLayer||"_geojsonTileLayer",A=p[E],I=s[E];if(!A||!I||Object.keys(I).length===0)continue;x.update(I,A,this.imageAtlas&&this.imageAtlas.patternPositions||{});const k=h&&h.style&&h.style.getLayer(_);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=l.exported.now()+s}setDependencies(s,h){const p={};for(const _ of h)p[_]=!0;this.dependencies[s]=p}hasDependency(s,h){for(const p of s){const _=this.dependencies[p];if(_){for(const x of h)if(_[x])return!0}}return!1}}class cn{constructor(s,h){this.max=s,this.onRemove=h,this.reset()}reset(){for(const s in this.data)for(const h of this.data[s])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(s,h,p){const _=s.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const x={value:h,timeout:void 0};if(p!==void 0&&(x.timeout=setTimeout(()=>{this.remove(s,x)},p)),this.data[_].push(x),this.order.push(_),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const h=this.data[s].shift();return h.timeout&&clearTimeout(h.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),h.value}getByKey(s){const h=this.data[s];return h?h[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,h){if(!this.has(s))return this;const p=s.wrapped().key,_=h===void 0?0:this.data[p].indexOf(h),x=this.data[p][_];return this.data[p].splice(_,1),x.timeout&&clearTimeout(x.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(x.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(s){const h=[];for(const p in this.data)for(const _ of this.data[p])s(_.value)||h.push(_);for(const p of h)this.remove(p.value.tileID,p)}}class wi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,h,p){const _=String(h);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][_]=this.stateChanges[s][_]||{},l.extend(this.stateChanges[s][_],p),this.deletedStates[s]===null){this.deletedStates[s]={};for(const x in this.state[s])x!==_&&(this.deletedStates[s][x]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][_]===null){this.deletedStates[s][_]={};for(const x in this.state[s][_])p[x]||(this.deletedStates[s][_][x]=null)}else for(const x in p)this.deletedStates[s]&&this.deletedStates[s][_]&&this.deletedStates[s][_][x]===null&&delete this.deletedStates[s][_][x]}removeFeatureState(s,h,p){if(this.deletedStates[s]===null)return;const _=String(h);if(this.deletedStates[s]=this.deletedStates[s]||{},p&&h!==void 0)this.deletedStates[s][_]!==null&&(this.deletedStates[s][_]=this.deletedStates[s][_]||{},this.deletedStates[s][_][p]=null);else if(h!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][_])for(p in this.deletedStates[s][_]={},this.stateChanges[s][_])this.deletedStates[s][_][p]=null;else this.deletedStates[s][_]=null;else this.deletedStates[s]=null}getState(s,h){const p=String(h),_=l.extend({},(this.state[s]||{})[p],(this.stateChanges[s]||{})[p]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const x=this.deletedStates[s][h];if(x===null)return{};for(const E in x)delete _[E]}return _}initializeTileState(s,h){s.setFeatureState(this.state,h)}coalesceChanges(s,h){const p={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const x={};for(const E in this.stateChanges[_])this.state[_][E]||(this.state[_][E]={}),l.extend(this.state[_][E],this.stateChanges[_][E]),x[E]=this.state[_][E];p[_]=x}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const x={};if(this.deletedStates[_]===null)for(const E in this.state[_])x[E]={},this.state[_][E]={};else for(const E in this.deletedStates[_]){if(this.deletedStates[_][E]===null)this.state[_][E]={};else for(const A of Object.keys(this.deletedStates[_][E]))delete this.state[_][E][A];x[E]=this.state[_][E]}p[_]=p[_]||{},l.extend(p[_],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const _ in s)s[_].setFeatureState(p,h)}}class Wt extends l.Evented{constructor(s,h,p){super(),this.id=s,this.dispatcher=p,this.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(_,x,E,A){const I=new rn[x.type](_,x,E,A);if(I.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${I.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],I),I}(s,h,p,this),this._tiles={},this._cache=new cn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new wi}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles){const h=this._tiles[s];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,h){return this._source.loadTile(s,h)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s,()=>{})}_abortTile(s){this._source.abortTile&&this._source.abortTile(s,()=>{}),this._source.fire(new l.Event("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(s),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(On).map(s=>s.key)}getRenderableIds(s){const h=[];for(const p in this._tiles)this._isIdRenderable(p,s)&&h.push(this._tiles[p]);return s?h.sort((p,_)=>{const x=p.tileID,E=_.tileID,A=new l.pointGeometry(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),I=new l.pointGeometry(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-E.overscaledZ||I.y-A.y||I.x-A.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(On).map(p=>p.key)}hasRenderableParent(s){const h=this.findLoadedParent(s,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(s,h){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(h||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(s,h){const p=this._tiles[s];p&&(p.state!=="loading"&&(p.state=h),this._loadTile(p,this._tileLoaded.bind(this,p,s,h)))}_tileLoaded(s,h,p,_){if(_)return s.state="errored",void(_.status!==404?this._source.fire(new l.ErrorEvent(_,{tile:s})):this.update(this.transform,this.terrain));s.timeAdded=l.exported.now(),p==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(h,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new l.Event("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const h=this.getRenderableIds();for(let _=0;_<h.length;_++){const x=h[_];if(s.neighboringTiles&&s.neighboringTiles[x]){const E=this.getTileByID(x);p(s,E),p(E,s)}}function p(_,x){_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let E=x.tileID.canonical.x-_.tileID.canonical.x;const A=x.tileID.canonical.y-_.tileID.canonical.y,I=Math.pow(2,_.tileID.canonical.z),k=x.tileID.key;E===0&&A===0||Math.abs(A)>1||(Math.abs(E)>1&&(Math.abs(E+I)===1?E+=I:Math.abs(E-I)===1&&(E-=I)),x.dem&&_.dem&&(_.dem.backfillBorder(x.dem,E,A),_.neighboringTiles&&_.neighboringTiles[k]&&(_.neighboringTiles[k].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,h,p,_){for(const x in this._tiles){let E=this._tiles[x];if(_[x]||!E.hasData()||E.tileID.overscaledZ<=h||E.tileID.overscaledZ>p)continue;let A=E.tileID;for(;E&&E.tileID.overscaledZ>h+1;){const k=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[k.key],E&&E.hasData()&&(A=k)}let I=A;for(;I.overscaledZ>h;)if(I=I.scaledTo(I.overscaledZ-1),s[I.key]){_[A.key]=A;break}}}findLoadedParent(s,h){if(s.key in this._loadedParentTiles){const p=this._loadedParentTiles[s.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=s.overscaledZ-1;p>=h;p--){const _=s.scaledTo(p),x=this._getLoadedTile(_);if(x)return x}}_getLoadedTile(s){const h=this._tiles[s.key];return h&&h.hasData()?h:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const h=Math.ceil(s.width/this._source.tileSize)+1,p=Math.ceil(s.height/this._source.tileSize)+1,_=Math.floor(h*p*5),x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(s){const h=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,h){const p={};for(const _ in this._tiles){const x=this._tiles[_];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+h),p[x.tileID.key]=x}this._tiles=p;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(_,this._tiles[_])}}update(s,h){if(this.transform=s,this.terrain=h,!this._sourceLoaded||this._paused)return;let p;this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new l.OverscaledTileID(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y)):(p=s.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(p=p.filter(k=>this._source.hasTile(k)))):p=[];const _=s.coveringZoomLevel(this._source),x=Math.max(_-Wt.maxOverzooming,this._source.minzoom),E=Math.max(_+Wt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const k={};for(const z of p)if(z.canonical.z>this._source.minzoom){const B=z.scaledTo(z.canonical.z-1);k[B.key]=B;const j=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));k[j.key]=j}p=p.concat(Object.values(k))}const A=this._updateRetainedTiles(p,_);if(ns(this._source.type)){const k={},z={},B=Object.keys(A);for(const j of B){const ie=A[j],te=this._tiles[j];if(!te||te.fadeEndTime&&te.fadeEndTime<=l.exported.now())continue;const ne=this.findLoadedParent(ie,x);ne&&(this._addTile(ne.tileID),k[ne.tileID.key]=ne.tileID),z[j]=ie}this._retainLoadedChildren(z,_,E,A);for(const j in k)A[j]||(this._coveredTiles[j]=!0,A[j]=k[j]);if(h){const j={},ie={};for(const te of p)this._tiles[te.key].hasData()?j[te.key]=te:ie[te.key]=te;for(const te in ie){const ne=ie[te].children(this._source.maxzoom);this._tiles[ne[0].key]&&this._tiles[ne[1].key]&&this._tiles[ne[2].key]&&this._tiles[ne[3].key]&&(j[ne[0].key]=A[ne[0].key]=ne[0],j[ne[1].key]=A[ne[1].key]=ne[1],j[ne[2].key]=A[ne[2].key]=ne[2],j[ne[3].key]=A[ne[3].key]=ne[3],delete ie[te])}for(const te in ie){const ne=this.findLoadedParent(ie[te],this._source.minzoom);if(ne){j[ne.tileID.key]=A[ne.tileID.key]=ne.tileID;for(const de in j)j[de].isChildOf(ne.tileID)&&delete j[de]}}for(const te in this._tiles)j[te]||(this._coveredTiles[te]=!0)}}for(const k in A)this._tiles[k].clearFadeHold();const I=l.keysDifference(this._tiles,A);for(const k of I){const z=this._tiles[k];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(k)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,h){const p={},_={},x=Math.max(h-Wt.maxOverzooming,this._source.minzoom),E=Math.max(h+Wt.maxUnderzooming,this._source.minzoom),A={};for(const I of s){const k=this._addTile(I);p[I.key]=I,k.hasData()||h<this._source.maxzoom&&(A[I.key]=I)}this._retainLoadedChildren(A,h,E,p);for(const I of s){let k=this._tiles[I.key];if(k.hasData())continue;if(h+1>this._source.maxzoom){const B=I.children(this._source.maxzoom)[0],j=this.getTile(B);if(j&&j.hasData()){p[B.key]=B;continue}}else{const B=I.children(this._source.maxzoom);if(p[B[0].key]&&p[B[1].key]&&p[B[2].key]&&p[B[3].key])continue}let z=k.wasRequested();for(let B=I.overscaledZ-1;B>=x;--B){const j=I.scaledTo(B);if(_[j.key]||(_[j.key]=!0,k=this.getTile(j),!k&&z&&(k=this._addTile(j)),k&&(p[j.key]=j,z=k.wasRequested(),k.hasData())))break}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const h=[];let p,_=this._tiles[s].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){p=this._loadedParentTiles[_.key];break}h.push(_.key);const x=_.scaledTo(_.overscaledZ-1);if(p=this._getLoadedTile(x),p)break;_=x}for(const x of h)this._loadedParentTiles[x]=p}}_addTile(s){let h=this._tiles[s.key];if(h)return h;h=this._cache.getAndRemove(s),h&&(this._setTileReloadTimer(s.key,h),h.tileID=s,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,h)));const p=h;return h||(h=new si(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,s.key,h.state))),h.uses++,this._tiles[s.key]=h,p||this._source.fire(new l.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(s,h){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const p=h.getExpiryTimeout();p&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},p))}_removeTile(s){const h=this._tiles[s];h&&(h.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,h,p){const _=[],x=this.transform;if(!x)return _;const E=p?x.getCameraQueryGeometry(s):s,A=s.map(te=>x.pointCoordinate(te,this.terrain)),I=E.map(te=>x.pointCoordinate(te,this.terrain)),k=this.getIds();let z=1/0,B=1/0,j=-1/0,ie=-1/0;for(const te of I)z=Math.min(z,te.x),B=Math.min(B,te.y),j=Math.max(j,te.x),ie=Math.max(ie,te.y);for(let te=0;te<k.length;te++){const ne=this._tiles[k[te]];if(ne.holdingForFade())continue;const de=ne.tileID,ge=Math.pow(2,x.zoom-ne.tileID.overscaledZ),xe=h*ne.queryPadding*l.EXTENT/ne.tileSize/ge,re=[de.getTilePoint(new l.MercatorCoordinate(z,B)),de.getTilePoint(new l.MercatorCoordinate(j,ie))];if(re[0].x-xe<l.EXTENT&&re[0].y-xe<l.EXTENT&&re[1].x+xe>=0&&re[1].y+xe>=0){const Ee=A.map(Le=>de.getTilePoint(Le)),be=I.map(Le=>de.getTilePoint(Le));_.push({tile:ne,tileID:de,queryGeometry:Ee,cameraQueryGeometry:be,scale:ge})}}return _}getVisibleCoordinates(s){const h=this.getRenderableIds(s).map(p=>this._tiles[p].tileID);for(const p of h)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(ns(this._source.type))for(const s in this._tiles){const h=this._tiles[s];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=l.exported.now())return!0}return!1}setFeatureState(s,h,p){this._state.updateState(s=s||"_geojsonTileLayer",h,p)}removeFeatureState(s,h,p){this._state.removeFeatureState(s=s||"_geojsonTileLayer",h,p)}getFeatureState(s,h){return this._state.getState(s=s||"_geojsonTileLayer",h)}setDependencies(s,h,p){const _=this._tiles[s];_&&_.setDependencies(h,p)}reloadTilesForDependencies(s,h){for(const p in this._tiles)this._tiles[p].hasDependency(s,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(s,h))}}function On(m,s){const h=Math.abs(2*m.wrap)-+(m.wrap<0),p=Math.abs(2*s.wrap)-+(s.wrap<0);return m.overscaledZ-s.overscaledZ||p-h||s.canonical.y-m.canonical.y||s.canonical.x-m.canonical.x}function ns(m){return m==="raster"||m==="image"||m==="video"}Wt.maxOverzooming=10,Wt.maxUnderzooming=3;const Li="mapboxgl_preloaded_worker_pool";class Yn{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<Yn.workerCount;)this.workers.push(new Worker(Eo.workerUrl));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Li]}numActive(){return Object.keys(this.active).length}}const Lr=Math.floor(l.exported.hardwareConcurrency/2);let ji;function fi(){return ji||(ji=new Yn),ji}function Gi(m,s){const h={};for(const p in m)p!=="ref"&&(h[p]=m[p]);return l.refProperties.forEach(p=>{p in s&&(h[p]=s[p])}),h}function js(m){m=m.slice();const s=Object.create(null);for(let h=0;h<m.length;h++)s[m[h].id]=m[h];for(let h=0;h<m.length;h++)"ref"in m[h]&&(m[h]=Gi(m[h],s[m[h].ref]));return m}Yn.workerCount=Math.max(Math.min(Lr,6),1);const Vt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ki(m,s,h){h.push({command:Vt.addSource,args:[m,s[m]]})}function Fn(m,s,h){s.push({command:Vt.removeSource,args:[m]}),h[m]=!0}function is(m,s,h,p){Fn(m,h,p),ki(m,s,h)}function _o(m,s,h){let p;for(p in m[h])if(Object.prototype.hasOwnProperty.call(m[h],p)&&p!=="data"&&!L(m[h][p],s[h][p]))return!1;for(p in s[h])if(Object.prototype.hasOwnProperty.call(s[h],p)&&p!=="data"&&!L(m[h][p],s[h][p]))return!1;return!0}function kr(m,s,h,p,_,x){let E;for(E in s=s||{},m=m||{})Object.prototype.hasOwnProperty.call(m,E)&&(L(m[E],s[E])||h.push({command:x,args:[p,E,s[E],_]}));for(E in s)Object.prototype.hasOwnProperty.call(s,E)&&!Object.prototype.hasOwnProperty.call(m,E)&&(L(m[E],s[E])||h.push({command:x,args:[p,E,s[E],_]}))}function Rr(m){return m.id}function Gs(m,s){return m[s.id]=s,m}class vr{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=l.clamp(s,0,1);let h=1,p=this._distances[h];const _=s*this.paddedLength+this.padding;for(;p<_&&h<this._distances.length;)p=this._distances[++h];const x=h-1,E=this._distances[x],A=p-E,I=A>0?(_-E)/A:0;return this.points[x].mult(1-I).add(this.points[h].mult(I))}}function Me(m,s){let h=!0;return m==="always"||m!=="never"&&s!=="never"||(h=!1),h}class We{constructor(s,h,p){const _=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(s/p),this.yCellCount=Math.ceil(h/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)_.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,p,_,x){this._forEachCell(h,p,_,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(x)}insertCircle(s,h,p,_){this._forEachCell(h-_,p-_,h+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(p),this.circles.push(_)}_insertBoxCell(s,h,p,_,x,E){this.boxCells[x].push(E)}_insertCircleCell(s,h,p,_,x,E){this.circleCells[x].push(E)}_query(s,h,p,_,x,E,A){if(p<0||s>this.width||_<0||h>this.height)return[];const I=[];if(s<=0&&h<=0&&this.width<=p&&this.height<=_){if(x)return[{key:null,x1:s,y1:h,x2:p,y2:_}];for(let k=0;k<this.boxKeys.length;k++)I.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const z=this.circles[3*k],B=this.circles[3*k+1],j=this.circles[3*k+2];I.push({key:this.circleKeys[k],x1:z-j,y1:B-j,x2:z+j,y2:B+j})}}else this._forEachCell(s,h,p,_,this._queryCell,I,{hitTest:x,overlapMode:E,seenUids:{box:{},circle:{}}},A);return I}query(s,h,p,_){return this._query(s,h,p,_,!1,null)}hitTest(s,h,p,_,x,E){return this._query(s,h,p,_,!0,x,E).length>0}hitTestCircle(s,h,p,_,x){const E=s-p,A=s+p,I=h-p,k=h+p;if(A<0||E>this.width||k<0||I>this.height)return!1;const z=[];return this._forEachCell(E,I,A,k,this._queryCellCircle,z,{hitTest:!0,overlapMode:_,circle:{x:s,y:h,radius:p},seenUids:{box:{},circle:{}}},x),z.length>0}_queryCell(s,h,p,_,x,E,A,I){const{seenUids:k,hitTest:z,overlapMode:B}=A,j=this.boxCells[x];if(j!==null){const te=this.bboxes;for(const ne of j)if(!k.box[ne]){k.box[ne]=!0;const de=4*ne,ge=this.boxKeys[ne];if(s<=te[de+2]&&h<=te[de+3]&&p>=te[de+0]&&_>=te[de+1]&&(!I||I(ge))&&(!z||!Me(B,ge.overlapMode))&&(E.push({key:ge,x1:te[de],y1:te[de+1],x2:te[de+2],y2:te[de+3]}),z))return!0}}const ie=this.circleCells[x];if(ie!==null){const te=this.circles;for(const ne of ie)if(!k.circle[ne]){k.circle[ne]=!0;const de=3*ne,ge=this.circleKeys[ne];if(this._circleAndRectCollide(te[de],te[de+1],te[de+2],s,h,p,_)&&(!I||I(ge))&&(!z||!Me(B,ge.overlapMode))){const xe=te[de],re=te[de+1],Ee=te[de+2];if(E.push({key:ge,x1:xe-Ee,y1:re-Ee,x2:xe+Ee,y2:re+Ee}),z)return!0}}}return!1}_queryCellCircle(s,h,p,_,x,E,A,I){const{circle:k,seenUids:z,overlapMode:B}=A,j=this.boxCells[x];if(j!==null){const te=this.bboxes;for(const ne of j)if(!z.box[ne]){z.box[ne]=!0;const de=4*ne,ge=this.boxKeys[ne];if(this._circleAndRectCollide(k.x,k.y,k.radius,te[de+0],te[de+1],te[de+2],te[de+3])&&(!I||I(ge))&&!Me(B,ge.overlapMode))return E.push(!0),!0}}const ie=this.circleCells[x];if(ie!==null){const te=this.circles;for(const ne of ie)if(!z.circle[ne]){z.circle[ne]=!0;const de=3*ne,ge=this.circleKeys[ne];if(this._circlesCollide(te[de],te[de+1],te[de+2],k.x,k.y,k.radius)&&(!I||I(ge))&&!Me(B,ge.overlapMode))return E.push(!0),!0}}}_forEachCell(s,h,p,_,x,E,A,I){const k=this._convertToXCellCoord(s),z=this._convertToYCellCoord(h),B=this._convertToXCellCoord(p),j=this._convertToYCellCoord(_);for(let ie=k;ie<=B;ie++)for(let te=z;te<=j;te++)if(x.call(this,s,h,p,_,this.xCellCount*te+ie,E,A,I))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,p,_,x,E){const A=_-s,I=x-h,k=p+E;return k*k>A*A+I*I}_circleAndRectCollide(s,h,p,_,x,E,A){const I=(E-_)/2,k=Math.abs(s-(_+I));if(k>I+p)return!1;const z=(A-x)/2,B=Math.abs(h-(x+z));if(B>z+p)return!1;if(k<=I||B<=z)return!0;const j=k-I,ie=B-z;return j*j+ie*ie<=p*p}}function rs(m,s,h,p,_){const x=l.create();return s?(l.scale(x,x,[1/_,1/_,1]),h||l.rotateZ(x,x,p.angle)):l.multiply(x,p.labelPlaneMatrix,m),x}function Ei(m,s,h,p,_){if(s){const x=l.clone(m);return l.scale(x,x,[_,_,1]),h||l.rotateZ(x,x,-p.angle),x}return p.glCoordMatrix}function Bt(m,s,h){let p;h?(p=[m.x,m.y,h(m.x,m.y),1],l.transformMat4(p,p,s)):(p=[m.x,m.y,0,1],ir(p,p,s));const _=p[3];return{point:new l.pointGeometry(p[0]/_,p[1]/_),signedDistanceFromCamera:_}}function $i(m,s){return .5+m/s*.5}function Ri(m,s){const h=m[0]/m[3],p=m[1]/m[3];return h>=-s[0]&&h<=s[0]&&p>=-s[1]&&p<=s[1]}function Di(m,s,h,p,_,x,E,A,I,k){const z=p?m.textSizeData:m.iconSizeData,B=l.evaluateSizeForZoom(z,h.transform.zoom),j=[256/h.width*2+1,256/h.height*2+1],ie=p?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ie.clear();const te=m.lineVertexArray,ne=p?m.text.placedSymbolArray:m.icon.placedSymbolArray,de=h.transform.width/h.transform.height;let ge=!1;for(let xe=0;xe<ne.length;xe++){const re=ne.get(xe);if(re.hidden||re.writingMode===l.WritingMode.vertical&&!ge){At(re.numGlyphs,ie);continue}let Ee;if(ge=!1,k?(Ee=[re.anchorX,re.anchorY,k(re.anchorX,re.anchorY),1],l.transformMat4(Ee,Ee,s)):(Ee=[re.anchorX,re.anchorY,0,1],ir(Ee,Ee,s)),!Ri(Ee,j)){At(re.numGlyphs,ie);continue}const be=$i(h.transform.cameraToCenterDistance,Ee[3]),Le=l.evaluateSizeForFeature(z,B,re),ke=E?Le/be:Le*be,Be=new l.pointGeometry(re.anchorX,re.anchorY),Ce=Bt(Be,_,k).point,et={},qe=It(re,ke,!1,A,s,_,x,m.glyphOffsetArray,te,ie,Ce,Be,et,de,I,k);ge=qe.useVertical,(qe.notEnoughRoom||ge||qe.needsFlipping&&It(re,ke,!0,A,s,_,x,m.glyphOffsetArray,te,ie,Ce,Be,et,de,I,k).notEnoughRoom)&&At(re.numGlyphs,ie)}p?m.text.dynamicLayoutVertexBuffer.updateData(ie):m.icon.dynamicLayoutVertexBuffer.updateData(ie)}function ss(m,s,h,p,_,x,E,A,I,k,z,B,j){const ie=A.glyphStartIndex+A.numGlyphs,te=A.lineStartIndex,ne=A.lineStartIndex+A.lineLength,de=s.getoffsetX(A.glyphStartIndex),ge=s.getoffsetX(ie-1),xe=Kn(m*de,h,p,_,x,E,A.segment,te,ne,I,k,z,B,j);if(!xe)return null;const re=Kn(m*ge,h,p,_,x,E,A.segment,te,ne,I,k,z,B,j);return re?{first:xe,last:re}:null}function He(m,s,h,p){return m===l.WritingMode.horizontal&&Math.abs(h.y-s.y)>Math.abs(h.x-s.x)*p?{useVertical:!0}:(m===l.WritingMode.vertical?s.y<h.y:s.x>h.x)?{needsFlipping:!0}:null}function It(m,s,h,p,_,x,E,A,I,k,z,B,j,ie,te,ne){const de=s/24,ge=m.lineOffsetX*de,xe=m.lineOffsetY*de;let re;if(m.numGlyphs>1){const Ee=m.glyphStartIndex+m.numGlyphs,be=m.lineStartIndex,Le=m.lineStartIndex+m.lineLength,ke=ss(de,A,ge,xe,h,z,B,m,I,x,j,te,ne);if(!ke)return{notEnoughRoom:!0};const Be=Bt(ke.first.point,E,ne).point,Ce=Bt(ke.last.point,E,ne).point;if(p&&!h){const et=He(m.writingMode,Be,Ce,ie);if(et)return et}re=[ke.first];for(let et=m.glyphStartIndex+1;et<Ee-1;et++)re.push(Kn(de*A.getoffsetX(et),ge,xe,h,z,B,m.segment,be,Le,I,x,j,te,ne));re.push(ke.last)}else{if(p&&!h){const be=Bt(B,_,ne).point,Le=m.lineStartIndex+m.segment+1,ke=new l.pointGeometry(I.getx(Le),I.gety(Le)),Be=Bt(ke,_,ne),Ce=Be.signedDistanceFromCamera>0?Be.point:Pt(B,ke,be,1,_,ne),et=He(m.writingMode,be,Ce,ie);if(et)return et}const Ee=Kn(de*A.getoffsetX(m.glyphStartIndex),ge,xe,h,z,B,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,I,x,j,te,ne);if(!Ee)return{notEnoughRoom:!0};re=[Ee]}for(const Ee of re)l.addDynamicAttributes(k,Ee.point,Ee.angle);return{}}function Pt(m,s,h,p,_,x){const E=Bt(m.add(m.sub(s)._unit()),_,x).point,A=h.sub(E);return h.add(A._mult(p/A.mag()))}function Kn(m,s,h,p,_,x,E,A,I,k,z,B,j,ie){const te=p?m-s:m+s;let ne=te>0?1:-1,de=0;p&&(ne*=-1,de=Math.PI),ne<0&&(de+=Math.PI);let ge=ne>0?A+E:A+E+1,xe=_,re=_,Ee=0,be=0;const Le=Math.abs(te),ke=[];for(;Ee+be<=Le;){if(ge+=ne,ge<A||ge>=I)return null;if(re=xe,ke.push(xe),xe=B[ge],xe===void 0){const nt=new l.pointGeometry(k.getx(ge),k.gety(ge)),Ct=Bt(nt,z,ie);if(Ct.signedDistanceFromCamera>0)xe=B[ge]=Ct.point;else{const Rt=ge-ne;xe=Pt(Ee===0?x:new l.pointGeometry(k.getx(Rt),k.gety(Rt)),nt,re,Le-Ee+1,z,ie)}}Ee+=be,be=re.dist(xe)}const Be=(Le-Ee)/be,Ce=xe.sub(re),et=Ce.mult(Be)._add(re);et._add(Ce._unit()._perp()._mult(h*ne));const qe=de+Math.atan2(xe.y-re.y,xe.x-re.x);return ke.push(et),{point:et,angle:j?qe:0,path:ke}}const Dr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function At(m,s){for(let h=0;h<m;h++){const p=s.length;s.resize(p+4),s.float32.set(Dr,3*p)}}function ir(m,s,h){const p=s[0],_=s[1];return m[0]=h[0]*p+h[4]*_+h[12],m[1]=h[1]*p+h[5]*_+h[13],m[3]=h[3]*p+h[7]*_+h[15],m}const $n=100;class $s{constructor(s,h=new We(s.width+200,s.height+200,25),p=new We(s.width+200,s.height+200,25)){this.transform=s,this.grid=h,this.ignoredGrid=p,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+$n,this.screenBottomBoundary=s.height+$n,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,h,p,_,x,E){const A=this.projectAndGetPerspectiveRatio(_,s.anchorPointX,s.anchorPointY,E),I=p*A.perspectiveRatio,k=s.x1*I+A.point.x,z=s.y1*I+A.point.y,B=s.x2*I+A.point.x,j=s.y2*I+A.point.y;return!this.isInsideGrid(k,z,B,j)||h!=="always"&&this.grid.hitTest(k,z,B,j,h,x)||A.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[k,z,B,j],offscreen:this.isOffscreen(k,z,B,j)}}placeCollisionCircles(s,h,p,_,x,E,A,I,k,z,B,j,ie,te){const ne=[],de=new l.pointGeometry(h.anchorX,h.anchorY),ge=Bt(de,E,te),xe=$i(this.transform.cameraToCenterDistance,ge.signedDistanceFromCamera),re=(z?x/xe:x*xe)/l.ONE_EM,Ee=Bt(de,A,te).point,be=ss(re,_,h.lineOffsetX*re,h.lineOffsetY*re,!1,Ee,de,h,p,A,{},!1,te);let Le=!1,ke=!1,Be=!0;if(be){const Ce=.5*j*xe+ie,et=new l.pointGeometry(-100,-100),qe=new l.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),nt=new vr,Ct=be.first,Rt=be.last;let _t=[];for(let $t=Ct.path.length-1;$t>=1;$t--)_t.push(Ct.path[$t]);for(let $t=1;$t<Rt.path.length;$t++)_t.push(Rt.path[$t]);const sn=2.5*Ce;if(I){const $t=_t.map(Ht=>Bt(Ht,I,te));_t=$t.some(Ht=>Ht.signedDistanceFromCamera<=0)?[]:$t.map(Ht=>Ht.point)}let on=[];if(_t.length>0){const $t=_t[0].clone(),Ht=_t[0].clone();for(let ln=1;ln<_t.length;ln++)$t.x=Math.min($t.x,_t[ln].x),$t.y=Math.min($t.y,_t[ln].y),Ht.x=Math.max(Ht.x,_t[ln].x),Ht.y=Math.max(Ht.y,_t[ln].y);on=$t.x>=et.x&&Ht.x<=qe.x&&$t.y>=et.y&&Ht.y<=qe.y?[_t]:Ht.x<et.x||$t.x>qe.x||Ht.y<et.y||$t.y>qe.y?[]:l.clipLine([_t],et.x,et.y,qe.x,qe.y)}for(const $t of on){nt.reset($t,.25*Ce);let Ht=0;Ht=nt.length<=.5*Ce?1:Math.ceil(nt.paddedLength/sn)+1;for(let ln=0;ln<Ht;ln++){const ai=ln/Math.max(Ht-1,1),cs=nt.lerp(ai),Br=cs.x+$n,us=cs.y+$n;ne.push(Br,us,Ce,0);const eo=Br-Ce,Er=us-Ce,Wi=Br+Ce,As=us+Ce;if(Be=Be&&this.isOffscreen(eo,Er,Wi,As),ke=ke||this.isInsideGrid(eo,Er,Wi,As),s!=="always"&&this.grid.hitTestCircle(Br,us,Ce,s,B)&&(Le=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Le}}}}return{circles:!k&&Le||!ke||xe<this.perspectiveRatioCutoff?[]:ne,offscreen:Be,collisionDetected:Le}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let p=1/0,_=1/0,x=-1/0,E=-1/0;for(const z of s){const B=new l.pointGeometry(z.x+$n,z.y+$n);p=Math.min(p,B.x),_=Math.min(_,B.y),x=Math.max(x,B.x),E=Math.max(E,B.y),h.push(B)}const A=this.grid.query(p,_,x,E).concat(this.ignoredGrid.query(p,_,x,E)),I={},k={};for(const z of A){const B=z.key;if(I[B.bucketInstanceId]===void 0&&(I[B.bucketInstanceId]={}),I[B.bucketInstanceId][B.featureIndex])continue;const j=[new l.pointGeometry(z.x1,z.y1),new l.pointGeometry(z.x2,z.y1),new l.pointGeometry(z.x2,z.y2),new l.pointGeometry(z.x1,z.y2)];l.polygonIntersectsPolygon(h,j)&&(I[B.bucketInstanceId][B.featureIndex]=!0,k[B.bucketInstanceId]===void 0&&(k[B.bucketInstanceId]=[]),k[B.bucketInstanceId].push(B.featureIndex))}return k}insertCollisionBox(s,h,p,_,x,E){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:E,overlapMode:h},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,p,_,x,E){const A=p?this.ignoredGrid:this.grid,I={bucketInstanceId:_,featureIndex:x,collisionGroupID:E,overlapMode:h};for(let k=0;k<s.length;k+=4)A.insertCircle(I,s[k],s[k+1],s[k+2])}projectAndGetPerspectiveRatio(s,h,p,_){let x;return _?(x=[h,p,_(h,p),1],l.transformMat4(x,x,s)):(x=[h,p,0,1],ir(x,x,s)),{point:new l.pointGeometry((x[0]/x[3]+1)/2*this.transform.width+$n,(-x[1]/x[3]+1)/2*this.transform.height+$n),perspectiveRatio:.5+this.transform.cameraToCenterDistance/x[3]*.5}}isOffscreen(s,h,p,_){return p<$n||s>=this.screenRightBoundary||_<$n||h>this.screenBottomBoundary}isInsideGrid(s,h,p,_){return p>=0&&s<this.gridRightBoundary&&_>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const s=l.identity([]);return l.translate(s,s,[-100,-100,0]),s}}function Ln(m,s,h){return s*(l.EXTENT/(m.tileSize*Math.pow(2,h-m.tileID.overscaledZ)))}class oi{constructor(s,h,p,_){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Qt{constructor(s,h,p,_,x){this.text=new oi(s?s.text:null,h,p,x),this.icon=new oi(s?s.icon:null,h,_,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Hs{constructor(s,h,p){this.text=s,this.icon=h,this.skipFade=p}}class xr{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class br{constructor(s,h,p,_,x){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=x}}class ws{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[s]}}function Ws(m,s,h,p,_){const{horizontalAlign:x,verticalAlign:E}=l.getAnchorAlignment(m),A=-(x-.5)*s,I=-(E-.5)*h,k=l.evaluateVariableOffset(m,p);return new l.pointGeometry(A+k[0]*_,I+k[1]*_)}function os(m,s,h,p,_,x){const{x1:E,x2:A,y1:I,y2:k,anchorPointX:z,anchorPointY:B}=m,j=new l.pointGeometry(s,h);return p&&j._rotate(_?x:-x),{x1:E+j.x,y1:I+j.y,x2:A+j.x,y2:k+j.y,anchorPointX:z,anchorPointY:B}}class Q{constructor(s,h,p,_,x){this.transform=s.clone(),this.terrain=h,this.collisionIndex=new $s(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new ws(_),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,p,_){const x=p.getBucket(h),E=p.latestFeatureIndex;if(!x||!E||h.id!==x.layerIds[0])return;const A=p.collisionBoxArray,I=x.layers[0].layout,k=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),z=p.tileSize/l.EXTENT,B=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),j=I.get("text-pitch-alignment")==="map",ie=I.get("text-rotation-alignment")==="map",te=Ln(p,1,this.transform.zoom),ne=rs(B,j,ie,this.transform,te);let de=null;if(j){const xe=Ei(B,j,ie,this.transform,te);de=l.multiply([],this.transform.labelPlaneMatrix,xe)}this.retainedQueryData[x.bucketInstanceId]=new br(x.bucketInstanceId,E,x.sourceLayerIndex,x.index,p.tileID);const ge={bucket:x,layout:I,posMatrix:B,textLabelPlaneMatrix:ne,labelToScreenMatrix:de,scale:k,textPixelRatio:z,holdingForFade:p.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(_)for(const xe of x.sortKeyRanges){const{sortKey:re,symbolInstanceStart:Ee,symbolInstanceEnd:be}=xe;s.push({sortKey:re,symbolInstanceStart:Ee,symbolInstanceEnd:be,parameters:ge})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:ge})}attemptAnchorPlacement(s,h,p,_,x,E,A,I,k,z,B,j,ie,te,ne,de){const ge=[j.textOffset0,j.textOffset1],xe=Ws(s,p,_,ge,x),re=this.collisionIndex.placeCollisionBox(os(h,xe.x,xe.y,E,A,this.transform.angle),B,I,k,z.predicate,de);if((!ne||this.collisionIndex.placeCollisionBox(os(ne,xe.x,xe.y,E,A,this.transform.angle),B,I,k,z.predicate,de).box.length!==0)&&re.box.length>0){let Ee;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(Ee=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:ge,width:p,height:_,anchor:s,textBoxScale:x,prevAnchor:Ee},this.markUsedJustification(ie,s,j,te),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,te,j),this.placedOrientations[j.crossTileID]=te),{shift:xe,placedGlyphBoxes:re}}}placeLayerBucketPart(s,h,p){const{bucket:_,layout:x,posMatrix:E,textLabelPlaneMatrix:A,labelToScreenMatrix:I,textPixelRatio:k,holdingForFade:z,collisionBoxArray:B,partiallyEvaluatedTextSize:j,collisionGroup:ie}=s.parameters,te=x.get("text-optional"),ne=x.get("icon-optional"),de=l.getOverlapMode(x,"text-overlap","text-allow-overlap"),ge=de==="always",xe=l.getOverlapMode(x,"icon-overlap","icon-allow-overlap"),re=xe==="always",Ee=x.get("text-rotation-alignment")==="map",be=x.get("text-pitch-alignment")==="map",Le=x.get("icon-text-fit")!=="none",ke=x.get("symbol-z-order")==="viewport-y",Be=ge&&(re||!_.hasIconData()||ne),Ce=re&&(ge||!_.hasTextData()||te);!_.collisionArrays&&B&&_.deserializeCollisionBoxes(B);const et=(qe,nt)=>{if(h[qe.crossTileID])return;if(z)return void(this.placements[qe.crossTileID]=new Hs(!1,!1,!1));let Ct=!1,Rt=!1,_t=!0,sn=null,on={box:null,offscreen:null},$t={box:null,offscreen:null},Ht=null,ln=null,ai=null,cs=0,Br=0,us=0;nt.textFeatureIndex?cs=nt.textFeatureIndex:qe.useRuntimeCollisionCircles&&(cs=qe.featureIndex),nt.verticalTextFeatureIndex&&(Br=nt.verticalTextFeatureIndex);const eo=this.retainedQueryData[_.bucketInstanceId].tileID,Er=this.terrain?(Qn,Ft)=>this.terrain.getElevation(eo,Qn,Ft):null;for(const Qn of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const Ft=nt[Qn];Ft&&(Ft.elevation=Er?Er(Ft.anchorPointX,Ft.anchorPointY):0)}const Wi=nt.textBox;if(Wi){const Qn=en=>{let li=l.WritingMode.horizontal;if(_.allowVerticalPlacement&&!en&&this.prevPlacement){const ci=this.prevPlacement.placedOrientations[qe.crossTileID];ci&&(this.placedOrientations[qe.crossTileID]=ci,li=ci,this.markUsedOrientation(_,li,qe))}return li},Ft=(en,li)=>{if(_.allowVerticalPlacement&&qe.numVerticalGlyphVertices>0&&nt.verticalTextBox){for(const ci of _.writingModes)if(ci===l.WritingMode.vertical?(on=li(),$t=on):on=en(),on&&on.box&&on.box.length)break}else on=en()};if(x.get("text-variable-anchor")){let en=x.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[qe.crossTileID]){const bn=this.prevPlacement.variableOffsets[qe.crossTileID];en.indexOf(bn.anchor)>0&&(en=en.filter(Tr=>Tr!==bn.anchor),en.unshift(bn.anchor))}const li=(bn,Tr,To)=>{const Xu=bn.x2-bn.x1,ha=bn.y2-bn.y1,mf=qe.textBoxScale,Yu=Le&&xe==="never"?Tr:null;let to={box:[],offscreen:!1};const So=de!=="never"?2*en.length:en.length;for(let Ao=0;Ao<So;++Ao){const cc=this.attemptAnchorPlacement(en[Ao%en.length],bn,Xu,ha,mf,Ee,be,k,E,ie,Ao>=en.length?de:"never",qe,_,To,Yu,Er);if(cc&&(to=cc.placedGlyphBoxes,to&&to.box&&to.box.length)){Ct=!0,sn=cc.shift;break}}return to};Ft(()=>li(Wi,nt.iconBox,l.WritingMode.horizontal),()=>{const bn=nt.verticalTextBox;return _.allowVerticalPlacement&&!(on&&on.box&&on.box.length)&&qe.numVerticalGlyphVertices>0&&bn?li(bn,nt.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null}}),on&&(Ct=on.box,_t=on.offscreen);const ci=Qn(on&&on.box);if(!Ct&&this.prevPlacement){const bn=this.prevPlacement.variableOffsets[qe.crossTileID];bn&&(this.variableOffsets[qe.crossTileID]=bn,this.markUsedJustification(_,bn.anchor,qe,ci))}}else{const en=(li,ci)=>{const bn=this.collisionIndex.placeCollisionBox(li,de,k,E,ie.predicate,Er);return bn&&bn.box&&bn.box.length&&(this.markUsedOrientation(_,ci,qe),this.placedOrientations[qe.crossTileID]=ci),bn};Ft(()=>en(Wi,l.WritingMode.horizontal),()=>{const li=nt.verticalTextBox;return _.allowVerticalPlacement&&qe.numVerticalGlyphVertices>0&&li?en(li,l.WritingMode.vertical):{box:null,offscreen:null}}),Qn(on&&on.box&&on.box.length)}}if(Ht=on,Ct=Ht&&Ht.box&&Ht.box.length>0,_t=Ht&&Ht.offscreen,qe.useRuntimeCollisionCircles){const Qn=_.text.placedSymbolArray.get(qe.centerJustifiedTextSymbolIndex),Ft=l.evaluateSizeForFeature(_.textSizeData,j,Qn),en=x.get("text-padding");ln=this.collisionIndex.placeCollisionCircles(de,Qn,_.lineVertexArray,_.glyphOffsetArray,Ft,E,A,I,p,be,ie.predicate,qe.collisionCircleDiameter,en,Er),ln.circles.length&&ln.collisionDetected&&!p&&l.warnOnce("Collisions detected, but collision boxes are not shown"),Ct=ge||ln.circles.length>0&&!ln.collisionDetected,_t=_t&&ln.offscreen}if(nt.iconFeatureIndex&&(us=nt.iconFeatureIndex),nt.iconBox){const Qn=Ft=>{const en=Le&&sn?os(Ft,sn.x,sn.y,Ee,be,this.transform.angle):Ft;return this.collisionIndex.placeCollisionBox(en,xe,k,E,ie.predicate,Er)};$t&&$t.box&&$t.box.length&&nt.verticalIconBox?(ai=Qn(nt.verticalIconBox),Rt=ai.box.length>0):(ai=Qn(nt.iconBox),Rt=ai.box.length>0),_t=_t&&ai.offscreen}const As=te||qe.numHorizontalGlyphVertices===0&&qe.numVerticalGlyphVertices===0,lc=ne||qe.numIconVertices===0;if(As||lc?lc?As||(Rt=Rt&&Ct):Ct=Rt&&Ct:Rt=Ct=Rt&&Ct,Ct&&Ht&&Ht.box&&this.collisionIndex.insertCollisionBox(Ht.box,de,x.get("text-ignore-placement"),_.bucketInstanceId,$t&&$t.box&&Br?Br:cs,ie.ID),Rt&&ai&&this.collisionIndex.insertCollisionBox(ai.box,xe,x.get("icon-ignore-placement"),_.bucketInstanceId,us,ie.ID),ln&&(Ct&&this.collisionIndex.insertCollisionCircles(ln.circles,de,x.get("text-ignore-placement"),_.bucketInstanceId,cs,ie.ID),p)){const Qn=_.bucketInstanceId;let Ft=this.collisionCircleArrays[Qn];Ft===void 0&&(Ft=this.collisionCircleArrays[Qn]=new xr);for(let en=0;en<ln.circles.length;en+=4)Ft.circles.push(ln.circles[en+0]),Ft.circles.push(ln.circles[en+1]),Ft.circles.push(ln.circles[en+2]),Ft.circles.push(ln.collisionDetected?1:0)}if(qe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(_.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[qe.crossTileID]=new Hs(Ct||Be,Rt||Ce,_t||_.justReloaded),h[qe.crossTileID]=!0};if(ke){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const qe=_.getSortedSymbolIndexes(this.transform.angle);for(let nt=qe.length-1;nt>=0;--nt){const Ct=qe[nt];et(_.symbolInstances.get(Ct),_.collisionArrays[Ct])}}else for(let qe=s.symbolInstanceStart;qe<s.symbolInstanceEnd;qe++)et(_.symbolInstances.get(qe),_.collisionArrays[qe]);if(p&&_.bucketInstanceId in this.collisionCircleArrays){const qe=this.collisionCircleArrays[_.bucketInstanceId];l.invert(qe.invProjMatrix,E),qe.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(s,h,p,_){let x;x=_===l.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(h)];const E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const A of E)A>=0&&(s.text.placedSymbolArray.get(A).crossTileID=x>=0&&A!==x?0:p.crossTileID)}markUsedOrientation(s,h,p){const _=h===l.WritingMode.horizontal||h===l.WritingMode.horizontalOnly?h:0,x=h===l.WritingMode.vertical?h:0,E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const A of E)s.text.placedSymbolArray.get(A).placedOrientation=_;p.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const _=h?h.symbolFadeChange(s):1,x=h?h.opacities:{},E=h?h.variableOffsets:{},A=h?h.placedOrientations:{};for(const I in this.placements){const k=this.placements[I],z=x[I];z?(this.opacities[I]=new Qt(z,_,k.text,k.icon),p=p||k.text!==z.text.placed||k.icon!==z.icon.placed):(this.opacities[I]=new Qt(null,_,k.text,k.icon,k.skipFade),p=p||k.text||k.icon)}for(const I in x){const k=x[I];if(!this.opacities[I]){const z=new Qt(k,_,!1,!1);z.isHidden()||(this.opacities[I]=z,p=p||k.text.placed||k.icon.placed)}}for(const I in E)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=E[I]);for(const I in A)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=A[I]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h){const p={};for(const _ of h){const x=_.getBucket(s);x&&_.latestFeatureIndex&&s.id===x.layerIds[0]&&this.updateBucketOpacities(x,p,_.collisionBoxArray)}}updateBucketOpacities(s,h,p){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const _=s.layers[0].layout,x=new Qt(null,0,!1,!1,!0),E=_.get("text-allow-overlap"),A=_.get("icon-allow-overlap"),I=_.get("text-variable-anchor"),k=_.get("text-rotation-alignment")==="map",z=_.get("text-pitch-alignment")==="map",B=_.get("icon-text-fit")!=="none",j=new Qt(null,0,E&&(A||!s.hasIconData()||_.get("icon-optional")),A&&(E||!s.hasTextData()||_.get("text-optional")),!0);!s.collisionArrays&&p&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(p);const ie=(te,ne,de)=>{for(let ge=0;ge<ne/4;ge++)te.opacityVertexArray.emplaceBack(de)};for(let te=0;te<s.symbolInstances.length;te++){const ne=s.symbolInstances.get(te),{numHorizontalGlyphVertices:de,numVerticalGlyphVertices:ge,crossTileID:xe}=ne;let re=this.opacities[xe];h[xe]?re=x:re||(re=j,this.opacities[xe]=re),h[xe]=!0;const Ee=ne.numIconVertices>0,be=this.placedOrientations[ne.crossTileID],Le=be===l.WritingMode.vertical,ke=be===l.WritingMode.horizontal||be===l.WritingMode.horizontalOnly;if(de>0||ge>0){const Be=pe(re.text);ie(s.text,de,Le?Ie:Be),ie(s.text,ge,ke?Ie:Be);const Ce=re.text.isHidden();[ne.rightJustifiedTextSymbolIndex,ne.centerJustifiedTextSymbolIndex,ne.leftJustifiedTextSymbolIndex].forEach(nt=>{nt>=0&&(s.text.placedSymbolArray.get(nt).hidden=Ce||Le?1:0)}),ne.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(ne.verticalPlacedTextSymbolIndex).hidden=Ce||ke?1:0);const et=this.variableOffsets[ne.crossTileID];et&&this.markUsedJustification(s,et.anchor,ne,be);const qe=this.placedOrientations[ne.crossTileID];qe&&(this.markUsedJustification(s,"left",ne,qe),this.markUsedOrientation(s,qe,ne))}if(Ee){const Be=pe(re.icon),Ce=!(B&&ne.verticalPlacedIconSymbolIndex&&Le);ne.placedIconSymbolIndex>=0&&(ie(s.icon,ne.numIconVertices,Ce?Be:Ie),s.icon.placedSymbolArray.get(ne.placedIconSymbolIndex).hidden=re.icon.isHidden()),ne.verticalPlacedIconSymbolIndex>=0&&(ie(s.icon,ne.numVerticalIconVertices,Ce?Ie:Be),s.icon.placedSymbolArray.get(ne.verticalPlacedIconSymbolIndex).hidden=re.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Be=s.collisionArrays[te];if(Be){let Ce=new l.pointGeometry(0,0);if(Be.textBox||Be.verticalTextBox){let qe=!0;if(I){const nt=this.variableOffsets[xe];nt?(Ce=Ws(nt.anchor,nt.width,nt.height,nt.textOffset,nt.textBoxScale),k&&Ce._rotate(z?this.transform.angle:-this.transform.angle)):qe=!1}Be.textBox&&R(s.textCollisionBox.collisionVertexArray,re.text.placed,!qe||Le,Ce.x,Ce.y),Be.verticalTextBox&&R(s.textCollisionBox.collisionVertexArray,re.text.placed,!qe||ke,Ce.x,Ce.y)}const et=!!(!ke&&Be.verticalIconBox);Be.iconBox&&R(s.iconCollisionBox.collisionVertexArray,re.icon.placed,et,B?Ce.x:0,B?Ce.y:0),Be.verticalIconBox&&R(s.iconCollisionBox.collisionVertexArray,re.icon.placed,!et,B?Ce.x:0,B?Ce.y:0)}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);if(s.bucketInstanceId in this.collisionCircleArrays){const te=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=te.invProjMatrix,s.placementViewportMatrix=te.viewportMatrix,s.collisionCircleArray=te.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>s}setStale(){this.stale=!0}}function R(m,s,h,p,_){m.emplaceBack(s?1:0,h?1:0,p||0,_||0),m.emplaceBack(s?1:0,h?1:0,p||0,_||0),m.emplaceBack(s?1:0,h?1:0,p||0,_||0),m.emplaceBack(s?1:0,h?1:0,p||0,_||0)}const F=Math.pow(2,25),Z=Math.pow(2,24),K=Math.pow(2,17),ce=Math.pow(2,16),fe=Math.pow(2,9),he=Math.pow(2,8),le=Math.pow(2,1);function pe(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const s=m.placed?1:0,h=Math.floor(127*m.opacity);return h*F+s*Z+h*K+s*ce+h*fe+s*he+h*le+s}const Ie=0;class ze{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,h,p,_,x){const E=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(E,_,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((A,I)=>A.sortKey-I.sortKey));this._currentPartIndex<E.length;)if(h.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,x())return!0;return!1}}class Pe{constructor(s,h,p,_,x,E,A,I){this.placement=new Q(s,h,E,A,I),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(s,h,p){const _=l.exported.now(),x=()=>{const E=l.exported.now()-_;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=h[s[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=A)&&(!E.maxzoom||E.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new ze(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const rt=512/l.EXTENT/2;class lt{constructor(s,h,p){this.tileID=s,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let _=0;_<h.length;_++){const x=h.get(_),E=x.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,s)})}}getScaledCoordinates(s,h){const p=rt/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*l.EXTENT+s.anchorX)*p),y:Math.floor((h.canonical.y*l.EXTENT+s.anchorY)*p)}}findMatches(s,h,p){const _=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let x=0;x<s.length;x++){const E=s.get(x);if(E.crossTileID)continue;const A=this.indexedSymbolInstances[E.key];if(!A)continue;const I=this.getScaledCoordinates(E,h);for(const k of A)if(Math.abs(k.coord.x-I.x)<=_&&Math.abs(k.coord.y-I.y)<=_&&!p[k.crossTileID]){p[k.crossTileID]=!0,E.crossTileID=k.crossTileID;break}}}}class Ye{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class gt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const h=Math.round((s-this.lng)/360);if(h!==0)for(const p in this.indexes){const _=this.indexes[p],x={};for(const E in _){const A=_[E];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+h),x[A.tileID.key]=A}this.indexes[p]=x}this.lng=s}addBucket(s,h,p){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let x=0;x<h.symbolInstances.length;x++)h.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const _=this.usedCrossTileIDs[s.overscaledZ];for(const x in this.indexes){const E=this.indexes[x];if(Number(x)>s.overscaledZ)for(const A in E){const I=E[A];I.tileID.isChildOf(s)&&I.findMatches(h.symbolInstances,s,_)}else{const A=E[s.scaledTo(Number(x)).key];A&&A.findMatches(h.symbolInstances,s,_)}}for(let x=0;x<h.symbolInstances.length;x++){const E=h.symbolInstances.get(x);E.crossTileID||(E.crossTileID=p.generate(),_[E.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new lt(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(const p in h.indexedSymbolInstances)for(const _ of h.indexedSymbolInstances[p])delete this.usedCrossTileIDs[s][_.crossTileID]}removeStaleBuckets(s){let h=!1;for(const p in this.indexes){const _=this.indexes[p];for(const x in _)s[_[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[x]),delete _[x],h=!0)}return h}}class ft{constructor(){this.layerIndexes={},this.crossTileIDs=new Ye,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,p){let _=this.layerIndexes[s.id];_===void 0&&(_=this.layerIndexes[s.id]=new gt);let x=!1;const E={};_.handleWrapJump(p);for(const A of h){const I=A.getBucket(s);I&&s.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(A.tileID,I,this.crossTileIDs)&&(x=!0),E[I.bucketInstanceId]=!0)}return _.removeStaleBuckets(E)&&(x=!0),x}pruneUnusedLayers(s){const h={};s.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}var Lt=l.createLayout([{name:"a_pos",type:"Int16",components:2}]);class xt extends l.Evented{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=s._cache.max,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const s in this._tiles){const h=this._tiles[s];h.textures.forEach(p=>p.destroy()),h.textures=[]}}update(s,h){this.sourceCache.update(s,h),this._renderableTilesKeys=[];for(const p of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),l.ortho(p.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),this._tiles[p.key]=new si(p,this.tileSize))}removeOutdated(s){const h={};this.renderHistory=this.renderHistory.filter((p,_)=>this.renderHistory.indexOf(p)===_).slice(0,this.renderHistorySize);for(const p of this._renderableTilesKeys)h[p]=!0;for(const p of this.renderHistory)h[p]=!0;for(const p in this._tiles)h[p]||(this._tiles[p].clearTextures(s),delete this._tiles[p])}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){const h={};for(const p of this._renderableTilesKeys){const _=this._tiles[p].tileID;if(_.canonical.equals(s.canonical)){const x=s.clone();x.posMatrix=new Float64Array(16),l.ortho(x.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),h[p]=x}else if(_.canonical.isChildOf(s.canonical)){const x=s.clone();x.posMatrix=new Float64Array(16);const E=_.canonical.z-s.canonical.z,A=_.canonical.x-(_.canonical.x>>E<<E),I=_.canonical.y-(_.canonical.y>>E<<E),k=l.EXTENT>>E;l.ortho(x.posMatrix,0,k,0,k,0,1),l.translate(x.posMatrix,x.posMatrix,[-A*k,-I*k,0]),h[p]=x}else if(s.canonical.isChildOf(_.canonical)){const x=s.clone();x.posMatrix=new Float64Array(16);const E=s.canonical.z-_.canonical.z,A=s.canonical.x-(s.canonical.x>>E<<E),I=s.canonical.y-(s.canonical.y>>E<<E),k=l.EXTENT>>E;l.ortho(x.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),l.translate(x.posMatrix,x.posMatrix,[A*k,I*k,0]),l.scale(x.posMatrix,x.posMatrix,[1/2**E,1/2**E,0]),h[p]=x}}return h}getSourceTile(s,h){const p=this.sourceCache._source;let _=s.overscaledZ-this.deltaZoom;if(_>p.maxzoom&&(_=p.maxzoom),_<p.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(_).key);let x=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!x||!x.dem)&&h)for(;_>=p.minzoom&&(!x||!x.dem);)x=this.sourceCache.getTileByID(s.scaledTo(_--).key);return x}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(h=>h.timeLoaded>=s)}}class Tt{constructor(s,h,p){this.style=s,this.sourceCache=new xt(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.elevationOffset=typeof p.elevationOffset=="number"?p.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(s,h,p,_=l.EXTENT){if(!(h>=0&&h<_&&p>=0&&p<_))return this.elevationOffset;let x=0;const E=this.getTerrainData(s);if(E.tile&&E.tile.dem){const A=l.transformMat4$1([],[h/_*l.EXTENT,p/_*l.EXTENT],E.u_terrain_matrix),I=[A[0]*E.tile.dem.dim,A[1]*E.tile.dem.dim],k=[Math.floor(I[0]),Math.floor(I[1])],z=E.tile.dem.get(k[0],k[1]),B=E.tile.dem.get(k[0],k[1]+1),j=E.tile.dem.get(k[0]+1,k[1]),ie=E.tile.dem.get(k[0]+1,k[1]+1);x=l.number(l.number(z,B,I[0]-k[0]),l.number(j,ie,I[0]-k[0]),I[1]-k[1])}return x}rememberForRerender(s,h){for(const p in this.sourceCache._tiles){const _=this.sourceCache._tiles[p];(_.tileID.equals(h)||_.tileID.isChildOf(h))&&(s===this.sourceCache.sourceCache.id&&(_.timeLoaded=Date.now()),this._rerender[s]=this._rerender[s]||{},this._rerender[s][_.tileID.key]=!0)}}needsRerender(s,h){return this._rerender[s]&&this._rerender[s][h.key]}clearRerenderCache(){this._rerender={}}getElevation(s,h,p,_=l.EXTENT){return(this.getDEMElevation(s,h,p,_)+this.elevationOffset)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const _=this.style.map.painter.context,x=new l.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ee(_,x,_.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ee(_,new l.RGBAImage({width:1,height:1}),_.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.identity([])}const h=this.sourceCache.getSourceTile(s,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const _=this.style.map.painter.context;h.demTexture=this.style.map.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new ee(_,h.dem.getPixels(),_.gl.RGBA,{premultiply:!1}),h.demTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+s.key;if(p&&!this._demMatrixCache[p]){const _=this.sourceCache.sourceCache._source.maxzoom;let x=s.canonical.z-h.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=_?x=s.canonical.z-_:l.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=s.canonical.x-(s.canonical.x>>x<<x),A=s.canonical.y-(s.canonical.y>>x<<x),I=l.fromScaling(new Float64Array(16),[1/(l.EXTENT<<x),1/(l.EXTENT<<x),0]);l.translate(I,I,[E*l.EXTENT,A*l.EXTENT,0]),this._demMatrixCache[s.key]={matrix:I,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getRTTFramebuffer(){const s=this.style.map.painter;if(!this._rttFramebuffer){const h=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=s.context.createFramebuffer(h,h,!0),this._rttFramebuffer.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,h,h))}return this._rttFramebuffer}getFramebuffer(s){const h=this.style.map.painter,p=h.width/devicePixelRatio,_=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===_||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ee(h.context,{width:p,height:_,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ee(h.context,{width:p,height:_,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,_,!0),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,_))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let x=0,E=0;x<this._coordsTextureSize;x++)for(let A=0;A<this._coordsTextureSize;A++,E+=4)h[E+0]=255&A,h[E+1]=255&x,h[E+2]=A>>8<<4|x>>8,h[E+3]=0;const p=new l.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),_=new ee(s,p,s.gl.RGBA,{premultiply:!1});return _.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=_,_}pointCoordinate(s){const h=new Uint8Array(4),p=this.style.map.painter,_=p.context,x=_.gl;_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),x.readPixels(s.x,p.height/devicePixelRatio-s.y-1,1,1,x.RGBA,x.UNSIGNED_BYTE,h),_.bindFramebuffer.set(null);const E=h[0]+(h[2]>>4<<8),A=h[1]+((15&h[2])<<8),I=this.coordsIndex[255-h[3]],k=I&&this.sourceCache.getTileByID(I);if(!k)return null;const z=this._coordsTextureSize,B=(1<<k.tileID.canonical.z)*z;return new l.MercatorCoordinate((k.tileID.canonical.x*z+E)/B,(k.tileID.canonical.y*z+A)/B,this.getElevation(k.tileID,E,A,z))}getTerrainMesh(){if(this._mesh)return this._mesh;const s=this.style.map.painter.context,h=new l.PosArray,p=new l.TriangleIndexArray,_=this.meshSize,x=l.EXTENT/_,E=_*_;for(let A=0;A<=_;A++)for(let I=0;I<=_;I++)h.emplaceBack(I*x,A*x);for(let A=0;A<E;A+=_+1)for(let I=0;I<_;I++)p.emplaceBack(I+A,_+I+A+1,_+I+A+2),p.emplaceBack(I+A,_+I+A+2,I+A+1);return this._mesh={indexBuffer:s.createIndexBuffer(p),vertexBuffer:s.createVertexBuffer(h,Lt.members),segments:l.SegmentVector.simpleSegment(0,0,h.length,p.length)},this._mesh}getMinMaxElevation(s){const h=this.getTerrainData(s).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=(h.dem.min+this.elevationOffset)*this.exaggeration,p.maxElevation=(h.dem.max+this.elevationOffset)*this.exaggeration),p}}const zt=(m,s)=>l.emitValidationErrors(m,s&&s.filter(h=>h.identifier!=="source.canvas")),Nt=l.pick(Vt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),hn=l.pick(Vt,["setCenter","setZoom","setBearing","setPitch"]),dn=function(){const m={},s=l.spec.$version;for(const h in l.spec.$root){const p=l.spec.$root[h];if(p.required){let _=null;_=h==="version"?s:p.type==="array"?[]:{},_!=null&&(m[h]=_)}}return m}();class Jn extends l.Evented{constructor(s,h={}){super(),this.map=s,this.dispatcher=new je(fi(),this),this.imageManager=new Y,this.imageManager.setEventedParent(this),this.glyphManager=new ye(s._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Ve(256,512),this.crossTileSymbolIndex=new ft,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const p=this;this._rtlTextPluginCallback=Jn.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(x,E)=>{if(l.triggerPluginCompletionEvent(x),E&&E.every(A=>A))for(const A in p.sourceCaches)p.sourceCaches[A].reload()})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const x=this.sourceCaches[_.sourceId];if(!x)return;const E=x.getSource();if(E&&E.vectorLayerIds)for(const A in this._layers){const I=this._layers[A];I.source===E.id&&this._validateLayer(I)}})}loadURL(s,h={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const p=typeof h.validate!="boolean"||h.validate,_=this.map._requestManager.transformRequest(s,l.ResourceType.Style);this._request=l.getJSON(_,(x,E)=>{this._request=null,x?this.fire(new l.ErrorEvent(x)):E&&this._load(E,p)})}loadJSON(s,h={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(s,h.validate!==!1)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(dn,!1)}_load(s,h){if(h&&zt(this,l.validateStyle(s)))return;this._loaded=!0,this.stylesheet=s;for(const _ in s.sources)this.addSource(_,s.sources[_],{validate:!1});s.sprite?this._loadSprite(s.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(s.glyphs);const p=js(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p)_=l.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Fe(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}_loadSprite(s){this._spriteRequest=function(h,p,_,x){let E,A,I;const k=_>1?"@2x":"";let z=l.getJSON(p.transformRequest(p.normalizeSpriteURL(h,k,".json"),l.ResourceType.SpriteJSON),(ie,te)=>{z=null,I||(I=ie,E=te,j())}),B=l.getImage(p.transformRequest(p.normalizeSpriteURL(h,k,".png"),l.ResourceType.SpriteImage),(ie,te)=>{B=null,I||(I=ie,A=te,j())});function j(){if(I)x(I);else if(E&&A){const ie=l.exported.getImageData(A),te={};for(const ne in E){const{width:de,height:ge,x:xe,y:re,sdf:Ee,pixelRatio:be,stretchX:Le,stretchY:ke,content:Be}=E[ne],Ce=new l.RGBAImage({width:de,height:ge});l.RGBAImage.copy(ie,Ce,{x:xe,y:re},{x:0,y:0},{width:de,height:ge}),te[ne]={data:Ce,pixelRatio:be,sdf:Ee,stretchX:Le,stretchY:ke,content:Be}}x(null,te)}}return{cancel(){z&&(z.cancel(),z=null),B&&(B.cancel(),B=null)}}}(s,this.map._requestManager,this.map.getPixelRatio(),(h,p)=>{if(this._spriteRequest=null,h)this.fire(new l.ErrorEvent(h));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(s){const h=this.sourceCaches[s.source];if(!h)return;const p=s.sourceLayer;if(!p)return;const _=h.getSource();(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(p)===-1)&&this.fire(new l.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${_.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(s){const h=[];for(const p of s){const _=this._layers[p];_.type!=="custom"&&h.push(_.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const h=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(_.length||x.length)&&this._updateWorkerLayers(_,x);for(const E in this._updatedSources){const A=this._updatedSources[E];if(A==="reload")this._reloadSource(E);else{if(A!=="clear")throw new Error(`Invalid action ${A}`);this._clearSource(E)}}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(s);this.light.updateTransitions(s),this._resetUpdates()}const p={};for(const _ in this.sourceCaches){const x=this.sourceCaches[_];p[_]=x.used,x.used=!1}for(const _ of this._order){const x=this._layers[_];x.recalculate(s,this._availableImages),!x.isHidden(s.zoom)&&x.source&&(this.sourceCaches[x.source].used=!0)}for(const _ in p){const x=this.sourceCaches[_];p[_]!==x.used&&x.fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_}))}this.light.recalculate(s),this.z=s.zoom,h&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateWorkerLayers(s,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(s),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(s){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),s){const h=this.sourceCaches[s.source];if(!h)throw new Error(`cannot load terrain, because there exists no source with ID: ${s.source}`);this.terrain=new Tt(this,h,s),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=p=>{p.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=p=>{p.tile&&(p.sourceId===s.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(p.sourceId,p.tile.tileID)):p.source.type==="geojson"&&this.terrain.rememberForRerender(p.sourceId,p.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new l.Event("terrain",{terrain:s}))}setState(s){if(this._checkLoaded(),zt(this,l.validateStyle(s)))return!1;(s=l.clone$1(s)).layers=js(s.layers);const h=function(_,x){if(!_)return[{command:Vt.setStyle,args:[x]}];let E=[];try{if(!L(_.version,x.version))return[{command:Vt.setStyle,args:[x]}];L(_.center,x.center)||E.push({command:Vt.setCenter,args:[x.center]}),L(_.zoom,x.zoom)||E.push({command:Vt.setZoom,args:[x.zoom]}),L(_.bearing,x.bearing)||E.push({command:Vt.setBearing,args:[x.bearing]}),L(_.pitch,x.pitch)||E.push({command:Vt.setPitch,args:[x.pitch]}),L(_.sprite,x.sprite)||E.push({command:Vt.setSprite,args:[x.sprite]}),L(_.glyphs,x.glyphs)||E.push({command:Vt.setGlyphs,args:[x.glyphs]}),L(_.transition,x.transition)||E.push({command:Vt.setTransition,args:[x.transition]}),L(_.light,x.light)||E.push({command:Vt.setLight,args:[x.light]});const A={},I=[];(function(z,B,j,ie){let te;for(te in B=B||{},z=z||{})Object.prototype.hasOwnProperty.call(z,te)&&(Object.prototype.hasOwnProperty.call(B,te)||Fn(te,j,ie));for(te in B)Object.prototype.hasOwnProperty.call(B,te)&&(Object.prototype.hasOwnProperty.call(z,te)?L(z[te],B[te])||(z[te].type==="geojson"&&B[te].type==="geojson"&&_o(z,B,te)?j.push({command:Vt.setGeoJSONSourceData,args:[te,B[te].data]}):is(te,B,j,ie)):ki(te,B,j))})(_.sources,x.sources,I,A);const k=[];_.layers&&_.layers.forEach(z=>{A[z.source]?E.push({command:Vt.removeLayer,args:[z.id]}):k.push(z)}),E=E.concat(I),function(z,B,j){B=B||[];const ie=(z=z||[]).map(Rr),te=B.map(Rr),ne=z.reduce(Gs,{}),de=B.reduce(Gs,{}),ge=ie.slice(),xe=Object.create(null);let re,Ee,be,Le,ke,Be,Ce;for(re=0,Ee=0;re<ie.length;re++)be=ie[re],Object.prototype.hasOwnProperty.call(de,be)?Ee++:(j.push({command:Vt.removeLayer,args:[be]}),ge.splice(ge.indexOf(be,Ee),1));for(re=0,Ee=0;re<te.length;re++)be=te[te.length-1-re],ge[ge.length-1-re]!==be&&(Object.prototype.hasOwnProperty.call(ne,be)?(j.push({command:Vt.removeLayer,args:[be]}),ge.splice(ge.lastIndexOf(be,ge.length-Ee),1)):Ee++,Be=ge[ge.length-re],j.push({command:Vt.addLayer,args:[de[be],Be]}),ge.splice(ge.length-re,0,be),xe[be]=!0);for(re=0;re<te.length;re++)if(be=te[re],Le=ne[be],ke=de[be],!xe[be]&&!L(Le,ke))if(L(Le.source,ke.source)&&L(Le["source-layer"],ke["source-layer"])&&L(Le.type,ke.type)){for(Ce in kr(Le.layout,ke.layout,j,be,null,Vt.setLayoutProperty),kr(Le.paint,ke.paint,j,be,null,Vt.setPaintProperty),L(Le.filter,ke.filter)||j.push({command:Vt.setFilter,args:[be,ke.filter]}),L(Le.minzoom,ke.minzoom)&&L(Le.maxzoom,ke.maxzoom)||j.push({command:Vt.setLayerZoomRange,args:[be,ke.minzoom,ke.maxzoom]}),Le)Object.prototype.hasOwnProperty.call(Le,Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&(Ce.indexOf("paint.")===0?kr(Le[Ce],ke[Ce],j,be,Ce.slice(6),Vt.setPaintProperty):L(Le[Ce],ke[Ce])||j.push({command:Vt.setLayerProperty,args:[be,Ce,ke[Ce]]}));for(Ce in ke)Object.prototype.hasOwnProperty.call(ke,Ce)&&!Object.prototype.hasOwnProperty.call(Le,Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&(Ce.indexOf("paint.")===0?kr(Le[Ce],ke[Ce],j,be,Ce.slice(6),Vt.setPaintProperty):L(Le[Ce],ke[Ce])||j.push({command:Vt.setLayerProperty,args:[be,Ce,ke[Ce]]}))}else j.push({command:Vt.removeLayer,args:[be]}),Be=ge[ge.lastIndexOf(be)+1],j.push({command:Vt.addLayer,args:[ke,Be]})}(k,x.layers,E)}catch(A){console.warn("Unable to compute style diff:",A),E=[{command:Vt.setStyle,args:[x]}]}return E}(this.serialize(),s).filter(_=>!(_.command in hn));if(h.length===0)return!1;const p=h.filter(_=>!(_.command in Nt));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return h.forEach(_=>{_.command!=="setTransition"&&this[_.command].apply(this,_.args)}),this.stylesheet=s,!0}addImage(s,h){if(this.getImage(s))return this.fire(new l.ErrorEvent(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,h),this._afterImageUpdated(s)}updateImage(s,h){this.imageManager.updateImage(s,h)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new l.ErrorEvent(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,h,p={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(l.validateStyle.source,`sources.${s}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const _=this.sourceCaches[s]=new Wt(s,h,this.dispatcher);_.style=this,_.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:_.serialize(),sourceId:s})),_.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===s)return this.fire(new l.ErrorEvent(new Error(`Source "${s}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],h.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,h){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const p=this.sourceCaches[s].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,h,p={}){this._checkLoaded();const _=s.id;if(this.getLayer(_))return void this.fire(new l.ErrorEvent(new Error(`Layer "${_}" already exists on this map.`)));let x;if(s.type==="custom"){if(zt(this,l.validateCustomStyleLayer(s)))return;x=l.createStyleLayer(s)}else{if(typeof s.source=="object"&&(this.addSource(_,s.source),s=l.clone$1(s),s=l.extend(s,{source:_})),this._validate(l.validateStyle.layer,`layers.${_}`,s,{arrayIndex:-1},p))return;x=l.createStyleLayer(s),this._validateLayer(x),x.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[x.id]=x.serialize()}const E=h?this._order.indexOf(h):this._order.length;if(h&&E===-1)this.fire(new l.ErrorEvent(new Error(`Cannot add layer "${_}" before non-existing layer "${h}".`)));else{if(this._order.splice(E,0,_),this._layerOrderChanged=!0,this._layers[_]=x,this._removedLayers[_]&&x.source&&x.type!=="custom"){const A=this._removedLayers[_];delete this._removedLayers[_],A.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.sourceCaches[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(s,h){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new l.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===h)return;const p=this._order.indexOf(s);this._order.splice(p,1);const _=h?this._order.indexOf(h):this._order.length;h&&_===-1?this.fire(new l.ErrorEvent(new Error(`Cannot move layer "${s}" before non-existing layer "${h}".`))):(this._order.splice(_,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const h=this._layers[s];if(!h)return void this.fire(new l.ErrorEvent(new Error(`Cannot remove non-existing layer "${s}".`)));h.setEventedParent(null);const p=this._order.indexOf(s);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=h,delete this._layers[s],delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],h.onRemove&&h.onRemove(this.map)}getLayer(s){return this._layers[s]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,h,p){this._checkLoaded();const _=this.getLayer(s);_?_.minzoom===h&&_.maxzoom===p||(h!=null&&(_.minzoom=h),p!=null&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new l.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,h,p={}){this._checkLoaded();const _=this.getLayer(s);if(_){if(!L(_.filter,h))return h==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(l.validateStyle.filter,`layers.${_.id}.filter`,h,null,p)||(_.filter=l.clone$1(h),this._updateLayer(_)))}else this.fire(new l.ErrorEvent(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return l.clone$1(this.getLayer(s).filter)}setLayoutProperty(s,h,p,_={}){this._checkLoaded();const x=this.getLayer(s);x?L(x.getLayoutProperty(h),p)||(x.setLayoutProperty(h,p,_),this._updateLayer(x)):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,h){const p=this.getLayer(s);if(p)return p.getLayoutProperty(h);this.fire(new l.ErrorEvent(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,h,p,_={}){this._checkLoaded();const x=this.getLayer(s);x?L(x.getPaintProperty(h),p)||(x.setPaintProperty(h,p,_)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,h){return this.getLayer(s).getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();const p=s.source,_=s.sourceLayer,x=this.sourceCaches[p];if(x===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const E=x.getSource().type;E==="geojson"&&_?this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||_?(s.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),x.setFeatureState(_,s.id,h)):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,h){this._checkLoaded();const p=s.source,_=this.sourceCaches[p];if(_===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const x=_.getSource().type,E=x==="vector"?s.sourceLayer:void 0;x!=="vector"||E?h&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):_.removeFeatureState(E,s.id,h):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const h=s.source,p=s.sourceLayer,_=this.sourceCaches[h];if(_!==void 0)return _.getSource().type!=="vector"||p?(s.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),_.getFeatureState(p,s.id)):void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:l.mapObject(this.sourceCaches,s=>s.serialize()),layers:this._serializeLayers(this._order)},s=>s!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(s){const h=E=>this._layers[E].type==="fill-extrusion",p={},_=[];for(let E=this._order.length-1;E>=0;E--){const A=this._order[E];if(h(A)){p[A]=E;for(const I of s){const k=I[A];if(k)for(const z of k)_.push(z)}}}_.sort((E,A)=>A.intersectionZ-E.intersectionZ);const x=[];for(let E=this._order.length-1;E>=0;E--){const A=this._order[E];if(h(A))for(let I=_.length-1;I>=0;I--){const k=_[I].feature;if(p[k.layer.id]<E)break;x.push(k),_.pop()}else for(const I of s){const k=I[A];if(k)for(const z of k)x.push(z.feature)}}return x}queryRenderedFeatures(s,h,p){h&&h.filter&&this._validate(l.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);const _={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const E of h.layers){const A=this._layers[E];if(!A)return this.fire(new l.ErrorEvent(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];_[A.source]=!0}}const x=[];h.availableImages=this._availableImages;for(const E in this.sourceCaches)h.layers&&!_[E]||x.push(ri(this.sourceCaches[E],this._layers,this._serializedLayers,s,h,p));return this.placement&&x.push(function(E,A,I,k,z,B,j){const ie={},te=B.queryRenderedSymbols(k),ne=[];for(const de of Object.keys(te).map(Number))ne.push(j[de]);ne.sort(bi);for(const de of ne){const ge=de.featureIndex.lookupSymbolFeatures(te[de.bucketInstanceId],A,de.bucketIndex,de.sourceLayerIndex,z.filter,z.layers,z.availableImages,E);for(const xe in ge){const re=ie[xe]=ie[xe]||[],Ee=ge[xe];Ee.sort((be,Le)=>{const ke=de.featureSortOrder;if(ke){const Be=ke.indexOf(be.featureIndex);return ke.indexOf(Le.featureIndex)-Be}return Le.featureIndex-be.featureIndex});for(const be of Ee)re.push(be)}}for(const de in ie)ie[de].forEach(ge=>{const xe=ge.feature,re=I[E[de].source].getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=re});return ie}(this._layers,this._serializedLayers,this.sourceCaches,s,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(s,h){h&&h.filter&&this._validate(l.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[s];return p?function(_,x){const E=_.getRenderableIds().map(k=>_.getTileByID(k)),A=[],I={};for(let k=0;k<E.length;k++){const z=E[k],B=z.tileID.canonical.key;I[B]||(I[B]=!0,z.querySourceFeatures(A,x))}return A}(p,h):[]}addSourceType(s,h,p){return Jn.getSourceType(s)?p(new Error(`A source type called "${s}" already exists.`)):(Jn.setSourceType(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(s,h={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const E in s)if(!L(s[E],p[E])){_=!0;break}if(!_)return;const x={now:l.exported.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,h),this.light.updateTransitions(x)}_validate(s,h,p,_,x={}){return(!x||x.validate!==!1)&&zt(this,s.call(l.validateStyle,l.extend({key:h,style:this.serialize(),value:p,styleSpec:l.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const h=this.sourceCaches[s];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const h in this.sourceCaches)this.sourceCaches[h].update(s,this.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,h,p,_,x=!1){let E=!1,A=!1;const I={};for(const k of this._order){const z=this._layers[k];if(z.type!=="symbol")continue;if(!I[z.source]){const j=this.sourceCaches[z.source];I[z.source]=j.getRenderableIds(!0).map(ie=>j.getTileByID(ie)).sort((ie,te)=>te.tileID.overscaledZ-ie.tileID.overscaledZ||(ie.tileID.isLessThan(te.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(z,I[z.source],s.center.lng);E=E||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),s.zoom))&&(this.pauseablePlacement=new Pe(s,this.terrain,this._order,x,h,p,_,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),A=!0),E&&this.pauseablePlacement.placement.setStale()),A||E)for(const k of this._order){const z=this._layers[k];z.type==="symbol"&&this.placement.updateLayerOpacities(z,I[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,h,p){this.imageManager.getImages(h.icons,p),this._updateTilesForChangedImages();const _=this.sourceCaches[h.source];_&&_.setDependencies(h.tileID.key,h.type,h.icons)}getGlyphs(s,h,p){this.glyphManager.getGlyphs(h.stacks,p)}getResource(s,h,p){return l.makeRequest(h,p)}}Jn.getSourceType=function(m){return rn[m]},Jn.setSourceType=function(m,s){rn[m]=s},Jn.registerForPluginStateChange=l.registerForPluginStateChange;var zr="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const pi={prelude:qt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:qt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:qt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:qt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:qt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:qt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:qt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:qt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:qt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:qt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:qt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:qt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:qt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:qt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:qt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:qt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:qt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:qt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:qt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:qt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:qt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:qt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:qt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:qt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",zr),terrainDepth:qt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",zr),terrainCoords:qt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",zr)};function qt(m,s){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=s.match(/attribute ([\w]+) ([\w]+)/g),_=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=x?x.concat(_):_,A={};return{fragmentSource:m=m.replace(h,(I,k,z,B,j)=>(A[j]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${j}
varying ${z} ${B} ${j};
#else
uniform ${z} ${B} u_${j};
#endif
`:`
#ifdef HAS_UNIFORM_u_${j}
    ${z} ${B} ${j} = u_${j};
#endif
`)),vertexSource:s=s.replace(h,(I,k,z,B,j)=>{const ie=B==="float"?"vec2":"vec4",te=j.match(/color/)?"color":ie;return A[j]?k==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${z} ${ie} a_${j};
varying ${z} ${B} ${j};
#else
uniform ${z} ${B} u_${j};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${z} ${B} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${te}(a_${j}, u_${j}_t);
#else
    ${z} ${B} ${j} = u_${j};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${z} ${ie} a_${j};
#else
uniform ${z} ${B} u_${j};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${z} ${B} ${j} = a_${j};
#else
    ${z} ${B} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${z} ${B} ${j} = unpack_mix_${te}(a_${j}, u_${j}_t);
#else
    ${z} ${B} ${j} = u_${j};
#endif
`}),staticAttributes:p,staticUniforms:E}}class yo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,h,p,_,x,E,A,I,k){this.context=s;let z=this.boundPaintVertexBuffers.length!==_.length;for(let B=0;!z&&B<_.length;B++)this.boundPaintVertexBuffers[B]!==_[B]&&(z=!0);s.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===p&&!z&&this.boundIndexBuffer===x&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===A&&this.boundDynamicVertexBuffer2===I&&this.boundDynamicVertexBuffer3===k?(s.bindVertexArrayOES.set(this.vao),A&&A.bind(),x&&x.dynamicDraw&&x.bind(),I&&I.bind(),k&&k.bind()):this.freshBind(h,p,_,x,E,A,I,k)}freshBind(s,h,p,_,x,E,A,I){let k;const z=s.numAttributes,B=this.context,j=B.gl;if(B.extVertexArrayObject)this.vao&&this.destroy(),this.vao=B.extVertexArrayObject.createVertexArrayOES(),B.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=A,this.boundDynamicVertexBuffer3=I;else{k=B.currentNumAttributes||0;for(let ie=z;ie<k;ie++)j.disableVertexAttribArray(ie)}h.enableAttributes(j,s);for(const ie of p)ie.enableAttributes(j,s);E&&E.enableAttributes(j,s),A&&A.enableAttributes(j,s),I&&I.enableAttributes(j,s),h.bind(),h.setVertexAttribPointers(j,s,x);for(const ie of p)ie.bind(),ie.setVertexAttribPointers(j,s,x);E&&(E.bind(),E.setVertexAttribPointers(j,s,x)),_&&_.bind(),A&&(A.bind(),A.setVertexAttribPointers(j,s,x)),I&&(I.bind(),I.setVertexAttribPointers(j,s,x)),B.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function vo(m){const s=[];for(let h=0;h<m.length;h++){if(m[h]===null)continue;const p=m[h].split(" ");s.push(p.pop())}return s}class Ko{constructor(s,h,p,_,x,E,A){const I=s.gl;this.program=I.createProgram();const k=vo(p.staticAttributes),z=_?_.getBinderAttributes():[],B=k.concat(z),j=pi.prelude.staticUniforms?vo(pi.prelude.staticUniforms):[],ie=p.staticUniforms?vo(p.staticUniforms):[],te=_?_.getBinderUniforms():[],ne=j.concat(ie).concat(te),de=[];for(const ke of ne)de.indexOf(ke)<0&&de.push(ke);const ge=_?_.defines():[];E&&ge.push("#define OVERDRAW_INSPECTOR;"),A&&ge.push("#define TERRAIN3D;");const xe=ge.concat(pi.prelude.fragmentSource,p.fragmentSource).join(`
`),re=ge.concat(pi.prelude.vertexSource,p.vertexSource).join(`
`),Ee=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(Ee,xe),I.compileShader(Ee),I.attachShader(this.program,Ee);const be=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(be,re),I.compileShader(be),I.attachShader(this.program,be),this.attributes={};const Le={};this.numAttributes=B.length;for(let ke=0;ke<this.numAttributes;ke++)B[ke]&&(I.bindAttribLocation(this.program,ke,B[ke]),this.attributes[B[ke]]=ke);I.linkProgram(this.program),I.deleteShader(be),I.deleteShader(Ee);for(let ke=0;ke<de.length;ke++){const Be=de[ke];if(Be&&!Le[Be]){const Ce=I.getUniformLocation(this.program,Be);Ce&&(Le[Be]=Ce)}}this.fixedUniforms=x(s,Le),this.terrainUniforms=((ke,Be)=>({u_depth:new l.Uniform1i(ke,Be.u_depth),u_terrain:new l.Uniform1i(ke,Be.u_terrain),u_terrain_dim:new l.Uniform1f(ke,Be.u_terrain_dim),u_terrain_matrix:new l.UniformMatrix4f(ke,Be.u_terrain_matrix),u_terrain_unpack:new l.Uniform4f(ke,Be.u_terrain_unpack),u_terrain_offset:new l.Uniform1f(ke,Be.u_terrain_offset),u_terrain_exaggeration:new l.Uniform1f(ke,Be.u_terrain_exaggeration)}))(s,Le),this.binderUniforms=_?_.getUniforms(s,Le):[]}draw(s,h,p,_,x,E,A,I,k,z,B,j,ie,te,ne,de,ge,xe){const re=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(p),s.setStencilMode(_),s.setColorMode(x),s.setCullFace(E),I){s.activeTexture.set(re.TEXTURE2),re.bindTexture(re.TEXTURE_2D,I.depthTexture),s.activeTexture.set(re.TEXTURE3),re.bindTexture(re.TEXTURE_2D,I.texture);for(const be in this.terrainUniforms)this.terrainUniforms[be].set(I[be])}for(const be in this.fixedUniforms)this.fixedUniforms[be].set(A[be]);ne&&ne.setUniforms(s,this.binderUniforms,ie,{zoom:te});let Ee=0;switch(h){case re.LINES:Ee=2;break;case re.TRIANGLES:Ee=3;break;case re.LINE_STRIP:Ee=1}for(const be of j.get()){const Le=be.vaos||(be.vaos={});(Le[k]||(Le[k]=new yo)).bind(s,this,z,ne?ne.getPaintVertexBuffers():[],B,be.vertexOffset,de,ge,xe),re.drawElements(h,be.primitiveLength*Ee,re.UNSIGNED_SHORT,be.primitiveOffset*Ee*2)}}}function Jo(m,s,h){const p=1/Ln(h,1,s.transform.tileZoom),_=Math.pow(2,h.tileID.overscaledZ),x=h.tileSize*Math.pow(2,s.transform.tileZoom)/_,E=x*(h.tileID.canonical.x+h.tileID.wrap*_),A=x*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[E>>16,A>>16],u_pixel_coord_lower:[65535&E,65535&A]}}const qs=(m,s,h,p)=>{const _=s.style.light,x=_.properties.get("position"),E=[x.x,x.y,x.z],A=l.create$1();_.properties.get("anchor")==="viewport"&&l.fromRotation(A,-s.transform.angle),l.transformMat3(E,E,A);const I=_.properties.get("color");return{u_matrix:m,u_lightpos:E,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+h,u_opacity:p}},Or=(m,s,h,p,_,x,E)=>l.extend(qs(m,s,h,p),Jo(x,s,E),{u_height_factor:-Math.pow(2,_.overscaledZ)/E.tileSize/8}),Qo=m=>({u_matrix:m}),ea=(m,s,h,p)=>l.extend(Qo(m),Jo(h,s,p)),ta=(m,s)=>({u_matrix:m,u_world:s}),Za=(m,s,h,p,_)=>l.extend(ea(m,s,h,p),{u_world:_}),Wl=(m,s,h,p)=>{const _=m.transform;let x,E;if(p.paint.get("circle-pitch-alignment")==="map"){const A=Ln(h,1,_.zoom);x=!0,E=[A,A]}else x=!1,E=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(s.posMatrix,h,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+x,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:E}},Es=(m,s,h)=>{const p=Ln(h,1,s.zoom),_=Math.pow(2,s.zoom-h.tileID.overscaledZ),x=h.tileID.overscaleFactor();return{u_matrix:m,u_camera_to_center_distance:s.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[s.pixelsToGLUnits[0]/(p*_),s.pixelsToGLUnits[1]/(p*_)],u_overscale_factor:x}},G=(m,s,h=1)=>({u_matrix:m,u_color:s,u_overlay:0,u_overlay_scale:h}),J=m=>({u_matrix:m}),ue=(m,s,h,p)=>({u_matrix:m,u_extrude_scale:Ln(s,1,h),u_intensity:p});function Ae(m,s){const h=Math.pow(2,s.canonical.z),p=s.canonical.y;return[new l.MercatorCoordinate(0,p/h).toLngLat().lat,new l.MercatorCoordinate(0,(p+1)/h).toLngLat().lat]}const Ne=(m,s,h,p)=>{const _=m.transform;return{u_matrix:Bn(m,s,h,p),u_ratio:1/Ln(s,1,_.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},at=(m,s,h,p,_)=>l.extend(Ne(m,s,h,_),{u_image:0,u_image_height:p}),Ot=(m,s,h,p,_)=>{const x=m.transform,E=kt(s,x);return{u_matrix:Bn(m,s,h,_),u_texsize:s.imageAtlasTexture.size,u_ratio:1/Ln(s,1,x.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[E,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},En=(m,s,h,p,_,x)=>{const E=m.lineAtlas,A=kt(s,m.transform),I=h.layout.get("line-cap")==="round",k=E.getDash(p.from,I),z=E.getDash(p.to,I),B=k.width*_.fromScale,j=z.width*_.toScale;return l.extend(Ne(m,s,h,x),{u_patternscale_a:[A/B,-k.height/2],u_patternscale_b:[A/j,-z.height/2],u_sdfgamma:E.width/(256*Math.min(B,j)*m.pixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:z.y,u_mix:_.t})};function kt(m,s){return 1/Ln(m,1,s.tileZoom)}function Bn(m,s,h,p){return m.translatePosMatrix(p?p.posMatrix:s.tileID.posMatrix,s,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const rr=(m,s,h,p,_)=>{return{u_matrix:m,u_tl_parent:s,u_scale_parent:h,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(E=_.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(x=_.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:Od(_.paint.get("raster-hue-rotate"))};var x,E};function Od(m){m*=Math.PI/180;const s=Math.sin(m),h=Math.cos(m);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}const wu=(m,s,h,p,_,x,E,A,I,k)=>{const z=_.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:z.cameraToCenterDistance,u_pitch:z.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:z.width/z.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:E,u_coord_matrix:A,u_is_text:+I,u_pitch_with_map:+p,u_texsize:k,u_texture:0}},ql=(m,s,h,p,_,x,E,A,I,k,z)=>{const B=_.transform;return l.extend(wu(m,s,h,p,_,x,E,A,I,k),{u_gamma_scale:p?Math.cos(B._pitch)*B.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:+z})},Fd=(m,s,h,p,_,x,E,A,I,k)=>l.extend(ql(m,s,h,p,_,x,E,A,!0,I,!0),{u_texsize_icon:k,u_texture_icon:1}),ng=(m,s,h)=>({u_matrix:m,u_opacity:s,u_color:h}),ig=(m,s,h,p,_,x)=>l.extend(function(E,A,I,k){const z=I.imageManager.getPattern(E.from.toString()),B=I.imageManager.getPattern(E.to.toString()),{width:j,height:ie}=I.imageManager.getPixelSize(),te=Math.pow(2,k.tileID.overscaledZ),ne=k.tileSize*Math.pow(2,I.transform.tileZoom)/te,de=ne*(k.tileID.canonical.x+k.tileID.wrap*te),ge=ne*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[j,ie],u_mix:A.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/Ln(k,1,I.transform.tileZoom),u_pixel_coord_upper:[de>>16,ge>>16],u_pixel_coord_lower:[65535&de,65535&ge]}}(p,x,h,_),{u_matrix:m,u_opacity:s}),Eu={fillExtrusion:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_lightpos:new l.Uniform3f(m,s.u_lightpos),u_lightintensity:new l.Uniform1f(m,s.u_lightintensity),u_lightcolor:new l.Uniform3f(m,s.u_lightcolor),u_vertical_gradient:new l.Uniform1f(m,s.u_vertical_gradient),u_opacity:new l.Uniform1f(m,s.u_opacity)}),fillExtrusionPattern:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_lightpos:new l.Uniform3f(m,s.u_lightpos),u_lightintensity:new l.Uniform1f(m,s.u_lightintensity),u_lightcolor:new l.Uniform3f(m,s.u_lightcolor),u_vertical_gradient:new l.Uniform1f(m,s.u_vertical_gradient),u_height_factor:new l.Uniform1f(m,s.u_height_factor),u_image:new l.Uniform1i(m,s.u_image),u_texsize:new l.Uniform2f(m,s.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,s.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,s.u_scale),u_fade:new l.Uniform1f(m,s.u_fade),u_opacity:new l.Uniform1f(m,s.u_opacity)}),fill:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix)}),fillPattern:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_image:new l.Uniform1i(m,s.u_image),u_texsize:new l.Uniform2f(m,s.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,s.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,s.u_scale),u_fade:new l.Uniform1f(m,s.u_fade)}),fillOutline:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_world:new l.Uniform2f(m,s.u_world)}),fillOutlinePattern:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_world:new l.Uniform2f(m,s.u_world),u_image:new l.Uniform1i(m,s.u_image),u_texsize:new l.Uniform2f(m,s.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,s.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,s.u_scale),u_fade:new l.Uniform1f(m,s.u_fade)}),circle:(m,s)=>({u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_scale_with_map:new l.Uniform1i(m,s.u_scale_with_map),u_pitch_with_map:new l.Uniform1i(m,s.u_pitch_with_map),u_extrude_scale:new l.Uniform2f(m,s.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(m,s.u_matrix)}),collisionBox:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_pixels_to_tile_units:new l.Uniform1f(m,s.u_pixels_to_tile_units),u_extrude_scale:new l.Uniform2f(m,s.u_extrude_scale),u_overscale_factor:new l.Uniform1f(m,s.u_overscale_factor)}),collisionCircle:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_inv_matrix:new l.UniformMatrix4f(m,s.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(m,s.u_viewport_size)}),debug:(m,s)=>({u_color:new l.UniformColor(m,s.u_color),u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_overlay:new l.Uniform1i(m,s.u_overlay),u_overlay_scale:new l.Uniform1f(m,s.u_overlay_scale)}),clippingMask:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix)}),heatmap:(m,s)=>({u_extrude_scale:new l.Uniform1f(m,s.u_extrude_scale),u_intensity:new l.Uniform1f(m,s.u_intensity),u_matrix:new l.UniformMatrix4f(m,s.u_matrix)}),heatmapTexture:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_world:new l.Uniform2f(m,s.u_world),u_image:new l.Uniform1i(m,s.u_image),u_color_ramp:new l.Uniform1i(m,s.u_color_ramp),u_opacity:new l.Uniform1f(m,s.u_opacity)}),hillshade:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_image:new l.Uniform1i(m,s.u_image),u_latrange:new l.Uniform2f(m,s.u_latrange),u_light:new l.Uniform2f(m,s.u_light),u_shadow:new l.UniformColor(m,s.u_shadow),u_highlight:new l.UniformColor(m,s.u_highlight),u_accent:new l.UniformColor(m,s.u_accent)}),hillshadePrepare:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_image:new l.Uniform1i(m,s.u_image),u_dimension:new l.Uniform2f(m,s.u_dimension),u_zoom:new l.Uniform1f(m,s.u_zoom),u_unpack:new l.Uniform4f(m,s.u_unpack)}),line:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_ratio:new l.Uniform1f(m,s.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,s.u_units_to_pixels)}),lineGradient:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_ratio:new l.Uniform1f(m,s.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,s.u_units_to_pixels),u_image:new l.Uniform1i(m,s.u_image),u_image_height:new l.Uniform1f(m,s.u_image_height)}),linePattern:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_texsize:new l.Uniform2f(m,s.u_texsize),u_ratio:new l.Uniform1f(m,s.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_image:new l.Uniform1i(m,s.u_image),u_units_to_pixels:new l.Uniform2f(m,s.u_units_to_pixels),u_scale:new l.Uniform3f(m,s.u_scale),u_fade:new l.Uniform1f(m,s.u_fade)}),lineSDF:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_ratio:new l.Uniform1f(m,s.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,s.u_units_to_pixels),u_patternscale_a:new l.Uniform2f(m,s.u_patternscale_a),u_patternscale_b:new l.Uniform2f(m,s.u_patternscale_b),u_sdfgamma:new l.Uniform1f(m,s.u_sdfgamma),u_image:new l.Uniform1i(m,s.u_image),u_tex_y_a:new l.Uniform1f(m,s.u_tex_y_a),u_tex_y_b:new l.Uniform1f(m,s.u_tex_y_b),u_mix:new l.Uniform1f(m,s.u_mix)}),raster:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_tl_parent:new l.Uniform2f(m,s.u_tl_parent),u_scale_parent:new l.Uniform1f(m,s.u_scale_parent),u_buffer_scale:new l.Uniform1f(m,s.u_buffer_scale),u_fade_t:new l.Uniform1f(m,s.u_fade_t),u_opacity:new l.Uniform1f(m,s.u_opacity),u_image0:new l.Uniform1i(m,s.u_image0),u_image1:new l.Uniform1i(m,s.u_image1),u_brightness_low:new l.Uniform1f(m,s.u_brightness_low),u_brightness_high:new l.Uniform1f(m,s.u_brightness_high),u_saturation_factor:new l.Uniform1f(m,s.u_saturation_factor),u_contrast_factor:new l.Uniform1f(m,s.u_contrast_factor),u_spin_weights:new l.Uniform3f(m,s.u_spin_weights)}),symbolIcon:(m,s)=>({u_is_size_zoom_constant:new l.Uniform1i(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,s.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,s.u_size_t),u_size:new l.Uniform1f(m,s.u_size),u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,s.u_pitch),u_rotate_symbol:new l.Uniform1i(m,s.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,s.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,s.u_fade_change),u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,s.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,s.u_coord_matrix),u_is_text:new l.Uniform1i(m,s.u_is_text),u_pitch_with_map:new l.Uniform1i(m,s.u_pitch_with_map),u_texsize:new l.Uniform2f(m,s.u_texsize),u_texture:new l.Uniform1i(m,s.u_texture)}),symbolSDF:(m,s)=>({u_is_size_zoom_constant:new l.Uniform1i(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,s.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,s.u_size_t),u_size:new l.Uniform1f(m,s.u_size),u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,s.u_pitch),u_rotate_symbol:new l.Uniform1i(m,s.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,s.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,s.u_fade_change),u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,s.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,s.u_coord_matrix),u_is_text:new l.Uniform1i(m,s.u_is_text),u_pitch_with_map:new l.Uniform1i(m,s.u_pitch_with_map),u_texsize:new l.Uniform2f(m,s.u_texsize),u_texture:new l.Uniform1i(m,s.u_texture),u_gamma_scale:new l.Uniform1f(m,s.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(m,s.u_is_halo)}),symbolTextAndIcon:(m,s)=>({u_is_size_zoom_constant:new l.Uniform1i(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,s.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,s.u_size_t),u_size:new l.Uniform1f(m,s.u_size),u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,s.u_pitch),u_rotate_symbol:new l.Uniform1i(m,s.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,s.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,s.u_fade_change),u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,s.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,s.u_coord_matrix),u_is_text:new l.Uniform1i(m,s.u_is_text),u_pitch_with_map:new l.Uniform1i(m,s.u_pitch_with_map),u_texsize:new l.Uniform2f(m,s.u_texsize),u_texsize_icon:new l.Uniform2f(m,s.u_texsize_icon),u_texture:new l.Uniform1i(m,s.u_texture),u_texture_icon:new l.Uniform1i(m,s.u_texture_icon),u_gamma_scale:new l.Uniform1f(m,s.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(m,s.u_is_halo)}),background:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_opacity:new l.Uniform1f(m,s.u_opacity),u_color:new l.UniformColor(m,s.u_color)}),backgroundPattern:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_opacity:new l.Uniform1f(m,s.u_opacity),u_image:new l.Uniform1i(m,s.u_image),u_pattern_tl_a:new l.Uniform2f(m,s.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(m,s.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(m,s.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(m,s.u_pattern_br_b),u_texsize:new l.Uniform2f(m,s.u_texsize),u_mix:new l.Uniform1f(m,s.u_mix),u_pattern_size_a:new l.Uniform2f(m,s.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(m,s.u_pattern_size_b),u_scale_a:new l.Uniform1f(m,s.u_scale_a),u_scale_b:new l.Uniform1f(m,s.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,s.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(m,s.u_tile_units_to_pixels)}),terrain:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_texture:new l.Uniform1i(m,s.u_texture)}),terrainDepth:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix)}),terrainCoords:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_texture:new l.Uniform1i(m,s.u_texture),u_terrain_coords_id:new l.Uniform1f(m,s.u_terrain_coords_id)})};class Tu{constructor(s,h,p){this.context=s;const _=s.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Su={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Au{constructor(s,h,p,_){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=_,this.context=s;const x=s.gl;this.buffer=x.createBuffer(),s.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let p=0;p<this.attributes.length;p++){const _=h.attributes[this.attributes[p].name];_!==void 0&&s.enableVertexAttribArray(_)}}setVertexAttribPointers(s,h,p){for(let _=0;_<this.attributes.length;_++){const x=this.attributes[_],E=h.attributes[x.name];E!==void 0&&s.vertexAttribPointer(E,x.components,s[Su[x.type]],!1,this.itemSize,x.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Kt{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Bd extends Kt{getDefault(){return l.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class rg extends Kt{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Xa extends Kt{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Ya extends Kt{getDefault(){return[!0,!0,!0,!0]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Nd extends Kt{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class sr extends Kt{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Pu extends Kt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Zl extends Kt{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Xl extends Kt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class Iu extends Kt{getDefault(){return[0,1]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Cu extends Kt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class Yl extends Kt{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Mu extends Kt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class Lu extends Kt{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Kl extends Kt{getDefault(){return l.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Ud extends Kt{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class Vd extends Kt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class na extends Kt{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class sg extends Kt{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class og extends Kt{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class ag extends Kt{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class lg extends Kt{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class cg extends Kt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class ug extends Kt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class ku extends Kt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class Jl extends Kt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Ru extends Kt{getDefault(){return null}set(s){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Du extends Kt{constructor(s){super(s),this.vao=s.extVertexArrayObject}getDefault(){return null}set(s){this.vao&&(s!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(s),this.current=s,this.dirty=!1)}}class ia extends Kt{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class jd extends Kt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Gd extends Kt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Ql extends Kt{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class xo extends Ql{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class $d extends Ql{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class ra{constructor(s,h,p,_){this.context=s,this.width=h,this.height=p;const x=s.gl,E=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new xo(s,E),_&&(this.depthAttachment=new $d(s,E)),x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const s=this.context.gl,h=this.colorAttachment.get();if(h&&s.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&s.deleteRenderbuffer(p)}s.deleteFramebuffer(this.framebuffer)}}class mn{constructor(s,h,p){this.blendFunction=s,this.blendColor=h,this.mask=p}}mn.Replace=[1,0],mn.disabled=new mn(mn.Replace,l.Color.transparent,[!1,!1,!1,!1]),mn.unblended=new mn(mn.Replace,l.Color.transparent,[!0,!0,!0,!0]),mn.alphaBlended=new mn([1,771],l.Color.transparent,[!0,!0,!0,!0]);class Hd{constructor(s){this.gl=s,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Bd(this),this.clearDepth=new rg(this),this.clearStencil=new Xa(this),this.colorMask=new Ya(this),this.depthMask=new Nd(this),this.stencilMask=new sr(this),this.stencilFunc=new Pu(this),this.stencilOp=new Zl(this),this.stencilTest=new Xl(this),this.depthRange=new Iu(this),this.depthTest=new Cu(this),this.depthFunc=new Yl(this),this.blend=new Mu(this),this.blendFunc=new Lu(this),this.blendColor=new Kl(this),this.blendEquation=new Ud(this),this.cullFace=new Vd(this),this.cullFaceSide=new na(this),this.frontFace=new sg(this),this.program=new og(this),this.activeTexture=new ag(this),this.viewport=new lg(this),this.bindFramebuffer=new cg(this),this.bindRenderbuffer=new ug(this),this.bindTexture=new ku(this),this.bindVertexBuffer=new Jl(this),this.bindElementBuffer=new Ru(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Du(this),this.pixelStoreUnpack=new ia(this),this.pixelStoreUnpackPremultiplyAlpha=new jd(this),this.pixelStoreUnpackFlipY=new Gd(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=s.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(s.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h){return new Tu(this,s,h)}createVertexBuffer(s,h,p){return new Au(this,s,h,p)}createRenderbuffer(s,h,p){const _=this.gl,x=_.createRenderbuffer();return this.bindRenderbuffer.set(x),_.renderbufferStorage(_.RENDERBUFFER,s,h,p),this.bindRenderbuffer.set(null),x}createFramebuffer(s,h,p){return new ra(this,s,h,p)}clear({color:s,depth:h}){const p=this.gl;let _=0;s&&(_|=p.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(_|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p.clear(_)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){L(s.blendFunction,mn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class jt{constructor(s,h,p){this.func=s,this.mask=h,this.range=p}}jt.ReadOnly=!1,jt.ReadWrite=!0,jt.disabled=new jt(519,jt.ReadOnly,[0,1]);const Jt=7680;class fn{constructor(s,h,p,_,x,E){this.test=s,this.ref=h,this.mask=p,this.fail=_,this.depthFail=x,this.pass=E}}fn.disabled=new fn({func:519,mask:0},0,0,Jt,Jt,Jt);class vn{constructor(s,h,p){this.enable=s,this.mode=h,this.frontFace=p}}let Ka;function sa(m,s,h,p,_,x,E){const A=m.context,I=A.gl,k=m.useProgram("collisionBox"),z=[];let B=0,j=0;for(let re=0;re<p.length;re++){const Ee=p[re],be=s.getTile(Ee),Le=be.getBucket(h);if(!Le)continue;let ke=Ee.posMatrix;_[0]===0&&_[1]===0||(ke=m.translatePosMatrix(Ee.posMatrix,be,_,x));const Be=E?Le.textCollisionBox:Le.iconCollisionBox,Ce=Le.collisionCircleArray;if(Ce.length>0){const et=l.create(),qe=ke;l.mul(et,Le.placementInvProjMatrix,m.transform.glCoordMatrix),l.mul(et,et,Le.placementViewportMatrix),z.push({circleArray:Ce,circleOffset:j,transform:qe,invTransform:et,coord:Ee}),B+=Ce.length/4,j=B}Be&&k.draw(A,I.LINES,jt.disabled,fn.disabled,m.colorModeForRenderPass(),vn.disabled,Es(ke,m.transform,be),m.style.terrain&&m.style.terrain.getTerrainData(Ee),h.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,m.transform.zoom,null,null,Be.collisionVertexBuffer)}if(!E||!z.length)return;const ie=m.useProgram("collisionCircle"),te=new l.CollisionCircleLayoutArray;te.resize(4*B),te._trim();let ne=0;for(const re of z)for(let Ee=0;Ee<re.circleArray.length/4;Ee++){const be=4*Ee,Le=re.circleArray[be+0],ke=re.circleArray[be+1],Be=re.circleArray[be+2],Ce=re.circleArray[be+3];te.emplace(ne++,Le,ke,Be,Ce,0),te.emplace(ne++,Le,ke,Be,Ce,1),te.emplace(ne++,Le,ke,Be,Ce,2),te.emplace(ne++,Le,ke,Be,Ce,3)}(!Ka||Ka.length<2*B)&&(Ka=function(re){const Ee=2*re,be=new l.QuadTriangleArray;be.resize(Ee),be._trim();for(let Le=0;Le<Ee;Le++){const ke=6*Le;be.uint16[ke+0]=4*Le+0,be.uint16[ke+1]=4*Le+1,be.uint16[ke+2]=4*Le+2,be.uint16[ke+3]=4*Le+2,be.uint16[ke+4]=4*Le+3,be.uint16[ke+5]=4*Le+0}return be}(B));const de=A.createIndexBuffer(Ka,!0),ge=A.createVertexBuffer(te,l.collisionCircleLayout.members,!0);for(const re of z){const Ee={u_matrix:re.transform,u_inv_matrix:re.invTransform,u_camera_to_center_distance:(xe=m.transform).cameraToCenterDistance,u_viewport_size:[xe.width,xe.height]};ie.draw(A,I.TRIANGLES,jt.disabled,fn.disabled,m.colorModeForRenderPass(),vn.disabled,Ee,m.style.terrain&&m.style.terrain.getTerrainData(re.coord),h.id,ge,de,l.SegmentVector.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,m.transform.zoom,null,null,null)}var xe;ge.destroy(),de.destroy()}vn.disabled=new vn(!1,1029,2305),vn.backCCW=new vn(!0,1029,2305);const hg=l.identity(new Float32Array(16));function dg(m,s,h,p,_,x){const{horizontalAlign:E,verticalAlign:A}=l.getAnchorAlignment(m),I=-(E-.5)*s,k=-(A-.5)*h,z=l.evaluateVariableOffset(m,p);return new l.pointGeometry((I/_+z[0])*x,(k/_+z[1])*x)}function Wd(m,s,h,p,_,x,E,A,I,k,z){const B=m.text.placedSymbolArray,j=m.text.dynamicLayoutVertexArray,ie=m.icon.dynamicLayoutVertexArray,te={};j.clear();for(let ne=0;ne<B.length;ne++){const de=B.get(ne),ge=m.allowVerticalPlacement&&!de.placedOrientation,xe=de.hidden||!de.crossTileID||ge?null:p[de.crossTileID];if(xe){const re=new l.pointGeometry(de.anchorX,de.anchorY),Ee=Bt(re,h?E:x,z),be=$i(_.cameraToCenterDistance,Ee.signedDistanceFromCamera);let Le=l.evaluateSizeForFeature(m.textSizeData,I,de)*be/l.ONE_EM;h&&(Le*=m.tilePixelRatio/A);const{width:ke,height:Be,anchor:Ce,textOffset:et,textBoxScale:qe}=xe,nt=dg(Ce,ke,Be,et,qe,Le),Ct=h?Bt(re.add(nt),x,z).point:Ee.point.add(s?nt.rotate(-_.angle):nt),Rt=m.allowVerticalPlacement&&de.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let _t=0;_t<de.numGlyphs;_t++)l.addDynamicAttributes(j,Ct,Rt);k&&de.associatedIconIndex>=0&&(te[de.associatedIconIndex]={shiftedAnchor:Ct,angle:Rt})}else At(de.numGlyphs,j)}if(k){ie.clear();const ne=m.icon.placedSymbolArray;for(let de=0;de<ne.length;de++){const ge=ne.get(de);if(ge.hidden)At(ge.numGlyphs,ie);else{const xe=te[de];if(xe)for(let re=0;re<ge.numGlyphs;re++)l.addDynamicAttributes(ie,xe.shiftedAnchor,xe.angle);else At(ge.numGlyphs,ie)}}m.icon.dynamicLayoutVertexBuffer.updateData(ie)}m.text.dynamicLayoutVertexBuffer.updateData(j)}function fg(m,s,h){return h.iconsInText&&s?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function ec(m,s,h,p,_,x,E,A,I,k,z,B){const j=m.context,ie=j.gl,te=m.transform,ne=A==="map",de=I==="map",ge=A!=="viewport"&&h.layout.get("symbol-placement")!=="point",xe=ne&&!de&&!ge,re=!h.layout.get("symbol-sort-key").isConstant();let Ee=!1;const be=m.depthModeForSublayer(0,jt.ReadOnly),Le=h.layout.get("text-variable-anchor"),ke=[];for(const Be of p){const Ce=s.getTile(Be),et=Ce.getBucket(h);if(!et)continue;const qe=_?et.text:et.icon;if(!qe||!qe.segments.get().length)continue;const nt=qe.programConfigurations.get(h.id),Ct=_||et.sdfIcons,Rt=_?et.textSizeData:et.iconSizeData,_t=de||te.pitch!==0,sn=m.useProgram(fg(Ct,_,et),nt),on=l.evaluateSizeForZoom(Rt,te.zoom),$t=m.style.terrain&&m.style.terrain.getTerrainData(Be);let Ht,ln,ai,cs,Br=[0,0],us=null;if(_){if(ln=Ce.glyphAtlasTexture,ai=ie.LINEAR,Ht=Ce.glyphAtlasTexture.size,et.iconsInText){Br=Ce.imageAtlasTexture.size,us=Ce.imageAtlasTexture;const Tr=Rt.kind==="composite"||Rt.kind==="camera";cs=_t||m.options.rotating||m.options.zooming||Tr?ie.LINEAR:ie.NEAREST}}else{const Tr=h.layout.get("icon-size").constantOr(0)!==1||et.iconsNeedLinear;ln=Ce.imageAtlasTexture,ai=Ct||m.options.rotating||m.options.zooming||Tr||_t?ie.LINEAR:ie.NEAREST,Ht=Ce.imageAtlasTexture.size}const eo=Ln(Ce,1,m.transform.zoom),Er=rs(Be.posMatrix,de,ne,m.transform,eo),Wi=Ei(Be.posMatrix,de,ne,m.transform,eo),As=Le&&et.hasTextData(),lc=h.layout.get("icon-text-fit")!=="none"&&As&&et.hasIconData();if(ge){const Tr=m.style.terrain?(Xu,ha)=>m.style.terrain.getElevation(Be,Xu,ha):null,To=h.layout.get("text-rotation-alignment")==="map";Di(et,Be.posMatrix,m,_,Er,Wi,de,k,To,Tr)}const Qn=m.translatePosMatrix(Be.posMatrix,Ce,x,E),Ft=ge||_&&Le||lc?hg:Er,en=m.translatePosMatrix(Wi,Ce,x,E,!0),li=Ct&&h.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ci;ci=Ct?et.iconsInText?Fd(Rt.kind,on,xe,de,m,Qn,Ft,en,Ht,Br):ql(Rt.kind,on,xe,de,m,Qn,Ft,en,_,Ht,!0):wu(Rt.kind,on,xe,de,m,Qn,Ft,en,_,Ht);const bn={program:sn,buffers:qe,uniformValues:ci,atlasTexture:ln,atlasTextureIcon:us,atlasInterpolation:ai,atlasInterpolationIcon:cs,isSDF:Ct,hasHalo:li};if(re&&et.canOverlap){Ee=!0;const Tr=qe.segments.get();for(const To of Tr)ke.push({segments:new l.SegmentVector([To]),sortKey:To.sortKey,state:bn,terrainData:$t})}else ke.push({segments:qe.segments,sortKey:0,state:bn,terrainData:$t})}Ee&&ke.sort((Be,Ce)=>Be.sortKey-Ce.sortKey);for(const Be of ke){const Ce=Be.state;if(j.activeTexture.set(ie.TEXTURE0),Ce.atlasTexture.bind(Ce.atlasInterpolation,ie.CLAMP_TO_EDGE),Ce.atlasTextureIcon&&(j.activeTexture.set(ie.TEXTURE1),Ce.atlasTextureIcon&&Ce.atlasTextureIcon.bind(Ce.atlasInterpolationIcon,ie.CLAMP_TO_EDGE)),Ce.isSDF){const et=Ce.uniformValues;Ce.hasHalo&&(et.u_is_halo=1,Ja(Ce.buffers,Be.segments,h,m,Ce.program,be,z,B,et,Be.terrainData)),et.u_is_halo=0}Ja(Ce.buffers,Be.segments,h,m,Ce.program,be,z,B,Ce.uniformValues,Be.terrainData)}}function Ja(m,s,h,p,_,x,E,A,I,k){const z=p.context;_.draw(z,z.gl.TRIANGLES,x,E,A,vn.disabled,I,k,h.id,m.layoutVertexBuffer,m.indexBuffer,s,h.paint,p.transform.zoom,m.programConfigurations.get(h.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Qa(m,s,h,p,_,x,E){const A=m.context.gl,I=h.paint.get("fill-pattern"),k=I&&I.constantOr(1),z=h.getCrossfadeParameters();let B,j,ie,te,ne;E?(j=k&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=A.LINES):(j=k?"fillPattern":"fill",B=A.TRIANGLES);for(const de of p){const ge=s.getTile(de);if(k&&!ge.patternsLoaded())continue;const xe=ge.getBucket(h);if(!xe)continue;const re=xe.programConfigurations.get(h.id),Ee=m.useProgram(j,re),be=m.style.terrain&&m.style.terrain.getTerrainData(de);k&&(m.context.activeTexture.set(A.TEXTURE0),ge.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),re.updatePaintBuffers(z));const Le=I.constantOr(null);if(Le&&ge.imageAtlas){const Ce=ge.imageAtlas,et=Ce.patternPositions[Le.to.toString()],qe=Ce.patternPositions[Le.from.toString()];et&&qe&&re.setConstantPatternPositions(et,qe)}const ke=be?de:null,Be=m.translatePosMatrix(ke?ke.posMatrix:de.posMatrix,ge,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(E){te=xe.indexBuffer2,ne=xe.segments2;const Ce=[A.drawingBufferWidth,A.drawingBufferHeight];ie=j==="fillOutlinePattern"&&k?Za(Be,m,z,ge,Ce):ta(Be,Ce)}else te=xe.indexBuffer,ne=xe.segments,ie=k?ea(Be,m,z,ge):Qo(Be);Ee.draw(m.context,B,_,m.stencilModeForClipping(de),x,vn.disabled,ie,be,h.id,xe.layoutVertexBuffer,te,ne,h.paint,m.transform.zoom,re)}}function el(m,s,h,p,_,x,E){const A=m.context,I=A.gl,k=h.paint.get("fill-extrusion-pattern"),z=k.constantOr(1),B=h.getCrossfadeParameters(),j=h.paint.get("fill-extrusion-opacity");for(const ie of p){const te=s.getTile(ie),ne=te.getBucket(h);if(!ne)continue;const de=m.style.terrain&&m.style.terrain.getTerrainData(ie),ge=ne.programConfigurations.get(h.id),xe=m.useProgram(z?"fillExtrusionPattern":"fillExtrusion",ge);z&&(m.context.activeTexture.set(I.TEXTURE0),te.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),ge.updatePaintBuffers(B));const re=k.constantOr(null);if(re&&te.imageAtlas){const ke=te.imageAtlas,Be=ke.patternPositions[re.to.toString()],Ce=ke.patternPositions[re.from.toString()];Be&&Ce&&ge.setConstantPatternPositions(Be,Ce)}const Ee=m.translatePosMatrix(ie.posMatrix,te,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),be=h.paint.get("fill-extrusion-vertical-gradient"),Le=z?Or(Ee,m,be,j,ie,B,te):qs(Ee,m,be,j);xe.draw(A,A.gl.TRIANGLES,_,x,E,vn.backCCW,Le,de,h.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,h.paint,m.transform.zoom,ge,m.style.terrain&&ne.centroidVertexBuffer)}}function zu(m,s,h,p,_,x,E){const A=m.context,I=A.gl,k=h.fbo;if(!k)return;const z=m.useProgram("hillshade"),B=m.style.terrain&&m.style.terrain.getTerrainData(s);A.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,k.colorAttachment.get()),z.draw(A,I.TRIANGLES,_,x,E,vn.disabled,((j,ie,te,ne)=>{const de=te.paint.get("hillshade-shadow-color"),ge=te.paint.get("hillshade-highlight-color"),xe=te.paint.get("hillshade-accent-color");let re=te.paint.get("hillshade-illumination-direction")*(Math.PI/180);te.paint.get("hillshade-illumination-anchor")==="viewport"&&(re-=j.transform.angle);const Ee=!j.options.moving;return{u_matrix:ne?ne.posMatrix:j.transform.calculatePosMatrix(ie.tileID.toUnwrapped(),Ee),u_image:0,u_latrange:Ae(0,ie.tileID),u_light:[te.paint.get("hillshade-exaggeration"),re],u_shadow:de,u_highlight:ge,u_accent:xe}})(m,h,p,B?s:null),B,p.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function qd(m,s,h,p,_,x){const E=m.context,A=E.gl,I=s.dem;if(I&&I.data){const k=I.dim,z=I.stride,B=I.getPixels();if(E.activeTexture.set(A.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||m.getTileTexture(z),s.demTexture){const ie=s.demTexture;ie.update(B,{premultiply:!1}),ie.bind(A.NEAREST,A.CLAMP_TO_EDGE)}else s.demTexture=new ee(E,B,A.RGBA,{premultiply:!1}),s.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);E.activeTexture.set(A.TEXTURE0);let j=s.fbo;if(!j){const ie=new ee(E,{width:k,height:k,data:null},A.RGBA);ie.bind(A.LINEAR,A.CLAMP_TO_EDGE),j=s.fbo=E.createFramebuffer(k,k,!0),j.colorAttachment.set(ie.texture)}E.bindFramebuffer.set(j.framebuffer),E.viewport.set([0,0,k,k]),m.useProgram("hillshadePrepare").draw(E,A.TRIANGLES,p,_,x,vn.disabled,((ie,te)=>{const ne=te.stride,de=l.create();return l.ortho(de,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(de,de,[0,-l.EXTENT,0]),{u_matrix:de,u_image:1,u_dimension:[ne,ne],u_zoom:ie.overscaledZ,u_unpack:te.getUnpackVector()}})(s.tileID,I),null,h.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function tc(m,s,h,p,_,x){const E=p.paint.get("raster-fade-duration");if(!x&&E>0){const A=l.exported.now(),I=(A-m.timeAdded)/E,k=s?(A-s.timeAdded)/E:-1,z=h.getSource(),B=_.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),j=!s||Math.abs(s.tileID.overscaledZ-B)>Math.abs(m.tileID.overscaledZ-B),ie=j&&m.refreshedUponExpiration?1:l.clamp(j?I:1-k,0,1);return m.refreshedUponExpiration&&I>=1&&(m.refreshedUponExpiration=!1),s?{opacity:1,mix:1-ie}:{opacity:ie,mix:0}}return{opacity:1,mix:0}}const nc=new l.Color(1,0,0,1),Fr=new l.Color(0,1,0,1),Zd=new l.Color(0,0,1,1),Ou=new l.Color(1,0,1,1),Xd=new l.Color(0,1,1,1);function bo(m,s,h,p){oa(m,0,s+h/2,m.transform.width,h,p)}function tl(m,s,h,p){oa(m,s-h/2,0,h,m.transform.height,p)}function oa(m,s,h,p,_,x){const E=m.context,A=E.gl;A.enable(A.SCISSOR_TEST),A.scissor(s*m.pixelRatio,h*m.pixelRatio,p*m.pixelRatio,_*m.pixelRatio),E.clear({color:x}),A.disable(A.SCISSOR_TEST)}function pg(m,s,h){const p=m.context,_=p.gl,x=h.posMatrix,E=m.useProgram("debug"),A=jt.disabled,I=fn.disabled,k=m.colorModeForRenderPass(),z="$debug",B=m.style.terrain&&m.style.terrain.getTerrainData(h);p.activeTexture.set(_.TEXTURE0),m.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE);const j=s.getTileByID(h.key).latestRawTileData,ie=Math.floor((j&&j.byteLength||0)/1024),te=s.getTile(h).tileSize,ne=512/Math.min(te,512)*(h.overscaledZ/m.transform.zoom)*.5;let de=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(de+=` => ${h.overscaledZ}`),function(ge,xe){ge.initDebugOverlayCanvas();const re=ge.debugOverlayCanvas,Ee=ge.context.gl,be=ge.debugOverlayCanvas.getContext("2d");be.clearRect(0,0,re.width,re.height),be.shadowColor="white",be.shadowBlur=2,be.lineWidth=1.5,be.strokeStyle="white",be.textBaseline="top",be.font="bold 36px Open Sans, sans-serif",be.fillText(xe,5,5),be.strokeText(xe,5,5),ge.debugOverlayTexture.update(re),ge.debugOverlayTexture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE)}(m,`${de} ${ie}kB`),E.draw(p,_.TRIANGLES,A,I,mn.alphaBlended,vn.disabled,G(x,l.Color.transparent,ne),null,z,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),E.draw(p,_.LINE_STRIP,A,I,k,vn.disabled,G(x,l.Color.red),B,z,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function ic(m,s,h){const p=m.context,_=p.gl,x=m.colorModeForRenderPass(),E=new jt(_.LEQUAL,jt.ReadWrite,m.depthRangeFor3D),A=m.useProgram("terrain"),I=s.getTerrainMesh(),k=s.getTerrainData(h.tileID);p.bindFramebuffer.set(null),p.viewport.set([0,0,m.width,m.height]),p.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,s.getRTTFramebuffer().colorAttachment.get());const z=m.transform.calculatePosMatrix(h.tileID.toUnwrapped());A.draw(p,_.TRIANGLES,E,fn.disabled,x,vn.backCCW,{u_matrix:z,u_texture:0},k,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}function Yd(m,s,h,p){const _=m.context,x=h.tileSize*s.qualityFactor;h.textures[p]||(h.textures[p]=m.getTileTexture(x)||new ee(_,{width:x,height:x,data:null},_.gl.RGBA),h.textures[p].bind(_.gl.LINEAR,_.gl.CLAMP_TO_EDGE),p===0&&s.sourceCache.renderHistory.unshift(h.tileID.key));const E=s.getRTTFramebuffer();E.colorAttachment.set(h.textures[p].texture),_.bindFramebuffer.set(E.framebuffer),_.viewport.set([0,0,x,x])}class Kd{constructor(s){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=s,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=s.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const s=this.painter.style,h=s.terrain;for(const p in s.sourceCaches){this._coordsDescendingInv[p]={};const _=s.sourceCaches[p].getVisibleCoordinates();for(const x of _){const E=h.sourceCache.getTerrainCoords(x);for(const A in E)this._coordsDescendingInv[p][A]||(this._coordsDescendingInv[p][A]=[]),this._coordsDescendingInv[p][A].push(E[A])}}for(const p of s._order){const _=s._layers[p],x=_.source;if(this._renderToTexture[_.type]&&!this._coordsDescendingInvStr[x]){this._coordsDescendingInvStr[x]={};for(const E in this._coordsDescendingInv[x])this._coordsDescendingInvStr[x][E]=this._coordsDescendingInv[x][E].map(A=>A.key).sort().join()}}return this._renderableTiles.forEach(p=>{for(const _ in this._coordsDescendingInvStr){const x=this._coordsDescendingInvStr[_][p.tileID.key];x&&x!==p.textureCoords[_]&&p.clearTextures(this.painter),h.needsRerender(_,p.tileID)&&p.clearTextures(this.painter)}this._rerender[p.tileID.key]=!p.textures.length}),h.clearRerenderCache(),h.sourceCache.removeOutdated(this.painter),this}renderLayer(s){const h=s.type,p=this.painter,_=p.style._order,x=p.currentLayer,E=x+1===_.length;if(this._renderToTexture[h]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(_[x]),!E))return!0;if(this._renderToTexture[this._prevType]||h==="hillshade"||this._renderToTexture[h]&&E){this._prevType=h;const A=this._stacks.length-1,I=this._stacks[A]||[];for(const k of this._renderableTiles){if(Yd(p,p.style.terrain,k,A),this._rerender[k.tileID.key]){p.context.clear({color:l.Color.transparent});for(let z=0;z<I.length;z++){const B=p.style._layers[I[z]],j=B.source?this._coordsDescendingInv[B.source][k.tileID.key]:[k.tileID];p._renderTileClippingMasks(B,j),p.renderLayer(p,p.style.sourceCaches[B.source],B,j),B.source&&(k.textureCoords[B.source]=this._coordsDescendingInvStr[B.source][k.tileID.key])}}ic(p,p.style.terrain,k)}if(h==="hillshade"){this._stacks.push([_[x]]);for(const k of this._renderableTiles){const z=this._coordsDescendingInv[s.source][k.tileID.key];Yd(p,p.style.terrain,k,this._stacks.length-1),p.context.clear({color:l.Color.transparent}),p._renderTileClippingMasks(s,z),p.renderLayer(p,p.style.sourceCaches[s.source],s,z),ic(p,p.style.terrain,k)}return!0}return this._renderToTexture[h]}return!1}}const nl={symbol:function(m,s,h,p,_){if(m.renderPass!=="translucent")return;const x=fn.disabled,E=m.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(A,I,k,z,B,j,ie){const te=I.transform,ne=B==="map",de=j==="map";for(const ge of A){const xe=z.getTile(ge),re=xe.getBucket(k);if(!re||!re.text||!re.text.segments.get().length)continue;const Ee=l.evaluateSizeForZoom(re.textSizeData,te.zoom),be=Ln(xe,1,I.transform.zoom),Le=rs(ge.posMatrix,de,ne,I.transform,be),ke=k.layout.get("icon-text-fit")!=="none"&&re.hasIconData();if(Ee){const Be=Math.pow(2,te.zoom-xe.tileID.overscaledZ);Wd(re,ne,de,ie,te,Le,ge.posMatrix,Be,Ee,ke,I.style.terrain?(Ce,et)=>I.style.terrain.getElevation(ge,Ce,et):null)}}}(p,m,h,s,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),_),h.paint.get("icon-opacity").constantOr(1)!==0&&ec(m,s,h,p,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),x,E),h.paint.get("text-opacity").constantOr(1)!==0&&ec(m,s,h,p,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),x,E),s.map.showCollisionBoxes&&(sa(m,s,h,p,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),sa(m,s,h,p,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(m,s,h,p){if(m.renderPass!=="translucent")return;const _=h.paint.get("circle-opacity"),x=h.paint.get("circle-stroke-width"),E=h.paint.get("circle-stroke-opacity"),A=!h.layout.get("circle-sort-key").isConstant();if(_.constantOr(1)===0&&(x.constantOr(1)===0||E.constantOr(1)===0))return;const I=m.context,k=I.gl,z=m.depthModeForSublayer(0,jt.ReadOnly),B=fn.disabled,j=m.colorModeForRenderPass(),ie=[];for(let te=0;te<p.length;te++){const ne=p[te],de=s.getTile(ne),ge=de.getBucket(h);if(!ge)continue;const xe=ge.programConfigurations.get(h.id),re=m.useProgram("circle",xe),Ee=ge.layoutVertexBuffer,be=ge.indexBuffer,Le=m.style.terrain&&m.style.terrain.getTerrainData(ne),ke={programConfiguration:xe,program:re,layoutVertexBuffer:Ee,indexBuffer:be,uniformValues:Wl(m,ne,de,h),terrainData:Le};if(A){const Be=ge.segments.get();for(const Ce of Be)ie.push({segments:new l.SegmentVector([Ce]),sortKey:Ce.sortKey,state:ke})}else ie.push({segments:ge.segments,sortKey:0,state:ke})}A&&ie.sort((te,ne)=>te.sortKey-ne.sortKey);for(const te of ie){const{programConfiguration:ne,program:de,layoutVertexBuffer:ge,indexBuffer:xe,uniformValues:re,terrainData:Ee}=te.state;de.draw(I,k.TRIANGLES,z,B,j,vn.disabled,re,Ee,h.id,ge,xe,te.segments,h.paint,m.transform.zoom,ne)}},heatmap:function(m,s,h,p){if(h.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const _=m.context,x=_.gl,E=fn.disabled,A=new mn([x.ONE,x.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(I,k,z){const B=I.gl;I.activeTexture.set(B.TEXTURE1),I.viewport.set([0,0,k.width/4,k.height/4]);let j=z.heatmapFbo;if(j)B.bindTexture(B.TEXTURE_2D,j.colorAttachment.get()),I.bindFramebuffer.set(j.framebuffer);else{const ie=B.createTexture();B.bindTexture(B.TEXTURE_2D,ie),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR),j=z.heatmapFbo=I.createFramebuffer(k.width/4,k.height/4,!1),function(te,ne,de,ge){const xe=te.gl;xe.texImage2D(xe.TEXTURE_2D,0,xe.RGBA,ne.width/4,ne.height/4,0,xe.RGBA,te.extRenderToTextureHalfFloat?te.extTextureHalfFloat.HALF_FLOAT_OES:xe.UNSIGNED_BYTE,null),ge.colorAttachment.set(de)}(I,k,ie,j)}})(_,m,h),_.clear({color:l.Color.transparent});for(let I=0;I<p.length;I++){const k=p[I];if(s.hasRenderableParent(k))continue;const z=s.getTile(k),B=z.getBucket(h);if(!B)continue;const j=B.programConfigurations.get(h.id),ie=m.useProgram("heatmap",j),{zoom:te}=m.transform;ie.draw(_,x.TRIANGLES,jt.disabled,E,A,vn.disabled,ue(k.posMatrix,z,te,h.paint.get("heatmap-intensity")),null,h.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,h.paint,m.transform.zoom,j)}_.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(_,x){const E=_.context,A=E.gl,I=x.heatmapFbo;if(!I)return;E.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,I.colorAttachment.get()),E.activeTexture.set(A.TEXTURE1);let k=x.colorRampTexture;k||(k=x.colorRampTexture=new ee(E,x.colorRamp,A.RGBA)),k.bind(A.LINEAR,A.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(E,A.TRIANGLES,jt.disabled,fn.disabled,_.colorModeForRenderPass(),vn.disabled,((z,B,j,ie)=>{const te=l.create();l.ortho(te,0,z.width,z.height,0,0,1);const ne=z.context.gl;return{u_matrix:te,u_world:[ne.drawingBufferWidth,ne.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:B.paint.get("heatmap-opacity")}})(_,x),null,x.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,x.paint,_.transform.zoom)}(m,h))},line:function(m,s,h,p){if(m.renderPass!=="translucent")return;const _=h.paint.get("line-opacity"),x=h.paint.get("line-width");if(_.constantOr(1)===0||x.constantOr(1)===0)return;const E=m.depthModeForSublayer(0,jt.ReadOnly),A=m.colorModeForRenderPass(),I=h.paint.get("line-dasharray"),k=h.paint.get("line-pattern"),z=k.constantOr(1),B=h.paint.get("line-gradient"),j=h.getCrossfadeParameters(),ie=z?"linePattern":I?"lineSDF":B?"lineGradient":"line",te=m.context,ne=te.gl;let de=!0;for(const ge of p){const xe=s.getTile(ge);if(z&&!xe.patternsLoaded())continue;const re=xe.getBucket(h);if(!re)continue;const Ee=re.programConfigurations.get(h.id),be=m.context.program.get(),Le=m.useProgram(ie,Ee),ke=de||Le.program!==be,Be=m.style.terrain&&m.style.terrain.getTerrainData(ge),Ce=k.constantOr(null);if(Ce&&xe.imageAtlas){const nt=xe.imageAtlas,Ct=nt.patternPositions[Ce.to.toString()],Rt=nt.patternPositions[Ce.from.toString()];Ct&&Rt&&Ee.setConstantPatternPositions(Ct,Rt)}const et=Be?ge:null,qe=z?Ot(m,xe,h,j,et):I?En(m,xe,h,I,j,et):B?at(m,xe,h,re.lineClipsArray.length,et):Ne(m,xe,h,et);if(z)te.activeTexture.set(ne.TEXTURE0),xe.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),Ee.updatePaintBuffers(j);else if(I&&(ke||m.lineAtlas.dirty))te.activeTexture.set(ne.TEXTURE0),m.lineAtlas.bind(te);else if(B){const nt=re.gradients[h.id];let Ct=nt.texture;if(h.gradientVersion!==nt.version){let Rt=256;if(h.stepInterpolant){const _t=s.getSource().maxzoom,sn=ge.canonical.z===_t?Math.ceil(1<<m.transform.maxZoom-ge.canonical.z):1;Rt=l.clamp(l.nextPowerOfTwo(re.maxLineLength/l.EXTENT*1024*sn),256,te.maxTextureSize)}nt.gradient=l.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Rt,image:nt.gradient||void 0,clips:re.lineClipsArray}),nt.texture?nt.texture.update(nt.gradient):nt.texture=new ee(te,nt.gradient,ne.RGBA),nt.version=h.gradientVersion,Ct=nt.texture}te.activeTexture.set(ne.TEXTURE0),Ct.bind(h.stepInterpolant?ne.NEAREST:ne.LINEAR,ne.CLAMP_TO_EDGE)}Le.draw(te,ne.TRIANGLES,E,m.stencilModeForClipping(ge),A,vn.disabled,qe,Be,h.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,h.paint,m.transform.zoom,Ee,re.layoutVertexBuffer2),de=!1}},fill:function(m,s,h,p){const _=h.paint.get("fill-color"),x=h.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const E=m.colorModeForRenderPass(),A=h.paint.get("fill-pattern"),I=m.opaquePassEnabledForLayer()&&!A.constantOr(1)&&_.constantOr(l.Color.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===I){const k=m.depthModeForSublayer(1,m.renderPass==="opaque"?jt.ReadWrite:jt.ReadOnly);Qa(m,s,h,p,k,E,!1)}if(m.renderPass==="translucent"&&h.paint.get("fill-antialias")){const k=m.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,jt.ReadOnly);Qa(m,s,h,p,k,E,!0)}},"fill-extrusion":function(m,s,h,p){const _=h.paint.get("fill-extrusion-opacity");if(_!==0&&m.renderPass==="translucent"){const x=new jt(m.context.gl.LEQUAL,jt.ReadWrite,m.depthRangeFor3D);if(_!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))el(m,s,h,p,x,fn.disabled,mn.disabled),el(m,s,h,p,x,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const E=m.colorModeForRenderPass();el(m,s,h,p,x,fn.disabled,E)}}},hillshade:function(m,s,h,p){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const _=m.context,x=m.depthModeForSublayer(0,jt.ReadOnly),E=m.colorModeForRenderPass(),[A,I]=m.renderPass==="translucent"?m.stencilConfigForOverlap(p):[{},p];for(const k of I){const z=s.getTile(k);z.needsHillshadePrepare!==void 0&&z.needsHillshadePrepare&&m.renderPass==="offscreen"?qd(m,z,h,x,fn.disabled,E):m.renderPass==="translucent"&&zu(m,k,z,h,x,A[k.overscaledZ],E)}_.viewport.set([0,0,m.width,m.height])},raster:function(m,s,h,p){if(m.renderPass!=="translucent"||h.paint.get("raster-opacity")===0||!p.length)return;const _=m.context,x=_.gl,E=s.getSource(),A=m.useProgram("raster"),I=m.colorModeForRenderPass(),[k,z]=E instanceof wt?[{},p]:m.stencilConfigForOverlap(p),B=z[z.length-1].overscaledZ,j=!m.options.moving;for(const ie of z){const te=m.depthModeForSublayer(ie.overscaledZ-B,h.paint.get("raster-opacity")===1?jt.ReadWrite:jt.ReadOnly,x.LESS),ne=s.getTile(ie);ne.registerFadeDuration(h.paint.get("raster-fade-duration"));const de=s.findLoadedParent(ie,0),ge=tc(ne,de,s,h,m.transform,m.style.terrain);let xe,re;const Ee=h.paint.get("raster-resampling")==="nearest"?x.NEAREST:x.LINEAR;_.activeTexture.set(x.TEXTURE0),ne.texture.bind(Ee,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(x.TEXTURE1),de?(de.texture.bind(Ee,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),xe=Math.pow(2,de.tileID.overscaledZ-ne.tileID.overscaledZ),re=[ne.tileID.canonical.x*xe%1,ne.tileID.canonical.y*xe%1]):ne.texture.bind(Ee,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST);const be=m.style.terrain&&m.style.terrain.getTerrainData(ie),Le=be?ie:null,ke=Le?Le.posMatrix:m.transform.calculatePosMatrix(ie.toUnwrapped(),j),Be=rr(ke,re||[0,0],xe||1,ge,h);E instanceof wt?A.draw(_,x.TRIANGLES,te,fn.disabled,I,vn.disabled,Be,be,h.id,E.boundsBuffer,m.quadTriangleIndexBuffer,E.boundsSegments):A.draw(_,x.TRIANGLES,te,k[ie.overscaledZ],I,vn.disabled,Be,be,h.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}},background:function(m,s,h,p){const _=h.paint.get("background-color"),x=h.paint.get("background-opacity");if(x===0)return;const E=m.context,A=E.gl,I=m.transform,k=I.tileSize,z=h.paint.get("background-pattern");if(m.isPatternMissing(z))return;const B=!z&&_.a===1&&x===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==B)return;const j=fn.disabled,ie=m.depthModeForSublayer(0,B==="opaque"?jt.ReadWrite:jt.ReadOnly),te=m.colorModeForRenderPass(),ne=m.useProgram(z?"backgroundPattern":"background"),de=p||I.coveringTiles({tileSize:k,terrain:m.style.terrain});z&&(E.activeTexture.set(A.TEXTURE0),m.imageManager.bind(m.context));const ge=h.getCrossfadeParameters();for(const xe of de){const re=p?xe.posMatrix:m.transform.calculatePosMatrix(xe.toUnwrapped()),Ee=z?ig(re,x,m,z,{tileID:xe,tileSize:k},ge):ng(re,x,_),be=m.style.terrain&&m.style.terrain.getTerrainData(xe);ne.draw(E,A.TRIANGLES,ie,j,te,vn.disabled,Ee,be,h.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}},debug:function(m,s,h){for(let p=0;p<h.length;p++)pg(m,s,h[p])},custom:function(m,s,h){const p=m.context,_=h.implementation;if(m.renderPass==="offscreen"){const x=_.prerender;x&&(m.setCustomLayerDefaults(),p.setColorMode(m.colorModeForRenderPass()),x.call(_,p.gl,m.transform.customLayerMatrix()),p.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),p.setColorMode(m.colorModeForRenderPass()),p.setStencilMode(fn.disabled);const x=_.renderingMode==="3d"?new jt(m.context.gl.LEQUAL,jt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,jt.ReadOnly);p.setDepthMode(x),_.render(p.gl,m.transform.customLayerMatrix()),p.setDirty(),m.setBaseState(),p.bindFramebuffer.set(null)}}};class Fu{constructor(s,h){this.context=new Hd(s),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.create(),renderTime:0},this.setup(),this.numSublayers=Wt.maxUnderzooming+Wt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ft,this.gpuTimers={}}resize(s,h,p){if(this.width=s*p,this.height=h*p,this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style._order)this.style._layers[_].resize()}setup(){const s=this.context,h=new l.PosArray;h.emplaceBack(0,0),h.emplaceBack(l.EXTENT,0),h.emplaceBack(0,l.EXTENT),h.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(h,Lt.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const p=new l.PosArray;p.emplaceBack(0,0),p.emplaceBack(l.EXTENT,0),p.emplaceBack(0,l.EXTENT),p.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=s.createVertexBuffer(p,Lt.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const _=new l.RasterBoundsArray;_.emplaceBack(0,0,0,0),_.emplaceBack(l.EXTENT,0,l.EXTENT,0),_.emplaceBack(0,l.EXTENT,0,l.EXTENT),_.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.rasterBoundsBuffer=s.createVertexBuffer(_,tt.members),this.rasterBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const x=new l.PosArray;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(x,Lt.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const E=new l.LineStripIndexArray;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(E);const A=new l.TriangleIndexArray;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(A),this.emptyTexture=new ee(s,{width:1,height:1,data:new Uint8Array([0,0,0,0])},s.gl.RGBA);const I=this.context.gl;this.stencilClearMode=new fn({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO)}clearStencil(){const s=this.context,h=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=l.create();l.ortho(p,0,this.width,this.height,0,0,1),l.scale(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,h.TRIANGLES,jt.disabled,this.stencilClearMode,mn.disabled,vn.disabled,J(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,h){if(this.currentStencilSource===s.source||!s.isTileClipped()||!h||!h.length)return;this.currentStencilSource=s.source;const p=this.context,_=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(mn.disabled),p.setDepthMode(jt.disabled);const x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of h){const A=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,I=this.style.terrain&&this.style.terrain.getTerrainData(E);x.draw(p,_.TRIANGLES,jt.disabled,new fn({func:_.ALWAYS,mask:0},A,255,_.KEEP,_.KEEP,_.REPLACE),mn.disabled,vn.disabled,J(E.posMatrix),I,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,h=this.context.gl;return new fn({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){const h=this.context.gl;return new fn({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){const h=this.context.gl,p=s.sort((E,A)=>A.overscaledZ-E.overscaledZ),_=p[p.length-1].overscaledZ,x=p[0].overscaledZ-_+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const E={};for(let A=0;A<x;A++)E[A+_]=new fn({func:h.GEQUAL,mask:255},A+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=x,[E,p]}return[{[_]:fn.disabled},p]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new mn([s.CONSTANT_COLOR,s.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?mn.unblended:mn.alphaBlended}depthModeForSublayer(s,h,p){if(!this.opaquePassEnabledForLayer())return jt.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new jt(p||this.context.gl.LEQUAL,h,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,h){this.style=s,this.options=h,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const p=this.style._order,_=this.style.sourceCaches,x=this.style.terrain&&new Kd(this);for(const k in _){const z=_[k];z.used&&z.prepare(this.context)}const E={},A={},I={};for(const k in _){const z=_[k];E[k]=z.getVisibleCoordinates(),A[k]=E[k].slice().reverse(),I[k]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<p.length;k++)if(this.style._layers[p[k]].is3D()){this.opaquePassCutoff=k;break}if(x){this.opaquePassCutoff=0;const k=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||k.length)&&(l.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(z,B){const j=z.context,ie=j.gl,te=mn.unblended,ne=new jt(ie.LEQUAL,jt.ReadWrite,[0,1]),de=B.getTerrainMesh(),ge=B.sourceCache.getRenderableTiles(),xe=z.useProgram("terrainDepth");j.bindFramebuffer.set(B.getFramebuffer("depth").framebuffer),j.viewport.set([0,0,z.width/devicePixelRatio,z.height/devicePixelRatio]),j.clear({color:l.Color.transparent,depth:1});for(const re of ge){const Ee=B.getTerrainData(re.tileID),be=z.transform.calculatePosMatrix(re.tileID.toUnwrapped());xe.draw(j,ie.TRIANGLES,ne,fn.disabled,te,vn.backCCW,{u_matrix:be},Ee,"terrain",de.vertexBuffer,de.indexBuffer,de.segments)}j.bindFramebuffer.set(null),j.viewport.set([0,0,z.width,z.height])}(this,this.style.terrain),function(z,B){const j=z.context,ie=j.gl,te=mn.unblended,ne=new jt(ie.LEQUAL,jt.ReadWrite,[0,1]),de=B.getTerrainMesh(),ge=B.getCoordsTexture(),xe=B.sourceCache.getRenderableTiles(),re=z.useProgram("terrainCoords");j.bindFramebuffer.set(B.getFramebuffer("coords").framebuffer),j.viewport.set([0,0,z.width/devicePixelRatio,z.height/devicePixelRatio]),j.clear({color:l.Color.transparent,depth:1}),B.coordsIndex=[];for(const Ee of xe){const be=B.getTerrainData(Ee.tileID);j.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_2D,ge.texture);const Le=z.transform.calculatePosMatrix(Ee.tileID.toUnwrapped());re.draw(j,ie.TRIANGLES,ne,fn.disabled,te,vn.backCCW,{u_matrix:Le,u_terrain_coords_id:(255-B.coordsIndex.length)/255,u_texture:0},be,"terrain",de.vertexBuffer,de.indexBuffer,de.segments),B.coordsIndex.push(Ee.tileID.key)}j.bindFramebuffer.set(null),j.viewport.set([0,0,z.width,z.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const k of p){const z=this.style._layers[k];if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const B=A[z.source];(z.type==="custom"||B.length)&&this.renderLayer(this,_[z.source],z,B)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!x)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[p[this.currentLayer]],z=_[k.source],B=E[k.source];this._renderTileClippingMasks(k,B),this.renderLayer(this,z,k,B)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const k=this.style._layers[p[this.currentLayer]],z=_[k.source];if(x&&x.renderLayer(k))continue;const B=(k.type==="symbol"?I:A)[k.source];this._renderTileClippingMasks(k,E[k.source]),this.renderLayer(this,z,k,B)}if(this.options.showTileBoundaries){let k,z;Object.values(this.style._layers).forEach(B=>{B.source&&!B.isHidden(this.transform.zoom)&&(B.source!==(z&&z.id)&&(z=this.style.sourceCaches[B.source]),(!k||k.getSource().maxzoom<z.getSource().maxzoom)&&(k=z))}),k&&nl.debug(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const z=k.transform.padding;bo(k,k.transform.height-(z.top||0),3,nc),bo(k,z.bottom||0,3,Fr),tl(k,z.left||0,3,Zd),tl(k,k.transform.width-(z.right||0),3,Ou);const B=k.transform.centerPoint;(function(j,ie,te,ne){oa(j,ie-1,te-10,2,20,ne),oa(j,ie-10,te-1,20,2,ne)})(k,B.x,k.transform.height-B.y,Xd)}(this),this.context.setDefault()}renderLayer(s,h,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||(_||[]).length)&&(this.id=p.id,this.gpuTimingStart(p),nl[p.type](s,h,p,_,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let p=this.gpuTimers[s.id];p||(p=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),p.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}queryGpuTimers(s){const h={};for(const p in s){const _=s[p],x=this.context.extTimerQuery,E=x.getQueryObjectEXT(_.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(_.query),h[p]=E}return h}translatePosMatrix(s,h,p,_,x){if(!p[0]&&!p[1])return s;const E=x?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(E){const k=Math.sin(E),z=Math.cos(E);p=[p[0]*z-p[1]*k,p[0]*k+p[1]*z]}const A=[x?p[0]:Ln(h,p[0],this.transform.zoom),x?p[1]:Ln(h,p[1],this.transform.zoom),0],I=new Float32Array(16);return l.translate(I,s,A),I}saveTileTexture(s){const h=this._tileTextures[s.size[0]];h?h.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const h=this._tileTextures[s];return h&&h.length>0?h.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const h=this.imageManager.getPattern(s.from.toString()),p=this.imageManager.getPattern(s.to.toString());return!h||!p}useProgram(s,h){this.cache=this.cache||{};const p=s+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new Ko(this.context,s,pi[s],h,Eu[s],this._showOverdrawInspector,this.style.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ee(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class rc{constructor(s,h){this.points=s,this.planes=h}static fromInvProjectionMatrix(s,h,p){const _=Math.pow(2,p),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const I=1/(A=l.transformMat4([],A,s))[3]/h*_;return l.mul$1(A,A,[I,I,1/A[3],I])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const I=l.sub([],x[A[0]],x[A[1]]),k=l.sub([],x[A[2]],x[A[1]]),z=l.normalize([],l.cross([],I,k)),B=-l.dot(z,x[A[1]]);return z.concat(B)});return new rc(x,E)}}class il{constructor(s,h){this.min=s,this.max=h,this.center=l.scale$1([],l.add([],this.min,this.max),.5)}quadrant(s){const h=[s%2==0,s<2],p=l.clone$2(this.min),_=l.clone$2(this.max);for(let x=0;x<h.length;x++)p[x]=h[x]?this.min[x]:this.center[x],_[x]=h[x]?this.center[x]:this.max[x];return _[2]=this.max[2],new il(p,_)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let _=0;_<s.planes.length;_++){const x=s.planes[_];let E=0;for(let A=0;A<h.length;A++)l.dot$1(x,h[A])>=0&&E++;if(E===0)return 0;E!==h.length&&(p=!1)}if(p)return 2;for(let _=0;_<3;_++){let x=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let A=0;A<s.points.length;A++){const I=s.points[A][_]-this.min[_];x=Math.min(x,I),E=Math.max(E,I)}if(E<0||x>this.max[_]-this.min[_])return 0}return 1}}class aa{constructor(s=0,h=0,p=0,_=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=p,this.right=_}interpolate(s,h,p){return h.top!=null&&s.top!=null&&(this.top=l.number(s.top,h.top,p)),h.bottom!=null&&s.bottom!=null&&(this.bottom=l.number(s.bottom,h.bottom,p)),h.left!=null&&s.left!=null&&(this.left=l.number(s.left,h.left,p)),h.right!=null&&s.right!=null&&(this.right=l.number(s.right,h.right,p)),this}getCenter(s,h){const p=l.clamp((this.left+s-this.right)/2,0,s),_=l.clamp((this.top+h-this.bottom)/2,0,h);return new l.pointGeometry(p,_)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new aa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class rl{constructor(s,h,p,_,x){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=x===void 0||!!x,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=p??0,this._maxPitch=_??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new aa,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const s=new rl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.tileSize=this.tileSize,s.latRange=this.latRange,s.width=this.width,s.height=this.height,s._center=this._center,s._elevation=this._elevation,s.zoom=this.zoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const h=-l.wrap(s,-180,180)*Math.PI/180;var p;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(p=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(_,x,E){var A=x[0],I=x[1],k=x[2],z=x[3],B=Math.sin(E),j=Math.cos(E);_[0]=A*j+k*B,_[1]=I*j+z*B,_[2]=A*-B+k*j,_[3]=I*-B+z*j}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const h=l.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,p){this._unmodified=!1,this._edgeInsets.interpolate(s,h,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){const h=[new l.UnwrappedTileID(0,s)];if(this._renderWorldCopies){const p=this.pointCoordinate(new l.pointGeometry(0,0)),_=this.pointCoordinate(new l.pointGeometry(this.width,0)),x=this.pointCoordinate(new l.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new l.pointGeometry(0,this.height)),A=Math.floor(Math.min(p.x,_.x,x.x,E.x)),I=Math.floor(Math.max(p.x,_.x,x.x,E.x)),k=1;for(let z=A-k;z<=I+k;z++)z!==0&&h.push(new l.UnwrappedTileID(z,s))}return h}coveringTiles(s){var h,p;let _=this.coveringZoomLevel(s);const x=_;if(s.minzoom!==void 0&&_<s.minzoom)return[];s.maxzoom!==void 0&&_>s.maxzoom&&(_=s.maxzoom);const E=this.pointCoordinate(this.getCameraPoint()),A=l.MercatorCoordinate.fromLngLat(this.center),I=Math.pow(2,_),k=[I*E.x,I*E.y,0],z=[I*A.x,I*A.y,0],B=rc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,_);let j=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(j=_);const ie=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,te=re=>({aabb:new il([re*I,0,0],[(re+1)*I,I,0]),zoom:0,x:0,y:0,wrap:re,fullyVisible:!1}),ne=[],de=[],ge=_,xe=s.reparseOverscaled?x:_;if(this._renderWorldCopies)for(let re=1;re<=3;re++)ne.push(te(-re)),ne.push(te(re));for(ne.push(te(0));ne.length>0;){const re=ne.pop(),Ee=re.x,be=re.y;let Le=re.fullyVisible;if(!Le){const nt=re.aabb.intersects(B);if(nt===0)continue;Le=nt===2}const ke=s.terrain?k:z,Be=re.aabb.distanceX(ke),Ce=re.aabb.distanceY(ke),et=Math.max(Math.abs(Be),Math.abs(Ce)),qe=ie+(1<<ge-re.zoom)-2;if(re.zoom===ge||et>qe&&re.zoom>=j){const nt=ge-re.zoom,Ct=k[0]-.5-(Ee<<nt),Rt=k[1]-.5-(be<<nt);de.push({tileID:new l.OverscaledTileID(re.zoom===ge?xe:re.zoom,re.wrap,re.zoom,Ee,be),distanceSq:l.sqrLen([z[0]-.5-Ee,z[1]-.5-be]),tileDistanceToCamera:Math.sqrt(Ct*Ct+Rt*Rt)})}else for(let nt=0;nt<4;nt++){const Ct=(Ee<<1)+nt%2,Rt=(be<<1)+(nt>>1),_t=re.zoom+1;let sn=re.aabb.quadrant(nt);if(s.terrain){const on=new l.OverscaledTileID(_t,re.wrap,_t,Ct,Rt),$t=s.terrain.getMinMaxElevation(on),Ht=(h=$t.minElevation)!==null&&h!==void 0?h:this.elevation,ln=(p=$t.maxElevation)!==null&&p!==void 0?p:this.elevation;sn=new il([sn.min[0],sn.min[1],Ht],[sn.max[0],sn.max[1],ln])}ne.push({aabb:sn,zoom:_t,x:Ct,y:Rt,wrap:re.wrap,fullyVisible:Le})}}return de.sort((re,Ee)=>re.distanceSq-Ee.distanceSq).map(re=>re.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const h=l.clamp(s.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.pointGeometry(l.mercatorXfromLng(s.lng)*this.worldSize,l.mercatorYfromLat(h)*this.worldSize)}unproject(s){return new l.MercatorCoordinate(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(s){this.freezeElevation||(this.elevation=s?this.getElevation(this._center,s):0)}getElevation(s,h){const p=l.MercatorCoordinate.fromLngLat(s),_=(1<<this.tileZoom)*l.EXTENT,x=p.x*_,E=p.y*_,A=Math.floor(x/l.EXTENT),I=Math.floor(E/l.EXTENT),k=new l.OverscaledTileID(this.tileZoom,0,this.tileZoom,A,I);return h.getElevation(k,x%l.EXTENT,E%l.EXTENT,l.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(s){const h=this.pointLocation(this.centerPoint,s),p=this.getElevation(h,s);if(!(this.elevation-p))return;const _=this.getCameraPosition(),x=l.MercatorCoordinate.fromLngLat(_.lngLat,_.altitude),E=l.MercatorCoordinate.fromLngLat(h,p),A=x.x-E.x,I=x.y-E.y,k=x.z-E.z,z=Math.sqrt(A*A+I*I+k*k),B=this.scaleZoom(this.cameraToCenterDistance/z/this.tileSize);this._elevation=p,this._center=h,this.zoom=B}setLocationAtPoint(s,h){const p=this.pointCoordinate(h),_=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(s),E=new l.MercatorCoordinate(x.x-(p.x-_.x),x.y-(p.y-_.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,h){return h?this.coordinatePoint(this.locationCoordinate(s),this.getElevation(s,h),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,h){return this.coordinateLocation(this.pointCoordinate(s,h))}locationCoordinate(s){return l.MercatorCoordinate.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(s,h){if(h){const j=h.pointCoordinate(s);if(j!=null)return j}const p=[s.x,s.y,0,1],_=[s.x,s.y,1,1];l.transformMat4(p,p,this.pixelMatrixInverse),l.transformMat4(_,_,this.pixelMatrixInverse);const x=p[3],E=_[3],A=p[1]/x,I=_[1]/E,k=p[2]/x,z=_[2]/E,B=k===z?0:(0-k)/(z-k);return new l.MercatorCoordinate(l.number(p[0]/x,_[0]/E,B)/this.worldSize,l.number(A,I,B)/this.worldSize)}coordinatePoint(s,h=0,p=this.pixelMatrix){const _=[s.x*this.worldSize,s.y*this.worldSize,h,1];return l.transformMat4(_,_,p),new l.pointGeometry(_[0]/_[3],_[1]/_[3])}getBounds(){const s=Math.max(0,this.height/2-this.getHorizon());return new l.LngLatBounds().extend(this.pointLocation(new l.pointGeometry(0,s))).extend(this.pointLocation(new l.pointGeometry(this.width,s))).extend(this.pointLocation(new l.pointGeometry(this.width,this.height))).extend(this.pointLocation(new l.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new l.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(s,h=!1){const p=s.key,_=h?this._alignedPosMatrixCache:this._posMatrixCache;if(_[p])return _[p];const x=s.canonical,E=this.worldSize/this.zoomScale(x.z),A=x.x+Math.pow(2,x.z)*s.wrap,I=l.identity(new Float64Array(16));return l.translate(I,I,[A*E,x.y*E,0]),l.scale(I,I,[E/l.EXTENT,E/l.EXTENT,1]),l.multiply(I,h?this.alignedProjMatrix:this.projMatrix,I),_[p]=new Float32Array(I),_[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s,h,p,_,x=-90,E=90,A=-180,I=180;const k=this.size,z=this._unmodified;if(this.latRange){const ie=this.latRange;x=l.mercatorYfromLat(ie[1])*this.worldSize,E=l.mercatorYfromLat(ie[0])*this.worldSize,s=E-x<k.y?k.y/(E-x):0}if(this.lngRange){const ie=this.lngRange;A=l.wrap(l.mercatorXfromLng(ie[0])*this.worldSize,0,this.worldSize),I=l.wrap(l.mercatorXfromLng(ie[1])*this.worldSize,0,this.worldSize),I<A&&(I+=this.worldSize),h=I-A<k.x?k.x/(I-A):0}const B=this.point,j=Math.max(h||0,s||0);if(j)return this.center=this.unproject(new l.pointGeometry(h?(I+A)/2:B.x,s?(E+x)/2:B.y)),this.zoom+=this.scaleZoom(j),this._unmodified=z,void(this._constraining=!1);if(this.latRange){const ie=B.y,te=k.y/2;ie-te<x&&(_=x+te),ie+te>E&&(_=E-te)}if(this.lngRange){const ie=(A+I)/2,te=l.wrap(B.x,ie-this.worldSize/2,ie+this.worldSize/2),ne=k.x/2;te-ne<A&&(p=A+ne),te+ne>I&&(p=I-ne)}p===void 0&&_===void 0||(this.center=this.unproject(new l.pointGeometry(p!==void 0?p:B.x,_!==void 0?_:B.y)).wrap()),this._unmodified=z,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,h=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let _=l.identity(new Float64Array(16));l.scale(_,_,[this.width/2,-this.height/2,1]),l.translate(_,_,[1,-1,0]),this.labelPlaneMatrix=_,_=l.identity(new Float64Array(16)),l.scale(_,_,[1,-1,1]),l.translate(_,_,[-1,-1,0]),l.scale(_,_,[2/this.width,2/this.height,1]),this.glCoordMatrix=_,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const x=Math.PI/2+this._pitch,E=this._fov*(.5+s.y/this.height),A=Math.sin(E)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-x-E,.01,Math.PI-.01)),I=this.getHorizon(),k=2*Math.atan(I/this.cameraToCenterDistance)*(.5+s.y/(2*I)),z=Math.sin(k)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-x-k,.01,Math.PI-.01)),B=Math.cos(Math.PI/2-this._pitch)*A+this.cameraToSeaLevelDistance,j=Math.cos(Math.PI/2-this._pitch)*z+this.cameraToSeaLevelDistance,ie=1.01*Math.min(B,j),te=this.height/50;_=new Float64Array(16),l.perspective(_,this._fov,this.width/this.height,te,ie),_[8]=2*-s.x/this.width,_[9]=2*s.y/this.height,l.scale(_,_,[1,-1,1]),l.translate(_,_,[0,0,-this.cameraToCenterDistance]),l.rotateX(_,_,this._pitch),l.rotateZ(_,_,this.angle),l.translate(_,_,[-h,-p,0]),this.mercatorMatrix=l.scale([],_,[this.worldSize,this.worldSize,this.worldSize]),l.scale(_,_,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,_),l.translate(_,_,[0,0,-this.elevation]),this.projMatrix=_,this.invProjMatrix=l.invert([],_),this.pixelMatrix3D=l.multiply(new Float64Array(16),this.labelPlaneMatrix,_);const ne=this.width%2/2,de=this.height%2/2,ge=Math.cos(this.angle),xe=Math.sin(this.angle),re=h-Math.round(h)+ge*ne+xe*de,Ee=p-Math.round(p)+ge*de+xe*ne,be=new Float64Array(_);if(l.translate(be,be,[re>.5?re-1:re,Ee>.5?Ee-1:Ee,0]),this.alignedProjMatrix=be,_=l.invert(new Float64Array(16),this.pixelMatrix),!_)throw new Error("failed to invert matrix");this.pixelMatrixInverse=_,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new l.pointGeometry(0,0)),h=[s.x*this.worldSize,s.y*this.worldSize,0,1];return l.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.pointGeometry(0,s))}getCameraQueryGeometry(s){const h=this.getCameraPoint();if(s.length===1)return[s[0],h];{let p=h.x,_=h.y,x=h.x,E=h.y;for(const A of s)p=Math.min(p,A.x),_=Math.min(_,A.y),x=Math.max(x,A.x),E=Math.max(E,A.y);return[new l.pointGeometry(p,_),new l.pointGeometry(x,_),new l.pointGeometry(x,E),new l.pointGeometry(p,E),new l.pointGeometry(p,_)]}}}class Jd{constructor(s){this._hashName=s&&encodeURIComponent(s),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(h,p){let _=!1,x=null;const E=()=>{x=null,_&&(h(),x=setTimeout(E,300),_=!1)};return()=>(_=!0,x||E(),x)}(this._updateHashUnthrottled.bind(this))}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,_),E=Math.round(h.lng*x)/x,A=Math.round(h.lat*x)/x,I=this._map.getBearing(),k=this._map.getPitch();let z="";if(z+=s?`/${E}/${A}/${p}`:`${p}/${A}/${E}`,(I||k)&&(z+="/"+Math.round(10*I)/10),k&&(z+=`/${Math.round(k)}`),this._hashName){const B=this._hashName;let j=!1;const ie=window.location.hash.slice(1).split("&").map(te=>{const ne=te.split("=")[0];return ne===B?(j=!0,`${ne}=${z}`):te}).filter(te=>te);return j||ie.push(`${B}=${z}`),`#${ie.join("&")}`}return`#${z}`}_getCurrentHash(){const s=window.location.hash.replace("#","");if(this._hashName){let h;return s.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(h=p)}),(h&&h[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._getCurrentHash();if(s.length>=3&&!s.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){const s=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,s)}catch{}}}const sl={linearity:.3,easing:l.bezier(0,0,.3,1)},Qd=l.extend({deceleration:2500,maxSpeed:1400},sl),ef=l.extend({deceleration:20,maxSpeed:1400},sl),tf=l.extend({deceleration:1e3,maxSpeed:360},sl),la=l.extend({deceleration:1e3,maxSpeed:90},sl);class nf{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,h=l.exported.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new l.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)h.zoom+=x.zoomDelta||0,h.bearing+=x.bearingDelta||0,h.pitch+=x.pitchDelta||0,x.panDelta&&h.pan._add(x.panDelta),x.around&&(h.around=x.around),x.pinchAround&&(h.pinchAround=x.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(h.pan.mag()){const x=al(h.pan.mag(),p,l.extend({},Qd,s||{}));_.offset=h.pan.mult(x.amount/h.pan.mag()),_.center=this._map.transform.center,ol(_,x)}if(h.zoom){const x=al(h.zoom,p,ef);_.zoom=this._map.transform.zoom+x.amount,ol(_,x)}if(h.bearing){const x=al(h.bearing,p,tf);_.bearing=this._map.transform.bearing+l.clamp(x.amount,-179,179),ol(_,x)}if(h.pitch){const x=al(h.pitch,p,la);_.pitch=this._map.transform.pitch+x.amount,ol(_,x)}if(_.zoom||_.bearing){const x=h.pinchAround===void 0?h.around:h.pinchAround;_.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),l.extend(_,{noMoveStart:!0})}}function ol(m,s){(!m.duration||m.duration<s.duration)&&(m.duration=s.duration,m.easing=s.easing)}function al(m,s,h){const{maxSpeed:p,linearity:_,deceleration:x}=h,E=l.clamp(m*_/(s/1e3),-p,p),A=Math.abs(E)/(x*_);return{easing:h.easing,duration:1e3*A,amount:E*(A/2)}}class or extends l.Event{constructor(s,h,p,_={}){const x=P.mousePos(h.getCanvasContainer(),p),E=h.unproject(x);super(s,l.extend({point:x,lngLat:E,originalEvent:p},_)),this._defaultPrevented=!1,this.target=h}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ll extends l.Event{constructor(s,h,p){const _=s==="touchend"?p.changedTouches:p.touches,x=P.touchPos(h.getCanvasContainer(),_),E=x.map(I=>h.unproject(I)),A=x.reduce((I,k,z,B)=>I.add(k.div(B.length)),new l.pointGeometry(0,0));super(s,{points:x,point:A,lngLats:E,lngLat:h.unproject(A),originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ar extends l.Event{constructor(s,h,p){super(s,{originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class mg{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new ar(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new or(s.type,this._map,s))}mouseup(s){this._map.fire(new or(s.type,this._map,s))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new or(s.type,this._map,s))}dblclick(s){return this._firePreventable(new or(s.type,this._map,s))}mouseover(s){this._map.fire(new or(s.type,this._map,s))}mouseout(s){this._map.fire(new or(s.type,this._map,s))}touchstart(s){return this._firePreventable(new ll(s.type,this._map,s))}touchmove(s){this._map.fire(new ll(s.type,this._map,s))}touchend(s){this._map.fire(new ll(s.type,this._map,s))}touchcancel(s){this._map.fire(new ll(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zs{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new or(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new or("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new or(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class rf{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(P.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=p,this._box||(this._box=P.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const x=Math.min(_.x,p.x),E=Math.max(_.x,p.x),A=Math.min(_.y,p.y),I=Math.max(_.y,p.y);P.setTransform(this._box,`translate(${x}px,${A}px)`),this._box.style.width=E-x+"px",this._box.style.height=I-A+"px"}mouseupWindow(s,h){if(!this._active||s.button!==0)return;const p=this._startPos,_=h;if(this.reset(),P.suppressClick(),p.x!==_.x||p.y!==_.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:x=>x.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(P.remove(this._box),this._box=null),P.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new l.Event(s,{originalEvent:h}))}}function Ts(m,s){if(m.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${s.length}`);const h={};for(let p=0;p<m.length;p++)h[m[p].identifier]=s[p];return h}class cl{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const x=new l.pointGeometry(0,0);for(const E of _)x._add(E);return x.div(_.length)}(h),this.touches=Ts(p,h)))}touchmove(s,h,p){if(this.aborted||!this.centroid)return;const _=Ts(p,h);for(const x in this.touches){const E=this.touches[x],A=_[x];(!A||A.dist(E)>30)&&(this.aborted=!0)}}touchend(s,h,p){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Bu{constructor(s){this.singleTap=new cl(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,h,p){this.singleTap.touchstart(s,h,p)}touchmove(s,h,p){this.singleTap.touchmove(s,h,p)}touchend(s,h,p){const _=this.singleTap.touchend(s,h,p);if(_){const x=s.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(_)<30;if(x&&E||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class gg{constructor(){this._zoomIn=new Bu({numTouches:1,numTaps:2}),this._zoomOut=new Bu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,p){this._zoomIn.touchstart(s,h,p),this._zoomOut.touchstart(s,h,p)}touchmove(s,h,p){this._zoomIn.touchmove(s,h,p),this._zoomOut.touchmove(s,h,p)}touchend(s,h,p){const _=this._zoomIn.touchend(s,h,p),x=this._zoomOut.touchend(s,h,p);return _?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(_)},{originalEvent:s})}):x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(x)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const _g={0:1,2:2};class sc{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(s,h){return!1}_move(s,h){return{}}mousedown(s,h){if(this._lastPoint)return;const p=P.mouseButton(s);this._correctButton(s,p)&&(this._lastPoint=h,this._eventButton=p)}mousemoveWindow(s,h){const p=this._lastPoint;if(p){if(s.preventDefault(),function(_,x){const E=_g[x];return _.buttons===void 0||(_.buttons&E)!==E}(s,this._eventButton))this.reset();else if(this._moved||!(h.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(p,h)}}mouseupWindow(s){this._lastPoint&&P.mouseButton(s)===this._eventButton&&(this._moved&&P.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ul extends sc{mousedown(s,h){super.mousedown(s,h),this._lastPoint&&(this._active=!0)}_correctButton(s,h){return h===0&&!s.ctrlKey}_move(s,h){return{around:h,panDelta:h.sub(s)}}}class Ss extends sc{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){const p=.8*(h.x-s.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(s){s.preventDefault()}}class st extends sc{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){const p=-.5*(h.y-s.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(s){s.preventDefault()}}class sf{constructor(s,h){this._minTouches=s.cooperativeGestures?2:1,this._clickTolerance=s.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(s,h,p){return this._calculateTransform(s,h,p)}touchmove(s,h,p){if(this._map._cooperativeGestures&&(this._minTouches===2&&p.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(s,!1,p.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(p.length<this._minTouches))return s.preventDefault(),this._calculateTransform(s,h,p)}touchend(s,h,p){this._calculateTransform(s,h,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,p){p.length>0&&(this._active=!0);const _=Ts(p,h),x=new l.pointGeometry(0,0),E=new l.pointGeometry(0,0);let A=0;for(const k in _){const z=_[k],B=this._touches[k];B&&(x._add(z),E._add(z.sub(B)),A++,_[k]=z)}if(this._touches=_,A<this._minTouches||!E.mag())return;const I=E.div(A);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(A),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(s){}_move(s,h,p){return{}}touchstart(s,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,p){if(!this._firstTwoTouches)return;s.preventDefault();const[_,x]=this._firstTwoTouches,E=Xs(p,h,_),A=Xs(p,h,x);if(!E||!A)return;const I=this._aroundCenter?null:E.add(A).div(2);return this._move([E,A],I,s)}touchend(s,h,p){if(!this._firstTwoTouches)return;const[_,x]=this._firstTwoTouches,E=Xs(p,h,_),A=Xs(p,h,x);E&&A||(this._active&&P.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Xs(m,s,h){for(let p=0;p<m.length;p++)if(m[p].identifier===h)return s[p]}function Nu(m,s){return Math.log(m/s)/Math.LN2}class Ke extends wo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){const p=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Nu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Nu(this._distance,p),pinchAround:h}}}function oc(m,s){return 180*m.angleWith(s)/Math.PI}class yg extends wo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){const p=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:oc(this._vector,p),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const h=25/(Math.PI*this._minDiameter)*360,p=oc(s,this._startVector);return Math.abs(p)<h}}function Uu(m){return Math.abs(m.y)>Math.abs(m.x)}class Vu extends wo{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,h,p){super.touchstart(s,h,p),this._currentTouchCount=p.length}_start(s){this._lastPoints=s,Uu(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,p){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const _=s[0].sub(this._lastPoints[0]),x=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(_,x,p.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(_.y+x.y)/2*-.5}):void 0}gestureBeginsVertically(s,h,p){if(this._valid!==void 0)return this._valid;const _=s.mag()>=2,x=h.mag()>=2;if(!_&&!x)return;if(!_||!x)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=s.y>0==h.y>0;return Uu(s)&&Uu(h)&&E}}const of={panStep:100,bearingStep:15,pitchStep:10};class af{constructor(){const s=of;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,p=0,_=0,x=0,E=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?p=-1:(s.preventDefault(),x=-1);break;case 39:s.shiftKey?p=1:(s.preventDefault(),x=1);break;case 38:s.shiftKey?_=1:(s.preventDefault(),E=-1);break;case 40:s.shiftKey?_=-1:(s.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:A=>{const I=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:vg,zoom:h?Math.round(I)+h*(s.shiftKey?2:1):I,bearing:A.getBearing()+p*this._bearingStep,pitch:A.getPitch()+_*this._pitchStep,offset:[-x*this._panStep,-E*this._panStep],center:A.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function vg(m){return m*(2-m)}const lf=4.000244140625;class ju{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;s.preventDefault()}let h=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const p=l.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%lf==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(_*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=P.mousePos(this._el,s);this._around=l.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;if(this._delta!==0){const A=this._type==="wheel"&&Math.abs(this._delta)>lf?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&I!==0&&(I=1/I);const k=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(k*I))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,p=this._startZoom,_=this._easing;let x,E=!1;if(this._type==="wheel"&&p&&_){const A=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),I=_(A);x=l.number(p,h,I),A<1?this._frameId||(this._frameId=!0):E=!0}else x=h,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:x-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=l.ease;if(this._prevEase){const p=this._prevEase,_=(l.exported.now()-p.start)/p.duration,x=p.easing(_+.01)-p.easing(_),E=.27/Math.sqrt(x*x+1e-4)*.01,A=Math.sqrt(.0729-E*E);h=l.bezier(E,A,.25,1)}return this._prevEase={start:l.exported.now(),duration:s,easing:h},h}reset(){this._active=!1}}class Gu{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class $u{constructor(){this.reset()}reset(){this._active=!1}dblclick(s,h){return s.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(s.shiftKey?-1:1),around:p.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hu{constructor(){this._tap=new Bu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(s,h,p){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=h[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(s,h,p))}touchmove(s,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=h[0],x=_.y-this._swipePoint.y;return this._swipePoint=_,s.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(s,h,p)}touchend(s,h,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(s,h,p)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hi{constructor(s,h,p){this._el=s,this._mousePan=h,this._touchPan=p}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ys{constructor(s,h,p){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class cf{constructor(s,h,p,_){this._el=s,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ca=m=>m.zoom||m.drag||m.pitch||m.rotate;class Wu extends l.Event{}function hl(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class uf{constructor(s,h){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new nf(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),l.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,x,E]of this._listeners)P.addEventListener(_,x,_===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[s,h,p]of this._listeners)P.removeEventListener(s,h,s===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(s){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new mg(h,s));const _=h.boxZoom=new rf(h,s);this._add("boxZoom",_);const x=new gg,E=new $u;h.doubleClickZoom=new Gu(E,x),this._add("tapZoom",x),this._add("clickZoom",E);const A=new Hu;this._add("tapDragZoom",A);const I=h.touchPitch=new Vu(h);this._add("touchPitch",I);const k=new Ss(s),z=new st(s);h.dragRotate=new Ys(s,k,z),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const B=new ul(s),j=new sf(s,h);h.dragPan=new Hi(p,B,j),this._add("mousePan",B),this._add("touchPan",j,["touchZoom","touchRotate"]);const ie=new yg,te=new Ke;h.touchZoomRotate=new cf(p,te,ie,A),this._add("touchRotate",ie,["touchPan","touchZoom"]),this._add("touchZoom",te,["touchPan","touchRotate"]);const ne=h.scrollZoom=new ju(h,this);this._add("scrollZoom",ne,["mousePan"]);const de=h.keyboard=new af;this._add("keyboard",de),this._add("blockableMapEvent",new Zs(h));for(const ge of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[ge]&&h[ge].enable(s[ge])}_add(s,h,p){this._handlers.push({handlerName:s,handler:h,allowed:p}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ca(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,h,p){for(const _ in s)if(_!==p&&(!h||h.indexOf(_)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const h=[];for(const p of s)this._el.contains(p.target)&&h.push(p);return h}handleEvent(s,h){if(s.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const p=s.type==="renderFrame"?void 0:s,_={needsRenderFrame:!1},x={},E={},A=s.touches,I=A?this._getMapTouches(A):void 0,k=I?P.touchPos(this._el,I):P.mousePos(this._el,s);for(const{handlerName:j,handler:ie,allowed:te}of this._handlers){if(!ie.isEnabled())continue;let ne;this._blockedByActive(E,te,j)?ie.reset():ie[h||s.type]&&(ne=ie[h||s.type](s,k,I),this.mergeHandlerResult(_,x,ne,j,p),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||ie.isActive())&&(E[j]=ie)}const z={};for(const j in this._previousActiveHandlers)E[j]||(z[j]=p);this._previousActiveHandlers=E,(Object.keys(z).length||hl(_))&&(this._changes.push([_,x,z]),this._triggerRenderFrame()),(Object.keys(E).length||hl(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=_;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(s,h,p,_,x){if(!p)return;l.extend(s,p);const E={handlerName:_,originalEvent:p.originalEvent||x};p.zoomDelta!==void 0&&(h.zoom=E),p.panDelta!==void 0&&(h.drag=E),p.pitchDelta!==void 0&&(h.pitch=E),p.bearingDelta!==void 0&&(h.rotate=E)}_applyChanges(){const s={},h={},p={};for(const[_,x,E]of this._changes)_.panDelta&&(s.panDelta=(s.panDelta||new l.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(s.around=_.around),_.pinchAround!==void 0&&(s.pinchAround=_.pinchAround),_.noInertia&&(s.noInertia=_.noInertia),l.extend(h,x),l.extend(p,E);this._updateMapTransform(s,h,p),this._changes=[]}_updateMapTransform(s,h,p){const _=this._map,x=_.transform,E=_.style&&_.style.terrain;if(!(hl(s)||E&&this._drag))return this._fireEvents(h,p,!0);let{panDelta:A,zoomDelta:I,bearingDelta:k,pitchDelta:z,around:B,pinchAround:j}=s;j!==void 0&&(B=j),_._stop(!0),B=B||_.transform.centerPoint;const ie=x.pointLocation(A?B.sub(A):B);k&&(x.bearing+=k),z&&(x.pitch+=z),I&&(x.zoom+=I),E?h.drag&&!this._drag?(this._drag={center:x.centerPoint,lngLat:x.pointLocation(B),point:B,handlerName:h.drag.handlerName},_.fire(new l.Event("freezeElevation",{freeze:!0}))):this._drag&&p[this._drag.handlerName]?(_.fire(new l.Event("freezeElevation",{freeze:!1})),this._drag=null):h.drag&&this._drag&&(x.center=x.pointLocation(x.centerPoint.sub(A))):x.setLocationAtPoint(ie,B),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,p,!0)}_fireEvents(s,h,p){const _=ca(this._eventsInProgress),x=ca(s),E={};for(const z in s){const{originalEvent:B}=s[z];this._eventsInProgress[z]||(E[`${z}start`]=B),this._eventsInProgress[z]=s[z]}!_&&x&&this._fireEvent("movestart",x.originalEvent);for(const z in E)this._fireEvent(z,E[z]);x&&this._fireEvent("move",x.originalEvent);for(const z in s){const{originalEvent:B}=s[z];this._fireEvent(z,B)}const A={};let I;for(const z in this._eventsInProgress){const{handlerName:B,originalEvent:j}=this._eventsInProgress[z];this._handlersById[B].isActive()||(delete this._eventsInProgress[z],I=h[B]||j,A[`${z}end`]=I)}for(const z in A)this._fireEvent(z,A[z]);const k=ca(this._eventsInProgress);if(p&&(_||x)&&!k){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;z?(B(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:I})):(this._map.fire(new l.Event("moveend",{originalEvent:I})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new l.Event(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new Wu("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const wr={extend:(m,...s)=>l.extend(m,...s),run(m){m()},logToElement(m,s=!1,h="log"){const p=window.document.getElementById(h);p&&(s&&(p.innerHTML=""),p.innerHTML+=`<br>${m}`)}};class xn extends l.Evented{constructor(s,h){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,p){return s=l.pointGeometry.convert(s).mult(-1),this.panTo(this.transform.center,l.extend({offset:s},h),p)}panTo(s,h,p){return this.easeTo(l.extend({center:s},h),p)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,p){return this.easeTo(l.extend({zoom:s},h),p)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,p){return this.easeTo(l.extend({bearing:s},h),p)}resetNorth(s,h){return this.rotateTo(0,l.extend({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=l.LngLatBounds.convert(s);const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),p,h)}_cameraForBoxAndBearing(s,h,p,_){const x={top:0,bottom:0,right:0,left:0};if(typeof(_=l.extend({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},_)).padding=="number"){const be=_.padding;_.padding={top:be,bottom:be,right:be,left:be}}_.padding=l.extend(x,_.padding);const E=this.transform,A=E.padding,I=E.project(l.LngLat.convert(s)),k=E.project(l.LngLat.convert(h)),z=I.rotate(-p*Math.PI/180),B=k.rotate(-p*Math.PI/180),j=new l.pointGeometry(Math.max(z.x,B.x),Math.max(z.y,B.y)),ie=new l.pointGeometry(Math.min(z.x,B.x),Math.min(z.y,B.y)),te=j.sub(ie),ne=(E.width-(A.left+A.right+_.padding.left+_.padding.right))/te.x,de=(E.height-(A.top+A.bottom+_.padding.top+_.padding.bottom))/te.y;if(de<0||ne<0)return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ge=Math.min(E.scaleZoom(E.scale*Math.min(ne,de)),_.maxZoom),xe=l.pointGeometry.convert(_.offset),re=new l.pointGeometry((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(p*Math.PI/180),Ee=xe.add(re).mult(E.scale/E.zoomScale(ge));return{center:E.unproject(I.add(k).div(2).sub(Ee)),zoom:ge,bearing:p}}fitBounds(s,h,p){return this._fitInternal(this.cameraForBounds(s,h),h,p)}fitScreenCoordinates(s,h,p,_,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.pointGeometry.convert(s)),this.transform.pointLocation(l.pointGeometry.convert(h)),p,_),_,x)}_fitInternal(s,h,p){return s?(delete(h=l.extend(s,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(s,h){this.stop();const p=this.transform;let _=!1,x=!1,E=!1;return"zoom"in s&&p.zoom!==+s.zoom&&(_=!0,p.zoom=+s.zoom),s.center!==void 0&&(p.center=l.LngLat.convert(s.center)),"bearing"in s&&p.bearing!==+s.bearing&&(x=!0,p.bearing=+s.bearing),"pitch"in s&&p.pitch!==+s.pitch&&(E=!0,p.pitch=+s.pitch),s.padding==null||p.isPaddingEqual(s.padding)||(p.padding=s.padding),this.fire(new l.Event("movestart",h)).fire(new l.Event("move",h)),_&&this.fire(new l.Event("zoomstart",h)).fire(new l.Event("zoom",h)).fire(new l.Event("zoomend",h)),x&&this.fire(new l.Event("rotatestart",h)).fire(new l.Event("rotate",h)).fire(new l.Event("rotateend",h)),E&&this.fire(new l.Event("pitchstart",h)).fire(new l.Event("pitch",h)).fire(new l.Event("pitchend",h)),this.fire(new l.Event("moveend",h))}calculateCameraOptionsFromTo(s,h,p,_=0){const x=l.MercatorCoordinate.fromLngLat(s,h),E=l.MercatorCoordinate.fromLngLat(p,_),A=E.x-x.x,I=E.y-x.y,k=E.z-x.z,z=Math.hypot(A,I,k);if(z===0)throw new Error("Can't calculate camera options with same From and To");const B=Math.hypot(A,I),j=this.transform.scaleZoom(this.transform.cameraToCenterDistance/z/this.transform.tileSize),ie=180*Math.atan2(A,-I)/Math.PI;let te=180*Math.acos(B/z)/Math.PI;return te=k<0?90-te:90+te,{center:E.toLngLat(),zoom:j,pitch:te,bearing:ie}}easeTo(s,h){this._stop(!1,s.easeId),((s=l.extend({offset:[0,0],duration:500,easing:l.ease},s)).animate===!1||!s.essential&&l.exported.prefersReducedMotion)&&(s.duration=0);const p=this.transform,_=this.getZoom(),x=this.getBearing(),E=this.getPitch(),A=this.getPadding(),I="zoom"in s?+s.zoom:_,k="bearing"in s?this._normalizeBearing(s.bearing,x):x,z="pitch"in s?+s.pitch:E,B="padding"in s?s.padding:p.padding,j=l.pointGeometry.convert(s.offset);let ie=p.centerPoint.add(j);const te=p.pointLocation(ie),ne=l.LngLat.convert(s.center||te);this._normalizeCenter(ne);const de=p.project(te),ge=p.project(ne).sub(de),xe=p.zoomScale(I-_);let re,Ee;s.around&&(re=l.LngLat.convert(s.around),Ee=p.locationPoint(re));const be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||I!==_,this._rotating=this._rotating||x!==k,this._pitching=this._pitching||z!==E,this._padding=!p.isPaddingEqual(B),this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,be),this._ease(Le=>{if(this._zooming&&(p.zoom=l.number(_,I,Le)),this._rotating&&(p.bearing=l.number(x,k,Le)),this._pitching&&(p.pitch=l.number(E,z,Le)),this._padding&&(p.interpolatePadding(A,B,Le),ie=p.centerPoint.add(j)),re)p.setLocationAtPoint(re,Ee);else{const ke=p.zoomScale(p.zoom-_),Be=I>_?Math.min(2,xe):Math.max(.5,xe),Ce=Math.pow(Be,1-Le),et=p.unproject(de.add(ge.mult(Le*Ce)).mult(ke));p.setLocationAtPoint(p.renderWorldCopies?et.wrap():et,ie)}this._fireMoveEvents(h)},Le=>{this._afterEase(h,Le)},s),this}_prepareEase(s,h,p={}){this._moving=!0,this.fire(new l.Event("freezeElevation",{freeze:!0})),h||p.moving||this.fire(new l.Event("movestart",s)),this._zooming&&!p.zooming&&this.fire(new l.Event("zoomstart",s)),this._rotating&&!p.rotating&&this.fire(new l.Event("rotatestart",s)),this._pitching&&!p.pitching&&this.fire(new l.Event("pitchstart",s))}_fireMoveEvents(s){this.fire(new l.Event("move",s)),this._zooming&&this.fire(new l.Event("zoom",s)),this._rotating&&this.fire(new l.Event("rotate",s)),this._pitching&&this.fire(new l.Event("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId,this.fire(new l.Event("freezeElevation",{freeze:!1}));const p=this._zooming,_=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new l.Event("zoomend",s)),_&&this.fire(new l.Event("rotateend",s)),x&&this.fire(new l.Event("pitchend",s)),this.fire(new l.Event("moveend",s))}flyTo(s,h){if(!s.essential&&l.exported.prefersReducedMotion){const _t=l.pick(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(_t,h)}this.stop(),s=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},s);const p=this.transform,_=this.getZoom(),x=this.getBearing(),E=this.getPitch(),A=this.getPadding(),I="zoom"in s?l.clamp(+s.zoom,p.minZoom,p.maxZoom):_,k="bearing"in s?this._normalizeBearing(s.bearing,x):x,z="pitch"in s?+s.pitch:E,B="padding"in s?s.padding:p.padding,j=p.zoomScale(I-_),ie=l.pointGeometry.convert(s.offset);let te=p.centerPoint.add(ie);const ne=p.pointLocation(te),de=l.LngLat.convert(s.center||ne);this._normalizeCenter(de);const ge=p.project(ne),xe=p.project(de).sub(ge);let re=s.curve;const Ee=Math.max(p.width,p.height),be=Ee/j,Le=xe.mag();if("minZoom"in s){const _t=l.clamp(Math.min(s.minZoom,_,I),p.minZoom,p.maxZoom),sn=Ee/p.zoomScale(_t-_);re=Math.sqrt(sn/Le*2)}const ke=re*re;function Be(_t){const sn=(be*be-Ee*Ee+(_t?-1:1)*ke*ke*Le*Le)/(2*(_t?be:Ee)*ke*Le);return Math.log(Math.sqrt(sn*sn+1)-sn)}function Ce(_t){return(Math.exp(_t)-Math.exp(-_t))/2}function et(_t){return(Math.exp(_t)+Math.exp(-_t))/2}const qe=Be(0);let nt=function(_t){return et(qe)/et(qe+re*_t)},Ct=function(_t){return Ee*((et(qe)*(Ce(sn=qe+re*_t)/et(sn))-Ce(qe))/ke)/Le;var sn},Rt=(Be(1)-qe)/re;if(Math.abs(Le)<1e-6||!isFinite(Rt)){if(Math.abs(Ee-be)<1e-6)return this.easeTo(s,h);const _t=be<Ee?-1:1;Rt=Math.abs(Math.log(be/Ee))/re,Ct=function(){return 0},nt=function(sn){return Math.exp(_t*re*sn)}}return s.duration="duration"in s?+s.duration:1e3*Rt/("screenSpeed"in s?+s.screenSpeed/re:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=x!==k,this._pitching=z!==E,this._padding=!p.isPaddingEqual(B),this._prepareEase(h,!1),this._ease(_t=>{const sn=_t*Rt,on=1/nt(sn);p.zoom=_t===1?I:_+p.scaleZoom(on),this._rotating&&(p.bearing=l.number(x,k,_t)),this._pitching&&(p.pitch=l.number(E,z,_t)),this._padding&&(p.interpolatePadding(A,B,_t),te=p.centerPoint.add(ie));const $t=_t===1?de:p.unproject(ge.add(xe.mult(Ct(sn))).mult(on));p.setLocationAtPoint(p.renderWorldCopies?$t.wrap():$t,te),this._fireMoveEvents(h)},()=>this._afterEase(h),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,h)}if(!s){const p=this.handlers;p&&p.stop(!1)}return this}_ease(s,h,p){p.animate===!1||p.duration===0?(s(1),h()):(this._easeStart=l.exported.now(),this._easeOptions=p,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,h){s=l.wrap(s,-180,180);const p=Math.abs(s-h);return Math.abs(s-360-h)<p&&(s-=360),Math.abs(s+360-h)<p&&(s+=360),s}_normalizeCenter(s){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const p=s.lng-h.center.lng;s.lng+=p>180?-360:p<-180?360:0}}class dl{constructor(s={}){this.options=s,l.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options&&this.options.compact,this._container=P.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=P.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=P.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){P.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,h){const p=this._map._getUIString(`AttributionControl.${h}`);s.title=p,s.setAttribute("aria-label",p)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(_=>typeof _!="string"?"":_)):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const h=this._map.style.sourceCaches;for(const _ in h){const x=h[_];if(x.used||x.usedForTerrain){const E=x.getSource();E.attribution&&s.indexOf(E.attribution)<0&&s.push(E.attribution)}}s=s.filter(_=>String(_).trim()),s.sort((_,x)=>_.length-x.length),s=s.filter((_,x)=>{for(let E=x+1;E<s.length;E++)if(s[E].indexOf(_)>=0)return!1;return!0});const p=s.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,s.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class ac{constructor(s={}){this.options=s,l.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=P.create("div","maplibregl-ctrl mapboxgl-ctrl");const h=P.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){P.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const s=this._container.children;if(s.length){const h=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact","mapboxgl-compact"):h.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class hf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const _ of p)if(_.id===s)return void(_.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const df={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},ff={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},xg={showCompass:!0,showZoom:!0,visualizePitch:!1};class as{constructor(s,h,p=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Ss({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,p&&(this.mousePitch=new st({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),P.addEventListener(h,"mousedown",this.mousedown),P.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),P.addEventListener(h,"touchmove",this.touchmove),P.addEventListener(h,"touchend",this.touchend),P.addEventListener(h,"touchcancel",this.reset)}down(s,h){this.mouseRotate.mousedown(s,h),this.mousePitch&&this.mousePitch.mousedown(s,h),P.disableDrag()}move(s,h){const p=this.map,_=this.mouseRotate.mousemoveWindow(s,h);if(_&&_.bearingDelta&&p.setBearing(p.getBearing()+_.bearingDelta),this.mousePitch){const x=this.mousePitch.mousemoveWindow(s,h);x&&x.pitchDelta&&p.setPitch(p.getPitch()+x.pitchDelta)}}off(){const s=this.element;P.removeEventListener(s,"mousedown",this.mousedown),P.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),P.removeEventListener(s,"touchmove",this.touchmove),P.removeEventListener(s,"touchend",this.touchend),P.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){P.enableDrag(),P.removeEventListener(window,"mousemove",this.mousemove),P.removeEventListener(window,"mouseup",this.mouseup)}mousedown(s){this.down(l.extend({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),P.mousePos(this.element,s)),P.addEventListener(window,"mousemove",this.mousemove),P.addEventListener(window,"mouseup",this.mouseup)}mousemove(s){this.move(s,P.mousePos(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=P.touchPos(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=P.touchPos(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function fl(m,s,h){if(m=new l.LngLat(m.lng,m.lat),s){const p=new l.LngLat(m.lng-360,m.lat),_=new l.LngLat(m.lng+360,m.lat),x=h.locationPoint(m).distSqr(s);h.locationPoint(p).distSqr(s)<x?m=p:h.locationPoint(_).distSqr(s)<x&&(m=_)}for(;Math.abs(m.lng-h.center.lng)>180;){const p=h.locationPoint(m);if(p.x>=0&&p.y>=0&&p.x<=h.width&&p.y<=h.height)break;m.lng>h.center.lng?m.lng-=360:m.lng+=360}return m}const dt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function bt(m,s,h){const p=m.classList;for(const _ in dt)p.remove(`maplibregl-${h}-anchor-${_}`,`mapboxgl-${h}-anchor-${_}`);p.add(`maplibregl-${h}-anchor-${s}`,`mapboxgl-${h}-anchor-${s}`)}class ua extends l.Evented{constructor(s,h){if(super(),(s instanceof HTMLElement||h)&&(s=l.extend({element:s},h)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,s&&s.element)this._element=s.element,this._offset=l.pointGeometry.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=P.create("div"),this._element.setAttribute("aria-label","Map marker");const p=P.createNS("http://www.w3.org/2000/svg","svg"),_=41,x=27;p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height",`${_}px`),p.setAttributeNS(null,"width",`${x}px`),p.setAttributeNS(null,"viewBox",`0 0 ${x} ${_}`);const E=P.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"stroke","none"),E.setAttributeNS(null,"stroke-width","1"),E.setAttributeNS(null,"fill","none"),E.setAttributeNS(null,"fill-rule","evenodd");const A=P.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill-rule","nonzero");const I=P.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const xe of k){const re=P.createNS("http://www.w3.org/2000/svg","ellipse");re.setAttributeNS(null,"opacity","0.04"),re.setAttributeNS(null,"cx","10.5"),re.setAttributeNS(null,"cy","5.80029008"),re.setAttributeNS(null,"rx",xe.rx),re.setAttributeNS(null,"ry",xe.ry),I.appendChild(re)}const z=P.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const B=P.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(B);const j=P.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"opacity","0.25"),j.setAttributeNS(null,"fill","#000000");const ie=P.createNS("http://www.w3.org/2000/svg","path");ie.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),j.appendChild(ie);const te=P.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(6.0, 7.0)"),te.setAttributeNS(null,"fill","#FFFFFF");const ne=P.createNS("http://www.w3.org/2000/svg","g");ne.setAttributeNS(null,"transform","translate(8.0, 8.0)");const de=P.createNS("http://www.w3.org/2000/svg","circle");de.setAttributeNS(null,"fill","#000000"),de.setAttributeNS(null,"opacity","0.25"),de.setAttributeNS(null,"cx","5.5"),de.setAttributeNS(null,"cy","5.5"),de.setAttributeNS(null,"r","5.4999962");const ge=P.createNS("http://www.w3.org/2000/svg","circle");ge.setAttributeNS(null,"fill","#FFFFFF"),ge.setAttributeNS(null,"cx","5.5"),ge.setAttributeNS(null,"cy","5.5"),ge.setAttributeNS(null,"r","5.4999962"),ne.appendChild(de),ne.appendChild(ge),A.appendChild(I),A.appendChild(z),A.appendChild(j),A.appendChild(te),A.appendChild(ne),p.appendChild(A),p.setAttributeNS(null,"height",_*this._scale+"px"),p.setAttributeNS(null,"width",x*this._scale+"px"),this._element.appendChild(p),this._offset=l.pointGeometry.convert(s&&s.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()}),bt(this._element,this._anchor,"marker"),this._popup=null}addTo(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),P.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=l.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(s){const h=s.code,p=s.charCode||s.keyCode;h!=="Space"&&h!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(s){const h=s.originalEvent.target,p=this._element;this._popup&&(h===p||p.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?s.remove():s.addTo(this._map),this):this}_update(s){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=fl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p=`rotateX(${this._map.getPitch()}deg)`),s&&s.type!=="moveend"||(this._pos=this._pos.round()),P.setTransform(this._element,`${dt[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${h}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const _=this._map.unproject(this._pos),x=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=_.distanceTo(this._lngLat)>20*x?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(s){return this._offset=l.pointGeometry.convert(s),this._update(),this}_onMove(s){if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(s){this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const qu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ks,mi=0,Js=!1;const ls={maxWidth:100,unit:"metric"};function pf(m,s,h){const p=h&&h.maxWidth||100,_=m._container.clientHeight/2,x=m.unproject([0,_]),E=m.unproject([p,_]),A=x.distanceTo(E);if(h&&h.unit==="imperial"){const I=3.2808*A;I>5280?Qs(s,p,I/5280,m._getUIString("ScaleControl.Miles")):Qs(s,p,I,m._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Qs(s,p,A/1852,m._getUIString("ScaleControl.NauticalMiles")):A>=1e3?Qs(s,p,A/1e3,m._getUIString("ScaleControl.Kilometers")):Qs(s,p,A,m._getUIString("ScaleControl.Meters"))}function Qs(m,s,h,p){const _=function(x){const E=Math.pow(10,`${Math.floor(x)}`.length-1);let A=x/E;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(I){const k=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*k)/k}(A),E*A}(h);m.style.width=s*(_/h)+"px",m.innerHTML=`${_}&nbsp;${p}`}const kn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Hn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Zu(m){if(m){if(typeof m=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(m,2)));return{center:new l.pointGeometry(0,0),top:new l.pointGeometry(0,m),"top-left":new l.pointGeometry(s,s),"top-right":new l.pointGeometry(-s,s),bottom:new l.pointGeometry(0,-m),"bottom-left":new l.pointGeometry(s,-s),"bottom-right":new l.pointGeometry(-s,-s),left:new l.pointGeometry(m,0),right:new l.pointGeometry(-m,0)}}if(m instanceof l.pointGeometry||Array.isArray(m)){const s=l.pointGeometry.convert(m);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:l.pointGeometry.convert(m.center||[0,0]),top:l.pointGeometry.convert(m.top||[0,0]),"top-left":l.pointGeometry.convert(m["top-left"]||[0,0]),"top-right":l.pointGeometry.convert(m["top-right"]||[0,0]),bottom:l.pointGeometry.convert(m.bottom||[0,0]),"bottom-left":l.pointGeometry.convert(m["bottom-left"]||[0,0]),"bottom-right":l.pointGeometry.convert(m["bottom-right"]||[0,0]),left:l.pointGeometry.convert(m.left||[0,0]),right:l.pointGeometry.convert(m.right||[0,0])}}return Zu(new l.pointGeometry(0,0))}const Eo={supported:v,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends xn{constructor(m){var s;if(l.PerformanceUtils.mark(l.PerformanceMarkers.create),(m=l.extend({},ff,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new rl(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),{bearingSnap:m.bearingSnap}),this._interactive=m.interactive,this._cooperativeGestures=m.cooperativeGestures,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new hf,this._controls=[],this._mapId=l.uniqueId(),this._locale=l.extend({},df,m.locale),this._clickTolerance=m.clickTolerance,this._pixelRatio=(s=m.pixelRatio)!==null&&s!==void 0?s:devicePixelRatio,this._requestManager=new N(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new uf(this,m),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=m.hash&&new Jd(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,l.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new dl({customAttribution:m.customAttribution})),m.maplibreLogo&&this.addControl(new ac,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new l.Event(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new l.Event(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new l.Event("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(m,s){if(s===void 0&&(s=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=m.onAdd(this);this._controls.push(m);const p=this._controlPositions[s];return s.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(m);return s>-1&&this._controls.splice(s,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,s,h,p){return p==null&&this.style.terrain&&(p=this.transform.getElevation(h,this.style.terrain)),super.calculateCameraOptionsFromTo(m,s,h,p)}resize(m){const s=this._containerDimensions(),h=s[0],p=s[1];this._resizeCanvas(h,p,this.getPixelRatio()),this.transform.resize(h,p),this.painter.resize(h,p,this.getPixelRatio());const _=!this._moving;return _&&(this.stop(),this.fire(new l.Event("movestart",m)).fire(new l.Event("move",m))),this.fire(new l.Event("resize",m)),_&&this.fire(new l.Event("moveend",m)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(m){const[s,h]=this._containerDimensions();this._pixelRatio=m,this._resizeCanvas(s,h,m),this.painter.resize(s,h,m)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(l.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(l.LngLat.convert(m),this.style&&this.style.terrain)}unproject(m){return this.transform.pointLocation(l.pointGeometry.convert(m),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(m,s,h){if(m==="mouseenter"||m==="mouseover"){let p=!1;return{layer:s,listener:h,delegates:{mousemove:x=>{const E=this.getLayer(s)?this.queryRenderedFeatures(x.point,{layers:[s]}):[];E.length?p||(p=!0,h.call(this,new or(m,this,x.originalEvent,{features:E}))):p=!1},mouseout:()=>{p=!1}}}}if(m==="mouseleave"||m==="mouseout"){let p=!1;return{layer:s,listener:h,delegates:{mousemove:E=>{(this.getLayer(s)?this.queryRenderedFeatures(E.point,{layers:[s]}):[]).length?p=!0:p&&(p=!1,h.call(this,new or(m,this,E.originalEvent)))},mouseout:E=>{p&&(p=!1,h.call(this,new or(m,this,E.originalEvent)))}}}}{const p=_=>{const x=this.getLayer(s)?this.queryRenderedFeatures(_.point,{layers:[s]}):[];x.length&&(_.features=x,h.call(this,_),delete _.features)};return{layer:s,listener:h,delegates:{[m]:p}}}}on(m,s,h){if(h===void 0)return super.on(m,s);const p=this._createDelegatedListener(m,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(m,s,h){if(h===void 0)return super.once(m,s);const p=this._createDelegatedListener(m,s,h);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(m,s,h){return h===void 0?super.off(m,s):(this._delegatedListeners&&this._delegatedListeners[m]&&(p=>{const _=this._delegatedListeners[m];for(let x=0;x<_.length;x++){const E=_[x];if(E.layer===s&&E.listener===h){for(const A in E.delegates)this.off(A,E.delegates[A]);return _.splice(x,1),this}}})(),this)}queryRenderedFeatures(m,s){if(!this.style)return[];let h;if(s!==void 0||m===void 0||m instanceof l.pointGeometry||Array.isArray(m)||(s=m,m=void 0),s=s||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof l.pointGeometry||typeof m[0]=="number")h=[l.pointGeometry.convert(m)];else{const p=l.pointGeometry.convert(m[0]),_=l.pointGeometry.convert(m[1]);h=[p,new l.pointGeometry(_.x,p.y),_,new l.pointGeometry(p.x,_.y),p]}return this.style.queryRenderedFeatures(h,s,this.transform)}querySourceFeatures(m,s){return this.style.querySourceFeatures(m,s)}setStyle(m,s){return(s=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(m,s))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const s=this._locale[m];if(s==null)throw new Error(`Missing UI string '${m}'`);return s}_updateStyle(m,s){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new Jn(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Jn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,s){if(typeof m=="string"){const h=this._requestManager.transformRequest(m,l.ResourceType.Style);l.getJSON(h,(p,_)=>{p?this.fire(new l.ErrorEvent(p)):_&&this._updateDiff(_,s)})}else typeof m=="object"&&this._updateDiff(m,s)}_updateDiff(m,s){try{this.style.setState(m)&&this._update(!0)}catch(h){l.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(m,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")}addSource(m,s){return this._lazyInitEmptyStyle(),this.style.addSource(m,s),this._update(!0)}isSourceLoaded(m){const s=this.style&&this.style.sourceCaches[m];if(s!==void 0)return s.loaded();this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){return this.style.setTerrain(m),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const s in m){const h=m[s]._tiles;for(const p in h){const _=h[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(m,s,h){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,s,h)}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,s,{pixelRatio:h=1,sdf:p=!1,stretchX:_,stretchY:x,content:E}={}){if(this._lazyInitEmptyStyle(),s instanceof HTMLImageElement||l.isImageBitmap(s)){const{width:A,height:I,data:k}=l.exported.getImageData(s);this.style.addImage(m,{data:new l.RGBAImage({width:A,height:I},k),pixelRatio:h,stretchX:_,stretchY:x,content:E,sdf:p,version:0})}else{if(s.width===void 0||s.height===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:I,data:k}=s,z=s;this.style.addImage(m,{data:new l.RGBAImage({width:A,height:I},new Uint8Array(k)),pixelRatio:h,stretchX:_,stretchY:x,content:E,sdf:p,version:0,userImage:z}),z.onAdd&&z.onAdd(this,m)}}}updateImage(m,s){const h=this.style.getImage(m);if(!h)return this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=s instanceof HTMLImageElement||l.isImageBitmap(s)?l.exported.getImageData(s):s,{width:_,height:x,data:E}=p;if(_===void 0||x===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==h.data.width||x!==h.data.height)return this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const A=!(s instanceof HTMLImageElement||l.isImageBitmap(s));h.data.replace(E,A),this.style.updateImage(m,h)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,s){l.getImage(this._requestManager.transformRequest(m,l.ResourceType.Image),s)}listImages(){return this.style.listImages()}addLayer(m,s){return this._lazyInitEmptyStyle(),this.style.addLayer(m,s),this._update(!0)}moveLayer(m,s){return this.style.moveLayer(m,s),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,s,h){return this.style.setLayerZoomRange(m,s,h),this._update(!0)}setFilter(m,s,h={}){return this.style.setFilter(m,s,h),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,s,h,p={}){return this.style.setPaintProperty(m,s,h,p),this._update(!0)}getPaintProperty(m,s){return this.style.getPaintProperty(m,s)}setLayoutProperty(m,s,h,p={}){return this.style.setLayoutProperty(m,s,h,p),this._update(!0)}getLayoutProperty(m,s){return this.style.getLayoutProperty(m,s)}setLight(m,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,s),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(m,s){return this.style.setFeatureState(m,s),this._update()}removeFeatureState(m,s){return this.style.removeFeatureState(m,s),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,s=0;return this._container&&(m=this._container.clientWidth||400,s=this._container.clientHeight||300),[m,s]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map","mapboxgl-map");const s=this._canvasContainer=P.create("div","maplibregl-canvas-container mapboxgl-canvas-container",m);this._interactive&&s.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=P.create("canvas","maplibregl-canvas mapboxgl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions();this._resizeCanvas(h[0],h[1],this.getPixelRatio());const p=this._controlContainer=P.create("div","maplibregl-control-container mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=P.create("div",`maplibregl-ctrl-${x} mapboxgl-ctrl-${x}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const m=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=P.create("div","maplibregl-cooperative-gesture-screen",m);let s="Control",h=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(h=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map",s="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${h}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",p=>{p.key===s&&(this._metaPress=!0)}),document.addEventListener("keyup",p=>{p.key===s&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",p=>{this._onCooperativeGesture(p,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(m,s,h){this._canvas.width=h*m,this._canvas.height=h*s,this._canvas.style.width=`${m}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const m=l.extend({},v.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);s?(this.painter=new Fu(s,this.transform),l.exported$1.testSupport(s)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(m,s,h){return!s&&h<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){let s,h=0;const p=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(s=p.createQueryEXT(),p.beginQueryEXT(p.TIME_ELAPSED_EXT,s),h=l.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let _=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const E=this.transform.zoom,A=l.exported.now();this.style.zoomHistory.update(E,A);const I=new l.EvaluationParameters(E,{now:A,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),k=I.crossFadingFactor();k===1&&k===this._crossFadingFactor||(_=!0,this._crossFadingFactor=k),this.style.update(I)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.load),this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const E=l.exported.now()-h;p.endQueryEXT(p.TIME_ELAPSED_EXT,s),setTimeout(()=>{const A=p.getQueryObjectEXT(s,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(s),this.fire(new l.Event("gpu-timing-frame",{cpuTime:E,gpuTime:A}))},50)}if(this.listens("gpu-timing-layer")){const E=this.painter.collectGpuTimers();setTimeout(()=>{const A=this.painter.queryGpuTimers(E);this.fire(new l.Event("gpu-timing-layer",{layerTimes:A}))},50)}const x=this._sourcesDirty||this._styleDirty||this._placementDirty;return x||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.Event("idle")),!this._loaded||this._fullyLoaded||x||(this._fullyLoaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),P.remove(this._canvasContainer),P.remove(this._controlContainer),this._cooperativeGestures&&P.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),l.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.exported.frame(m=>{l.PerformanceUtils.frame(m),this._frame=null,this._render(m)}))}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}_setCacheLimits(m,s){l.setCacheLimits(m,s)}get version(){return"2.4.0"}},NavigationControl:class{constructor(m){this.options=l.extend({},xg,m),this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map.getZoom(),s=m===this._map.getMaxZoom(),h=m===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const m=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=m}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new as(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){P.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,s){const h=P.create("button",m,this._container);return h.type="button",h.addEventListener("click",s),h}_setButtonTitle(m,s){const h=this._map._getUIString(`NavigationControl.${s}`);m.title=h,m.setAttribute("aria-label",h)}},GeolocateControl:class extends l.Evented{constructor(m){super(),this.options=l.extend({},qu,m),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(m){var s;return this._map=m,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),s=this._setupUI,Ks!==void 0?s(Ks):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(h=>{Ks=h.state!=="denied",s(Ks)}):(Ks=!!window.navigator.geolocation,s(Ks)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),P.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,mi=0,Js=!1}_isOutOfMapMaxBounds(m){const s=this._map.getMaxBounds(),h=m.coords;return s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",m)),this._finish()}}_updateCamera(m){const s=new l.LngLat(m.coords.longitude,m.coords.latitude),h=m.coords.accuracy,p=this._map.getBearing(),_=l.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(h),_,{geolocateSource:!0})}_updateMarker(m){if(m){const s=new l.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map._container.clientHeight/2,s=this._map.unproject([0,m]),h=this._map.unproject([1,m]),p=s.distanceTo(h),_=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&Js)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=P.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=P.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new ua(this._dotElement),this._circleElement=P.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ua({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":mi--,Js=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),mi++,mi>1?(m={maximumAge:6e5,timeout:0},Js=!0):(m=this.options.positionOptions,Js=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:dl,LogoControl:ac,ScaleControl:class{constructor(m){this.options=l.extend({},ls,m),l.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){pf(this._map,this._container,this.options)}onAdd(m){return this._map=m,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){P.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(m){this.options.unit=m,pf(this._map,this._container,this.options)}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=P.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){P.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=P.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(m){this.options=m,l.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(m){return this._map=m,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=P.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),P.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){P.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends l.Evented{constructor(m){super(),this.options=l.extend(Object.create(kn),m),l.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&P.remove(this._content),this._container&&(P.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=l.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const s=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=m;p=h.firstChild,p;)s.appendChild(p);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=P.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){this._container&&this._container.classList.add(m)}removeClassName(m){this._container&&this._container.classList.remove(m)}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}_createCloseButton(){this.options.closeButton&&(this._closeButton=P.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(m){this._update(m.point)}_onMouseMove(m){this._update(m.point)}_onDrag(m){this._update(m.point)}_update(m){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=P.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=P.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(x=>this._container.classList.add(x)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=fl(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!m))return;const s=this._pos=this._trackPointer&&m?m:this._map.project(this._lngLat);let h=this.options.anchor;const p=Zu(this.options.offset);if(!h){const x=this._container.offsetWidth,E=this._container.offsetHeight;let A;A=s.y+p.bottom.y<E?["top"]:s.y>this._map.transform.height-E?["bottom"]:[],s.x<x/2?A.push("left"):s.x>this._map.transform.width-x/2&&A.push("right"),h=A.length===0?"bottom":A.join("-")}const _=s.add(p[h]).round();P.setTransform(this._container,`${dt[h]} translate(${_.x}px,${_.y}px)`),bt(this._container,h,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Hn);m&&m.focus()}_onClose(){this.remove()}},Marker:ua,Style:Jn,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.pointGeometry,MercatorCoordinate:l.MercatorCoordinate,Evented:l.Evented,AJAXError:l.AJAXError,config:l.config,CanvasSource:nn,GeoJSONSource:ii,ImageSource:wt,RasterDEMTileSource:vt,RasterTileSource:Mt,VectorTileSource:Yt,VideoSource:St,prewarm:function(){fi().acquire(Li)},clearPrewarmedResources:function(){const m=ji;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Li),ji=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return Yn.workerCount},set workerCount(m){Yn.workerCount=m},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){l.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){l.clearTileCache(m)},workerUrl:"",addProtocol(m,s){l.config.REGISTERED_PROTOCOLS[m]=s},removeProtocol(m){delete l.config.REGISTERED_PROTOCOLS[m]}};return wr.extend(Eo,{isSafari:l.isSafari,getPerformanceMetrics:l.PerformanceUtils.getPerformanceMetrics}),Eo});var d=o;return d})})(yS);var ak=yS.exports;const lk=Cm(ak);function cm(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Dv=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),nw=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);nw&&parseFloat(nw[1]);const ck="3.4.14";function Ho(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Mp=typeof process!="object"||String(process)!=="[object process]"||process.browser,uk=typeof window<"u"&&typeof window.orientation<"u",iw=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);iw&&parseFloat(iw[1]);function hd(t){"@babel/helpers - typeof";return hd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hd(t)}function hk(t,e){if(hd(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(hd(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function dk(t){var e=hk(t,"string");return hd(e)==="symbol"?e:String(e)}function V(t,e,n){return e=dk(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class fk{constructor(e,n){V(this,"name",void 0),V(this,"workerThread",void 0),V(this,"isRunning",!0),V(this,"result",void 0),V(this,"_resolve",()=>{}),V(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((i,o)=>{this._resolve=i,this._reject=o})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){Ho(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Ho(this.isRunning),this.isRunning=!1,this._reject(e)}}let k_=class{terminate(){}};const R_=new Map;function pk(t){Ho(t.source&&!t.url||!t.source&&t.url);let e=R_.get(t.source||t.url);return e||(t.url&&(e=mk(t.url),R_.set(t.url,e)),t.source&&(e=xS(t.source),R_.set(t.source,e))),Ho(e),e}function mk(t){if(!t.startsWith("http"))return t;const e=gk(t);return xS(e)}function xS(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function gk(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function bS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const i=n||new Set;if(t){if(rw(t))i.add(t);else if(rw(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const o in t)bS(t[o],e,i)}}return n===void 0?Array.from(i):[]}function rw(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const D_=()=>{};class r0{static isSupported(){return typeof Worker<"u"&&Mp||typeof k_<"u"&&!Mp}constructor(e){V(this,"name",void 0),V(this,"source",void 0),V(this,"url",void 0),V(this,"terminated",!1),V(this,"worker",void 0),V(this,"onMessage",void 0),V(this,"onError",void 0),V(this,"_loadableURL","");const{name:n,source:i,url:o}=e;Ho(i||o),this.name=n,this.source=i,this.url=o,this.onMessage=D_,this.onError=c=>console.log(c),this.worker=Mp?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=D_,this.onError=D_,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||bS(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=pk({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new k_(i,{eval:!1})}else if(this.source)e=new k_(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class _k{static isSupported(){return r0.isSupported()}constructor(e){V(this,"name","unnamed"),V(this,"source",void 0),V(this,"url",void 0),V(this,"maxConcurrency",1),V(this,"maxMobileConcurrency",1),V(this,"onDebug",()=>{}),V(this,"reuseWorkers",!0),V(this,"props",{}),V(this,"jobQueue",[]),V(this,"idleQueue",[]),V(this,"count",0),V(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(c,d,l)=>c.done(l),i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(c,d)=>c.error(d);const o=new Promise(c=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:c}),this));return this._startQueuedJob(),await o}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new fk(n.name,e);e.onMessage=o=>n.onMessage(i,o.type,o.payload),e.onError=o=>n.onError(i,o),n.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new r0({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return uk?this.maxMobileConcurrency:this.maxConcurrency}}const yk={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Fo{static isSupported(){return r0.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Fo._workerFarm=Fo._workerFarm||new Fo({}),Fo._workerFarm.setProps(e),Fo._workerFarm}constructor(e){V(this,"props",void 0),V(this,"workerPools",new Map),this.props={...yk},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:o}=e;let c=this.workerPools.get(n);return c||(c=new _k({name:n,source:i,url:o}),c.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,c)),c}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}V(Fo,"_workerFarm",void 0);const vk="latest";function xk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let o=n.workerUrl;if(!o&&t.id==="compression"&&(o=e.workerUrl),e._workerType==="test"&&(o="modules/".concat(t.module,"/dist/").concat(i)),!o){let c=t.version;c==="latest"&&(c=vk);const d=c?"@".concat(c):"";o="https://unpkg.com/@loaders.gl/".concat(t.module).concat(d,"/dist/").concat(i)}return Ho(o),o}function bk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ck;Ho(t,"no worker provided");const n=t.version;return!(!e||!n)}function wk(t,e){return!Fo.isSupported()||!Mp&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function Ek(t,e,n,i,o){const c=t.id,d=xk(t,n),v=Fo.getWorkerFarm(n).getWorkerPool({name:c,url:d});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const w=await v.startJob("process-on-worker",Tk.bind(null,o));return w.postMessage("process",{input:e,options:n,context:i}),await(await w.result).result}async function Tk(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:o,input:c,options:d}=i;try{const l=await t(c,d);e.postMessage("done",{id:o,result:l})}catch(l){const v=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:o,error:v})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function Sk(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),o=new Uint8Array(e);for(let c=0;c<i.length;++c)if(i[c]!==o[c])return!1;return!0}function Ak(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=e.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),o=i.reduce((l,v)=>l+v.byteLength,0),c=new Uint8Array(o);let d=0;for(const l of i)c.set(l,d),d+=l.byteLength;return c.buffer}async function Pk(t){const e=[];for await(const n of t)e.push(n);return Ak(...e)}let Ik="";const sw={};function Ck(t){for(const e in sw)if(t.startsWith(e)){const n=sw[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(Ik).concat(t)),t}function Mk(t){return t&&typeof t=="object"&&t.isBuffer}function wS(t){if(Mk(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function ES(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function Lk(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const kk=t=>typeof t=="boolean",Hh=t=>typeof t=="function",Ad=t=>t!==null&&typeof t=="object",ow=t=>Ad(t)&&t.constructor==={}.constructor,Rk=t=>t&&typeof t[Symbol.iterator]=="function",Dk=t=>t&&typeof t[Symbol.asyncIterator]=="function",Gl=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,$l=t=>typeof Blob<"u"&&t instanceof Blob,zk=t=>t&&typeof t=="object"&&t.isBuffer,Ok=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Ad(t)&&Hh(t.tee)&&Hh(t.cancel)&&Hh(t.getReader),Fk=t=>Ad(t)&&Hh(t.read)&&Hh(t.pipe)&&kk(t.readable),TS=t=>Ok(t)||Fk(t),Bk=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Nk=/^([-\w.]+\/[-\w.+]+)/;function Uk(t){const e=Nk.exec(t);return e?e[1]:t}function aw(t){const e=Bk.exec(t);return e?e[1]:""}const SS=/\?.*/;function Vk(t){const e=t.match(SS);return e&&e[0]}function zv(t){return t.replace(SS,"")}function Wm(t){return Gl(t)?t.url:$l(t)?t.name||"":typeof t=="string"?t:""}function Ov(t){if(Gl(t)){const e=t,n=e.headers.get("content-type")||"",i=zv(e.url);return Uk(n)||aw(i)}return $l(t)?t.type||"":typeof t=="string"?aw(t):""}function jk(t){return Gl(t)?t.headers["content-length"]||-1:$l(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function AS(t){if(Gl(t))return t;const e={},n=jk(t);n>=0&&(e["content-length"]=String(n));const i=Wm(t),o=Ov(t);o&&(e["content-type"]=o);const c=await Hk(t);c&&(e["x-first-bytes"]=c),typeof t=="string"&&(t=new TextEncoder().encode(t));const d=new Response(t,{headers:e});return Object.defineProperty(d,"url",{value:i}),d}async function Gk(t){if(!t.ok){const e=await $k(t);throw new Error(e)}}async function $k(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function Hk(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const o=new FileReader;o.onload=c=>{var d;return i(c==null||(d=c.target)===null||d===void 0?void 0:d.result)},o.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),i=Wk(n);return"data:base64,".concat(i)}return null}function Wk(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}async function lw(t,e){if(typeof t=="string"){t=Ck(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await AS(t)}function qk(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Pd(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||qk()}const tp=globalThis.window||globalThis.self||globalThis.global,wh=globalThis.process||{},PS=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Pd();function Zk(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}let Xk=class{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=Zk(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}};function Yk(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function Kk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function z_(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const o=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const c=t.width*n,d=t.height*n,l=["font-size:1px;","padding:".concat(Math.floor(d/2),"px ").concat(Math.floor(c/2),"px;"),"line-height:".concat(d,"px;"),"background:url(".concat(o,");"),"background-size:".concat(c,"px ").concat(d,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),l]}let um;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(um||(um={}));const Jk=10;function cw(t){return typeof t!="string"?t:(t=t.toUpperCase(),um[t]||um.WHITE)}function Qk(t,e,n){if(!Pd&&typeof t=="string"){if(e){const i=cw(e);t="\x1B[".concat(i,"m").concat(t,"\x1B[39m")}if(n){const i=cw(n);t="\x1B[".concat(i+Jk,"m").concat(t,"\x1B[49m")}}return t}function e3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n),o=t;for(const c of i){const d=o[c];typeof d=="function"&&(e.find(l=>c===l)||(o[c]=d.bind(t)))}}function hm(t,e){if(!t)throw new Error(e||"Assertion failed")}function xc(){let t;if(Pd()&&tp.performance){var e,n;t=tp==null||(e=tp.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in wh){var i;const o=wh==null||(i=wh.hrtime)===null||i===void 0?void 0:i.call(wh);t=o[0]*1e3+o[1]/1e6}else t=Date.now();return t}const bc={debug:Pd()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},t3={enabled:!0,level:0};function fs(){}const uw={},hw={once:!0};let Fv=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=PS,this._startTs=xc(),this._deltaTs=xc(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Xk("__probe-".concat(this.id,"__"),t3),this.timeStamp("".concat(this.id," started")),e3(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((xc()-this._startTs).toPrecision(10))}getDelta(){return Number((xc()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){hm(e,n)}warn(e){return this._getLogFunction(0,e,bc.warn,arguments,hw)}error(e){return this._getLogFunction(0,e,bc.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,bc.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,bc.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,bc.debug||bc.info,arguments,hw)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||fs,i&&[i],{tag:s3(n)}):fs}image(e){let{logLevel:n,priority:i,image:o,message:c="",scale:d=1}=e;return this._shouldLog(n||i)?Pd()?r3({image:o,message:c,scale:d}):i3():fs}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||fs)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const o=dw({logLevel:e,message:n,opts:i}),{collapsed:c}=i;return o.method=(c?console.groupCollapsed:console.group)||console.info,this._getLogFunction(o)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||fs)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=IS(e)}_getLogFunction(e,n,i,o,c){if(this._shouldLog(e)){c=dw({logLevel:e,message:n,args:o,opts:c}),i=i||c.method,hm(i),c.total=this.getTotal(),c.delta=this.getDelta(),this._deltaTs=xc();const d=c.tag||c.message;if(c.once&&d)if(!uw[d])uw[d]=xc();else return fs;return n=n3(this.id,c.message,c),i.bind(console,n,...c.args)}return fs}};Fv.VERSION=PS;function IS(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return hm(Number.isFinite(e)&&e>=0),e}function dw(t){const{logLevel:e,message:n}=t;t.logLevel=IS(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const o=typeof t.message;return hm(o==="string"||o==="object"),Object.assign(t,{args:i},t.opts)}function n3(t,e,n){if(typeof e=="string"){const i=n.time?Kk(Yk(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=Qk(e,n.color,n.background)}return e}function i3(t){return console.warn("removed"),fs}function r3(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const c=new Image;return c.onload=()=>{const d=z_(c,n,i);console.log(...d)},c.src=e,fs}const o=e.nodeName||"";if(o.toLowerCase()==="img")return console.log(...z_(e,n,i)),fs;if(o.toLowerCase()==="canvas"){const c=new Image;return c.onload=()=>console.log(...z_(c,n,i)),c.src=e.toDataURL(),fs}return fs}function s3(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const fw=new Fv({id:"loaders.gl"});class o3{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class a3{constructor(){V(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.log.bind(this.console,...n)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.info.bind(this.console,...n)}warn(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.warn.bind(this.console,...n)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.error.bind(this.console,...n)}}const CS={fetch:null,mimeType:void 0,nothrow:!1,log:new a3,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Dv,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},l3={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function MS(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const LS=()=>{const t=MS();return t.globalOptions=t.globalOptions||{...CS},t.globalOptions};function c3(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],u3(t,n),d3(e,t,i)}function u3(t,e){pw(t,null,CS,l3,e);for(const n of e){const i=t&&t[n.id]||{},o=n.options&&n.options[n.id]||{},c=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};pw(i,n.id,o,c,e)}}function pw(t,e,n,i,o){const c=e||"Top level",d=e?"".concat(e,"."):"";for(const l in t){const v=!e&&Ad(t[l]),w=l==="baseUri"&&!e,C=l==="workerUrl"&&e;if(!(l in n)&&!w&&!C){if(l in i)fw.warn("".concat(c," loader option '").concat(d).concat(l,"' no longer supported, use '").concat(i[l],"'"))();else if(!v){const L=h3(l,o);fw.warn("".concat(c," loader option '").concat(d).concat(l,"' not recognized. ").concat(L))()}}}}function h3(t,e){const n=t.toLowerCase();let i="";for(const o of e)for(const c in o.options){if(t===c)return"Did you mean '".concat(o.id,".").concat(c,"'?");const d=c.toLowerCase();(n.startsWith(d)||d.startsWith(n))&&(i=i||"Did you mean '".concat(o.id,".").concat(c,"'?"))}return i}function d3(t,e,n){const o={...t.options||{}};return f3(o,n),o.log===null&&(o.log=new o3),mw(o,LS()),mw(o,e),o}function mw(t,e){for(const n in e)if(n in e){const i=e[n];ow(i)&&ow(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function f3(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Bv(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function Nv(t){var e,n;cm(t,"null loader"),cm(Bv(t),"invalid loader");let i;return Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const kS=()=>{const t=MS();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function p3(t){const e=kS();t=Array.isArray(t)?t:[t];for(const n of t){const i=Nv(n);e.find(o=>i===o)||e.unshift(i)}}function m3(){return kS()}const g3=new Fv({id:"loaders.gl"}),_3=/\.([^.]+)$/;async function y3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!RS(t))return null;let o=gw(t,e,{...n,nothrow:!0},i);if(o)return o;if($l(t)&&(t=await t.slice(0,10).arrayBuffer(),o=gw(t,e,n,i)),!o&&!(n!=null&&n.nothrow))throw new Error(DS(t));return o}function gw(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!RS(t))return null;if(e&&!Array.isArray(e))return Nv(e);let o=[];e&&(o=o.concat(e)),n!=null&&n.ignoreRegisteredLoaders||o.push(...m3()),x3(o);const c=v3(t,o,n,i);if(!c&&!(n!=null&&n.nothrow))throw new Error(DS(t));return c}function v3(t,e,n,i){const o=Wm(t),c=Ov(t),d=zv(o)||(i==null?void 0:i.url);let l=null,v="";if(n!=null&&n.mimeType&&(l=O_(e,n==null?void 0:n.mimeType),v="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),l=l||b3(e,d),v=v||(l?"matched url ".concat(d):""),l=l||O_(e,c),v=v||(l?"matched MIME type ".concat(c):""),l=l||E3(e,t),v=v||(l?"matched initial data ".concat(zS(t)):""),l=l||O_(e,n==null?void 0:n.fallbackMimeType),v=v||(l?"matched fallback MIME type ".concat(c):""),v){var w;g3.log(1,"selectLoader selected ".concat((w=l)===null||w===void 0?void 0:w.name,": ").concat(v,"."))}return l}function RS(t){return!(t instanceof Response&&t.status===204)}function DS(t){const e=Wm(t),n=Ov(t);let i="No valid loader found (";i+=e?"".concat(ES(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const o=t?zS(t):"";return i+=o?' first bytes: "'.concat(o,'"'):"first bytes: not available",i+=")",i}function x3(t){for(const e of t)Nv(e)}function b3(t,e){const n=e&&_3.exec(e),i=n&&n[1];return i?w3(t,i):null}function w3(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function O_(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function E3(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(T3(e,n))return n}else if(ArrayBuffer.isView(e)){if(_w(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&_w(e,0,n))return n;return null}function T3(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function _w(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(o=>S3(t,e,n,o))}function S3(t,e,n,i){if(i instanceof ArrayBuffer)return Sk(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":const o=s0(t,e,i.length);return i===o;default:return!1}}function zS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?s0(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?s0(t,0,e):""}function s0(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let o="";for(let c=0;c<n;c++)o+=String.fromCharCode(i.getUint8(e+c));return o}const A3=256*1024;function*P3(t,e){const n=(e==null?void 0:e.chunkSize)||A3;let i=0;const o=new TextEncoder;for(;i<t.length;){const c=Math.min(t.length-i,n),d=t.slice(i,i+c);i+=c,yield o.encode(d)}}const I3=256*1024;function C3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:n=I3}=e;let i=0;for(;i<t.byteLength;){const o=Math.min(t.byteLength-i,n),c=new ArrayBuffer(o),d=new Uint8Array(t,i,o);new Uint8Array(c).set(d),i+=o,yield c}}()}const M3=1024*1024;async function*L3(t,e){const n=(e==null?void 0:e.chunkSize)||M3;let i=0;for(;i<t.size;){const o=i+n,c=await t.slice(i,o).arrayBuffer();i=o,yield c}}function yw(t,e){return Dv?k3(t,e):R3(t)}async function*k3(t,e){const n=t.getReader();let i;try{for(;;){const o=i||n.read();e!=null&&e._streamReadAhead&&(i=n.read());const{done:c,value:d}=await o;if(c)return;yield wS(d)}}catch{n.releaseLock()}}async function*R3(t,e){for await(const n of t)yield wS(n)}function D3(t,e){if(typeof t=="string")return P3(t,e);if(t instanceof ArrayBuffer)return C3(t,e);if($l(t))return L3(t,e);if(TS(t))return yw(t,e);if(Gl(t))return yw(t.body,e);throw new Error("makeIterator")}const OS="Cannot convert supplied data type";function z3(t,e,n){if(e.text&&typeof t=="string")return t;if(zk(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const o=t.byteLength||t.length;return(t.byteOffset!==0||o!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+o)),i}throw new Error(OS)}async function O3(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return z3(t,e);if($l(t)&&(t=await AS(t)),Gl(t)){const o=t;return await Gk(o),e.binary?await o.arrayBuffer():await o.text()}if(TS(t)&&(t=D3(t,n)),Rk(t)||Dk(t))return Pk(t);throw new Error(OS)}function FS(t,e){const n=LS(),i=t||n;return typeof i.fetch=="function"?i.fetch:Ad(i.fetch)?o=>lw(o,i):e!=null&&e.fetch?e==null?void 0:e.fetch:lw}function F3(t,e,n){if(n)return n;const i={fetch:FS(e,t),...t};if(i.url){const o=zv(i.url);i.baseUrl=o,i.queryString=Vk(i.url),i.filename=ES(o),i.baseUrl=Lk(o)}return Array.isArray(i.loaders)||(i.loaders=null),i}function B3(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:null}async function Uv(t,e,n,i){Ho(!i||typeof i=="object"),e&&!Array.isArray(e)&&!Bv(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const o=Wm(t),d=B3(e,i),l=await y3(t,d,n);return l?(n=c3(n,l,d,o),i=F3({url:o,parse:Uv,loaders:d},n,i||null),await N3(l,t,n,i)):null}async function N3(t,e,n,i){if(bk(t),Gl(e)){const o=e,{ok:c,redirected:d,status:l,statusText:v,type:w,url:C}=o,L=Object.fromEntries(o.headers.entries());i.response={headers:L,ok:c,redirected:d,status:l,statusText:v,type:w,url:C}}if(e=await O3(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,i,t);if(wk(t,n))return await Ek(t,e,n,i,Uv);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw Ho(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function o0(t,e,n,i){!Array.isArray(e)&&!Bv(e)&&(n=e,e=void 0);const o=FS(n);let c=t;return typeof t=="string"&&(c=await o(t)),$l(t)&&(c=await o(t)),await Uv(c,e,n)}const U3="3.4.14",{_parseImageNode:V3}=globalThis,a0=typeof Image<"u",l0=typeof ImageBitmap<"u",j3=!!V3,c0=Dv?!0:j3;function G3(t){switch(t){case"auto":return l0||a0||c0;case"imagebitmap":return l0;case"image":return a0;case"data":return c0;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function $3(){if(l0)return"imagebitmap";if(a0)return"image";if(c0)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function H3(t){const e=q3(t);if(!e)throw new Error("Not an image");return e}function W3(t){switch(H3(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function q3(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const Z3=/^data:image\/svg\+xml/,X3=/\.svg((\?|#).*)?$/;function Vv(t){return t&&(Z3.test(t)||X3.test(t))}function Y3(t,e){if(Vv(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(c){throw new Error(c.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return BS(t,e)}function BS(t,e){if(Vv(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function NS(t,e,n){const i=Y3(t,n),o=self.URL||self.webkitURL,c=typeof i!="string"&&o.createObjectURL(i);try{return await K3(c||i,e)}finally{c&&o.revokeObjectURL(c)}}async function K3(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,o)=>{try{n.onload=()=>i(n),n.onerror=c=>o(new Error("Could not load image ".concat(t,": ").concat(c)))}catch(c){o(c)}})}const J3={};let vw=!0;async function Q3(t,e,n){let i;Vv(n)?i=await NS(t,e,n):i=BS(t,n);const o=e&&e.imagebitmap;return await eR(i,o)}async function eR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((tR(e)||!vw)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),vw=!1}return await createImageBitmap(t)}function tR(t){for(const e in t||J3)return!1;return!0}function nR(t){return!oR(t,"ftyp",4)||!(t[8]&96)?null:iR(t)}function iR(t){switch(rR(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function rR(t,e,n){return String.fromCharCode(...t.slice(e,n))}function sR(t){return[...t].map(e=>e.charCodeAt(0))}function oR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=sR(e);for(let o=0;o<i.length;++o)if(i[o]!==t[o+n])return!1;return!0}const co=!1,Wh=!0;function US(t){const e=Id(t);return lR(e)||hR(e)||cR(e)||uR(e)||aR(e)}function aR(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=nR(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function lR(t){const e=Id(t);return e.byteLength>=24&&e.getUint32(0,co)===2303741511?{mimeType:"image/png",width:e.getUint32(16,co),height:e.getUint32(20,co)}:null}function cR(t){const e=Id(t);return e.byteLength>=10&&e.getUint32(0,co)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Wh),height:e.getUint16(8,Wh)}:null}function uR(t){const e=Id(t);return e.byteLength>=14&&e.getUint16(0,co)===16973&&e.getUint32(2,Wh)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Wh),height:e.getUint32(22,Wh)}:null}function hR(t){const e=Id(t);if(!(e.byteLength>=3&&e.getUint16(0,co)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:o}=dR();let c=2;for(;c+9<e.byteLength;){const d=e.getUint16(c,co);if(o.has(d))return{mimeType:"image/jpeg",height:e.getUint16(c+5,co),width:e.getUint16(c+7,co)};if(!i.has(d))return null;c+=2,c+=e.getUint16(c,co)}return null}function dR(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Id(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function fR(t,e){const{mimeType:n}=US(t)||{},i=globalThis._parseImageNode;return cm(i),await i(t,n)}async function pR(t,e,n){e=e||{};const o=(e.image||{}).type||"auto",{url:c}=n||{},d=mR(o);let l;switch(d){case"imagebitmap":l=await Q3(t,e,c);break;case"image":l=await NS(t,e,c);break;case"data":l=await fR(t);break;default:cm(!1)}return o==="data"&&(l=W3(l)),l}function mR(t){switch(t){case"auto":case"data":return $3();default:return G3(t),t}}const gR=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],_R=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],yR={image:{type:"auto",decode:!0}},vR={id:"image",module:"images",name:"Images",version:U3,mimeTypes:_R,extensions:gR,parse:pR,tests:[t=>!!US(new DataView(t))],options:yR};function VS(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Xo(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||VS()}const Lp={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},np=Lp.window||Lp.self||Lp.global,Eh=Lp.process||{},jS=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Xo();const F_=globalThis;function GS(t){if(!t&&!Xo())return"Node";if(VS(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=n.indexOf("MSIE ")!==-1,o=n.indexOf("Trident/")!==-1;return i||o?"IE":F_.chrome?"Chrome":F_.safari?"Safari":F_.mozInnerScreenX?"Firefox":"Unknown"}function xR(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class bR{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";V(this,"storage",void 0),V(this,"id",void 0),V(this,"config",void 0),this.storage=xR(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function wR(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function ER(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function B_(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const o=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const c=t.width*n,d=t.height*n,l=["font-size:1px;","padding:".concat(Math.floor(d/2),"px ").concat(Math.floor(c/2),"px;"),"line-height:".concat(d,"px;"),"background:url(".concat(o,");"),"background-size:".concat(c,"px ").concat(d,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),l]}let dm;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(dm||(dm={}));function xw(t){return typeof t=="string"?dm[t.toUpperCase()]||dm.WHITE:t}function TR(t,e,n){return!Xo&&typeof t=="string"&&(e&&(e=xw(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=xw(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function SR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const o of i)typeof t[o]=="function"&&(e.find(c=>o===c)||(t[o]=t[o].bind(t)))}function fm(t,e){if(!t)throw new Error(e||"Assertion failed")}function wc(){let t;if(Xo&&"performance"in np){var e,n;t=np==null||(e=np.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in Eh){var i;const o=Eh==null||(i=Eh.hrtime)===null||i===void 0?void 0:i.call(Eh);t=o[0]*1e3+o[1]/1e6}else t=Date.now();return t}const Ec={debug:Xo&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},AR={enabled:!0,level:0};function ps(){}const bw={},ww={once:!0};class jv{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};V(this,"id",void 0),V(this,"VERSION",jS),V(this,"_startTs",wc()),V(this,"_deltaTs",wc()),V(this,"_storage",void 0),V(this,"userData",{}),V(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new bR("__probe-".concat(this.id,"__"),AR),this.timeStamp("".concat(this.id," started")),SR(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((wc()-this._startTs).toPrecision(10))}getDelta(){return Number((wc()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){fm(e,n)}warn(e){return this._getLogFunction(0,e,Ec.warn,arguments,ww)}error(e){return this._getLogFunction(0,e,Ec.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,Ec.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Ec.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return this._getLogFunction(e,n,Ec.debug||Ec.info,arguments,ww)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||ps,i&&[i],{tag:MR(n)}):ps}image(e){let{logLevel:n,priority:i,image:o,message:c="",scale:d=1}=e;return this._shouldLog(n||i)?Xo?CR({image:o,message:c,scale:d}):IR():ps}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||ps)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const o=Ew({logLevel:e,message:n,opts:i}),{collapsed:c}=i;return o.method=(c?console.groupCollapsed:console.group)||console.info,this._getLogFunction(o)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ps)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=$S(e)}_getLogFunction(e,n,i,o,c){if(this._shouldLog(e)){c=Ew({logLevel:e,message:n,args:o,opts:c}),i=i||c.method,fm(i),c.total=this.getTotal(),c.delta=this.getDelta(),this._deltaTs=wc();const d=c.tag||c.message;if(c.once)if(!bw[d])bw[d]=wc();else return ps;return n=PR(this.id,c.message,c),i.bind(console,n,...c.args)}return ps}}V(jv,"VERSION",jS);function $S(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return fm(Number.isFinite(e)&&e>=0),e}function Ew(t){const{logLevel:e,message:n}=t;t.logLevel=$S(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const o=typeof t.message;return fm(o==="string"||o==="object"),Object.assign(t,{args:i},t.opts)}function PR(t,e,n){if(typeof e=="string"){const i=n.time?ER(wR(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=TR(e,n.color,n.background)}return e}function IR(t){return console.warn("removed"),ps}function CR(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const c=new Image;return c.onload=()=>{const d=B_(c,n,i);console.log(...d)},c.src=e,ps}const o=e.nodeName||"";if(o.toLowerCase()==="img")return console.log(...B_(e,n,i)),ps;if(o.toLowerCase()==="canvas"){const c=new Image;return c.onload=()=>console.log(...B_(c,n,i)),c.src=e.toDataURL(),ps}return ps}function MR(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const yn=new jv({id:"deck"});let u0={};function LR(t){u0=t}function Qi(t,e,n,i){yn.level>0&&u0[t]&&u0[t].call(null,e,n,i)}function kR(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const RR={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:kR,parseTextSync:JSON.parse};function DR(){const t="8.9.28",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(t));return e||(yn.log(1,"deck.gl ".concat(t))(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:yn,_registerLoggers:LR},p3([RR,[vR,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const zR=DR(),tn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(tn,"IDENTITY",{get:()=>(yn.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const uo={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},h0={common:0,meters:1,pixels:2},Tw={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},Et=new jv({id:"luma.gl"});function pr(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const OR="Invalid WebGLRenderingContext",FR="Requires WebGL2";function qm(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function Zt(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function BR(t){return Zt(t)?t:null}function Zm(t){return pr(qm(t),OR),t}function mr(t){return pr(Zt(t),FR),t}const Rh={};function NR(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function UR(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function VR(t,e){Rh[t]=!0,e!==void 0&&NR(e)}function jR(t){const e=t.getError;t.getError=function(){let i;do i=e.apply(t),i!==0&&(Rh[i]=!0);while(i!==0);for(i in Rh)if(Rh[i])return delete Rh[i],parseInt(i,10);return 0}}const Cd=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const o=new t.VertexAttrib(n);this.attribs[i]=o}this.maxAttrib=0};Cd.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};Cd.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Hl=function(e){const n=this;this.gl=e,jR(e);const i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(c){return c===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(c){const d=n.currentVertexArrayObject;d.maxAttrib=Math.max(d.maxAttrib,c);const l=d.attribs[c];return l.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(c){const d=n.currentVertexArrayObject;d.maxAttrib=Math.max(d.maxAttrib,c);const l=d.attribs[c];return l.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(c,d){switch(c){case 34962:n.currentArrayBuffer=d;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=d;break}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(c,d){const v=n.currentVertexArrayObject.attribs[c];switch(d){case 34975:return v.buffer;case 34338:return v.enabled;case 34339:return v.size;case 34340:return v.stride;case 34341:return v.type;case 34922:return v.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(c,d,l,v,w,C){const L=n.currentVertexArrayObject;L.maxAttrib=Math.max(L.maxAttrib,c);const P=L.attribs[c];return P.buffer=n.currentArrayBuffer,P.size=d,P.type=l,P.normalized=v,P.stride=w,P.offset=C,P.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{UR("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};Hl.prototype.VERTEX_ARRAY_BINDING_OES=34229;Hl.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new Cd(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Hl.prototype.createVertexArrayOES=function(){const e=new Cd(this);return this.vertexArrayObjects.push(e),e};Hl.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};Hl.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof Cd&&e.hasBeenBound&&e.ext===this)};Hl.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){VR(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const i=this.original,o=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const c=this.currentVertexArrayObject;if(o===c)return;(!o||c.elementArrayBuffer!==o.elementArrayBuffer)&&i.bindBuffer.call(n,34963,c.elementArrayBuffer);let d=this.currentArrayBuffer;const l=Math.max(o?o.maxAttrib:0,c.maxAttrib);for(let v=0;v<=l;v++){const w=c.attribs[v],C=o?o.attribs[v]:null;if((!o||w.enabled!==C.enabled)&&(w.enabled?i.enableVertexAttribArray.call(n,v):i.disableVertexAttribArray.call(n,v)),w.enabled){let L=!1;(!o||w.buffer!==C.buffer)&&(d!==w.buffer&&(i.bindBuffer.call(n,34962,w.buffer),d=w.buffer),L=!0),(L||w.cached!==C.cached)&&i.vertexAttribPointer.call(n,v,w.size,w.type,w.normalized,w.stride,w.offset)}}this.currentArrayBuffer!==d&&i.bindBuffer.call(n,34962,this.currentArrayBuffer)};function GR(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const o=e.call(this)||[];return o.indexOf("OES_vertex_array_object")<0&&o.push("OES_vertex_array_object"),o};const n=t.getExtension;t.getExtension=function(o){const c=n.call(this,o);return c||(o!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Hl(this)),this.__OESVertexArrayObject))}}const Sw="OES_element_index",Aw="WEBGL_draw_buffers",$R="EXT_disjoint_timer_query",HR="EXT_disjoint_timer_query_webgl2",WR="EXT_texture_filter_anisotropic",Pw="WEBGL_debug_renderer_info",qR=35723,ZR=4352,XR=36795,YR=34047,KR=37445,JR=37446,Sn=t=>Zt(t)?void 0:0,QR={3074:t=>Zt(t)?void 0:36064,[qR]:t=>Zt(t)?void 0:ZR,35977:Sn,32937:Sn,[XR]:(t,e)=>{const n=Zt(t)?t.getExtension(HR):t.getExtension($R);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[KR]:(t,e)=>{const n=t.getExtension(Pw);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[JR]:(t,e)=>{const n=t.getExtension(Pw);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[YR]:(t,e)=>{const n=t.luma.extensions[WR];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:Sn,35071:Sn,37447:Sn,36063:(t,e)=>{if(!Zt(t)){const n=t.getExtension(Aw);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:Sn,35374:Sn,35377:Sn,34852:t=>{if(!Zt(t)){const e=t.getExtension(Aw);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:t=>t.getExtension(Sw)?2147483647:65535,33001:t=>t.getExtension(Sw)?16777216:65535,33e3:t=>16777216,37157:Sn,35373:Sn,35657:Sn,36183:Sn,37137:Sn,34045:Sn,35978:Sn,35979:Sn,35968:Sn,35376:Sn,35375:Sn,35659:Sn,37154:Sn,35371:Sn,35658:Sn,35076:Sn,35077:Sn,35380:Sn};function eD(t,e,n){const i=QR[n],o=typeof i=="function"?i(t,e,n):i;return o!==void 0?o:e(n)}const tD="OES_vertex_array_object",HS="ANGLE_instanced_arrays",nD="WEBGL_draw_buffers",iD="EXT_disjoint_timer_query",rD="EXT_texture_filter_anisotropic",sD="VertexArray requires WebGL2 or OES_vertex_array_object extension";function oD(t,e){return{webgl2:Zt(t),ext:t.getExtension(e)}}const WS={[tD]:{meta:{suffix:"OES"},createVertexArray:()=>{pr(!1,sD)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[HS]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){pr(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[nD]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{pr(!1)}},[iD]:{meta:{suffix:"EXT"},createQuery:()=>{pr(!1)},deleteQuery:()=>{pr(!1)},beginQuery:()=>{pr(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},N_={readBuffer:(t,e,n)=>{Zt(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:o,ext:c}=oD(t,HS);let d;switch(i){case 35069:d=o?void 0:!1;break;case 35070:d=!o&&!c?0:void 0;break}return d!==void 0?d:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!Zt(t))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,o)=>{if(!Zt(t))switch(o){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,o)},getTexParameter(t,e,n,i){switch(i){case 34046:const{extensions:o}=t.luma,c=o[rD];i=c&&c.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,i)},getParameter:eD,hint(t,e,n,i){return e(n,i)}};function aD(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(GR(t),lD(t),uD(t,WS),cD(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=aD;function lD(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function cD(t,e){let{target:n,target2:i}=e;Object.keys(N_).forEach(o=>{if(typeof N_[o]=="function"){const c=t[o]?t[o].bind(t):()=>{},d=N_[o].bind(null,t,c);n[o]=d,i[o]=d}})}function uD(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&hD(t,{extension:n,target:t.luma,target2:t})}function hD(t,e){let{extension:n,target:i,target2:o}=e;const c=WS[n];pr(c);const{meta:d={}}=c,{suffix:l=""}=d,v=t.getExtension(n);for(const w of Object.keys(c)){const C="".concat(w).concat(l);let L=null;w==="meta"||typeof t[w]=="function"||(v&&typeof v[C]=="function"?L=function(){return v[C](...arguments)}:typeof c[w]=="function"&&(L=c[w].bind(i))),L&&(i[w]=L,o[w]=L)}}const Gv={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},ya=(t,e,n)=>e?t.enable(n):t.disable(n),Iw=(t,e,n)=>t.hint(n,e),Gr=(t,e,n)=>t.pixelStorei(n,e),dD=(t,e)=>{const n=Zt(t)?36009:36160;return t.bindFramebuffer(n,e)},fD=(t,e)=>t.bindFramebuffer(36008,e);function Th(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const pD={3042:ya,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:ya,2885:(t,e)=>t.cullFace(e),2929:ya,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:ya,35723:Iw,36006:dD,2886:(t,e)=>t.frontFace(e),33170:Iw,2849:(t,e)=>t.lineWidth(e),32823:ya,32824:"polygonOffset",10752:"polygonOffset",35977:ya,32938:"sampleCoverage",32939:"sampleCoverage",3089:ya,3088:(t,e)=>t.scissor(...e),2960:ya,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),3333:Gr,3317:Gr,37440:Gr,37441:Gr,37443:Gr,3330:Gr,3332:Gr,3331:Gr,36010:fD,3314:Gr,32878:Gr,3316:Gr,3315:Gr,32877:Gr,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=Th(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=Th(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Th(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=Th(e)&&e.length===3?[...e,...e]:e;const[n,i,o,c,d,l]=e;t.stencilFuncSeparate(1028,n,i,o),t.stencilFuncSeparate(1029,c,d,l)},stencilOp:(t,e)=>{e=Th(e)&&e.length===3?[...e,...e]:e;const[n,i,o,c,d,l]=e;t.stencilOpSeparate(1028,n,i,o),t.stencilOpSeparate(1029,c,d,l)},viewport:(t,e)=>t.viewport(...e)};function Zn(t,e,n){return e[t]!==void 0?e[t]:n[t]}const mD={blendEquation:(t,e,n)=>t.blendEquationSeparate(Zn(32777,e,n),Zn(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Zn(32969,e,n),Zn(32968,e,n),Zn(32971,e,n),Zn(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Zn(32824,e,n),Zn(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Zn(32938,e,n),Zn(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Zn(2962,e,n),Zn(2967,e,n),Zn(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Zn(34816,e,n),Zn(36003,e,n),Zn(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Zn(2964,e,n),Zn(2965,e,n),Zn(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Zn(34817,e,n),Zn(34818,e,n),Zn(34819,e,n))},Cw={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},blendColor:(t,e,n,i,o)=>t({32773:new Float32Array([e,n,i,o])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,i,o)=>t({32969:e,32968:n,32971:i,32970:o}),clearColor:(t,e,n,i,o)=>t({3106:new Float32Array([e,n,i,o])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,i,o)=>t({3107:[e,n,i,o]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,i,o)=>t({3088:new Int32Array([e,n,i,o])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({2962:e,2967:n,2963:i,34816:e,36003:n,36004:i}),stencilFuncSeparate:(t,e,n,i,o)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:o}),stencilOp:(t,e,n,i)=>t({2964:e,2965:n,2966:i,34817:e,34818:n,34819:i}),stencilOpSeparate:(t,e,n,i,o)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:o}),viewport:(t,e,n,i,o)=>t({2978:[e,n,i,o]})},ro=(t,e)=>t.isEnabled(e),Mw={3042:ro,2884:ro,2929:ro,3024:ro,32823:ro,32926:ro,32928:ro,3089:ro,2960:ro,35977:ro};function qS(t){for(const e in t)return!1;return!0}function gD(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let o=0;o<t.length;++o)if(t[o]!==e[o])return!1;return!0}return!1}function Lw(t,e){const n=t[e].bind(t);t[e]=function(){const o=arguments.length<=0?void 0:arguments[0];return o in t.state.cache?t.state.enable?t.state.cache[o]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function _D(t,e,n){const i=t[e].bind(t);t[e]=function(){for(var c=arguments.length,d=new Array(c),l=0;l<c;l++)d[l]=arguments[l];const{valueChanged:v,oldValue:w}=n(t.state._updateCache,...d);return v&&i(...d),w},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function yD(t){const e=t.useProgram.bind(t);t.useProgram=function(i){t.state.program!==i&&(e(i),t.state.program=i)}}class vD{constructor(e){let{copyState:n=!1,log:i=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?bD(e):Object.assign({},Gv),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){pr(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Wo(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,i;const o=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const c in e){pr(c!==void 0);const d=e[c],l=this.cache[c];gD(d,l)||(n=!0,i=l,o&&!(c in o)&&(o[c]=l),this.cache[c]=d)}return{valueChanged:n,oldValue:i}}}function ZS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:i}=e;if(pr(i!==void 0),!t.state){const{polyfillContext:o}=globalThis;o&&o(t),t.state=new vD(t,{copyState:i}),yD(t);for(const c in Cw){const d=Cw[c];_D(t,c,d)}Lw(t,"getParameter"),Lw(t,"isEnabled")}return t.state.enable=n,t}function xD(t){t.state||ZS(t,{copyState:!1}),t.state.push()}function kw(t){pr(t.state),t.state.pop()}function Wo(t,e){if(pr(qm(t),"setParameters requires a WebGL context"),qS(e))return;const n={};for(const o in e){const c=Number(o),d=pD[o];d&&(typeof d=="string"?n[d]=!0:d(t,e[o],c))}const i=t.state&&t.state.cache;if(i)for(const o in n){const c=mD[o];c(t,e,i)}}function bD(t,e){if(e=e||Gv,typeof e=="number"){const o=e,c=Mw[o];return c?c(t,o):t.getParameter(o)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const o of n){const c=Mw[o];i[o]=c?c(t,Number(o)):t.getParameter(Number(o))}return i}function wD(t){Wo(t,Gv)}function Ns(t,e,n){if(qS(e))return n(t);const{nocatch:i=!0}=e;xD(t),Wo(t,e);let o;if(i)o=n(t),kw(t);else try{o=n(t)}finally{kw(t)}return o}function ou(t){const{luma:e}=t;if(t.canvas&&e){const n=e.canvasSizeInfo,i="clientWidth"in n?n.clientWidth:t.canvas.clientWidth;return i?t.drawingBufferWidth/i:1}return 1}function U_(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const i=ou(t),o=t.drawingBufferWidth,c=t.drawingBufferHeight;return TD(e,i,o,c,n)}function ED(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function TD(t,e,n,i,o){const c=Rw(t[0],e,n);let d=Dw(t[1],e,i,o),l=Rw(t[0]+1,e,n);const v=l===n-1?l:l-1;l=Dw(t[1]+1,e,i,o);let w;return o?(l=l===0?l:l+1,w=d,d=l):w=l===i-1?l:l-1,{x:c,y:d,width:Math.max(v-c+1,1),height:Math.max(w-d+1,1)}}function Rw(t,e,n){return Math.min(Math.round(t*e),n-1)}function Dw(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const $v=Xo(),SD=$v&&typeof document<"u",XS={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function YS(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};pr($v,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},XS,t);const{width:e,height:n}=t;function i(l){if(t.throwOnError)throw new Error(l);return console.error(l),null}t.onError=i;let o;const{canvas:c}=t,d=CD({canvas:c,width:e,height:n,onError:i});return o=ID(d,t),o?(o=Hv(o,t),MD(o),o):null}function Hv(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||LD(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},XS,e);const{manageState:n,debug:i}=e;return n&&ZS(t,{copyState:!1,log:function(){for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return Et.log(1,...c)()}}),$v&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),Et.level=Math.max(Et.level,1)):Et.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function AD(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info"),o=i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),c=i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:o||e,renderer:c||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function PD(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const i=ED(e.useDevicePixels);kD(t,i,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function ID(t,e){const{onError:n}=e;let i=null;const o=v=>i=v.statusMessage||i;t.addEventListener("webglcontextcreationerror",o,!1);const{webgl1:c=!0,webgl2:d=!0}=e;let l=null;return d&&(l=l||t.getContext("webgl2",e),l=l||t.getContext("experimental-webgl2",e)),c&&(l=l||t.getContext("webgl",e),l=l||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",o,!1),l?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),l):n("Failed to create ".concat(d&&!c?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function CD(t){let{canvas:e,width:n=800,height:i=600,onError:o}=t,c;return typeof e=="string"?(SD&&document.readyState==="complete"||o("createGLContext called on canvas '".concat(e,"' before page was loaded")),c=document.getElementById(e)):e?c=e:(c=document.createElement("canvas"),c.id="lumagl-canvas",c.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",c.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(c,document.body.firstChild)),c}function MD(t){const e=Zt(t)?"WebGL2":"WebGL1",n=AD(t),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",o=t.debug?" debug":"";Et.info(1,"".concat(e).concat(o," context ").concat(i))()}function LD(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function kD(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,o="height"in n?n.height:t.canvas.clientHeight;(!i||!o)&&(Et.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,o=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const c=t.luma.canvasSizeInfo;if(c.clientWidth!==i||c.clientHeight!==o||c.devicePixelRatio!==e){let d=e;const l=Math.floor(i*d),v=Math.floor(o*d);t.canvas.width=l,t.canvas.height=v,(t.drawingBufferWidth!==l||t.drawingBufferHeight!==v)&&(Et.warn("Device pixel ratio clamped")(),d=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/o),t.canvas.width=Math.floor(i*d),t.canvas.height=Math.floor(o*d)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:o,devicePixelRatio:e})}}function zw(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class Ow{constructor(e,n){V(this,"name",void 0),V(this,"type",void 0),V(this,"sampleSize",1),V(this,"time",void 0),V(this,"count",void 0),V(this,"samples",void 0),V(this,"lastTiming",void 0),V(this,"lastSampleTime",void 0),V(this,"lastSampleCount",void 0),V(this,"_count",0),V(this,"_time",0),V(this,"_samples",0),V(this,"_startTime",0),V(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=zw(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(zw()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Wv{constructor(e){V(this,"id",void 0),V(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:i}=e;return this.stats[n]||(e instanceof Ow?this.stats[n]=e:this.stats[n]=new Ow(n,i)),this.stats[n]}}const qh="8.5.21",RD="set luma.log.level=1 (or higher) to trace rendering";class DD{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Wv({id:e})),this.stats.get(e)}}const Cl=new DD;if(globalThis.luma&&globalThis.luma.VERSION!==qh)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(qh));globalThis.luma||(Xo()&&Et.log(1,"luma.gl ".concat(qh," - ").concat(RD))(),globalThis.luma=globalThis.luma||{VERSION:qh,version:qh,log:Et,stats:Cl,globals:{modules:{},nodeIO:{}}});function zD(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function OD(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function ht(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function V_(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const i=t[e];return ht(i!==void 0,"Accessing undefined constant GL.".concat(e)),i}function Ua(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const j_={};function $a(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";j_[t]=j_[t]||1;const e=j_[t]++;return"".concat(t,"-").concat(e)}function Fw(t){return ht(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function au(t){let e=!0;for(const n in t){e=!1;break}return e}function KS(t,e,n,i){const o="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),c=Object.getPrototypeOf(t);i.forEach(d=>{c.methodName||(c[d]=()=>{throw Et.removed("Calling removed method ".concat(e,".").concat(d,": "),o)(),new Error(d)})})}const Tc="Resource subclass must define virtual methods";let Yo=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Zm(e);const{id:i,userData:o={}}=n;this.gl=e,this.gl2=e,this.id=i||$a(this[Symbol.toStringTag]),this.userData=o,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(i=>i.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=V_(this.gl,e),ht(e);const o=(this.constructor.PARAMETERS||{})[e];if(o){const c=Zt(this.gl);if(!((!("webgl2"in o)||c)&&(!("extension"in o)||this.gl.getExtension(o.extension)))){const l=o.webgl1,v="webgl2"in o?o.webgl2:o.webgl1;return c?v:l}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:i}=e,o=this.constructor.PARAMETERS||{},c=Zt(this.gl),d={},l=n||Object.keys(o);for(const v of l){const w=o[v];if(w&&(!("webgl2"in w)||c)&&(!("extension"in w)||this.gl.getExtension(w.extension))){const L=i?Ua(this.gl,v):v;d[L]=this.getParameter(v,e),i&&w.type==="GLenum"&&(d[L]=Ua(this.gl,d[L]))}}return d}setParameter(e,n){e=V_(this.gl,e),ht(e);const o=(this.constructor.PARAMETERS||{})[e];if(o){const c=Zt(this.gl);if(!((!("webgl2"in o)||c)&&(!("extension"in o)||this.gl.getExtension(o.extension))))throw new Error("Parameter not available on this platform");o.type==="GLenum"&&(n=V_(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,i){return KS(this,e,n,i)}initialize(e){}_createHandle(){throw new Error(Tc)}_deleteHandle(){throw new Error(Tc)}_bindHandle(e){throw new Error(Tc)}_getOptsFromHandle(){throw new Error(Tc)}_getParameter(e,n){throw new Error(Tc)}_setParameter(e,n){throw new Error(Tc)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=Cl.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];Cl.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const o=Cl.get("Memory Usage".concat(i));o.get("GPU Memory").addCount(e),o.get("".concat(n," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=Cl.get("Memory Usage".concat(n));i.get("GPU Memory").subtractCount(this.byteLength),i.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const FD="Failed to deduce GL constant from typed array";function d0(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(FD)}}function dd(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function BD(t){let{data:e,width:n,height:i,bytesPerPixel:o=4,temp:c}=t;const d=n*o;c=c||new Uint8Array(d);for(let l=0;l<i/2;++l){const v=l*d,w=(i-l-1)*d;c.set(e.subarray(v,v+d)),e.copyWithin(v,w,w+d),e.set(c,w)}}function ND(t){let{data:e,width:n,height:i}=t;const o=Math.round(n/2),c=Math.round(i/2),d=new Uint8Array(o*c*4);for(let l=0;l<c;l++)for(let v=0;v<o;v++)for(let w=0;w<4;w++)d[(l*o+v)*4+w]=e[(l*2*n+v*2)*4+w];return{data:d,width:o,height:c}}function f0(t,e,n){const{removedProps:i={},deprecatedProps:o={},replacedProps:c={}}=n;for(const l in i)if(l in e){const w=i[l]?"".concat(t,".").concat(i[l]):"N/A";Et.removed("".concat(t,".").concat(l),w)()}for(const l in o)if(l in e){const v=o[l];Et.deprecated("".concat(t,".").concat(l),"".concat(t,".").concat(v))()}let d=null;for(const l in c)if(l in e){const v=c[l];Et.deprecated("".concat(t,".").concat(l),"".concat(t,".").concat(v))(),d=d||Object.assign({},e),d[v]=e[l],delete d[l]}return d||e}const UD={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},VD={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Zr{static getBytesPerElement(e){return dd(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return ht(e.size),dd(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return new Zr(UD,...n)}constructor(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(o=>this._assign(o)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Zr.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Zr.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=f0("Accessor",e,VD),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const Bw=10,JS={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},jD={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:JS},GD={removedProps:JS};class _n extends Yo{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Zr.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Zr.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=f0("Buffer",e,jD),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=f0("Buffer",e,GD),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new Zr(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:i=0,srcOffset:o=0}=e,c=e.byteLength||e.length;ht(n);const d=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(d,this.handle),o!==0||c!==void 0?(mr(this.gl),this.gl.bufferSubData(this.target,i,n,o,c)):this.gl.bufferSubData(d,i,n),this.gl.bindBuffer(d,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:i=0,writeOffset:o=0,size:c}=e;const{gl:d}=this;return mr(d),d.bindBuffer(36662,n.handle),d.bindBuffer(36663,this.handle),d.copyBufferSubData(36662,36663,i,o,c),d.bindBuffer(36662,null),d.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:i=0,length:o=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};mr(this.gl);const c=dd(this.accessor.type||5126,{clamped:!1}),d=this._getAvailableElementCount(n),l=i;let v,w;e?(w=e.length,v=w-l):(v=Math.min(d,o||d),w=l+v);const C=Math.min(d,v);return o=o||C,ht(o<=C),e=e||new c(w),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,i,o),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:i=0,size:o}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?o!==void 0?this.gl.bindBufferRange(e,n,this.handle,i,o):(ht(i===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(Bw,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;ht(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const o=this._getTarget();this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,i,this.usage),this.gl.bufferSubData(o,n,e),this.gl.bindBuffer(o,null),this.debugData=e.slice(0,Bw),this.bytesUsed=i,this._trackAllocatedMemory(i);const c=d0(e);return ht(c),this.setAccessor(new Zr(this.accessor,{type:c})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;ht(e>=0),this._trackDeallocatedMemory();let i=e;e===0&&(i=new Float32Array(0));const o=this._getTarget();return this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,i,n),this.gl.bindBuffer(o,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=dd(this.accessor.type||5126,{clamped:!1}),i=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new Zr(this.accessor,{type:d0(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return Et.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Et.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return Et.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return Et.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Zr(this.accessor,e),this}}const qv={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},QS={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},eA={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function $D(t,e){const n=qv[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const i=Zt(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}function HD(t,e){const n=qv[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const WD=[9729,9728],Nw=globalThis.WebGLBuffer||function(){};class lu extends Yo{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:i,linearFiltering:o}=n;let c=!0;return i&&(c=c&&$D(e,i),c=c&&(!o||HD(e,i))),c}constructor(e,n){const{id:i=$a("texture"),handle:o,target:c}=n;super(e,{id:i,handle:o}),this.target=c,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(W=>this.initialize(Object.assign({},e,{pixels:W,data:W}))),this;const i=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(i&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:o=null,format:c=6408,border:d=0,recreate:l=!1,parameters:v={},pixelStore:w={},textureUnit:C=void 0}=e;n||(n=o);let{width:L,height:P,dataFormat:N,type:X,compressed:ee=!1,mipmaps:me=!0}=e;const{depth:Y=0}=e;return{width:L,height:P,compressed:ee,dataFormat:N,type:X}=this._deduceParameters({format:c,type:X,dataFormat:N,compressed:ee,data:n,width:L,height:P}),this.width=L,this.height=P,this.depth=Y,this.format=c,this.type=X,this.dataFormat=N,this.border=d,this.textureUnit=C,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),me&&this._isNPOT()&&(Et.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),me=!1,this._updateForNPOT(v)),this.mipmaps=me,this.setImageData({data:n,width:L,height:P,depth:Y,format:c,type:X,dataFormat:N,border:d,mipmaps:me,parameters:w,compressed:ee}),me&&this.generateMipmap(),this.setParameters(v),l&&(this.data=n),i&&(this._video={video:n,parameters:v,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:i,mipmaps:o=!1}=e;return i!==this.width||n!==this.height?this.initialize({width:i,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:o}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(Et.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Ns(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:i=null,level:o=0,format:c=this.format,border:d=this.border,offset:l=0,parameters:v={}}=e;let{data:w=null,type:C=this.type,width:L=this.width,height:P=this.height,dataFormat:N=this.dataFormat,compressed:X=!1}=e;w||(w=i),{type:C,dataFormat:N,compressed:X,width:L,height:P}=this._deduceParameters({format:c,type:C,dataFormat:N,compressed:X,data:w,width:L,height:P});const{gl:ee}=this;ee.bindTexture(this.target,this.handle);let me=null;({data:w,dataType:me}=this._getDataType({data:w,compressed:X}));let Y,W=0;if(Ns(this.gl,v,()=>{switch(me){case"null":ee.texImage2D(n,o,c,L,P,d,N,C,w);break;case"typed-array":ee.texImage2D(n,o,c,L,P,d,N,C,w,l);break;case"buffer":Y=mr(ee),Y.bindBuffer(35052,w.handle||w),Y.texImage2D(n,o,c,L,P,d,N,C,l),Y.bindBuffer(35052,null);break;case"browser-object":Zt(ee)?ee.texImage2D(n,o,c,L,P,d,N,C,w):ee.texImage2D(n,o,c,N,C,w);break;case"compressed":for(const[q,oe]of w.entries())ee.compressedTexImage2D(n,q,oe.format,oe.width,oe.height,d,oe.data),W+=oe.levelSize;break;default:ht(!1,"Unknown image data type")}}),me==="compressed")this._trackAllocatedMemory(W,"Texture");else if(w&&w.byteLength)this._trackAllocatedMemory(w.byteLength,"Texture");else{const q=QS[this.dataFormat]||4,oe=eA[this.type]||1;this._trackAllocatedMemory(this.width*this.height*q*oe,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:i=null,data:o=null,x:c=0,y:d=0,width:l=this.width,height:v=this.height,level:w=0,format:C=this.format,type:L=this.type,dataFormat:P=this.dataFormat,compressed:N=!1,offset:X=0,border:ee=this.border,parameters:me={}}=e;if({type:L,dataFormat:P,compressed:N,width:l,height:v}=this._deduceParameters({format:C,type:L,dataFormat:P,compressed:N,data:o,width:l,height:v}),ht(this.depth===0,"texSubImage not supported for 3D textures"),o||(o=i),o&&o.data){const Y=o;o=Y.data,l=Y.shape[0],v=Y.shape[1]}o instanceof _n&&(o=o.handle),this.gl.bindTexture(this.target,this.handle),Ns(this.gl,me,()=>{if(N)this.gl.compressedTexSubImage2D(n,w,c,d,l,v,C,o);else if(o===null)this.gl.texSubImage2D(n,w,c,d,l,v,P,L,null);else if(ArrayBuffer.isView(o))this.gl.texSubImage2D(n,w,c,d,l,v,P,L,o,X);else if(o instanceof Nw){const Y=mr(this.gl);Y.bindBuffer(35052,o),Y.texSubImage2D(n,w,c,d,l,v,P,L,X),Y.bindBuffer(35052,null)}else Zt(this.gl)?mr(this.gl).texSubImage2D(n,w,c,d,l,v,P,L,o):this.gl.texSubImage2D(n,w,c,d,P,L,o)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return Et.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:i=!1}=e;return i?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof _n?{data:n.handle,dataType:"buffer"}:n instanceof Nw?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:i}=e;let{width:o,height:c,dataFormat:d,type:l,compressed:v}=e;const w=qv[n];return d=d||w&&w.dataFormat,l=l||w&&w.types[0],v=v||w&&w.compressed,{width:o,height:c}=this._deduceImageSize(i,o,c),{dataFormat:d,type:l,compressed:v,width:o,height:c,format:n,data:i}}_deduceImageSize(e,n,i){let o;return typeof ImageData<"u"&&e instanceof ImageData?o={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?o={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?o={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?o={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?o={width:e.videoWidth,height:e.videoHeight}:e?o={width:n,height:i}:o={width:n>=0?n:1,height:i>=0?i:1},ht(o,"Could not deduced texture size"),ht(n===void 0||o.width===n,"Deduced texture width does not match supplied width"),ht(i===void 0||o.height===i,"Deduced texture height does not match supplied height"),o}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:ht(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return Zt(this.gl)||!this.width||!this.height?!1:!Fw(this.width)||!Fw(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:WD.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let qD="";function ZD(t,e){return ht(typeof t=="string"),t=qD+t,new Promise((n,i)=>{try{const o=new Image;o.onload=()=>n(o),o.onerror=()=>i(new Error("Could not load image ".concat(t,"."))),o.crossOrigin=e&&e.crossOrigin||"anonymous",o.src=t}catch(o){i(o)}})}class Vs extends lu{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return lu.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Zm(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:ZD(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const p0=[34069,34070,34071,34072,34073,34074];class tA extends lu{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Zm(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:i={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(i)}),this}subImage(e){let{face:n,data:i,x:o=0,y:c=0,mipmapLevel:d=0}=e;return this._subImage({target:n,data:i,x:o,y:c,mipmapLevel:d})}async setCubeMapImageData(e){let{width:n,height:i,pixels:o,data:c,border:d=0,format:l=6408,type:v=5121}=e;const{gl:w}=this,C=o||c,L=await Promise.all(p0.map(P=>{const N=C[P];return Promise.all(Array.isArray(N)?N:[N])}));this.bind(),p0.forEach((P,N)=>{L[N].length>1&&this.opts.mipmaps!==!1&&Et.warn("".concat(this.id," has mipmap and multiple LODs."))(),L[N].forEach((X,ee)=>{n&&i?w.texImage2D(P,ee,l,n,i,d,l,v,X):w.texImage2D(P,ee,l,l,v,X)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:i,height:o,pixels:c,data:d,border:l=0,format:v=6408,type:w=5121}=e,{gl:C}=this,L=c||d;return this.bind(),L instanceof Promise?L.then(P=>this.setImageDataForFace(Object.assign({},e,{face:n,data:P,pixels:P}))):this.width||this.height?C.texImage2D(n,0,v,i,o,l,v,w,L):C.texImage2D(n,0,v,v,w,L),this}}tA.FACES=p0;class XD extends lu{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return Zt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};mr(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:i=6408,width:o,height:c,depth:d=1,border:l=0,format:v,type:w=5121,offset:C=0,data:L,parameters:P={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Ns(this.gl,P,()=>{ArrayBuffer.isView(L)&&this.gl.texImage3D(this.target,n,i,o,c,d,l,v,w,L),L instanceof _n&&(this.gl.bindBuffer(35052,L.handle),this.gl.texImage3D(this.target,n,i,o,c,d,l,v,w,C))}),L&&L.byteLength)this._trackAllocatedMemory(L.byteLength,"Texture");else{const N=QS[this.dataFormat]||4,X=eA[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*N*X,"Texture")}return this.loaded=!0,this}}const xl="EXT_color_buffer_float",Uw={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:xl,bpp:2},33327:{gl2:xl,bpp:4},34842:{gl2:xl,bpp:8},33326:{gl2:xl,bpp:4},33328:{gl2:xl,bpp:8},34836:{gl2:xl,bpp:16},35898:{gl2:xl,bpp:4}};function YD(t,e,n){const i=n[e];if(!i)return!1;const o=Zt(t)&&i.gl2||i.gl1;return typeof o=="string"?t.getExtension(o):o}class Vc extends Yo{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||YD(e,n,Uw)}static getSamplesForFormat(e,n){let{format:i}=n;return e.getInternalformatParameter(36161,i,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:i=1,height:o=1,samples:c=0}=e;return ht(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),c!==0&&Zt(this.gl)?this.gl.renderbufferStorageMultisample(36161,c,n,i,o):this.gl.renderbufferStorage(36161,n,i,o),this.format=n,this.width=i,this.height=o,this.samples=c,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Uw[this.format].bpp),this}resize(e){let{width:n,height:i}=e;return n!==this.width||i!==this.height?this.initialize({width:n,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const KD=256,JD=1024,QD=16384,Vw=6144,jw=6145,Gw=6146,$w=34041,nA="clear: bad arguments";function Zv(t){let{framebuffer:e=null,color:n=null,depth:i=null,stencil:o=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const c={};e&&(c.framebuffer=e);let d=0;n&&(d|=QD,n!==!0&&(c.clearColor=n)),i&&(d|=KD,i!==!0&&(c.clearDepth=i)),o&&(d|=JD,i!==!0&&(c.clearStencil=i)),ht(d!==0,nA),Ns(t,c,()=>{t.clear(d)})}function ez(t){let{framebuffer:e=null,buffer:n=Vw,drawBuffer:i=0,value:o=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};mr(t),Ns(t,{framebuffer:e},()=>{switch(n){case Vw:switch(o.constructor){case Int32Array:t.clearBufferiv(n,i,o);break;case Uint32Array:t.clearBufferuiv(n,i,o);break;case Float32Array:default:t.clearBufferfv(n,i,o)}break;case jw:t.clearBufferfv(jw,0,[o]);break;case Gw:t.clearBufferiv(Gw,0,[o]);break;case $w:const[c,d]=o;t.clearBufferfi($w,0,c,d);break;default:ht(!1,nA)}})}function tz(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return ht(!1),0}}function Xm(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:i=0,sourceFormat:o=6408}=e;let{sourceAttachment:c=36064,target:d=null,sourceWidth:l,sourceHeight:v,sourceType:w}=e;const{framebuffer:C,deleteFramebuffer:L}=nz(t);ht(C);const{gl:P,handle:N,attachments:X}=C;l=l||C.width,v=v||C.height,c===36064&&N===null&&(c=1028),ht(X[c]),w=w||X[c].type,d=iz(d,w,o,l,v),w=w||d0(d);const ee=P.bindFramebuffer(36160,N);return P.readPixels(n,i,l,v,o,w,d),P.bindFramebuffer(36160,ee||null),L&&C.delete(),d}function Hw(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=Xm(t,{sourceAttachment:e}),{width:o,height:c}=t;for(;c>n;)({data:i,width:o,height:c}=ND({data:i,width:o,height:c}));BD({data:i,width:o,height:c});const d=document.createElement("canvas");d.width=o,d.height=c;const l=d.getContext("2d"),v=l.createImageData(o,c);return v.data.set(i),l.putImageData(v,0,0),d.toDataURL()}function nz(t){return t instanceof xi?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:fz(t),deleteFramebuffer:!0}}function iz(t,e,n,i,o){if(t)return t;e=e||5121;const c=dd(e,{clamped:!1}),d=tz(n);return new c(i*o*d)}const Cn={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function rz(t){const e=new Vs(t,{format:6408,type:5126,dataFormat:6408}),n=new xi(t,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),i=n.getStatus();return e.delete(),n.delete(),i===36053}const iA={[Cn.WEBGL2]:[!1,!0],[Cn.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Cn.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Cn.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Cn.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Cn.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Cn.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Cn.FLOAT_BLEND]:["EXT_float_blend"],[Cn.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Cn.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Cn.TEXTURE_FLOAT]:["OES_texture_float",!0],[Cn.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Cn.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Cn.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Cn.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Cn.COLOR_ATTACHMENT_RGBA32F]:[rz,"EXT_color_buffer_float"],[Cn.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Cn.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Cn.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Cn.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Cn.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Cn.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},sz=2;function oz(t,e){return Xv(t,e)}function Xv(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>rA(t,n))}function az(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in iA)t.luma.caps[e]===void 0&&(t.luma.caps[e]=rA(t,e));return t.luma.caps}function rA(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=lz(t,e)),t.luma.caps[e]||Et.log(sz,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function lz(t,e){const n=iA[e];ht(n,e);let i;const o=Zt(t)&&n[1]||n[0];if(typeof o=="function")i=o(t);else if(Array.isArray(o)){i=!0;for(const c of o)i=i&&!!t.getExtension(c)}else typeof o=="string"?i=!!t.getExtension(o):typeof o=="boolean"?i=o:ht(!1);return i}const Ww="Multiple render targets not supported";class xi extends Yo{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:o}=n;let c=!0;return i&&(c=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),o&&(c=c&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),c}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new xi(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=mr(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=mr(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:i=1,attachments:o=null,color:c=!0,depth:d=!0,stencil:l=!1,check:v=!0,readBuffer:w=void 0,drawBuffers:C=void 0}=e;if(ht(n>=0&&i>=0,"Width and height need to be integers"),this.width=n,this.height=i,o)for(const L in o){const P=o[L];(Array.isArray(P)?P[0]:P).resize({width:n,height:i})}else o=this._createDefaultAttachments(c,d,l,n,i);this.update({clearAttachments:!0,attachments:o,readBuffer:w,drawBuffers:C}),o&&v&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:i,drawBuffers:o,clearAttachments:c=!1,resizeAttachments:d=!0}=e;this.attach(n,{clearAttachments:c,resizeAttachments:d});const{gl:l}=this,v=l.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),o&&this._setDrawBuffers(o),l.bindFramebuffer(36160,v||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:i}=e;if(this.handle===null)return ht(n===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),n!==this.width&&i!==this.height&&Et.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(i))();for(const o in this.attachments)this.attachments[o].resize({width:n,height:i});return this.width=n,this.height=i,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o={};n&&Object.keys(this.attachments).forEach(d=>{o[d]=null}),Object.assign(o,e);const c=this.gl.bindFramebuffer(36160,this.handle);for(const d in o){ht(d!==void 0,"Misspelled framebuffer binding point?");const l=Number(d),v=o[l];let w=v;if(!w)this._unattach(l);else if(w instanceof Vc)this._attachRenderbuffer({attachment:l,renderbuffer:w});else if(Array.isArray(v)){const[C,L=0,P=0]=v;w=C,this._attachTexture({attachment:l,texture:C,layer:L,level:P})}else this._attachTexture({attachment:l,texture:w,layer:0,level:0});i&&w&&w.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,c||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(d=>!this.attachments[d]).forEach(d=>{delete this.attachments[d]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(uz(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),i}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:i,stencil:o,drawBuffers:c=[]}=e,d=this.gl.bindFramebuffer(36160,this.handle);return(n||i||o)&&Zv(this.gl,{color:n,depth:i,stencil:o}),c.forEach((l,v)=>{ez(this.gl,{drawBuffer:v,value:l})}),this.gl.bindFramebuffer(36160,d||null),this}readPixels(){return Et.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return Et.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return Et.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return Et.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return Et.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return Et.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:i=0,y:o=0,width:c,height:d}=e;const l=mr(this.gl),v=l.bindFramebuffer(36008,this.handle);return i===0&&o===0&&c===void 0&&d===void 0?l.invalidateFramebuffer(36008,n):l.invalidateFramebuffer(36008,n,i,o,c,d),l.bindFramebuffer(36008,v),this}getAttachmentParameter(e,n,i){let o=this._getAttachmentParameterFallback(n);return o===null&&(this.gl.bindFramebuffer(36160,this.handle),o=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),i&&o>1e3&&(o=Ua(this.gl,o)),o}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const o={};for(const c of i){const d=n?Ua(this.gl,c):c;o[d]=this.getAttachmentParameter(e,c,n)}return o}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),i={};for(const o of n){const c=Number(o),d=e?Ua(this.gl,c):c;i[d]=this.getAttachmentParameters(c,e)}return i}show(){return typeof window<"u"&&window.open(Hw(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>Et.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const i=Hw(this,{targetMaxHeight:100});return Et.image({logLevel:e,message:n,image:i},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,i,o,c){let d=null;return e&&(d=d||{},d[36064]=new Vs(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:o,height:c,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(d[36064])),n&&i?(d=d||{},d[33306]=new Vc(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:o,height:111}),this.ownResources.push(d[33306])):n?(d=d||{},d[36096]=new Vc(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:o,height:c}),this.ownResources.push(d[36096])):i&&ht(!1),d}_unattach(e){const n=this.attachments[e];n&&(n instanceof Vc?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:i}=e;const{gl:o}=this;o.framebufferRenderbuffer(36160,n,36161,i.handle),this.attachments[n]=i}_attachTexture(e){let{attachment:n=36064,texture:i,layer:o,level:c}=e;const{gl:d}=this;switch(d.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:mr(d).framebufferTextureLayer(36160,n,i.target,c,o);break;case 34067:const v=cz(o);d.framebufferTexture2D(36160,n,v,i.handle,c);break;case 3553:d.framebufferTexture2D(36160,n,3553,i.handle,c);break;default:ht(!1,"Illegal texture type")}d.bindTexture(i.target,null),this.attachments[n]=i}_setReadBuffer(e){const n=BR(this.gl);n?n.readBuffer(e):ht(e===36064||e===1029,Ww),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,i=mr(n);if(i)i.drawBuffers(e);else{const o=n.getExtension("WEBGL_draw_buffers");o?o.drawBuffersWEBGL(e):ht(e.length===1&&(e[0]===36064||e[0]===1029),Ww)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=az(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function cz(t){return t<34069?t+34069:t}function uz(t){return(xi.STATUS||{})[t]||"Framebuffer error ".concat(t)}const hz=[36049,36048,33296,33298,33299,33300,33301,33302,33303];xi.ATTACHMENT_PARAMETERS=hz;function dz(t,e){ht(t instanceof Vs||t instanceof tA||t instanceof XD);const n=t.constructor,{gl:i,width:o,height:c,format:d,type:l,dataFormat:v,border:w,mipmaps:C}=t,L=Object.assign({width:o,height:c,format:d,type:l,dataFormat:v,border:w,mipmaps:C},e);return new n(i,L)}function fz(t,e){const{gl:n,width:i,height:o,id:c}=t;return new xi(n,Object.assign({},e,{id:"framebuffer-for-".concat(c),width:i,height:o,attachments:{36064:t}}))}function kp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=t.match(n);return i?i[1]:e}const pz=35632,mz=35633;function gz(t){switch(t){case pz:return"fragment";case mz:return"vertex";default:return"unknown type"}}function _z(t,e,n,i){const o=t.split(/\r?\n/),c={},d={},l=i||kp(e)||"(unnamed)",v="".concat(gz(n)," shader ").concat(l);for(let C=0;C<o.length;C++){const L=o[C];if(L.length<=1)continue;const P=L.split(":"),N=P[0],X=parseInt(P[2],10);if(isNaN(X))throw new Error("GLSL compilation error in ".concat(v,": ").concat(t));N!=="WARNING"?c[X]=L:d[X]=L}const w=yz(e);return{shaderName:v,errors:qw(c,w),warnings:qw(d,w)}}function qw(t,e){let n="";for(let i=0;i<e.length;i++){const o=e[i];if(!(!t[i+3]&&!t[i+2]&&!t[i+1])&&(n+="".concat(o,`
`),t[i+1])){const c=t[i+1],d=c.split(":",3),l=d[0],v=parseInt(d[1],10)||0,w=c.substring(d.join(":").length+1).trim();n+=sA("^^^ ".concat(l,": ").concat(w,`

`),v)}}return n}function yz(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const i=t.split(/\r?\n/),o=String(i.length+e-1).length;return i.map((c,d)=>{const l=String(d+e),v=l.length;return sA(l,o-v)+n+c})}function sA(t,e){let n="";for(let i=0;i<e;++i)n+=" ";return"".concat(n).concat(t)}function oA(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}const vz="Shader: GLSL source code must be a JavaScript string";class fd extends Yo{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return ht(!1),"unknown"}}constructor(e,n){Zm(e),ht(typeof n.source=="string",vz);const i=kp(n.source,null)||n.id||$a("unnamed ".concat(fd.getTypeName(n.shaderType)));super(e,{id:i}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const i=kp(n,null);i&&(this.id=$a(i)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(fd.getTypeName(this.shaderType),":").concat(this.id)}getName(){return kp(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:o,errors:c,warnings:d}=_z(i,this.source,this.shaderType,this.id);throw Et.error("GLSL compilation errors in ".concat(o,`
`).concat(c))(),Et.warn("GLSL compilation warnings in ".concat(o,`
`).concat(d))(),new Error("GLSL compilation errors in ".concat(o))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class G_ extends fd{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class $_ extends fd{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const xz={5126:Pn.bind(null,"uniform1fv",$r,1,Ji),35664:Pn.bind(null,"uniform2fv",$r,2,Ji),35665:Pn.bind(null,"uniform3fv",$r,3,Ji),35666:Pn.bind(null,"uniform4fv",$r,4,Ji),5124:Pn.bind(null,"uniform1iv",va,1,Ji),35667:Pn.bind(null,"uniform2iv",va,2,Ji),35668:Pn.bind(null,"uniform3iv",va,3,Ji),35669:Pn.bind(null,"uniform4iv",va,4,Ji),35670:Pn.bind(null,"uniform1iv",va,1,Ji),35671:Pn.bind(null,"uniform2iv",va,2,Ji),35672:Pn.bind(null,"uniform3iv",va,3,Ji),35673:Pn.bind(null,"uniform4iv",va,4,Ji),35674:Pn.bind(null,"uniformMatrix2fv",$r,4,Ro),35675:Pn.bind(null,"uniformMatrix3fv",$r,9,Ro),35676:Pn.bind(null,"uniformMatrix4fv",$r,16,Ro),35678:Bi,35680:Bi,5125:Pn.bind(null,"uniform1uiv",ip,1,Ji),36294:Pn.bind(null,"uniform2uiv",ip,2,Ji),36295:Pn.bind(null,"uniform3uiv",ip,3,Ji),36296:Pn.bind(null,"uniform4uiv",ip,4,Ji),35685:Pn.bind(null,"uniformMatrix2x3fv",$r,6,Ro),35686:Pn.bind(null,"uniformMatrix2x4fv",$r,8,Ro),35687:Pn.bind(null,"uniformMatrix3x2fv",$r,6,Ro),35688:Pn.bind(null,"uniformMatrix3x4fv",$r,12,Ro),35689:Pn.bind(null,"uniformMatrix4x2fv",$r,8,Ro),35690:Pn.bind(null,"uniformMatrix4x3fv",$r,12,Ro),35678:Bi,35680:Bi,35679:Bi,35682:Bi,36289:Bi,36292:Bi,36293:Bi,36298:Bi,36299:Bi,36300:Bi,36303:Bi,36306:Bi,36307:Bi,36308:Bi,36311:Bi},bz={},wz={},Ez={},Zw=[0];function Yv(t,e,n,i){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(Zw[0]=t,t=Zw);const o=t.length;if(o%e&&Et.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let c=i[o];c||(c=new n(o),i[o]=c);for(let d=0;d<o;d++)c[d]=t[d];return c}function $r(t,e){return Yv(t,e,Float32Array,bz)}function va(t,e){return Yv(t,e,Int32Array,wz)}function ip(t,e){return Yv(t,e,Uint32Array,Ez)}function Xw(t,e,n){const i=xz[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i().bind(null,t,e)}function Tz(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:!!n[2]}}function Sz(t,e,n){for(const i in t){const o=t[i];if((!n||!!n[i])&&!Az(o))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),o),new Error("".concat(e," Bad uniform ").concat(i))}return!0}function Az(t){return Array.isArray(t)||ArrayBuffer.isView(t)?Iz(t):isFinite(t)||t===!0||t===!1||t instanceof lu||t instanceof Vc?!0:t instanceof xi?!!t.texture:!1}function Pz(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let o=0,c=n.length;o<c;++o)i[o]=n[o]}else t[e]=n.slice();else t[e]=n}function Iz(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Bi(){let t=null;return(e,n,i)=>{const o=t!==i;return o&&(e.uniform1i(n,i),t=i),o}}function Pn(t,e,n,i){let o=null,c=null;return(d,l,v)=>{const w=e(v,n),C=w.length;let L=!1;if(o===null)o=new Float32Array(C),c=C,L=!0;else{ht(c===C,"Uniform length cannot change.");for(let P=0;P<C;++P)if(w[P]!==o[P]){L=!0;break}}return L&&(i(d,t,l,w),o.set(w)),L}}function Ji(t,e,n,i){t[e](n,i)}function Ro(t,e,n,i){t[e](n,!1,i)}const Cz=5120,Mz=5121,Lz=5122,kz=5123,Yw=0,rp=1,Rz=2,Dz=3,sp=4,zz=5,Oz=6,_i=5126,Fz=35664,Bz=35665,Nz=35666,Sh=5124,Uz=35667,Vz=35668,jz=35669,Ah=5125,Gz=36294,$z=36295,Hz=36296,Wz=35670,qz=35671,Zz=35672,Xz=35673,Yz=35674,Kz=35675,Jz=35676,Qz=35685,eO=35686,tO=35687,nO=35688,iO=35689,rO=35690,m0={[_i]:[_i,1,"float"],[Fz]:[_i,2,"vec2"],[Bz]:[_i,3,"vec3"],[Nz]:[_i,4,"vec4"],[Sh]:[Sh,1,"int"],[Uz]:[Sh,2,"ivec2"],[Vz]:[Sh,3,"ivec3"],[jz]:[Sh,4,"ivec4"],[Ah]:[Ah,1,"uint"],[Gz]:[Ah,2,"uvec2"],[$z]:[Ah,3,"uvec3"],[Hz]:[Ah,4,"uvec4"],[Wz]:[_i,1,"bool"],[qz]:[_i,2,"bvec2"],[Zz]:[_i,3,"bvec3"],[Xz]:[_i,4,"bvec4"],[Yz]:[_i,8,"mat2"],[Qz]:[_i,8,"mat2x3"],[eO]:[_i,8,"mat2x4"],[Kz]:[_i,12,"mat3"],[tO]:[_i,12,"mat3x2"],[nO]:[_i,12,"mat3x4"],[Jz]:[_i,16,"mat4"],[iO]:[_i,16,"mat4x2"],[rO]:[_i,16,"mat4x3"]};function sO(t){switch(t){case Yw:return Yw;case rp:return rp;case Dz:return rp;case Rz:return rp;case sp:return sp;case zz:return sp;case Oz:return sp;default:return ht(!1),0}}function Kw(t){const e=m0[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function aA(t,e){switch(t){case Cz:case Mz:case Lz:case kz:t=_i;break}for(const n in m0){const[i,o,c]=m0[n];if(i===t&&o===e)return{glType:n,name:c}}return null}class oO{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,i=n.getProgramParameter(e.handle,35721);for(let o=0;o<i;o++){const{name:c,type:d,size:l}=n.getActiveAttrib(e.handle,o),v=n.getAttribLocation(e.handle,c);v>=0&&this._addAttribute(v,c,d,l)}this.attributeInfos.sort((o,c)=>o.location-c.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!Zt(n))return;const i=n.getProgramParameter(e.handle,35971);for(let o=0;o<i;o++){const{name:c,type:d,size:l}=n.getTransformFeedbackVarying(e.handle,o);this._addVarying(o,c,d,l)}this.varyingInfos.sort((o,c)=>o.location-c.location)}_addAttribute(e,n,i,o){const{type:c,components:d}=Kw(i),l={type:c,size:o*d};this._inferProperties(e,n,l);const v={location:e,name:n,accessor:new Zr(l)};this.attributeInfos.push(v),this.attributeInfosByLocation[e]=v,this.attributeInfosByName[v.name]=v}_inferProperties(e,n,i){/instance/i.test(n)&&(i.divisor=1)}_addVarying(e,n,i,o){const{type:c,components:d}=Kw(i),l=new Zr({type:c,size:o*d}),v={location:e,name:n,accessor:l};this.varyingInfos.push(v),this.varyingInfosByName[v.name]=v}}const Jw=4,aO=35981,lO=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class lA extends Yo{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",lO),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:i,fs:o,varyings:c,bufferMode:d=aO}=e;return this.hash=n||"",this.vs=typeof i=="string"?new G_(this.gl,{id:"".concat(e.id,"-vs"),source:i}):i,this.fs=typeof o=="string"?new $_(this.gl,{id:"".concat(e.id,"-fs"),source:o}):o,ht(this.vs instanceof G_),ht(this.fs instanceof $_),this.uniforms={},this._textureUniforms={},c&&c.length>0&&(mr(this.gl),this.varyings=c,this.gl2.transformFeedbackVaryings(this.handle,c,d)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new oO(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:i=4,vertexCount:o,offset:c=0,start:d,end:l,isIndexed:v=!1,indexType:w=5123,instanceCount:C=0,isInstanced:L=C>0,vertexArray:P=null,transformFeedback:N,framebuffer:X,parameters:ee={},uniforms:me,samplers:Y}=e;if((me||Y)&&(Et.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(me||{})),Et.priority>=n){const W=X?X.id:"default",q="mode=".concat(Ua(this.gl,i)," verts=").concat(o," ")+"instances=".concat(C," indexType=").concat(Ua(this.gl,w)," ")+"isInstanced=".concat(L," isIndexed=").concat(v," ")+"Framebuffer=".concat(W);Et.log(n,q)()}return ht(P),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||o===0||L&&C===0?!1:(P.bindForDraw(o,C,()=>{if(X!==void 0&&(ee=Object.assign({},ee,{framebuffer:X})),N){const W=sO(i);N.begin(W)}this._bindTextures(),Ns(this.gl,ee,()=>{v&&L?this.gl2.drawElementsInstanced(i,o,w,c,C):v&&Zt(this.gl)&&!isNaN(d)&&!isNaN(l)?this.gl2.drawRangeElements(i,d,l,o,w,c):v?this.gl.drawElements(i,o,w,c):L?this.gl2.drawArraysInstanced(i,c,o,C):this.gl.drawArrays(i,c,o)}),N&&N.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Et.priority>=2&&Sz(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const i=e[n],o=this._uniformSetters[n];if(o){let c=i,d=!1;if(c instanceof xi&&(c=c.texture),c instanceof lu)if(d=this.uniforms[n]!==i,d){o.textureIndex===void 0&&(o.textureIndex=this._textureIndexCounter++);const l=c,{textureIndex:v}=o;l.bind(v),c=v,this._textureUniforms[n]=l}else c=o.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(o(c)||d)&&Pz(this.uniforms,n,i)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const i=this._textureUniforms[n];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),i={};for(const o of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new G_({handle:o});break;case 35632:i.fs=new $_({handle:o});break}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=$a(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Et.time(Jw,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),Et.timeEnd(Jw,"linkProgram for ".concat(this._getName()))(),e.debug||Et.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const i=this.gl.getActiveUniform(this.handle,n),{name:o}=Tz(i.name);let c=e.getUniformLocation(this.handle,o);if(this._uniformSetters[o]=Xw(e,c,i),i.size>1)for(let d=0;d<i.size;d++)c=e.getUniformLocation(this.handle,"".concat(o,"[").concat(d,"]")),this._uniformSetters["".concat(o,"[").concat(d,"]")]=Xw(e,c,i)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const cO=34918,uO=34919,hO=35007,dO=36795,fO=35976,pO=35887,mO=36202;class pm extends Yo{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=Zt(e),o=Xv(e,Cn.TIMER_QUERY);let c=i||o;for(const d of n)switch(d){case"queries":c=c&&i;break;case"timers":c=c&&o;break;default:ht(!1)}return c}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(hO)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?mO:pO)}beginTransformFeedbackQuery(){return this.begin(fO)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,uO);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(dO)}getResult(){return this.gl2.getQueryParameter(this.handle,cO)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,o)=>{const c=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>e?(o("Timed out"),this._pollingPromise=null):requestAnimationFrame(c)};requestAnimationFrame(c)}),this._pollingPromise}_createHandle(){return pm.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class cA extends Yo{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return Zt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};mr(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,au(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const i=this._getVaryingIndex(e),{buffer:o,byteSize:c,byteOffset:d}=this._getBufferParams(n);return i<0?(this.unused[e]=o,Et.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[i]=n,this.bindOnUse||this._bindBuffer(i,o,d,c),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,i,o;return e instanceof _n?o=e:(o=e.buffer,i=e.byteSize,n=e.byteOffset),(n!==void 0||i!==void 0)&&(n=n||0,i=i||o.byteLength-n),{buffer:o,byteOffset:n,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:i,byteOffset:o}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,o,i)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;const c=n&&n.handle;return!c||o===void 0?this.gl.bindBufferBase(35982,e,c):this.gl.bindBufferRange(35982,e,c,i,o),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let op=null;function gO(t){return(!op||op.byteLength<t)&&(op=new ArrayBuffer(t)),op}function _O(t,e){const n=gO(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function yO(t){let{target:e,source:n,start:i=0,count:o=1}=t;const c=n.length,d=o*c;let l=0;for(let v=i;l<c;l++)e[v++]=n[l];for(;l<d;)l<d-l?(e.copyWithin(i+l,i,i+l),l*=2):(e.copyWithin(i+l,i,i+d-l),l=d);return e}const vO="elements must be GL.ELEMENT_ARRAY_BUFFER";class Hr extends Yo{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?Zt(e)||GS()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new Hr(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return Hr.MAX_ATTRIBUTES=Hr.MAX_ATTRIBUTES||e.getParameter(34921),Hr.MAX_ATTRIBUTES}static setConstant(e,n,i){switch(i.constructor){case Float32Array:Hr._setConstantFloatArray(e,n,i);break;case Int32Array:Hr._setConstantIntArray(e,n,i);break;case Uint32Array:Hr._setConstantUintArray(e,n,i);break;default:ht(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Hr.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return ht(!e||e.target===34963,vO),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,i){if(n.target===34963)return this.setElementBuffer(n,i);const{size:o,type:c,stride:d,offset:l,normalized:v,integer:w,divisor:C}=i,{gl:L,gl2:P}=this;return e=Number(e),this.bind(()=>{L.bindBuffer(34962,n.handle),w?(ht(Zt(L)),P.vertexAttribIPointer(e,o,c,d,l)):L.vertexAttribPointer(e,o,c,v,d,l),L.enableVertexAttribArray(e),P.vertexAttribDivisor(e,C||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!Hr.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const i=this._normalizeConstantArrayValue(n),o=i.byteLength*e,c=i.length*e;let d=!this.buffer;if(this.buffer=this.buffer||new _n(this.gl,o),d=d||this.buffer.reallocate(o),d=d||!this._compareConstantArrayValues(i,this.bufferValue),d){const l=_O(n.constructor,c);yO({target:l,source:i,start:0,count:c}),this.buffer.subData(l),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==n[i])return!1;return!0}static _setConstantFloatArray(e,n,i){switch(i.length){case 1:e.vertexAttrib1fv(n,i);break;case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:ht(!1)}}static _setConstantIntArray(e,n,i){switch(ht(Zt(e)),i.length){case 1:e.vertexAttribI1iv(n,i);break;case 2:e.vertexAttribI2iv(n,i);break;case 3:e.vertexAttribI3iv(n,i);break;case 4:e.vertexAttribI4iv(n,i);break;default:ht(!1)}}static _setConstantUintArray(e,n,i){switch(ht(Zt(e)),i.length){case 1:e.vertexAttribI1uiv(n,i);break;case 2:e.vertexAttribI2uiv(n,i);break;case 3:e.vertexAttribI3uiv(n,i);break;case 4:e.vertexAttribI4uiv(n,i);break;default:ht(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:i}=n;return ht(Number.isFinite(i)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(i,e);default:return this.gl.getVertexAttrib(i,e)}})}}const xO="VertexArray: attributes must be Buffers or constants (i.e. typed array)",bO=/^(.+)__LOCATION_([0-9]+)$/,wO=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class EO{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Hr(e),KS(this,"VertexArray","v6.0",wO),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const i=e[n];this._setAttribute(n,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,i);const{location:o,accessor:c}=this._resolveLocationAndAccessor(e,n,n.accessor,i);return o>=0&&(this.values[o]=n,this.accessors[o]=c,this.clearDrawParams(),this.vertexArrayObject.setBuffer(o,n,c)),this}setConstant(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:o,accessor:c}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i));return o>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[o]=n,this.accessors[o]=c,this.clearDrawParams(),this.vertexArrayObject.enable(o,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new _n(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof _n&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof _n&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,i){let o;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),o=i()}),o}_resolveLocationAndAccessor(e,n,i,o){const c={location:-1,accessor:null},{location:d,name:l}=this._getAttributeIndex(e);if(!Number.isFinite(d)||d<0)return this.unused[e]=n,Et.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),c;const v=this._getAttributeInfo(l||d);if(!v)return c;const w=this.accessors[d]||{},C=Zr.resolve(v.accessor,w,i,o),{size:L,type:P}=C;return ht(Number.isFinite(L)&&Number.isFinite(P)),{location:d,accessor:C}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const i=bO.exec(e),o=i?i[1]:e,c=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(o)+c,name:o}:{location:-1}}_setAttribute(e,n){if(n instanceof _n)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof _n){const i=n[0],o=n[1];this.setBuffer(e,i,o)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const i=n;this.setConstant(e,i)}else if(n.buffer instanceof _n){const i=n;this.setBuffer(e,i.buffer,i)}else throw new Error(xO)}_setConstantAttributes(e,n){const i=Math.max(e|0,n|0);let o=this.values[0];ArrayBuffer.isView(o)&&this._setConstantAttributeZero(o,i);for(let c=1;c<this.vertexArrayObject.MAX_ATTRIBUTES;c++)o=this.values[c],ArrayBuffer.isView(o)&&this._setConstantAttribute(c,o)}_setConstantAttributeZero(e,n){if(Hr.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,n){Hr.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const i=this.values[n],o=this.accessors[n];if(!i)return;const{divisor:c}=o,d=c>0;if(e.isInstanced=e.isInstanced||d,i instanceof _n){const l=i;if(d){const v=l.getVertexCount(o);e.instanceCount=Math.min(e.instanceCount,v)}else{const v=l.getVertexCount(o);e.vertexCount=Math.min(e.vertexCount,v)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Et.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function TO(t,e){const{maxElts:n=16,size:i=1}=e;let o="[";for(let d=0;d<t.length&&d<n;++d)d>0&&(o+=",".concat(d%i===0?" ":"")),o+=pd(t[d],e);const c=t.length>n?"...":"]";return"".concat(o).concat(c)}function pd(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:i=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return TO(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const o=t.toPrecision(2);return o.indexOf(".0")===o.length-2?o.slice(0,-1):o}function Qw(t){let{header:e="Uniforms",program:n,uniforms:i,undefinedOnly:o=!1}=t;ht(n);const c=".*_.*",d=".*Matrix",l=n._uniformSetters,v={},w=Object.keys(l).sort();let C=0;for(const N of w)!N.match(c)&&!N.match(d)&&H_({table:v,header:e,uniforms:i,uniformName:N,undefinedOnly:o})&&C++;for(const N of w)N.match(d)&&H_({table:v,header:e,uniforms:i,uniformName:N,undefinedOnly:o})&&C++;for(const N of w)v[N]||H_({table:v,header:e,uniforms:i,uniformName:N,undefinedOnly:o})&&C++;let L=0;const P={};if(!o)for(const N in i){const X=i[N];v[N]||(L++,P[N]={Type:"NOT USED: ".concat(X),[e]:pd(X)})}return{table:v,count:C,unusedTable:P,unusedCount:L}}function H_(t){let{table:e,header:n,uniforms:i,uniformName:o,undefinedOnly:c}=t;const d=i[o],l=SO(d);return!c||!l?(e[o]={[n]:l?pd(d):"N/A","Uniform Type":l?d:"NOT PROVIDED"},!0):!1}function SO(t){return t!=null}function AO(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=eE(e,e.elements,null,n));const o=e.values;for(const c in o){const d=e._getAttributeInfo(c);if(d){let l="".concat(c,": ").concat(d.name);const v=e.accessors[d.location];v&&(l="".concat(c,": ").concat(PO(d.name,v))),i[l]=eE(e,o[c],v,n)}}return i}function eE(t,e,n,i){const{gl:o}=t;if(!e)return{[i]:"null","Format ":"N/A"};let c="NOT PROVIDED",d=1,l=0,v=0,w,C,L;if(n&&(c=n.type,d=n.size,c=String(c).replace("Array",""),w=c.indexOf("nt")!==-1),e instanceof _n){const P=e,{data:N,changed:X}=P.getDebugData();C=X?"*":"",L=N,v=P.byteLength,l=v/N.BYTES_PER_ELEMENT/d;let ee;if(n){const me=n.divisor>0;ee="".concat(me?"I ":"P "," ").concat(l," (x").concat(d,"=").concat(v," bytes ").concat(Ua(o,c),")")}else w=!0,ee="".concat(v," bytes");return{[i]:"".concat(C).concat(pd(L,{size:d,isInteger:w})),"Format ":ee}}return L=e,d=e.length,c=String(e.constructor.name).replace("Array",""),w=c.indexOf("nt")!==-1,{[i]:"".concat(pd(L,{size:d,isInteger:w})," (constant)"),"Format ":"".concat(d,"x").concat(c," (constant)")}}function PO(t,e){const{type:n,size:i}=e,o=aA(n,i);return o?"".concat(t," (").concat(o.name,")"):t}function IO(t){const e={},n="Accessors for ".concat(t.id);for(const i of t.attributeInfos)if(i){const o=tE(i);e["in ".concat(o)]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const o=tE(i);e["out ".concat(o)]={[n]:JSON.stringify(i.accessor)}}return e}function tE(t){const{type:e,size:n}=t.accessor,i=aA(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}const nE=Xo()&&typeof document<"u";let CO=0;class MO{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=me=>YS(me),onAddHTML:i=null,onInitialize:o=()=>{},onRender:c=()=>{},onFinalize:d=()=>{},onError:l,gl:v=null,glOptions:w={},debug:C=!1,createFramebuffer:L=!1,autoResizeViewport:P=!0,autoResizeDrawingBuffer:N=!0,stats:X=Cl.get("animation-loop-".concat(CO++))}=e;let{useDevicePixels:ee=!0}=e;"useDevicePixelRatio"in e&&(Et.deprecated("useDevicePixelRatio","useDevicePixels")(),ee=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:i,onInitialize:o,onRender:c,onFinalize:d,onError:l,gl:v,glOptions:w,debug:C,createFramebuffer:L},this.gl=v,this.needsRedraw=null,this.timeline=null,this.stats=X,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:P,autoResizeDrawingBuffer:N,useDevicePixels:ee}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return ht(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=pm.isSupported(this.gl,["timers"])?new pm(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.getElementById(e);return i?Number(i.value):n}setViewParameters(){return Et.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=nE?new Promise((e,n)=>{if(nE&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):OD(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):zD(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?Hv(this.props.gl,e):this.onCreateContext(e),!qm(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");wD(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let i=1;const{canvas:o}=this.gl;return o&&o.clientHeight?i=o.clientWidth/o.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&PD(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new xi(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const Md="vs",Kv="fs";function Jr(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const W_={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function LO(t){const e={};for(const n in t){const i=t[n],o=kO(i);e[n]=o}return e}function kO(t){let e=iE(t);return e==="object"?t?"type"in t?Object.assign({},t,W_[t.type]):"value"in t?(e=iE(t.value),Object.assign({type:e},t,W_[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},W_[e])}function iE(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const RO="vs",DO="fs";class rE{constructor(e){let{name:n,vs:i,fs:o,dependencies:c=[],uniforms:d,getUniforms:l,deprecations:v=[],defines:w={},inject:C={},vertexShader:L,fragmentShader:P}=e;Jr(typeof n=="string"),this.name=n,this.vs=i||L,this.fs=o||P,this.getModuleUniforms=l,this.dependencies=c,this.deprecations=this._parseDeprecationDefinitions(v),this.defines=w,this.injections=zO(C),d&&(this.uniforms=LO(d))}getModuleSource(e){let n;switch(e){case RO:n=this.vs||"";break;case DO:n=this.fs||"";break;default:Jr(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},i=this.uniforms;for(const o in i){const c=i[o];o in e&&!c.private?(c.validate&&Jr(c.validate(e[o],c),"".concat(this.name,": invalid ").concat(o)),n[o]=e[o]):n[o]=c.value}return n}}function zO(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];const o=n.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),e[o][n]=i}return e}function OO(t){return FO(hA(t))}function FO(t){const e={},n={};return uA({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((i,o)=>n[o]-n[i]).map(i=>e[i])}function uA(t){let{modules:e,level:n,moduleMap:i,moduleDepth:o}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const c of e)i[c.name]=c,(o[c.name]===void 0||o[c.name]<n)&&(o[c.name]=n);for(const c of e)c.dependencies&&uA({modules:c.dependencies,level:n+1,moduleMap:i,moduleDepth:o})}function hA(t,e){return t.map(n=>(n instanceof rE||(Jr(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),Jr(n.name,"shader module has no name"),n=new rE(n),n.dependencies=hA(n.dependencies)),n))}function BO(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",i=n.indexOf("MSIE ")!==-1,o=n.indexOf("Trident/")!==-1;return i||o}const NO=7936,UO=7937,VO=7938,jO=35724,Jv={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Sl={};Object.keys(Jv).forEach(t=>{Sl[t]=t});function GO(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function $O(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||NO),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||UO);return{gpuVendor:HO(n,i),vendor:n,renderer:i,version:t.getParameter(VO),shadingLanguageVersion:t.getParameter(jO)}}function HO(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const q_={};function sE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=Jv[e];if(Jr(i,e),!BO(n))return!0;if(e in q_)return q_[e];const o=i[0],c=n.behavior||"enable",d="#extension GL_".concat(o," : ").concat(c,`
void main(void) {}`),l=t.createShader(35633);t.shaderSource(l,d),t.compileShader(l);const v=t.getShaderParameter(l,35713);return t.deleteShader(l),q_[e]=v,v}function WO(t,e){const n=Jv[e];Jr(n,e);const i=GO(t)&&n[1]||n[0],o=typeof i=="string"?!!t.getExtension(i):i;return Jr(o===!1||o===!0),o}function ap(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>WO(t,n))}function qO(t){switch($O(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function ZO(t,e,n){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return ap(t,Sl.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),ap(t,Sl.GLSL_DERIVATIVES)&&sE(t,Sl.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),ap(t,Sl.GLSL_FRAG_DATA)&&sE(t,Sl.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),ap(t,Sl.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const XO=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,YO=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,KO={[Md]:XO,[Kv]:YO},Rp="__LUMA_INJECT_DECLARATIONS__",oE=/void\s+main\s*\([^)]*\)\s*\{\n?/,aE=/}\n?[^{}]*$/,Z_=[];function lE(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const o=e===Md;for(const c in n){const d=n[c];d.sort((v,w)=>v.order-w.order),Z_.length=d.length;for(let v=0,w=d.length;v<w;++v)Z_[v]=d[v].injection;const l="".concat(Z_.join(`
`),`
`);switch(c){case"vs:#decl":o&&(t=t.replace(Rp,l));break;case"vs:#main-start":o&&(t=t.replace(oE,v=>v+l));break;case"vs:#main-end":o&&(t=t.replace(aE,v=>l+v));break;case"fs:#decl":o||(t=t.replace(Rp,l));break;case"fs:#main-start":o||(t=t.replace(oE,v=>v+l));break;case"fs:#main-end":o||(t=t.replace(aE,v=>l+v));break;default:t=t.replace(c,v=>v+l)}}return t=t.replace(Rp,""),i&&(t=t.replace(/\}\s*$/,c=>c+KO[e])),t}function g0(t){const e={};return Jr(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const i in n)e[i]=e[i]?"".concat(e[i],`
`).concat(n[i]):n[i]}),e}function cu(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const dA=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],JO=[...dA,[cu("attribute"),"in $1"],[cu("varying"),"out $1"]],QO=[...dA,[cu("varying"),"in $1"]],fA=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],eF=[...fA,[cu("in"),"attribute $1"],[cu("out"),"varying $1"]],tF=[...fA,[cu("in"),"varying $1"]],_0="gl_FragColor",y0=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,nF=/void\s+main\s*\([^)]*\)\s*\{\n?/;function iF(t,e,n){switch(e){case 300:return n?mm(t,JO):rF(t);case 100:return n?mm(t,eF):sF(t);default:throw new Error("unknown GLSL version ".concat(e))}}function mm(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function rF(t){t=mm(t,QO);const e=t.match(y0);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(_0,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(nF,i=>"out vec4 ".concat(n,`;
`).concat(i)).replace(new RegExp("\\b".concat(_0,"\\b"),"g"),n)}return t}function sF(t){t=mm(t,tF);const e=t.match(y0);if(e){const n=e[1];t=t.replace(y0,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),_0)}return t}const oF=`

`.concat(Rp,`

`),pA={[Md]:"vertex",[Kv]:"fragment"},aF=`precision highp float;

`;function lF(t,e){const{vs:n,fs:i}=e,o=OO(e.modules||[]);return{gl:t,vs:cE(t,Object.assign({},e,{source:n,type:Md,modules:o})),fs:cE(t,Object.assign({},e,{source:i,type:Kv,modules:o})),getUniforms:cF(o)}}function cE(t,e){let{id:n,source:i,type:o,modules:c,defines:d={},hookFunctions:l=[],inject:v={},transpileToGLSL100:w=!1,prologue:C=!0,log:L}=e;Jr(typeof i=="string","shader source must be a string");const P=o===Md,N=i.split(`
`);let X=100,ee="",me=i;N[0].indexOf("#version ")===0?(X=300,ee=N[0],me=N.slice(1).join(`
`)):ee="#version ".concat(X);const Y={};c.forEach(Oe=>{Object.assign(Y,Oe.getDefines())}),Object.assign(Y,d);let W=C?"".concat(ee,`
`).concat(hF({id:n,source:i,type:o}),`
`).concat(uF({type:o}),`
`).concat(qO(t),`
`).concat(ZO(t),`
`).concat(dF(Y),`
`).concat(P?"":aF,`
`):"".concat(ee,`
`);const q=pF(l),oe={},ye={},Se={};for(const Oe in v){const Fe=typeof v[Oe]=="string"?{injection:v[Oe],order:0}:v[Oe],Ve=Oe.match(/^(v|f)s:(#)?([\w-]+)$/);if(Ve){const je=Ve[2],ut=Ve[3];je?ut==="decl"?ye[Oe]=[Fe]:Se[Oe]=[Fe]:oe[Oe]=[Fe]}else Se[Oe]=[Fe]}for(const Oe of c){L&&Oe.checkDeprecations(me,L);const Fe=Oe.getModuleSource(o,X);W+=Fe;const Ve=Oe.injections[o];for(const je in Ve){const ut=je.match(/^(v|f)s:#([\w-]+)$/);if(ut){const Yt=ut[2]==="decl"?ye:Se;Yt[je]=Yt[je]||[],Yt[je].push(Ve[je])}else oe[je]=oe[je]||[],oe[je].push(Ve[je])}}return W+=oF,W=lE(W,o,ye),W+=fF(q[o],oe),W+=me,W=lE(W,o,Se),W=iF(W,w?100:X,P),W}function cF(t){return function(n){const i={};for(const o of t){const c=o.getUniforms(n,i);Object.assign(i,c)}return i}}function uF(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(pA[e].toUpperCase(),`
`)}function hF(t){let{id:e,source:n,type:i}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(pA[i],`

`):""}function dF(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const i in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const o=t[i];(o||Number.isFinite(o))&&(n+="#define ".concat(i.toUpperCase()," ").concat(t[i],`
`))}return e===0&&(n+=`
`),n}function fF(t,e){let n="";for(const i in t){const o=t[i];if(n+="void ".concat(o.signature,` {
`),o.header&&(n+="  ".concat(o.header)),e[i]){const c=e[i];c.sort((d,l)=>d.order-l.order);for(const d of c)n+="  ".concat(d.injection,`
`)}o.footer&&(n+="  ".concat(o.footer)),n+=`}
`}return n}function pF(t){const e={vs:{},fs:{}};return t.forEach(n=>{let i;typeof n!="string"?(i=n,n=i.hook):i={},n=n.trim();const[o,c]=n.split(":"),d=n.replace(/\(.+/,"");e[o][d]=Object.assign(i,{signature:c})}),e}const mF="void main() {gl_FragColor = vec4(0);}",mA=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,gF=`#version 300 es
`.concat(mA);function gA(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,o,c]=n;if(!e.includes(i)||!o||!c)return null;const d=c.split(";")[0];return{qualifier:i,type:o,name:d}}function _A(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:i,output:o}=t;if(!n)return e===300?gF:e>300?"#version ".concat(e,`
`).concat(mA):mF;const c=vF(n,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(n,`;
out vec4 `).concat(o,`;
void main() {
  `).concat(o," = ").concat(c,`;
}`):"varying ".concat(i," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(c,`;
}`)}function _F(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Jr(!1),null}}function yF(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Jr(!1),null}}function vF(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return Jr(!1),null}}const xF=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,bF={name:"fp32",vs:xF,fs:null};function uE(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const Yr={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function wF(t,{precision:e=Yr.precision}={}){return t=EF(t),"".concat(parseFloat(t.toPrecision(e)))}function uu(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Ca(t,e,n){return SF(t,i=>Math.max(e,Math.min(n,i)))}function gm(t,e,n){return uu(t)?t.map((i,o)=>gm(i,e[o],n)):n*e+(1-n)*t}function md(t,e,n){const i=Yr.EPSILON;n&&(Yr.EPSILON=n);try{if(t===e)return!0;if(uu(t)&&uu(e)){if(t.length!==e.length)return!1;for(let o=0;o<t.length;++o)if(!md(t[o],e[o]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Yr.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Yr.EPSILON=i}}function EF(t){return Math.round(t/Yr.EPSILON)*Yr.EPSILON}function TF(t){return t.clone?t.clone():new Array(t.length)}function SF(t,e,n){if(uu(t)){const i=t;n=n||TF(i);for(let o=0;o<n.length&&o<i.length;++o)n[o]=e(t[o],o,n);return n}return e(t)}function AF(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class yA extends AF(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:uu(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Yr)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+wF(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!md(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){if(i===void 0)return this.lerp(this,e,n);for(let o=0;o<this.ELEMENTS;++o){const c=e[o];this[o]=c+i*(n[o]-c)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Yr.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}get elements(){return this}}function PF(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function qr(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function X_(t,e,n=""){if(Yr.debug&&!PF(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class IF extends yA{get x(){return this[0]}set x(e){this[0]=qr(e)}get y(){return this[1]}set y(e){this[1]=qr(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const o=this[i]-e[i];n+=o*o}return qr(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return qr(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return uE(e>=0&&e<this.ELEMENTS,"index is out of range"),qr(this[e])}setComponent(e,n){return uE(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var Dp=1e-6,hu=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function CF(){var t=new hu(2);return hu!=Float32Array&&(t[0]=0,t[1]=0),t}function hE(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function MF(t,e){return t[0]=-e[0],t[1]=-e[1],t}function vA(t,e,n,i){var o=e[0],c=e[1];return t[0]=o+i*(n[0]-o),t[1]=c+i*(n[1]-c),t}function LF(t,e,n){var i=e[0],o=e[1];return t[0]=n[0]*i+n[4]*o+n[12],t[1]=n[1]*i+n[5]*o+n[13],t}(function(){var t=CF();return function(e,n,i,o,c,d){var l,v;for(n||(n=2),i||(i=0),o?v=Math.min(o*n+i,e.length):v=e.length,l=i;l<v;l+=n)t[0]=e[l],t[1]=e[l+1],c(t,t,d),e[l]=t[0],e[l+1]=t[1];return e}})();function kF(t,e,n){const i=e[0],o=e[1],c=n[3]*i+n[7]*o||1;return t[0]=(n[0]*i+n[4]*o)/c,t[1]=(n[1]*i+n[5]*o)/c,t}function xA(t,e,n){const i=e[0],o=e[1],c=e[2],d=n[3]*i+n[7]*o+n[11]*c||1;return t[0]=(n[0]*i+n[4]*o+n[8]*c)/d,t[1]=(n[1]*i+n[5]*o+n[9]*c)/d,t[2]=(n[2]*i+n[6]*o+n[10]*c)/d,t}function RF(t,e,n){const i=e[0],o=e[1];return t[0]=n[0]*i+n[2]*o,t[1]=n[1]*i+n[3]*o,t[2]=e[2],t}function DF(){var t=new hu(3);return hu!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function zF(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function OF(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function FF(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function BF(t,e,n){var i=e[0],o=e[1],c=e[2],d=n[0],l=n[1],v=n[2];return t[0]=o*v-c*l,t[1]=c*d-i*v,t[2]=i*l-o*d,t}function bA(t,e,n){var i=e[0],o=e[1],c=e[2],d=n[3]*i+n[7]*o+n[11]*c+n[15];return d=d||1,t[0]=(n[0]*i+n[4]*o+n[8]*c+n[12])/d,t[1]=(n[1]*i+n[5]*o+n[9]*c+n[13])/d,t[2]=(n[2]*i+n[6]*o+n[10]*c+n[14])/d,t}function NF(t,e,n){var i=e[0],o=e[1],c=e[2];return t[0]=i*n[0]+o*n[3]+c*n[6],t[1]=i*n[1]+o*n[4]+c*n[7],t[2]=i*n[2]+o*n[5]+c*n[8],t}function UF(t,e,n){var i=n[0],o=n[1],c=n[2],d=n[3],l=e[0],v=e[1],w=e[2],C=o*w-c*v,L=c*l-i*w,P=i*v-o*l,N=o*P-c*L,X=c*C-i*P,ee=i*L-o*C,me=d*2;return C*=me,L*=me,P*=me,N*=2,X*=2,ee*=2,t[0]=l+C+N,t[1]=v+L+X,t[2]=w+P+ee,t}function VF(t,e,n,i){var o=[],c=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],c[0]=o[0],c[1]=o[1]*Math.cos(i)-o[2]*Math.sin(i),c[2]=o[1]*Math.sin(i)+o[2]*Math.cos(i),t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t}function jF(t,e,n,i){var o=[],c=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],c[0]=o[2]*Math.sin(i)+o[0]*Math.cos(i),c[1]=o[1],c[2]=o[2]*Math.cos(i)-o[0]*Math.sin(i),t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t}function GF(t,e,n,i){var o=[],c=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],c[0]=o[0]*Math.cos(i)-o[1]*Math.sin(i),c[1]=o[0]*Math.sin(i)+o[1]*Math.cos(i),c[2]=o[2],t[0]=c[0]+n[0],t[1]=c[1]+n[1],t[2]=c[2]+n[2],t}function $F(t,e){var n=t[0],i=t[1],o=t[2],c=e[0],d=e[1],l=e[2],v=Math.sqrt(n*n+i*i+o*o),w=Math.sqrt(c*c+d*d+l*l),C=v*w,L=C&&FF(t,e)/C;return Math.acos(Math.min(Math.max(L,-1),1))}var HF=zF;(function(){var t=DF();return function(e,n,i,o,c,d){var l,v;for(n||(n=3),i||(i=0),o?v=Math.min(o*n+i,e.length):v=e.length,l=i;l<v;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],c(t,t,d),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();const Y_=[0,0,0];let lp;class mo extends IF{static get ZERO(){return lp||(lp=new mo(0,0,0),Object.freeze(lp)),lp}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&uu(e)?this.copy(e):(Yr.debug&&(qr(e),qr(n),qr(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Yr.debug&&(qr(e.x),qr(e.y),qr(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=qr(e)}angle(e){return $F(this,e)}cross(e){return BF(this,this,e),this.check()}rotateX({radians:e,origin:n=Y_}){return VF(this,this,n,e),this.check()}rotateY({radians:e,origin:n=Y_}){return jF(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=Y_}){return GF(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return bA(this,this,e),this.check()}transformAsVector(e){return xA(this,this,e),this.check()}transformByMatrix3(e){return NF(this,this,e),this.check()}transformByMatrix2(e){return RF(this,this,e),this.check()}transformByQuaternion(e){return UF(this,this,e),this.check()}}class WF extends yA{toString(){let e="[";if(Yr.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=qr(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let o=0;o<this.RANK;++o)n[o]=this[i+o];return n}setColumn(e,n){const i=e*this.RANK;for(let o=0;o<this.RANK;++o)this[i+o]=n[o];return this}}function qF(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ZF(t,e){if(t===e){var n=e[1],i=e[2],o=e[3],c=e[6],d=e[7],l=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=c,t[11]=e[14],t[12]=o,t[13]=d,t[14]=l}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function v0(t,e){var n=e[0],i=e[1],o=e[2],c=e[3],d=e[4],l=e[5],v=e[6],w=e[7],C=e[8],L=e[9],P=e[10],N=e[11],X=e[12],ee=e[13],me=e[14],Y=e[15],W=n*l-i*d,q=n*v-o*d,oe=n*w-c*d,ye=i*v-o*l,Se=i*w-c*l,Oe=o*w-c*v,Fe=C*ee-L*X,Ve=C*me-P*X,je=C*Y-N*X,ut=L*me-P*ee,Gt=L*Y-N*ee,Yt=P*Y-N*me,Mt=W*Yt-q*Gt+oe*ut+ye*je-Se*Ve+Oe*Fe;return Mt?(Mt=1/Mt,t[0]=(l*Yt-v*Gt+w*ut)*Mt,t[1]=(o*Gt-i*Yt-c*ut)*Mt,t[2]=(ee*Oe-me*Se+Y*ye)*Mt,t[3]=(P*Se-L*Oe-N*ye)*Mt,t[4]=(v*je-d*Yt-w*Ve)*Mt,t[5]=(n*Yt-o*je+c*Ve)*Mt,t[6]=(me*oe-X*Oe-Y*q)*Mt,t[7]=(C*Oe-P*oe+N*q)*Mt,t[8]=(d*Gt-l*je+w*Fe)*Mt,t[9]=(i*je-n*Gt-c*Fe)*Mt,t[10]=(X*Se-ee*oe+Y*W)*Mt,t[11]=(L*oe-C*Se-N*W)*Mt,t[12]=(l*Ve-d*ut-v*Fe)*Mt,t[13]=(n*ut-i*Ve+o*Fe)*Mt,t[14]=(ee*q-X*ye-me*W)*Mt,t[15]=(C*ye-L*q+P*W)*Mt,t):null}function XF(t){var e=t[0],n=t[1],i=t[2],o=t[3],c=t[4],d=t[5],l=t[6],v=t[7],w=t[8],C=t[9],L=t[10],P=t[11],N=t[12],X=t[13],ee=t[14],me=t[15],Y=e*d-n*c,W=e*l-i*c,q=e*v-o*c,oe=n*l-i*d,ye=n*v-o*d,Se=i*v-o*l,Oe=w*X-C*N,Fe=w*ee-L*N,Ve=w*me-P*N,je=C*ee-L*X,ut=C*me-P*X,Gt=L*me-P*ee;return Y*Gt-W*ut+q*je+oe*Ve-ye*Fe+Se*Oe}function kl(t,e,n){var i=e[0],o=e[1],c=e[2],d=e[3],l=e[4],v=e[5],w=e[6],C=e[7],L=e[8],P=e[9],N=e[10],X=e[11],ee=e[12],me=e[13],Y=e[14],W=e[15],q=n[0],oe=n[1],ye=n[2],Se=n[3];return t[0]=q*i+oe*l+ye*L+Se*ee,t[1]=q*o+oe*v+ye*P+Se*me,t[2]=q*c+oe*w+ye*N+Se*Y,t[3]=q*d+oe*C+ye*X+Se*W,q=n[4],oe=n[5],ye=n[6],Se=n[7],t[4]=q*i+oe*l+ye*L+Se*ee,t[5]=q*o+oe*v+ye*P+Se*me,t[6]=q*c+oe*w+ye*N+Se*Y,t[7]=q*d+oe*C+ye*X+Se*W,q=n[8],oe=n[9],ye=n[10],Se=n[11],t[8]=q*i+oe*l+ye*L+Se*ee,t[9]=q*o+oe*v+ye*P+Se*me,t[10]=q*c+oe*w+ye*N+Se*Y,t[11]=q*d+oe*C+ye*X+Se*W,q=n[12],oe=n[13],ye=n[14],Se=n[15],t[12]=q*i+oe*l+ye*L+Se*ee,t[13]=q*o+oe*v+ye*P+Se*me,t[14]=q*c+oe*w+ye*N+Se*Y,t[15]=q*d+oe*C+ye*X+Se*W,t}function _m(t,e,n){var i=n[0],o=n[1],c=n[2],d,l,v,w,C,L,P,N,X,ee,me,Y;return e===t?(t[12]=e[0]*i+e[4]*o+e[8]*c+e[12],t[13]=e[1]*i+e[5]*o+e[9]*c+e[13],t[14]=e[2]*i+e[6]*o+e[10]*c+e[14],t[15]=e[3]*i+e[7]*o+e[11]*c+e[15]):(d=e[0],l=e[1],v=e[2],w=e[3],C=e[4],L=e[5],P=e[6],N=e[7],X=e[8],ee=e[9],me=e[10],Y=e[11],t[0]=d,t[1]=l,t[2]=v,t[3]=w,t[4]=C,t[5]=L,t[6]=P,t[7]=N,t[8]=X,t[9]=ee,t[10]=me,t[11]=Y,t[12]=d*i+C*o+X*c+e[12],t[13]=l*i+L*o+ee*c+e[13],t[14]=v*i+P*o+me*c+e[14],t[15]=w*i+N*o+Y*c+e[15]),t}function Qv(t,e,n){var i=n[0],o=n[1],c=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*c,t[9]=e[9]*c,t[10]=e[10]*c,t[11]=e[11]*c,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function YF(t,e,n,i){var o=i[0],c=i[1],d=i[2],l=Math.hypot(o,c,d),v,w,C,L,P,N,X,ee,me,Y,W,q,oe,ye,Se,Oe,Fe,Ve,je,ut,Gt,Yt,Mt,zn;return l<Dp?null:(l=1/l,o*=l,c*=l,d*=l,v=Math.sin(n),w=Math.cos(n),C=1-w,L=e[0],P=e[1],N=e[2],X=e[3],ee=e[4],me=e[5],Y=e[6],W=e[7],q=e[8],oe=e[9],ye=e[10],Se=e[11],Oe=o*o*C+w,Fe=c*o*C+d*v,Ve=d*o*C-c*v,je=o*c*C-d*v,ut=c*c*C+w,Gt=d*c*C+o*v,Yt=o*d*C+c*v,Mt=c*d*C-o*v,zn=d*d*C+w,t[0]=L*Oe+ee*Fe+q*Ve,t[1]=P*Oe+me*Fe+oe*Ve,t[2]=N*Oe+Y*Fe+ye*Ve,t[3]=X*Oe+W*Fe+Se*Ve,t[4]=L*je+ee*ut+q*Gt,t[5]=P*je+me*ut+oe*Gt,t[6]=N*je+Y*ut+ye*Gt,t[7]=X*je+W*ut+Se*Gt,t[8]=L*Yt+ee*Mt+q*zn,t[9]=P*Yt+me*Mt+oe*zn,t[10]=N*Yt+Y*Mt+ye*zn,t[11]=X*Yt+W*Mt+Se*zn,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function wA(t,e,n){var i=Math.sin(n),o=Math.cos(n),c=e[4],d=e[5],l=e[6],v=e[7],w=e[8],C=e[9],L=e[10],P=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=c*o+w*i,t[5]=d*o+C*i,t[6]=l*o+L*i,t[7]=v*o+P*i,t[8]=w*o-c*i,t[9]=C*o-d*i,t[10]=L*o-l*i,t[11]=P*o-v*i,t}function KF(t,e,n){var i=Math.sin(n),o=Math.cos(n),c=e[0],d=e[1],l=e[2],v=e[3],w=e[8],C=e[9],L=e[10],P=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*o-w*i,t[1]=d*o-C*i,t[2]=l*o-L*i,t[3]=v*o-P*i,t[8]=c*i+w*o,t[9]=d*i+C*o,t[10]=l*i+L*o,t[11]=v*i+P*o,t}function EA(t,e,n){var i=Math.sin(n),o=Math.cos(n),c=e[0],d=e[1],l=e[2],v=e[3],w=e[4],C=e[5],L=e[6],P=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*o+w*i,t[1]=d*o+C*i,t[2]=l*o+L*i,t[3]=v*o+P*i,t[4]=w*o-c*i,t[5]=C*o-d*i,t[6]=L*o-l*i,t[7]=P*o-v*i,t}function JF(t,e){var n=e[0],i=e[1],o=e[2],c=e[3],d=n+n,l=i+i,v=o+o,w=n*d,C=i*d,L=i*l,P=o*d,N=o*l,X=o*v,ee=c*d,me=c*l,Y=c*v;return t[0]=1-L-X,t[1]=C+Y,t[2]=P-me,t[3]=0,t[4]=C-Y,t[5]=1-w-X,t[6]=N+ee,t[7]=0,t[8]=P+me,t[9]=N-ee,t[10]=1-w-L,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function QF(t,e,n,i,o,c,d){var l=1/(n-e),v=1/(o-i),w=1/(c-d);return t[0]=c*2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c*2*v,t[6]=0,t[7]=0,t[8]=(n+e)*l,t[9]=(o+i)*v,t[10]=(d+c)*w,t[11]=-1,t[12]=0,t[13]=0,t[14]=d*c*2*w,t[15]=0,t}function e4(t,e,n,i,o){var c=1/Math.tan(e/2),d;return t[0]=c/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,o!=null&&o!==1/0?(d=1/(i-o),t[10]=(o+i)*d,t[14]=2*o*i*d):(t[10]=-1,t[14]=-2*i),t}var t4=e4;function n4(t,e,n,i,o,c,d){var l=1/(e-n),v=1/(i-o),w=1/(c-d);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*v,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*w,t[11]=0,t[12]=(e+n)*l,t[13]=(o+i)*v,t[14]=(d+c)*w,t[15]=1,t}var i4=n4;function r4(t,e,n,i){var o,c,d,l,v,w,C,L,P,N,X=e[0],ee=e[1],me=e[2],Y=i[0],W=i[1],q=i[2],oe=n[0],ye=n[1],Se=n[2];return Math.abs(X-oe)<Dp&&Math.abs(ee-ye)<Dp&&Math.abs(me-Se)<Dp?qF(t):(C=X-oe,L=ee-ye,P=me-Se,N=1/Math.hypot(C,L,P),C*=N,L*=N,P*=N,o=W*P-q*L,c=q*C-Y*P,d=Y*L-W*C,N=Math.hypot(o,c,d),N?(N=1/N,o*=N,c*=N,d*=N):(o=0,c=0,d=0),l=L*d-P*c,v=P*o-C*d,w=C*c-L*o,N=Math.hypot(l,v,w),N?(N=1/N,l*=N,v*=N,w*=N):(l=0,v=0,w=0),t[0]=o,t[1]=l,t[2]=C,t[3]=0,t[4]=c,t[5]=v,t[6]=L,t[7]=0,t[8]=d,t[9]=w,t[10]=P,t[11]=0,t[12]=-(o*X+c*ee+d*me),t[13]=-(l*X+v*ee+w*me),t[14]=-(C*X+L*ee+P*me),t[15]=1,t)}function s4(){var t=new hu(4);return hu!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function o4(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Ld(t,e,n){var i=e[0],o=e[1],c=e[2],d=e[3];return t[0]=n[0]*i+n[4]*o+n[8]*c+n[12]*d,t[1]=n[1]*i+n[5]*o+n[9]*c+n[13]*d,t[2]=n[2]*i+n[6]*o+n[10]*c+n[14]*d,t[3]=n[3]*i+n[7]*o+n[11]*c+n[15]*d,t}(function(){var t=s4();return function(e,n,i,o,c,d){var l,v;for(n||(n=4),i||(i=0),o?v=Math.min(o*n+i,e.length):v=e.length,l=i;l<v;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],c(t,t,d),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();var x0;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(x0||(x0={}));const a4=45*Math.PI/180,l4=1,K_=.1,J_=500,c4=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class go extends WF{static get IDENTITY(){return h4()}static get ZERO(){return u4()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return x0}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,o,c,d,l,v,w,C,L,P,N,X,ee,me){return this[0]=e,this[1]=n,this[2]=i,this[3]=o,this[4]=c,this[5]=d,this[6]=l,this[7]=v,this[8]=w,this[9]=C,this[10]=L,this[11]=P,this[12]=N,this[13]=X,this[14]=ee,this[15]=me,this.check()}setRowMajor(e,n,i,o,c,d,l,v,w,C,L,P,N,X,ee,me){return this[0]=e,this[1]=c,this[2]=w,this[3]=N,this[4]=n,this[5]=d,this[6]=C,this[7]=X,this[8]=i,this[9]=l,this[10]=L,this[11]=ee,this[12]=o,this[13]=v,this[14]=P,this[15]=me,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(c4)}fromObject(e){return this.check()}fromQuaternion(e){return JF(this,e),this.check()}frustum(e){const{left:n,right:i,bottom:o,top:c,near:d=K_,far:l=J_}=e;return l===1/0?d4(this,n,i,o,c,d):QF(this,n,i,o,c,d,l),this.check()}lookAt(e){const{eye:n,center:i=[0,0,0],up:o=[0,1,0]}=e;return r4(this,n,i,o),this.check()}ortho(e){const{left:n,right:i,bottom:o,top:c,near:d=K_,far:l=J_}=e;return i4(this,n,i,o,c,d,l),this.check()}orthographic(e){const{fovy:n=a4,aspect:i=l4,focalDistance:o=1,near:c=K_,far:d=J_}=e;dE(n);const l=n/2,v=o*Math.tan(l),w=v*i;return this.ortho({left:-w,right:w,bottom:-v,top:v,near:c,far:d})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:i=1,near:o=.1,far:c=500}=e;return dE(n),t4(this,n,i,o,c),this.check()}determinant(){return XF(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),o=1/i[0],c=1/i[1],d=1/i[2];return e[0]=this[0]*o,e[1]=this[1]*c,e[2]=this[2]*d,e[3]=0,e[4]=this[4]*o,e[5]=this[5]*c,e[6]=this[6]*d,e[7]=0,e[8]=this[8]*o,e[9]=this[9]*c,e[10]=this[10]*d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),o=1/i[0],c=1/i[1],d=1/i[2];return e[0]=this[0]*o,e[1]=this[1]*c,e[2]=this[2]*d,e[3]=this[4]*o,e[4]=this[5]*c,e[5]=this[6]*d,e[6]=this[8]*o,e[7]=this[9]*c,e[8]=this[10]*d,e}transpose(){return ZF(this,this),this.check()}invert(){return v0(this,this),this.check()}multiplyLeft(e){return kl(this,e,this),this.check()}multiplyRight(e){return kl(this,this,e),this.check()}rotateX(e){return wA(this,this,e),this.check()}rotateY(e){return KF(this,this,e),this.check()}rotateZ(e){return EA(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return YF(this,this,e,n),this.check()}scale(e){return Qv(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return _m(this,this,e),this.check()}transform(e,n){return e.length===4?(n=Ld(n||[-0,-0,-0,-0],e,this),X_(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;let o;switch(i){case 2:o=LF(n||[-0,-0],e,this);break;case 3:o=bA(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return X_(o,e.length),o}transformAsVector(e,n){let i;switch(e.length){case 2:i=kF(n||[-0,-0],e,this);break;case 3:i=xA(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return X_(i,e.length),i}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}}let cp,up;function u4(){return cp||(cp=new go([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(cp)),cp}function h4(){return up||(up=new go,Object.freeze(up)),up}function dE(t){if(t>Math.PI*2)throw Error("expected radians")}function d4(t,e,n,i,o,c){const d=2*c/(n-e),l=2*c/(o-i),v=(n+e)/(n-e),w=(o+i)/(o-i),C=-1,L=-1,P=-2*c;return t[0]=d,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=v,t[9]=w,t[10]=C,t[11]=L,t[12]=0,t[13]=0,t[14]=P,t[15]=0,t}const fE=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,f4={lightSources:{}};function Q_(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.map(n=>n*e/255)}function p4(t){let{ambientLight:e,pointLights:n=[],directionalLights:i=[]}=t;const o={};return e?o["lighting_uAmbientLight.color"]=Q_(e):o["lighting_uAmbientLight.color"]=[0,0,0],n.forEach((c,d)=>{o["lighting_uPointLight[".concat(d,"].color")]=Q_(c),o["lighting_uPointLight[".concat(d,"].position")]=c.position,o["lighting_uPointLight[".concat(d,"].attenuation")]=c.attenuation||[1,0,0]}),o.lighting_uPointLightCount=n.length,i.forEach((c,d)=>{o["lighting_uDirectionalLight[".concat(d,"].color")]=Q_(c),o["lighting_uDirectionalLight[".concat(d,"].direction")]=c.direction}),o.lighting_uDirectionalLightCount=i.length,o}function TA(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:f4;if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:i}=t.lightSources||{};return e||n&&n.length>0||i&&i.length>0?Object.assign({},p4({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return TA({lightSources:e})}return{}}const m4={name:"lights",vs:fE,fs:fE,getUniforms:TA,defines:{MAX_LIGHTS:3}},g4=new Uint8Array([0,255,255,255]),_4={pickingSelectedColor:null,pickingHighlightColor:g4,pickingActive:!1,pickingAttribute:!1};function y4(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_4;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=!!t.pickingActive,e.picking_uAttribute=!!t.pickingAttribute),e}const v4=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,x4=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,b4={name:"picking",vs:v4,fs:x4,getUniforms:y4},w4=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,E4={};function T4(t){const{ambient:e=.35,diffuse:n=.6,shininess:i=32,specularColor:o=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:o.map(c=>c/255)}}function S4(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:E4;if(!("material"in t))return{};const{material:e}=t;return e?T4(e):{lighting_uEnabled:!1}}const A4={name:"gouraud-lighting",dependencies:[m4],vs:w4,defines:{LIGHTING_VERTEX:1},getUniforms:S4},P4=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,I4={name:"transform",vs:P4,fs:null};class kd{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new kd(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:i="",defines:o={},inject:c={},varyings:d=[],bufferMode:l=35981,transpileToGLSL100:v=!1}=e,w=this._getModuleList(e.modules),C=this._getHash(n),L=this._getHash(i),P=w.map(q=>this._getHash(q.name)).sort(),N=d.map(q=>this._getHash(q)),X=Object.keys(o).sort(),ee=Object.keys(c).sort(),me=[],Y=[];for(const q of X)me.push(this._getHash(q)),me.push(this._getHash(o[q]));for(const q of ee)Y.push(this._getHash(q)),Y.push(this._getHash(c[q]));const W="".concat(C,"/").concat(L,"D").concat(me.join("/"),"M").concat(P.join("/"),"I").concat(Y.join("/"),"V").concat(N.join("/"),"H").concat(this.stateHash,"B").concat(l).concat(v?"T":"");if(!this._programCache[W]){const q=lF(this.gl,{vs:n,fs:i,modules:w,inject:c,defines:o,hookFunctions:this._hookFunctions,transpileToGLSL100:v});this._programCache[W]=new lA(this.gl,{hash:W,vs:q.vs,fs:q.fs,varyings:d,bufferMode:l}),this._getUniforms[W]=q.getUniforms||(oe=>{}),this._useCounts[W]=0}return this._useCounts[W]++,this._programCache[W]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),i={};let o=0;for(let c=0,d=this._defaultModules.length;c<d;++c){const l=this._defaultModules[c],v=l.name;n[o++]=l,i[v]=!0}for(let c=0,d=e.length;c<d;++c){const l=e[c],v=l.name;i[v]||(n[o++]=l,i[v]=!0)}return n.length=o,n}}const C4={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function M4(t,e,n){const i={};let o=e.indices;for(const c in e.attributes){const d=e.attributes[c],l=L4(c,n);if(c==="indices")o=d;else if(d.constant)i[l]=d.value;else{const v=d.value,w={...d};delete w.value,i[l]=[new _n(t,v),w],k4(c,w)}}if(o){const c=o.value||o;ht(c instanceof Uint16Array||c instanceof Uint32Array,'attribute array for "indices" must be of integer type');const d={size:1,isIndexed:o.isIndexed===void 0?!0:o.isIndexed};i.indices=[new _n(t,{data:c,target:34963}),d]}return i}function L4(t,e){const{attributeMap:n=C4}=e||{};return n&&n[t]||t}function k4(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}ht(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const Sc=2,R4=1e4,D4="Model needs drawMode and vertexCount",pE=()=>{},z4={};class ym{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i=$a("model")}=n;ht(qm(e)),this.id=i,this.gl=e,this.id=n.id||$a("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||kd.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:i,fs:o,modules:c,defines:d,inject:l,varyings:v,bufferMode:w,transpileToGLSL100:C}=e;this.programProps={program:n,vs:i,fs:o,modules:c,defines:d,inject:l,varyings:v,bufferMode:w,transpileToGLSL100:C},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},ht(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),D4)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:i,fs:o,modules:c,defines:d,inject:l,varyings:v,bufferMode:w,transpileToGLSL100:C}=e;this.programProps={program:n,vs:i,fs:o,modules:c,defines:d,inject:l,varyings:v,bufferMode:w,transpileToGLSL100:C},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return ht(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return ht(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=M4(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(au(e))return this;const n={};for(const i in e){const o=e[i];n[i]=o.getValue?o.getValue():o}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return Zv(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:i,uniforms:o={},attributes:c={},transformFeedback:d=this.transformFeedback,parameters:l={},vertexArray:v=this.vertexArray}=e;this.setAttributes(c),this.updateModuleSettings(n),this.setUniforms(o);let w;Et.priority>=Sc&&(w=this._logDrawCallStart(Sc));const C=this.vertexArray.getDrawParams(),{isIndexed:L=C.isIndexed,indexType:P=C.indexType,indexOffset:N=C.indexOffset,vertexArrayInstanced:X=C.isInstanced}=this.props;X&&!this.isInstanced&&Et.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:ee,instanceCount:me}=this,{onBeforeRender:Y=pE,onAfterRender:W=pE}=this.props;Y(),this.program.setUniforms(this.uniforms);const q=this.program.draw(Object.assign(z4,e,{logPriority:w,uniforms:null,framebuffer:i,parameters:l,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:v,transformFeedback:d,isIndexed:L,indexType:P,isInstanced:ee,instanceCount:me,offset:L?N:0}));return W(),Et.priority>=Sc&&this._logDrawCallEnd(w,v,i),q}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:i,unbindModels:o=[]}=e;let{parameters:c}=e;i&&this._setFeedbackBuffers(i),n&&(c=Object.assign({},c,{35977:n})),o.forEach(d=>d.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:c}))}finally{o.forEach(d=>d.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Et.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:i,fs:o,modules:c,inject:d,defines:l,varyings:v,bufferMode:w,transpileToGLSL100:C}=this.programProps;n=this.programManager.get({vs:i,fs:o,modules:c,inject:d,defines:l,varyings:v,bufferMode:w,transpileToGLSL100:C}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}ht(n instanceof lA,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new EO(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof _n&&n.delete()}}_setAnimationProps(e){this.animated&&ht(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(au(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new cA(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:R4;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),Et.group(Sc,">>> DRAWING MODEL ".concat(this.id),{collapsed:Et.level<=2})(),e}_logDrawCallEnd(e,n,i,o){if(e===void 0)return;const c=AO({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:d,unusedTable:l,unusedCount:v}=Qw({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:w,count:C}=Qw({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});C>0&&Et.log("MISSING UNIFORMS",Object.keys(w))(),v>0&&Et.log("UNUSED UNIFORMS",Object.keys(l))();const L=IO(this.vertexArray.configuration);Et.table(e,c)(),Et.table(e,d)(),Et.table(e+1,L)(),o&&o.log({logLevel:Sc,message:"Rendered to ".concat(o.id)}),Et.groupEnd(Sc)()}}class O4{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:o}=n;return{attributes:Object.assign({},i,e.attributes),transformFeedback:o}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],i=e?n[e]:null;return i?i instanceof _n?i:i.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,i=this.getBuffer(n);return i?i.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&ht(Zt(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const o in this.feedbackMap){const c=this.feedbackMap[o];o in n&&(i[c]=o)}Object.assign(i,e.feedbackBuffers);for(const o in i){const c=i[o];if(typeof c=="string"){const d=n[c],{byteLength:l,usage:v,accessor:w}=d;i[o]=this._createNewBuffer(o,{byteLength:l,usage:v,accessor:w})}}return i}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:i})}_setupTransformFeedback(e,n){let{model:i}=n;const{program:o}=i;e.transformFeedback=new cA(this.gl,{program:o,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),o=this._getNextIndex();this.bindings[o]=this._updateBinding(this.bindings[o],{sourceBuffers:n,feedbackBuffers:i})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(const o in this.feedbackMap){const c=this.feedbackMap[o];n[o]=e.feedbackBuffers[c],i[c]=e.sourceBuffers[o],ht(i[c]instanceof _n)}return{sourceBuffers:n,feedbackBuffers:i}}_createNewBuffer(e,n){const i=new _n(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const F4="transform_uSampler_",vm="transform_uSize_",mE="transform_position";function B4(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:i,targetTexture:o}=t,d=Object.keys(n).length,l=null;const v={};let w=e,C={};if(d>0||i){const L=w.split(`
`),P=L.slice();if(L.forEach((N,X,ee)=>{if(d>0){const me=G4(N,n);if(me){const{updatedLine:Y,inject:W}=me;P[X]=Y,C=g0([C,W]),Object.assign(v,me.samplerTextureMap),d--}}i&&!l&&(l=j4(N,i))}),i){ht(o);const N="".concat(vm).concat(i),X="uniform vec2 ".concat(N,`;
`),ee="     vec2 ".concat(mE," = transform_getPos(").concat(N,`);
     gl_Position = vec4(`).concat(mE,`, 0, 1.);
`);C=g0([C,{"vs:#decl":X,"vs:#main-start":ee}])}w=P.join(`
`)}return{vs:w,targetTextureType:l,inject:C,samplerTextureMap:v}}function N4(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=t;const o={};let c,d;n&&({width:c,height:d}=i,o["".concat(vm).concat(n)]=[c,d]);for(const l in e)({width:c,height:d}=e[l]),o["".concat(vm).concat(l)]=[c,d];return o}function U4(t){return gA(t,["attribute","in"])}function V4(t){const e="".concat(F4).concat(t),n="".concat(vm).concat(t),i="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:i}}function j4(t,e){const n=gA(t,["varying","out"]);return n&&n.name===e?n.type:null}function G4(t,e){const n={},i=U4(t);if(!i)return null;const{type:o,name:c}=i;if(c&&e[c]){const d="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:l,sizeName:v,uniformDeclerations:w}=V4(c),C=_F(o),L="  ".concat(o," ").concat(c," = transform_getInput(").concat(l,", ").concat(v,").").concat(C,`;
`);return n[l]=c,{updatedLine:d,inject:{"vs:#decl":w,"vs:#main-start":L},samplerTextureMap:n}}return null}const $4={10241:9728,10240:9728,10242:33071,10243:33071},H4="transform_output";class W4{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:i,framebuffer:o,targetTexture:c}=this.bindings[this.currentIndex],d=Object.assign({},n,e.attributes),l=Object.assign({},e.uniforms),v=Object.assign({},e.parameters);let w=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){d.transform_elementID=this.elementIDBuffer;for(const L in this.samplerTextureMap){const P=this.samplerTextureMap[L];l[L]=i[P]}this._setSourceTextureParameters();const C=N4({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:c});Object.assign(l,C)}return this.hasTargetTexture&&(w=!1,v.viewport=[0,0,o.width,o.height]),{attributes:d,framebuffer:o,uniforms:l,discard:w,parameters:v}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],i=Xm(n);if(!e)return i;const o=i.constructor,c=yF(this.targetTextureType),d=new o(i.length*c/4);let l=0;for(let v=0;v<i.length;v+=4)for(let w=0;w<c;w++)d[l++]=i[v+w];return d}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:i}=e;if(i instanceof Vs)return i;const o=n[i];return o?(this._targetRefTexName=i,this._createNewTexture(o)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:i={},_targetTexture:o}=e,c=this._createTargetTexture({sourceTextures:i,textureOrReference:o});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:i,targetTexture:c}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((i,o,c)=>{c[o]=o}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new _n(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),o=this._getNextIndex();this.bindings[o]=this._updateBinding(this.bindings[o],{sourceTextures:n,targetTexture:i})}}_updateBinding(e,n){const{sourceBuffers:i,sourceTextures:o,targetTexture:c}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,o),Object.assign(e.sourceBuffers,i),c){e.targetTexture=c;const{width:d,height:l}=c,{framebuffer:v}=e;v?(v.update({attachments:{36064:c},resizeAttachments:!1}),v.resize({width:d,height:l})):e.framebuffer=new xi(this.gl,{id:"transform-framebuffer",width:d,height:l,attachments:{36064:c}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const i in n)n[i].setParameters($4)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}_createNewTexture(e){const n=dz(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:i}=this.bindings[this.currentIndex],{vs:o,uniforms:c,targetTextureType:d,inject:l,samplerTextureMap:v}=B4({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),w=g0([e.inject||{},l]);this.targetTextureType=d,this.samplerTextureMap=v;const C=e._fs||_A({version:oA(o),input:this.targetTextureVarying,inputType:d,output:H4}),L=this.hasSourceTextures||this.targetTextureVarying?[I4].concat(e.modules||[]):e.modules;return{vs:o,fs:C,modules:L,uniforms:c,inject:w}}}class ex{static isSupported(e){return Zt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:i}=this;e&&e.delete(),n&&n.delete(),i&&i.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,i=this._updateDrawOptions(e);n&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=e||i.swap();ht(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n){const o=i.getData(e);if(o)return o}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)i.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new ym(n,Object.assign({},e,{fs:e.fs||_A({version:oA(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const o of i)n=o.updateModelProps(n);return n}_buildResourceTransforms(e,n){q4(n)&&(this.bufferTransform=new O4(e,n)),Z4(n)&&(this.textureTransform=new W4(e,n)),ht(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const o of i)n=Object.assign(n,o.getDrawOptions(n));return n}}function q4(t){return!!(!au(t.feedbackBuffers)||!au(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function Z4(t){return!!(!au(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const gE={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class SA{static get DRAW_MODE(){return gE}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=$a("geometry"),drawMode:i=gE.TRIANGLES,attributes:o={},indices:c=null,vertexCount:d=null}=e;this.id=n,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(o,c),this.vertexCount=d||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const i in e){let o=e[i];o=ArrayBuffer.isView(o)?{value:o}:o,ht(ArrayBuffer.isView(o.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!o.size&&(o.size=3),i==="indices"?(ht(!this.indices),this.indices=o):this.attributes[i]=o}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const o in e){const c=e[o],{value:d,size:l,constant:v}=c;!v&&d&&l>=1&&(i=Math.min(i,d.length/l))}return ht(Number.isFinite(i)),i}}let X4=1,Y4=1;class AA{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:o=1,repeat:c=1}=e,d=X4++,l={time:0,delay:n,duration:i,rate:o,repeat:c};return this._setChannelTime(l,this.time),this.channels.set(d,l),d}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const o of n)this._setChannelTime(o,this.time);const i=this.animations.values();for(const o of i){const{animation:c,channel:d}=o;c.setTime(this.getTime(d))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=Y4++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,o=e.duration*e.repeat;i>=o?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}const K4=[255,255,255],J4=1;let Q4=0;class PA{constructor(e={}){V(this,"id",void 0),V(this,"color",void 0),V(this,"intensity",void 0),V(this,"type","ambient");const{color:n=K4}=e,{intensity:i=J4}=e;this.id=e.id||"ambient-".concat(Q4++),this.color=n,this.intensity=i}}const eB=[255,255,255],tB=1,nB=[0,0,-1];let iB=0;class _E{constructor(e={}){V(this,"id",void 0),V(this,"color",void 0),V(this,"intensity",void 0),V(this,"type","directional"),V(this,"direction",void 0),V(this,"shadow",void 0);const{color:n=eB}=e,{intensity:i=tB}=e,{direction:o=nB}=e,{_shadow:c=!1}=e;this.id=e.id||"directional-".concat(iB++),this.color=n,this.intensity=i,this.type="directional",this.direction=new mo(o).normalize().toArray(),this.shadow=c}getProjectedLight(e){return this}}class rB{constructor(e,n={id:"pass"}){V(this,"id",void 0),V(this,"gl",void 0),V(this,"props",void 0);const{id:i}=n;this.id=i,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class tx extends rB{constructor(...e){super(...e),V(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return Wo(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:i,viewports:o,views:c,onViewportActive:d,clearStack:l=!0,clearCanvas:v=!0}=e;e.pass=e.pass||"unknown";const w=this.gl;v&&oB(w,n),l&&(this._lastRenderIndex=-1);const C=[];for(const L of o){const P=c&&c[L.id];d==null||d(L);const N=this._getDrawLayerParams(L,e),X=L.subViewports||[L];for(const ee of X){const me=this._drawLayersInViewport(w,{target:n,moduleParameters:i,viewport:ee,view:P,pass:e.pass,layers:e.layers},N);C.push(me)}}return C}_getDrawLayerParams(e,{layers:n,pass:i,isPicking:o=!1,layerFilter:c,cullRect:d,effects:l,moduleParameters:v},w=!1){const C=[],L=IA(this._lastRenderIndex+1),P={layer:n[0],viewport:e,isPicking:o,renderPass:i,cullRect:d},N={};for(let X=0;X<n.length;X++){const ee=n[X],me=this._shouldDrawLayer(ee,P,c,N),Y={shouldDrawLayer:me};me&&!w&&(Y.layerRenderIndex=L(ee,me),Y.moduleParameters=this._getModuleParameters(ee,l,i,v),Y.layerParameters=this.getLayerParameters(ee,X,e)),C[X]=Y}return C}_drawLayersInViewport(e,{layers:n,moduleParameters:i,pass:o,target:c,viewport:d,view:l},v){const w=sB(e,{moduleParameters:i,target:c,viewport:d});if(l&&l.props.clear){const L=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;Ns(e,{scissorTest:!0,scissor:w},()=>Zv(e,L))}const C={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};Wo(e,{viewport:w});for(let L=0;L<n.length;L++){const P=n[L],{shouldDrawLayer:N,layerRenderIndex:X,moduleParameters:ee,layerParameters:me}=v[L];if(N&&P.props.pickable&&C.pickableCount++,P.isComposite)C.compositeCount++;else if(N){C.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,X),ee.viewport=d;try{P._drawLayer({moduleParameters:ee,uniforms:{layerIndex:X},parameters:me})}catch(Y){P.raiseError(Y,"drawing ".concat(P," to ").concat(o))}}}return C}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,i){return e.props.parameters}_shouldDrawLayer(e,n,i,o){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let d=e.parent;for(;d;){if(!d.props.visible||!d.filterSubLayer(n))return!1;n.layer=d,d=d.parent}if(i){const l=n.layer.id;if(l in o||(o[l]=i(n)),!o[l])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,i,o){var c;const d=Object.assign(Object.create(((c=e.internalState)===null||c===void 0?void 0:c.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:ou(this.gl)});if(n)for(const v of n){var l;Object.assign(d,(l=v.getModuleParameters)===null||l===void 0?void 0:l.call(v,e))}return Object.assign(d,this.getModuleParameters(e,n),o)}}function IA(t=0,e={}){const n={},i=(o,c)=>{const d=o.props._offset,l=o.id,v=o.parent&&o.parent.id;let w;if(v&&!(v in e)&&i(o.parent,!1),v in n){const C=n[v]=n[v]||IA(e[v],e);w=C(o,c),n[l]=C}else Number.isFinite(d)?(w=d+(e[v]||0),n[l]=null):w=t;return c&&w>=t&&(t=w+1),e[l]=w,w};return i}function sB(t,{moduleParameters:e,target:n,viewport:i}){const o=n&&n.id!=="default-framebuffer",c=e&&e.devicePixelRatio||ou(t),d=o?n.height:t.drawingBufferHeight,l=i;return[l.x*c,d-(l.y+l.height)*c,l.width*c,l.height*c]}function oB(t,e){const n=e?e.width:t.drawingBufferWidth,i=e?e.height:t.drawingBufferHeight;Wo(t,{viewport:[0,0,n,i]}),t.clear(16640)}class aB extends tx{constructor(e,n){super(e,n),V(this,"shadowMap",void 0),V(this,"depthBuffer",void 0),V(this,"fbo",void 0),this.shadowMap=new Vs(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new Vc(e,{format:33189,width:1,height:1}),this.fbo=new xi(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const n=this.fbo;Ns(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=e.viewports[0],o=ou(this.gl),c=i.width*o,d=i.height*o;(c!==n.width||d!==n.height)&&n.resize({width:c,height:d}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const CA="#define SMOOTH_EDGE_RADIUS 0.5",lB=`
`.concat(CA,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),cB=`
`.concat(CA,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),uB={name:"geometry",vs:lB,fs:cB},hB=Object.keys(tn).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(tn[t],";")).join(""),dB=Object.keys(uo).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(uo[t],";")).join(""),fB=Object.keys(h0).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(h0[t],";")).join(""),pB="".concat(hB,`
`).concat(dB,`
`).concat(fB,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function mB(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function Rd(t){let e={},n;return i=>{for(const o in i)if(!mB(i[o],e[o])){n=t(i),e=i;break}return n}}const yE=[0,0,0,0],gB=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],MA=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_B=[0,0,0],LA=[0,0,0],yB=Rd(bB);function kA(t,e,n=LA){n.length<3&&(n=[n[0],n[1],0]);let i=n,o,c=!0;switch(e===tn.LNGLAT_OFFSETS||e===tn.METER_OFFSETS?o=n:o=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case uo.WEB_MERCATOR:(e===tn.LNGLAT||e===tn.CARTESIAN)&&(o=[0,0,0],c=!1);break;case uo.WEB_MERCATOR_AUTO_OFFSET:e===tn.LNGLAT?i=o:e===tn.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],o=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case uo.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case uo.GLOBE:c=!1,o=null;break;default:c=!1}return{geospatialOrigin:o,shaderCoordinateOrigin:i,offsetMode:c}}function vB(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:o}=t;let{viewMatrix:c,viewProjectionMatrix:d}=t,l=yE,v=yE,w=t.cameraPosition;const{geospatialOrigin:C,shaderCoordinateOrigin:L,offsetMode:P}=kA(t,e,n);return P&&(v=t.projectPosition(C||L),w=[w[0]-v[0],w[1]-v[1],w[2]-v[2]],v[3]=1,l=Ld([],v,d),c=i||c,d=kl([],o,c),d=kl([],d,gB)),{viewMatrix:c,viewProjectionMatrix:d,projectionCenter:l,originCommon:v,cameraPosCommon:w,shaderCoordinateOrigin:L,geospatialOrigin:C}}function xB({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=tn.DEFAULT,coordinateOrigin:o=LA,autoWrapLongitude:c=!1}){i===tn.DEFAULT&&(i=t.isGeospatial?tn.LNGLAT:tn.CARTESIAN);const d=yB({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:o});return d.project_uWrapLongitude=c,d.project_uModelMatrix=n||MA,d}function bB({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:o,viewProjectionMatrix:c,originCommon:d,cameraPosCommon:l,shaderCoordinateOrigin:v,geospatialOrigin:w}=vB(t,n,i),C=t.getDistanceScales(),L=[t.width*e,t.height*e],P=Ld([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,N={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:v,project_uCommonOrigin:d.slice(0,3),project_uCenter:o,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:L,project_uDevicePixelRatio:e,project_uFocalDistance:P,project_uCommonUnitsPerMeter:C.unitsPerMeter,project_uCommonUnitsPerWorldUnit:C.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:_B,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:c,project_uModelMatrix:MA,project_uCameraPosition:l};if(w){const X=t.getDistanceScales(w);switch(n){case tn.METER_OFFSETS:N.project_uCommonUnitsPerWorldUnit=X.unitsPerMeter,N.project_uCommonUnitsPerWorldUnit2=X.unitsPerMeter2;break;case tn.LNGLAT:case tn.LNGLAT_OFFSETS:t._pseudoMeters||(N.project_uCommonUnitsPerMeter=X.unitsPerMeter),N.project_uCommonUnitsPerWorldUnit=X.unitsPerDegree,N.project_uCommonUnitsPerWorldUnit2=X.unitsPerDegree2;break;case tn.CARTESIAN:N.project_uCommonUnitsPerWorldUnit=[1,1,X.unitsPerMeter[2]],N.project_uCommonUnitsPerWorldUnit2=[0,0,X.unitsPerMeter2[2]];break}}return N}const wB={};function EB(t=wB){return"viewport"in t?xB(t):{}}const nx={name:"project",dependencies:[bF,uB],vs:pB,getUniforms:EB};function TB(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Yc(t,e){const n=Ld([],e,t);return o4(n,n,1/n[3]),n}function vE(t,e){const n=t%e;return n<0?e+n:n}function b0(t,e,n){return t<e?e:t>n?n:t}function SB(t){return Math.log(t)*Math.LOG2E}const ix=Math.log2||SB;function qo(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const zs=Math.PI,RA=zs/4,vs=zs/180,w0=180/zs,du=512,xm=4003e4,hp=85.051129,AB=1.5;function PB(t){return ix(t)}function bm(t){const[e,n]=t;qo(Number.isFinite(e)),qo(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=e*vs,o=n*vs,c=du*(i+zs)/(2*zs),d=du*(zs+Math.log(Math.tan(RA+o*.5)))/(2*zs);return[c,d]}function fu(t){const[e,n]=t,i=e/du*(2*zs)-zs,o=2*(Math.atan(Math.exp(n/du*(2*zs)-zs))-RA);return[i*w0,o*w0]}function IB(t){const{latitude:e}=t;qo(Number.isFinite(e));const n=Math.cos(e*vs);return PB(xm*n)-9}function ey(t){const e=Math.cos(t*vs);return du/xm/e}function E0(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;qo(Number.isFinite(e)&&Number.isFinite(n));const o=du,c=Math.cos(e*vs),d=o/360,l=d/c,v=o/xm/c,w={unitsPerMeter:[v,v,v],metersPerUnit:[1/v,1/v,1/v],unitsPerDegree:[d,l,v],degreesPerUnit:[1/d,1/l,1/v]};if(i){const C=vs*Math.tan(e*vs)/c,L=d*C/2,P=o/xm*C,N=P/l*v;w.unitsPerDegree2=[0,L,P],w.unitsPerMeter2=[N,0,N]}return w}function DA(t,e){const[n,i,o]=t,[c,d,l]=e,{unitsPerMeter:v,unitsPerMeter2:w}=E0({longitude:n,latitude:i,highPrecision:!0}),C=bm(t);C[0]+=c*(v[0]+w[0]*d),C[1]+=d*(v[1]+w[1]*d);const L=fu(C),P=(o||0)+(l||0);return Number.isFinite(o)||Number.isFinite(l)?[L[0],L[1],P]:L}function CB(t){const{height:e,pitch:n,bearing:i,altitude:o,scale:c,center:d}=t,l=TB();_m(l,l,[0,0,-o]),wA(l,l,-n*vs),EA(l,l,i*vs);const v=c/e;return Qv(l,l,[v,v,v]),d&&_m(l,l,OF([],d)),l}function MB(t){const{width:e,height:n,altitude:i,pitch:o=0,offset:c,center:d,scale:l,nearZMultiplier:v=1,farZMultiplier:w=1}=t;let{fovy:C=wm(AB)}=t;i!==void 0&&(C=wm(i));const L=C*vs,P=o*vs,N=zA(C);let X=N;d&&(X+=d[2]*l/Math.cos(P)/n);const ee=L*(.5+(c?c[1]:0)/n),me=Math.sin(ee)*X/Math.sin(b0(Math.PI/2-P-ee,.01,Math.PI-.01)),Y=Math.sin(P)*me+X,W=X*10,q=Math.min(Y*w,W);return{fov:L,aspect:e/n,focalDistance:N,near:v,far:q}}function wm(t){return 2*Math.atan(.5/t)*w0}function zA(t){return .5/Math.tan(.5*t*vs)}function OA(t,e){const[n,i,o=0]=t;return qo(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(o)),Yc(e,[n,i,o,1])}function rx(t,e,n=0){const[i,o,c]=t;if(qo(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(c))return Yc(e,[i,o,c,1]);const d=Yc(e,[i,o,0,1]),l=Yc(e,[i,o,1,1]),v=d[2],w=l[2],C=v===w?0:((n||0)-v)/(w-v);return vA([],d,l,C)}function LB(t){const{width:e,height:n,bounds:i,minExtent:o=0,maxZoom:c=24,offset:d=[0,0]}=t,[[l,v],[w,C]]=i,L=kB(t.padding),P=bm([l,b0(C,-hp,hp)]),N=bm([w,b0(v,-hp,hp)]),X=[Math.max(Math.abs(N[0]-P[0]),o),Math.max(Math.abs(N[1]-P[1]),o)],ee=[e-L.left-L.right-Math.abs(d[0])*2,n-L.top-L.bottom-Math.abs(d[1])*2];qo(ee[0]>0&&ee[1]>0);const me=ee[0]/X[0],Y=ee[1]/X[1],W=(L.right-L.left)/2/me,q=(L.top-L.bottom)/2/Y,oe=[(N[0]+P[0])/2+W,(N[1]+P[1])/2+q],ye=fu(oe),Se=Math.min(c,ix(Math.abs(Math.min(me,Y))));return qo(Number.isFinite(Se)),{longitude:ye[0],latitude:ye[1],zoom:Se}}function kB(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(qo(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const xE=Math.PI/180;function RB(t,e=0){const{width:n,height:i,unproject:o}=t,c={targetZ:e},d=o([0,i],c),l=o([n,i],c);let v,w;const C=t.fovy?.5*t.fovy*xE:Math.atan(.5/t.altitude),L=(90-t.pitch)*xE;return C>L-.01?(v=bE(t,0,e),w=bE(t,n,e)):(v=o([0,0],c),w=o([n,0],c)),[d,l,w,v]}function bE(t,e,n){const{pixelUnprojectionMatrix:i}=t,o=Yc(i,[e,0,1,1]),c=Yc(i,[e,t.height,1,1]),l=(n*t.distanceScales.unitsPerMeter[2]-o[2])/(c[2]-o[2]),v=vA([],o,c,l),w=fu(v);return w.push(n),w}const wE=512;function DB(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:o,latitude:c,zoom:d,bearing:l=0}=t;(o<-180||o>180)&&(o=vE(o+180,360)-180),(l<-180||l>180)&&(l=vE(l+180,360)-180);const v=ix(n/wE);if(d<=v)d=v,c=0;else{const w=n/2/Math.pow(2,d),C=fu([0,w])[1];if(c<C)c=C;else{const L=fu([0,wE-w])[1];c>L&&(c=L)}}return{width:e,height:n,longitude:o,latitude:c,zoom:d,pitch:i,bearing:l}}const zB=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,OB=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,FB=Rd(jB),BB=Rd(GB),NB=[0,0,0,1],UB=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function VB(t,e){const[n,i,o]=t,c=rx([n,i,o],e);return Number.isFinite(o)?c:[c[0],c[1],0]}function jB({viewport:t,center:e}){return new go(t.viewProjectionMatrix).invert().transform(e)}function GB({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,o=t.isGeospatial?void 0:1,c=[[0,0,o],[t.width,0,o],[0,t.height,o],[t.width,t.height,o],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(d=>VB(d,i));for(const d of e){const l=d.clone().translate(new mo(t.center).negate()),v=c.map(C=>l.transform(C)),w=new go().ortho({left:Math.min(...v.map(C=>C[0])),right:Math.max(...v.map(C=>C[0])),bottom:Math.min(...v.map(C=>C[1])),top:Math.max(...v.map(C=>C[1])),near:Math.min(...v.map(C=>-C[2])),far:Math.max(...v.map(C=>-C[2]))});n.push(w.multiplyRight(d))}return n}function $B(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||NB,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},o=FB({viewport:t.viewport,center:e.project_uCenter}),c=[],d=BB({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let l=0;l<t.shadowMatrices.length;l++){const v=d[l],w=v.clone().translate(new mo(t.viewport.center).negate());e.project_uCoordinateSystem===tn.LNGLAT&&e.project_uProjectionMode===uo.WEB_MERCATOR?(d[l]=w,c[l]=o):(d[l]=v.clone().multiplyRight(UB),c[l]=w.transform(o))}for(let l=0;l<d.length;l++)i["shadow_uViewProjectionMatrices[".concat(l,"]")]=d[l],i["shadow_uProjectCenters[".concat(l,"]")]=c[l],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(l)]=t.shadowMaps[l]:i["shadow_uShadowMap".concat(l)]=t.dummyShadowMap;return i}const ty={name:"shadow",dependencies:[nx],vs:zB,fs:OB,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?$B(t,e):{}},HB={color:[255,255,255],intensity:1},EE=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],WB=[0,0,0,200/255];class sx{constructor(e={}){V(this,"id","lighting-effect"),V(this,"props",void 0),V(this,"shadowColor",WB),V(this,"shadow",void 0),V(this,"ambientLight",void 0),V(this,"directionalLights",void 0),V(this,"pointLights",void 0),V(this,"shadowPasses",[]),V(this,"shadowMaps",[]),V(this,"dummyShadowMap",null),V(this,"programManager",void 0),V(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.props=e}preRender(e,{layers:n,layerFilter:i,viewports:o,onViewportActive:c,views:d}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=kd.getDefaultProgramManager(e),ty&&this.programManager.addDefaultModule(ty)),this.dummyShadowMap||(this.dummyShadowMap=new Vs(e,{width:1,height:1}));for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:n,layerFilter:i,viewports:o,onViewportActive:c,views:d,moduleParameters:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(ty),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const i=new go().lookAt({eye:new mo(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new aB(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new PA(HB),this.directionalLights.push(new _E(EE[0]),new _E(EE[1])))}}class qB{constructor(e={}){V(this,"_pool",[]),V(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:i=1,type:o,padding:c=0,copy:d=!1,initialize:l=!1,maxCount:v}){const w=o||e&&e.constructor||Float32Array,C=n*i+c;if(ArrayBuffer.isView(e)){if(C<=e.length)return e;if(C*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new w(e.buffer,0,C)}let L=1/0;v&&(L=v*i+c);const P=this._allocate(w,C,l,L);return e&&d?P.set(e):l||P.fill(0,0,4),this._release(e),P}release(e){this._release(e)}_allocate(e,n,i,o){let c=Math.max(Math.ceil(n*this.opts.overAlloc),1);c>o&&(c=o);const d=this._pool,l=e.BYTES_PER_ELEMENT*c,v=d.findIndex(w=>w.byteLength>=l);if(v>=0){const w=new e(d.splice(v,1)[0],0,c);return i&&w.fill(0),w}return new e(c)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:o}=i,c=n.findIndex(d=>d.byteLength>=o);c<0?n.push(i):(c>0||n.length<this.opts.poolSize)&&n.splice(c,0,i),n.length>this.opts.poolSize&&n.shift()}}const pu=new qB;function Dh(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ZB(t){return[t[12],t[13],t[14]]}function XB(t){return{left:Ac(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Ac(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Ac(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Ac(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Ac(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Ac(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const TE=new mo;function Ac(t,e,n,i){TE.set(t,e,n);const o=TE.len();return{distance:i/o,normal:new mo(-t/o,-e/o,-n/o)}}function YB(t){return t-Math.fround(t)}let Ph;function ny(t,e){const{size:n=1,startIndex:i=0}=e,o=e.endIndex!==void 0?e.endIndex:t.length,c=(o-i)/n;Ph=pu.allocate(Ph,c,{type:Float32Array,size:n*2});let d=i,l=0;for(;d<o;){for(let v=0;v<n;v++){const w=t[d++];Ph[l+v]=w,Ph[l+v+n]=YB(w)}l+=n*2}return Ph.subarray(0,c*n*2)}function KB(t){let e=null,n=!1;for(const i of t)i&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const JB=Math.PI/180,QB=Dh(),SE=[0,0,0],eN={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function tN({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:o,padding:c,near:d,far:l}){const v=t/e,w=n?new go().orthographic({fovy:i,aspect:v,focalDistance:o,near:d,far:l}):new go().perspective({fovy:i,aspect:v,near:d,far:l});if(c){const{left:C=0,right:L=0,top:P=0,bottom:N=0}=c,X=Ca((C+t-L)/2,0,t)-t/2,ee=Ca((P+e-N)/2,0,e)-e/2;w[8]-=X*2/t,w[9]+=ee*2/e}return w}class xu{constructor(e={}){V(this,"id",void 0),V(this,"x",void 0),V(this,"y",void 0),V(this,"width",void 0),V(this,"height",void 0),V(this,"padding",void 0),V(this,"isGeospatial",void 0),V(this,"zoom",void 0),V(this,"focalDistance",void 0),V(this,"position",void 0),V(this,"modelMatrix",void 0),V(this,"distanceScales",void 0),V(this,"scale",void 0),V(this,"center",void 0),V(this,"cameraPosition",void 0),V(this,"projectionMatrix",void 0),V(this,"viewMatrix",void 0),V(this,"viewMatrixUncentered",void 0),V(this,"viewMatrixInverse",void 0),V(this,"viewProjectionMatrix",void 0),V(this,"pixelProjectionMatrix",void 0),V(this,"pixelUnprojectionMatrix",void 0),V(this,"resolution",void 0),V(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||eN,this.focalDistance=e.focalDistance||1,this.position=e.position||SE,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?uo.WEB_MERCATOR:uo.WEB_MERCATOR_AUTO_OFFSET:uo.IDENTITY}equals(e){return e instanceof xu?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&md(e.projectionMatrix,this.projectionMatrix)&&md(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const i=this.projectPosition(e),o=OA(i,this.pixelProjectionMatrix),[c,d]=o,l=n?d:this.height-d;return e.length===2?[c,l]:[c,l,o[2]]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[o,c,d]=e,l=n?c:this.height-c,v=i&&i*this.distanceScales.unitsPerMeter[2],w=rx([o,l,d],this.pixelUnprojectionMatrix,v),[C,L,P]=this.unprojectPosition(w);return Number.isFinite(d)?[C,L,P]:Number.isFinite(i)?[C,L,i]:[C,L]}projectPosition(e){const[n,i]=this.projectFlat(e),o=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,o]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),o=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,o]}projectFlat(e){if(this.isGeospatial){const n=bm(e);return n[1]=Ca(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?fu(e):e}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,0],n),o=this.unproject([this.width,0],n),c=this.unproject([0,this.height],n),d=this.unproject([this.width,this.height],n);return[Math.min(i[0],o[0],c[0],d[0]),Math.min(i[1],o[1],c[1],d[1]),Math.max(i[0],o[0],c[0],d[0]),Math.max(i[1],o[1],c[1],d[1])]}getDistanceScales(e){return e?E0({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:i=1,height:o=1}){return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+o}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,XB(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=IB({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||E0({latitude:i,longitude:n}));const o=Math.pow(2,this.zoom);this.scale=o;const{position:c,modelMatrix:d}=e;let l=SE;if(c&&(l=d?new go(d).transformAsVector(c,[]):c),this.isGeospatial){const v=this.projectPosition([n,i,0]);this.center=new mo(l).scale(this.distanceScales.unitsPerMeter).add(v)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:n=QB,projectionMatrix:i=null,orthographic:o=!1,fovyRadians:c,fovy:d=75,near:l=.1,far:v=1e3,padding:w=null,focalDistance:C=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new go().multiplyRight(n).translate(new mo(this.center).negate()),this.projectionMatrix=i||tN({width:this.width,height:this.height,orthographic:o,fovyRadians:c||d*JB,focalDistance:C,padding:w,near:l,far:v});const L=Dh();kl(L,L,this.projectionMatrix),kl(L,L,this.viewMatrix),this.viewProjectionMatrix=L,this.viewMatrixInverse=v0([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=ZB(this.viewMatrixInverse);const P=Dh(),N=Dh();Qv(P,P,[this.width/2,-this.height/2,1]),_m(P,P,[1,-1,0]),kl(N,P,this.viewProjectionMatrix),this.pixelProjectionMatrix=N,this.pixelUnprojectionMatrix=v0(Dh(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||yn.warn("Pixel project matrix not invertible")()}}V(xu,"displayName","Viewport");class mu extends xu{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:o=0,pitch:c=0,bearing:d=0,nearZMultiplier:l=.1,farZMultiplier:v=1.01,nearZ:w,farZ:C,orthographic:L=!1,projectionMatrix:P,repeat:N=!1,worldOffset:X=0,position:ee,padding:me,legacyMeterSizes:Y=!1}=e;let{width:W,height:q,altitude:oe=1.5}=e;const ye=Math.pow(2,o);W=W||1,q=q||1;let Se,Oe=null;if(P)oe=P[5]/2,Se=wm(oe);else{e.fovy?(Se=e.fovy,oe=zA(Se)):Se=wm(oe);let Ve;if(me){const{top:je=0,bottom:ut=0}=me;Ve=[0,Ca((je+q-ut)/2,0,q)-q/2]}Oe=MB({width:W,height:q,scale:ye,center:ee&&[0,0,ee[2]*ey(n)],offset:Ve,pitch:c,fovy:Se,nearZMultiplier:l,farZMultiplier:v}),Number.isFinite(w)&&(Oe.near=w),Number.isFinite(C)&&(Oe.far=C)}let Fe=CB({height:q,pitch:c,bearing:d,scale:ye,altitude:oe});X&&(Fe=new go().translate([512*X,0,0]).multiplyLeft(Fe)),super({...e,width:W,height:q,viewMatrix:Fe,longitude:i,latitude:n,zoom:o,...Oe,fovy:Se,focalDistance:oe}),V(this,"longitude",void 0),V(this,"latitude",void 0),V(this,"pitch",void 0),V(this,"bearing",void 0),V(this,"altitude",void 0),V(this,"fovy",void 0),V(this,"orthographic",void 0),V(this,"_subViewports",void 0),V(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=i,this.zoom=o,this.pitch=c,this.bearing=d,this.altitude=oe,this.fovy=Se,this.orthographic=L,this._subViewports=N?[]:null,this._pseudoMeters=Y,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let o=n;o<=i;o++){const c=o?new mu({...this,worldOffset:o}):this;this._subViewports.push(c)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),o=(e[2]||0)*ey(e[1]);return[n,i,o]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),o=(e[2]||0)/ey(i);return[n,i,o]}addMetersToLngLat(e,n){return DA(e,n)}panByPosition(e,n){const i=rx(n,this.pixelUnprojectionMatrix),o=this.projectFlat(e),c=hE([],o,MF([],i)),d=hE([],this.center,c),[l,v]=this.unprojectFlat(d);return{longitude:l,latitude:v}}getBounds(e={}){const n=RB(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:i,height:o}=this,{longitude:c,latitude:d,zoom:l}=LB({width:i,height:o,bounds:e,...n});return new mu({width:i,height:o,longitude:c,latitude:d,zoom:l})}}V(mu,"displayName","WebMercatorViewport");const AE=[0,0,0];function iy(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof mu){const[o,c,d=0]=t,l=e.getDistanceScales([o,c]);i[2]=d*l.unitsPerMeter[2]}return i}function nN(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:o,fromCoordinateSystem:c,fromCoordinateOrigin:d}=t;return o===tn.DEFAULT&&(o=e.isGeospatial?tn.LNGLAT:tn.CARTESIAN),c===void 0&&(c=o),d===void 0&&(d=i),{viewport:e,coordinateSystem:o,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:c,fromCoordinateOrigin:d}}function FA(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:o,offsetMode:c}){let[d,l,v=0]=t;switch(n&&([d,l,v]=Ld([],[d,l,v,1],n)),i){case tn.LNGLAT:return iy([d,l,v],e,c);case tn.LNGLAT_OFFSETS:return iy([d+o[0],l+o[1],v+(o[2]||0)],e,c);case tn.METER_OFFSETS:return iy(DA(o,[d,l,v]),e,c);case tn.CARTESIAN:default:return e.isGeospatial?[d+o[0],l+o[1],v+o[2]]:e.projectPosition([d,l,v])}}function BA(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:o,modelMatrix:c,fromCoordinateSystem:d,fromCoordinateOrigin:l}=nN(e),{autoOffset:v=!0}=e,{geospatialOrigin:w=AE,shaderCoordinateOrigin:C=AE,offsetMode:L=!1}=v?kA(n,i,o):{},P=FA(t,{viewport:n,modelMatrix:c,coordinateSystem:d,coordinateOrigin:l,offsetMode:L});if(L){const N=n.projectPosition(w||C);HF(P,P,N)}return P}const iN=[255,255,255],rN=1,sN=[0,0,1],oN=[0,0,1];let aN=0;class lN{constructor(e={}){V(this,"id",void 0),V(this,"color",void 0),V(this,"intensity",void 0),V(this,"type","point"),V(this,"position",void 0),V(this,"attenuation",void 0),V(this,"projectedLight",void 0);const{color:n=iN}=e,{intensity:i=rN}=e,{position:o=oN}=e;this.id=e.id||"point-".concat(aN++),this.color=n,this.intensity=i,this.type="point",this.position=o,this.attenuation=cN(e),this.projectedLight={...this}}getProjectedLight({layer:e}){const{projectedLight:n}=this,i=e.context.viewport,{coordinateSystem:o,coordinateOrigin:c}=e.props,d=BA(this.position,{viewport:i,coordinateSystem:o,coordinateOrigin:c,fromCoordinateSystem:i.isGeospatial?tn.LNGLAT:tn.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return n.color=this.color,n.intensity=this.intensity,n.position=d,n}}function cN(t){return t.attenuation?t.attenuation:"intensity"in t?[0,0,t.intensity||0]:sN}const PE={blendFunc:[1,0,32771,0],blendEquation:32774};class NA extends tx{constructor(...e){super(...e),V(this,"pickZ",void 0),V(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:i,viewports:o,onViewportActive:c,pickingFBO:d,deviceRect:{x:l,y:v,width:w,height:C},cullRect:L,effects:P,pass:N="picking",pickZ:X,moduleParameters:ee}){const me=this.gl;this.pickZ=X;const Y=this._resetColorEncoder(X),W=Ns(me,{scissorTest:!0,scissor:[l,v,w,C],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...PE,blend:!X},()=>super.render({target:d,layers:e,layerFilter:n,views:i,viewports:o,onViewportActive:c,cullRect:L,effects:P==null?void 0:P.filter(oe=>oe.useInPicking),pass:N,isPicking:!0,moduleParameters:ee}));return this._colorEncoderState=null,{decodePickingColor:Y&&hN.bind(null,Y),stats:W}}shouldDrawLayer(e){const{pickable:n,operation:i}=e.props;return n&&i.includes("draw")||i.includes("terrain")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,i){const o={...e.props.parameters},{pickable:c,operation:d}=e.props;return this._colorEncoderState?c&&d.includes("draw")&&(Object.assign(o,PE),o.blend=!0,o.blendColor=uN(this._colorEncoderState,e,i)):o.blend=!1,d.includes("terrain")&&(o.blend=!1),o}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function uN(t,e,n){const{byLayer:i,byAlpha:o}=t;let c,d=i.get(e);return d?(d.viewports.push(n),c=d.a):(c=i.size+1,c<=255?(d={a:c,layer:e,viewports:[n]},i.set(e,d),o[c]=d):(yn.warn("Too many pickable layers, only picking the first 255")(),c=0)),[0,0,0,c/255]}function hN(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const Ic={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Em=Symbol.for("component"),Va=Symbol.for("propTypes"),ry=Symbol.for("deprecatedProps"),Kc=Symbol.for("asyncPropDefaults"),Bl=Symbol.for("asyncPropOriginal"),Ma=Symbol.for("asyncPropResolved");function ox(t,e=()=>!0){return Array.isArray(t)?UA(t,e,[]):e(t)?[t]:[]}function UA(t,e,n){let i=-1;for(;++i<t.length;){const o=t[i];Array.isArray(o)?UA(o,e,n):e(o)&&n.push(o)}return n}function dN({target:t,source:e,start:n=0,count:i=1}){const o=e.length,c=i*o;let d=0;for(let l=n;d<o;d++)t[l++]=e[d];for(;d<c;)d<c-d?(t.copyWithin(n+d,n,n+d),d*=2):(t.copyWithin(n+d,n,n+c-d),d=c);return t}class fN{constructor(e,n,i){V(this,"id",void 0),V(this,"context",void 0),V(this,"isLoaded",void 0),V(this,"persistent",void 0),V(this,"_loadCount",0),V(this,"_subscribers",new Set),V(this,"_data",void 0),V(this,"_loader",void 0),V(this,"_error",void 0),V(this,"_content",void 0),this.id=e,this.context=i,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let o=e;typeof e=="string"&&(o=o0(e)),o instanceof Promise?(this.isLoaded=!1,this._loader=o.then(c=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=c)}).catch(c=>{this._loadCount===i&&(this.isLoaded=!0,this._error=c||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const c of this._subscribers)c.onChange(this.getData())}}class pN{constructor({gl:e,protocol:n}){V(this,"protocol",void 0),V(this,"_context",void 0),V(this,"_resources",void 0),V(this,"_consumers",void 0),V(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:i=!1,persistent:o=!0}){let c=this._resources[e];c?c.setData(n,i):(c=new fN(e,n,this._context),this._resources[e]=c),c.persistent=o}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const i in n){const o=n[i],c=this._resources[o.resourceId];c&&c.unsubscribe(o)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:i,requestId:o="default"}){const{_resources:c,protocol:d}=this;e.startsWith(d)&&(e=e.replace(d,""),c[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=c[e];if(this._track(i,o,l,n),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,o){const c=this._consumers,d=c[e]=c[e]||{},l=d[n]||{},v=l.resourceId&&this._resources[l.resourceId];v&&(v.unsubscribe(l),this.prune()),i&&(d[n]=l,l.onChange=o,l.resourceId=i.id,i.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const mN=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,VA={name:"project32",dependencies:[nx],vs:mN},jA={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...b4},gN=[nx],_N=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function yN(t){const e=kd.getDefaultProgramManager(t);for(const n of gN)e.addDefaultModule(n);for(const n of _N)e.addShaderHook(n);return e}const vN="layerManager.setLayers",xN="layerManager.activateViewport";class bN{constructor(e,{deck:n,stats:i,viewport:o,timeline:c}={}){V(this,"layers",void 0),V(this,"context",void 0),V(this,"resourceManager",void 0),V(this,"_lastRenderedLayers",[]),V(this,"_needsRedraw",!1),V(this,"_needsUpdate",!1),V(this,"_nextLayers",null),V(this,"_debug",!1),V(this,"activateViewport",d=>{Qi(xN,this,d),d&&(this.context.viewport=d)}),this.layers=[],this.resourceManager=new pN({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&yN(e),stats:i||new Wv({id:"deck.gl"}),viewport:o||new xu({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:c||new AA,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const o=i.getNeedsRedraw(e);n=n||o}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Qi(vN,this,n,e),this._lastRenderedLayers=e;const i=ox(e,Boolean);for(const o of i)o.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}_updateLayers(e,n){const i={};for(const d of e)i[d.id]?yn.warn("Multiple old layers with same id ".concat(d.id))():i[d.id]=d;const o=[];this._updateSublayersRecursively(n,i,o),this._finalizeOldLayers(i);let c=!1;for(const d of o)if(d.hasUniformTransition()){c="Uniform transition in ".concat(d);break}this._needsUpdate=c,this.layers=o}_updateSublayersRecursively(e,n,i){for(const o of e){o.context=this.context;const c=n[o.id];c===null&&yn.warn("Multiple new layers with same id ".concat(o.id))(),n[o.id]=null;let d=null;try{this._debug&&c!==o&&o.validateProps(),c?(this._transferLayerState(c,o),this._updateLayer(o)):this._initializeLayer(o),i.push(o),d=o.isComposite?o.getSubLayers():null}catch(l){this._handleError("matching",l,o)}d&&this._updateSublayersRecursively(d,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Ic.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Ic.MATCHED,n!==e&&(e.lifecycle=Ic.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Ic.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Ic.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function ho(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!ho(t[i],e[i],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),o=Object.keys(e);if(i.length!==o.length)return!1;for(const c of i)if(!e.hasOwnProperty(c)||!ho(t[c],e[c],n-1))return!1;return!0}return!1}class wN{constructor(e){V(this,"width",void 0),V(this,"height",void 0),V(this,"views",void 0),V(this,"viewState",void 0),V(this,"controllers",void 0),V(this,"timeline",void 0),V(this,"_viewports",void 0),V(this,"_viewportMap",void 0),V(this,"_isUpdating",void 0),V(this,"_needsRedraw",void 0),V(this,"_needsUpdate",void 0),V(this,"_eventManager",void 0),V(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),o={x:e[0],y:e[1]};for(let c=i.length-1;c>=0;--c){const d=i[c];if(d.containsPixel(o)){const l=e.slice();return l[0]-=d.x,l[1]-=d.y,d.unproject(l,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=ox(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!ho(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):yn.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:c=>{var d;return(d=this.getView(e.id))===null||d===void 0?void 0:d.makeViewport({viewState:c,width:this.width,height:this.height})}})}_updateController(e,n,i,o){const c=e.controller;if(c&&i){const d={...n,...c,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!o||o.constructor!==c.type)&&(o=this._createController(e,d)),o&&o.setProps(d),o}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let o=e.length;o--;){const c=e[o],d=this.getViewState(c),l=c.makeViewport({viewState:d,width:this.width,height:this.height});let v=n[c.id];const w=!!c.controller;w&&!v&&(i=!0),(i||!w)&&v&&(v.finalize(),v=null),this.controllers[c.id]=this._updateController(c,d,l,v),l&&this._viewports.unshift(l)}for(const o in n){const c=n[o];c&&!this.controllers[o]&&c.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,o)=>!e[o].equals(n[o]))}}const EN=/([0-9]+\.?[0-9]*)(%|px)/;function xa(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=EN.exec(t);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function ba(t,e){return t.relative?Math.round(t.position*e):t.position}function Ci(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class gu{constructor(e){V(this,"id",void 0),V(this,"viewportInstance",void 0),V(this,"_x",void 0),V(this,"_y",void 0),V(this,"_width",void 0),V(this,"_height",void 0),V(this,"_padding",void 0),V(this,"props",void 0);const{id:n,x:i=0,y:o=0,width:c="100%",height:d="100%",padding:l=null,viewportInstance:v}=e||{};Ci(!v||v instanceof xu),this.viewportInstance=v,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=xa(i),this._y=xa(o),this._width=xa(c),this._height=xa(d),this._padding=l&&{left:xa(l.left||0),right:xa(l.right||0),top:xa(l.top||0),bottom:xa(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&ho(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const o=this.getDimensions({width:e,height:n});return!o.height||!o.width?null:new this.ViewportType({...i,...this.props,...o})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions({width:e,height:n}){const i={x:ba(this._x,e),y:ba(this._y,n),width:ba(this._width,e),height:ba(this._height,n)};return this._padding&&(i.padding={left:ba(this._padding.left,e),top:ba(this._padding.top,n),right:ba(this._padding.right,e),bottom:ba(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Dd{constructor(e){V(this,"_inProgress",void 0),V(this,"_handle",void 0),V(this,"_timeline",void 0),V(this,"time",void 0),V(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)===null||n===void 0||n.call(i,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:o}=this;this._handle=i.addChannel({delay:i.getTime(),duration:o.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const IE=()=>{},T0={BREAK:1,SNAP_TO_END:2,IGNORE:3},TN=t=>t,SN=T0.BREAK;class AN{constructor(e){V(this,"getControllerState",void 0),V(this,"props",void 0),V(this,"propsInTransition",void 0),V(this,"transition",void 0),V(this,"onViewStateChange",void 0),V(this,"onStateChange",void 0),V(this,"_onTransitionUpdate",n=>{const{time:i,settings:{interpolator:o,startProps:c,endProps:d,duration:l,easing:v}}=n,w=v(i/l),C=o.interpolateProps(c,d,w);this.propsInTransition=this.getControllerState({...this.props,...C}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Dd(e.timeline),this.onViewStateChange=e.onViewStateChange||IE,this.onStateChange=e.onStateChange||IE}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let o=i;if(this.transition.inProgress){const{interruption:c,endProps:d}=this.transition.settings;o={...i,...c===T0.SNAP_TO_END?d:this.propsInTransition||i}}this._triggerTransition(o,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===T0.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=this.getControllerState(e),o=this.getControllerState(n).shortestPathFrom(i),c=n.transitionInterpolator,d=c.getDuration?c.getDuration(e,n):n.transitionDuration;if(d===0)return;const l=c.initializeProps(e,o);this.propsInTransition={};const v={duration:d,easing:n.transitionEasing||TN,interpolator:c,interruption:n.transitionInterruption||SN,startProps:l.start,endProps:l.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(v),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class PN{constructor(e){V(this,"_propsToCompare",void 0),V(this,"_propsToExtract",void 0),V(this,"_requiredProps",void 0);const{compare:n,extract:i,required:o}=e;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=o}arePropsEqual(e,n){for(const i of this._propsToCompare)if(!(i in e)||!(i in n)||!md(e[i],n[i]))return!1;return!0}initializeProps(e,n){const i={},o={};for(const c of this._propsToExtract)(c in e||c in n)&&(i[c]=e[c],o[c]=n[c]);return this._checkRequiredProps(i),this._checkRequiredProps(o),{start:i,end:o}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const i=e[n];Ci(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}const IN=["longitude","latitude","zoom","bearing","pitch"],CN=["longitude","latitude","zoom"];class GA extends PN{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:IN,required:CN},super(i.transitionProps),V(this,"opts",void 0),this.opts=i}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:o,around:c}=this.opts;if(o&&c){const d=o(e),l=o(n),v=d.unproject(c);i.start.around=c,Object.assign(i.end,{around:l.project(v),aroundPosition:v,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const o={};for(const c of this._propsToExtract)o[c]=gm(e[c]||0,n[c]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const c=this.opts.makeViewport({...n,...o});Object.assign(o,c.panByPosition(n.aroundPosition,gm(e.around,n.around,i)))}return o}}const wa={transitionDuration:0},MN=300,dp=t=>1-(1-t)*(1-t),Pc={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},bl={};class LN{constructor(e){V(this,"props",void 0),V(this,"state",{}),V(this,"transitionManager",void 0),V(this,"eventManager",void 0),V(this,"onViewStateChange",void 0),V(this,"onStateChange",void 0),V(this,"makeViewport",void 0),V(this,"_controllerState",void 0),V(this,"_events",{}),V(this,"_interactionState",{isDragging:!1}),V(this,"_customEvents",[]),V(this,"_eventStartBlocked",null),V(this,"_panMove",!1),V(this,"invertPan",!1),V(this,"dragMode","rotate"),V(this,"inertia",0),V(this,"scrollZoom",!0),V(this,"dragPan",!0),V(this,"dragRotate",!0),V(this,"doubleClickZoom",!0),V(this,"touchZoom",!0),V(this,"touchRotate",!1),V(this,"keyboard",!0),this.transitionManager=new AN({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:i}=this.props,{offsetCenter:o}=e;return[o.x-n,o.y-i]}isPointInBounds(e,n){const{width:i,height:o}=this.props;if(n&&n.handled)return!1;const c=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=o;return c&&n&&n.stopPropagation(),c}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?MN:0;const{scrollZoom:i=!0,dragPan:o=!0,dragRotate:c=!0,doubleClickZoom:d=!0,touchZoom:l=!0,touchRotate:v=!1,keyboard:w=!0}=e,C=!!this.onViewStateChange;this.toggleEvents(Pc.WHEEL,C&&i),this.toggleEvents(Pc.PAN,C),this.toggleEvents(Pc.PINCH,C&&(l||v)),this.toggleEvents(Pc.TRIPLE_PAN,C&&v),this.toggleEvents(Pc.DOUBLE_TAP,C&&d),this.toggleEvents(Pc.KEYBOARD,C&&w),this.scrollZoom=i,this.dragPan=o,this.dragRotate=c,this.doubleClickZoom=d,this.touchZoom=l,this.touchRotate=v,this.keyboard=w}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,n=null,i={}){const o={...e.getViewportProps(),...n},c=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),c){const d=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:o,interactionState:this._interactionState,oldViewState:d})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const o=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(o,wa,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,wa,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),o=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],c=this.controllerState.pan({pos:o}).panEnd();this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:dp},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,wa,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),o=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],c=this.controllerState.rotate({pos:o}).rotateEnd();this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:dp},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const{speed:i=.01,smooth:o=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:c}=e;let d=2/(1+Math.exp(-Math.abs(c*i)));c<0&&d!==0&&(d=1/d);const l=this.controllerState.zoom({pos:n,scale:d});return this.updateViewport(l,{...this._getTransitionProps({around:n}),transitionDuration:o?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,wa,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,wa,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),o=[i[0],i[1]+=e.velocityY*n/2],c=this.controllerState.rotate({pos:o});this.updateViewport(c,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:dp},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return bl._startPinchRotation=e.rotation,bl._lastPinchEvent=e,this.updateViewport(i,wa,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,o=this.getCenter(e);n=n.zoom({pos:o,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:bl._startPinchRotation-i})}return this.updateViewport(n,wa,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),bl._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=bl;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const o=this.getCenter(e);let c=this.controllerState.rotateEnd();const d=Math.log2(e.scale),l=(d-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),v=Math.pow(2,d+l*n/2);c=c.zoom({pos:o,scale:v}).zoomEnd(),this.updateViewport(c,{...this._getTransitionProps({around:o}),transitionDuration:n,transitionEasing:dp},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const o=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(o,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return bl._startPinchRotation=null,bl._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),o=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(o,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:o,rotateSpeedX:c,rotateSpeedY:d}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let v;const w={};switch(e.srcEvent.code){case"Minus":v=n?l.zoomOut(i).zoomOut(i):l.zoomOut(i),w.isZooming=!0;break;case"Equal":v=n?l.zoomIn(i).zoomIn(i):l.zoomIn(i),w.isZooming=!0;break;case"ArrowLeft":n?(v=l.rotateLeft(c),w.isRotating=!0):(v=l.moveLeft(o),w.isPanning=!0);break;case"ArrowRight":n?(v=l.rotateRight(c),w.isRotating=!0):(v=l.moveRight(o),w.isPanning=!0);break;case"ArrowUp":n?(v=l.rotateUp(d),w.isRotating=!0):(v=l.moveUp(o),w.isPanning=!0);break;case"ArrowDown":n?(v=l.rotateDown(d),w.isRotating=!0):(v=l.moveDown(o),w.isPanning=!0);break;default:return!1}return this.updateViewport(v,this._getTransitionProps(),w),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?wa:e?{...n,transitionInterpolator:new GA({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class kN{constructor(e,n){V(this,"_viewportProps",void 0),V(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const CE=5,RN=1.2;class DN extends kN{constructor(e){const{width:n,height:i,latitude:o,longitude:c,zoom:d,bearing:l=0,pitch:v=0,altitude:w=1.5,position:C=[0,0,0],maxZoom:L=20,minZoom:P=0,maxPitch:N=60,minPitch:X=0,startPanLngLat:ee,startZoomLngLat:me,startRotatePos:Y,startBearing:W,startPitch:q,startZoom:oe,normalize:ye=!0}=e;Ci(Number.isFinite(c)),Ci(Number.isFinite(o)),Ci(Number.isFinite(d)),super({width:n,height:i,latitude:o,longitude:c,zoom:d,bearing:l,pitch:v,altitude:w,maxZoom:L,minZoom:P,maxPitch:N,minPitch:X,normalize:ye,position:C},{startPanLngLat:ee,startZoomLngLat:me,startRotatePos:Y,startBearing:W,startPitch:q,startZoom:oe}),V(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const c=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(c)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:o,startBearing:c,startPitch:d}=this.getState();if(!o||c===void 0||d===void 0)return this;let l;return e?l=this._getNewRotation(e,o,d,c):l={bearing:c+n,pitch:d+i},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:o,startZoomLngLat:c}=this.getState();if(c||(o=this.getViewportProps().zoom,c=this._unproject(n)||this._unproject(e)),!c)return this;const{maxZoom:d,minZoom:l}=this.getViewportProps();let v=o+Math.log2(i);v=Ca(v,l,d);const w=this.makeViewport({...this.getViewportProps(),zoom:v});return this._getUpdatedState({zoom:v,...w.panByPosition(c,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:o,longitude:c}=i;return Math.abs(o-n.bearing)>180&&(i.bearing=o<0?o+360:o-360),Math.abs(c-n.longitude)>180&&(i.longitude=c<0?c+360:c-360),i}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:o}=e;e.zoom=Ca(o,i,n);const{maxPitch:c,minPitch:d,pitch:l}=e;e.pitch=Ca(l,d,c);const{normalize:v=!0}=e;return v&&Object.assign(e,DB(e)),e}_zoomFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,i,o){const c=e[0]-n[0],d=e[1]-n[1],l=e[1],v=n[1],{width:w,height:C}=this.getViewportProps(),L=c/w;let P=0;d>0?Math.abs(C-v)>CE&&(P=d/(v-C)*RN):d<0&&v>CE&&(P=1-l/v),P=Ca(P,-1,1);const{minPitch:N,maxPitch:X}=this.getViewportProps(),ee=o+180*L;let me=i;return P>0?me=i+P*(X-i):P<0&&(me=i-P*(N-i)),{pitch:me,bearing:ee}}}class zN extends LN{constructor(...e){super(...e),V(this,"ControllerState",DN),V(this,"transition",{transitionDuration:300,transitionInterpolator:new GA({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),V(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class $A extends gu{get ViewportType(){return mu}get ControllerType(){return zN}}V($A,"displayName","MapView");const ON=new sx;function FN(t,e){var n,i;const o=(n=t.order)!==null&&n!==void 0?n:1/0,c=(i=e.order)!==null&&i!==void 0?i:1/0;return o-c}class BN{constructor(){V(this,"effects",void 0),V(this,"_resolvedEffects",[]),V(this,"_defaultEffects",[]),V(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(i=>i.id===e.id)){const i=n.findIndex(o=>FN(o,e)>0);i<0?n.push(e):n.splice(i,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(ho(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const o of this.effects)n[o.id]=o;const i=[];for(const o of e){const c=n[o.id];c&&c!==o?c.setProps?(c.setProps(o.props),i.push(c)):(c.cleanup(),i.push(o)):i.push(o),delete n[o.id]}for(const o in n)n[o].cleanup();this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(o=>o instanceof sx)||this._resolvedEffects.push(ON),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class NN extends tx{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const UN="deckRenderer.renderLayers";class VN{constructor(e){V(this,"gl",void 0),V(this,"layerFilter",void 0),V(this,"drawPickingColors",void 0),V(this,"drawLayersPass",void 0),V(this,"pickLayersPass",void 0),V(this,"renderCount",void 0),V(this,"_needsRedraw",void 0),V(this,"renderBuffers",void 0),V(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new NN(e),this.pickLayersPass=new NA(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||xi.getDefaultFramebuffer(this.gl)};i.effects&&this._preRender(i.effects,i);const o=this.lastPostProcessEffect?this.renderBuffers[0]:i.target,c=n.render({...i,target:o});i.effects&&this._postRender(i.effects,i),this.renderCount++,Qi(UN,this,c,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const i of e)n.preRenderStats[i.id]=i.preRender(this.gl,n),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new xi(this.gl),new xi(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:i}=this,o={...n,inputBuffer:i[0],swapBuffer:i[1],target:null};for(const c of e)if(c.postRender){if(c.id===this.lastPostProcessEffect){o.target=n.target,c.postRender(this.gl,o);break}const d=c.postRender(this.gl,o);o.inputBuffer=d,o.swapBuffer=d===i[0]?i[1]:i[0]}}}const jN={pickedColor:null,pickedObjectIndex:-1};function GN({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:o,deviceRect:c}){const{x:d,y:l,width:v,height:w}=c;let C=o*o,L=-1,P=0;for(let N=0;N<w;N++){const X=N+l-i,ee=X*X;if(ee>C)P+=4*v;else for(let me=0;me<v;me++){if(t[P+3]-1>=0){const W=me+d-n,q=W*W+ee;q<=C&&(C=q,L=P)}P+=4}}if(L>=0){const N=t.slice(L,L+4),X=e(N);if(X){const ee=Math.floor(L/4/v),me=L/4-ee*v;return{...X,pickedColor:N,pickedX:d+me,pickedY:l+ee}}yn.error("Picked non-existent layer. Is picking buffer corrupt?")()}return jN}function $N({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const c=t.slice(i,i+4),d=c.join(",");if(!n.has(d)){const l=e(c);l?n.set(d,{...l,color:c}):yn.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function HA({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:o,z:c}){let d=e[0];e.length>1&&(d=WN((t==null?void 0:t.pickedViewports)||e,{x:i,y:o}));let l;if(d){const v=[i-d.x,o-d.y];c!==void 0&&(v[2]=c),l=d.unproject(v)}return{color:null,layer:null,viewport:d,index:-1,picked:!1,x:i,y:o,pixel:[i,o],coordinate:l,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function HN(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:o}=t,{pickedColor:c,pickedLayer:d,pickedObjectIndex:l}=e,v=d?[d]:[];if(i==="hover"){const L=n.index,P=n.layerId,N=d?d.props.id:null;if(N!==P||l!==L){if(N!==P){const X=o.find(ee=>ee.props.id===P);X&&v.unshift(X)}n.layerId=N,n.index=l,n.info=null}}const w=HA(t),C=new Map;return C.set(null,w),v.forEach(L=>{let P={...w};L===d&&(P.color=c,P.index=l,P.picked=!0),P=WA({layer:L,info:P,mode:i});const N=P.layer;L===d&&i==="hover"&&(n.info=P),C.set(N.id,P),i==="hover"&&N.updateAutoHighlight(P)}),C}function WA({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function WN(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class qN{constructor(e){V(this,"gl",void 0),V(this,"pickingFBO",void 0),V(this,"depthFBO",void 0),V(this,"pickLayersPass",void 0),V(this,"layerFilter",void 0),V(this,"lastPickedInfo",void 0),V(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new NA(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:i,viewports:o},c=this.lastPickedInfo.info){const d=c&&c.layer&&c.layer.id,l=c&&c.viewport&&c.viewport.id,v=d?i.find(P=>P.id===d):null,w=l&&o.find(P=>P.id===l)||o[0],C=w&&w.unproject([e-w.x,n-w.y]);return{...c,...{x:e,y:n,viewport:w,coordinate:C,layer:v}}}_resizeBuffer(){var e,n;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new xi(i),xi.isSupported(i,{colorBufferFloat:!0}))){const o=new xi(i);o.attach({36064:new Vs(i,{format:Zt(i)?34836:6408,type:5126})}),this.depthFBO=o}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:i,x:o,y:c,radius:d=0,depth:l=1,mode:v="query",unproject3D:w,onViewportActive:C,effects:L}){const P=this._getPickable(e),N=ou(this.gl);if(!P)return{result:[],emptyInfo:HA({viewports:i,x:o,y:c,pixelRatio:N})};this._resizeBuffer();const X=U_(this.gl,[o,c],!0),ee=[X.x+Math.floor(X.width/2),X.y+Math.floor(X.height/2)],me=Math.round(d*N),{width:Y,height:W}=this.pickingFBO,q=this._getPickingRect({deviceX:ee[0],deviceY:ee[1],deviceRadius:me,deviceWidth:Y,deviceHeight:W}),oe={x:o-d,y:c-d,width:d*2+1,height:d*2+1};let ye;const Se=[],Oe=new Set;for(let Fe=0;Fe<l;Fe++){let Ve;if(q){const ut=this._drawAndSample({layers:P,views:n,viewports:i,onViewportActive:C,deviceRect:q,cullRect:oe,effects:L,pass:"picking:".concat(v)});Ve=GN({...ut,deviceX:ee[0],deviceY:ee[1],deviceRadius:me,deviceRect:q})}else Ve={pickedColor:null,pickedObjectIndex:-1};let je;if(Ve.pickedLayer&&w&&this.depthFBO){const{pickedColors:ut}=this._drawAndSample({layers:[Ve.pickedLayer],views:n,viewports:i,onViewportActive:C,deviceRect:{x:Ve.pickedX,y:Ve.pickedY,width:1,height:1},cullRect:oe,effects:L,pass:"picking:".concat(v,":z")},!0);ut[3]&&(je=ut[0])}Ve.pickedLayer&&Fe+1<l&&(Oe.add(Ve.pickedLayer),Ve.pickedLayer.disablePickingIndex(Ve.pickedObjectIndex)),ye=HN({pickInfo:Ve,lastPickedInfo:this.lastPickedInfo,mode:v,layers:P,viewports:i,x:o,y:c,z:je,pixelRatio:N});for(const ut of ye.values())ut.layer&&Se.push(ut);if(!Ve.pickedColor)break}for(const Fe of Oe)Fe.restorePickingColors();return{result:Se,emptyInfo:ye.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:i,x:o,y:c,width:d=1,height:l=1,mode:v="query",maxObjects:w=null,onViewportActive:C,effects:L}){const P=this._getPickable(e);if(!P)return[];this._resizeBuffer();const N=ou(this.gl),X=U_(this.gl,[o,c],!0),ee=X.x,me=X.y+X.height,Y=U_(this.gl,[o+d,c+l],!0),W=Y.x+Y.width,q=Y.y,oe={x:ee,y:q,width:W-ee,height:me-q},ye=this._drawAndSample({layers:P,views:n,viewports:i,onViewportActive:C,deviceRect:oe,cullRect:{x:o,y:c,width:d,height:l},effects:L,pass:"picking:".concat(v)}),Se=$N(ye),Oe=new Map,Fe=Number.isFinite(w);for(let Ve=0;Ve<Se.length&&!(Fe&&w&&Oe.size>=w);Ve++){const je=Se[Ve];let ut={color:je.pickedColor,layer:null,index:je.pickedObjectIndex,picked:!0,x:o,y:c,pixelRatio:N};ut=WA({layer:je.pickedLayer,info:ut,mode:v}),Oe.has(ut.object)||Oe.set(ut.object,ut)}return Array.from(Oe.values())}_drawAndSample({layers:e,views:n,viewports:i,onViewportActive:o,deviceRect:c,cullRect:d,effects:l,pass:v},w=!1){const C=w?this.depthFBO:this.pickingFBO,L={layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:o,pickingFBO:C,deviceRect:c,cullRect:d,effects:l,pass:v,pickZ:w,preRenderStats:{}};for(const W of l)W.useInPicking&&(L.preRenderStats[W.id]=W.preRender(this.gl,L));const{decodePickingColor:P}=this.pickLayersPass.render(L),{x:N,y:X,width:ee,height:me}=c,Y=new(w?Float32Array:Uint8Array)(ee*me*4);return Xm(C,{sourceX:N,sourceY:X,sourceWidth:ee,sourceHeight:me,target:Y}),{pickedColors:Y,decodePickingColor:P}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:o,deviceHeight:c}){const d=Math.max(0,e-i),l=Math.max(0,n-i),v=Math.min(o,e+i+1)-d,w=Math.min(c,n+i+1)-l;return v<=0||w<=0?null:{x:d,y:l,width:v,height:w}}}const ZN={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class XN{constructor(e){V(this,"el",null),V(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,ZN),n.appendChild(this.el))}setTooltip(e,n,i){const o=this.el;if(o){if(typeof e=="string")o.innerText=e;else if(e)e.text&&(o.innerText=e.text),e.html&&(o.innerHTML=e.html),e.className&&(o.className=e.className);else{this.isVisible=!1,o.style.display="none";return}this.isVisible=!0,o.style.display="block",o.style.transform="translate(".concat(n,"px, ").concat(i,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(o.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var qA={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,i,o){var c=["","webkit","Moz","MS","ms","o"],d=n.createElement("div"),l="function",v=Math.round,w=Math.abs,C=Date.now;function L(G,J,ue){return setTimeout(q(G,ue),J)}function P(G,J,ue){return Array.isArray(G)?(N(G,ue[J],ue),!0):!1}function N(G,J,ue){var Ae;if(G)if(G.forEach)G.forEach(J,ue);else if(G.length!==o)for(Ae=0;Ae<G.length;)J.call(ue,G[Ae],Ae,G),Ae++;else for(Ae in G)G.hasOwnProperty(Ae)&&J.call(ue,G[Ae],Ae,G)}function X(G,J,ue){var Ae="DEPRECATED METHOD: "+J+`
`+ue+` AT 
`;return function(){var Ne=new Error("get-stack-trace"),at=Ne&&Ne.stack?Ne.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ot=e.console&&(e.console.warn||e.console.log);return Ot&&Ot.call(e.console,Ae,at),G.apply(this,arguments)}}var ee;typeof Object.assign!="function"?ee=function(J){if(J===o||J===null)throw new TypeError("Cannot convert undefined or null to object");for(var ue=Object(J),Ae=1;Ae<arguments.length;Ae++){var Ne=arguments[Ae];if(Ne!==o&&Ne!==null)for(var at in Ne)Ne.hasOwnProperty(at)&&(ue[at]=Ne[at])}return ue}:ee=Object.assign;var me=X(function(J,ue,Ae){for(var Ne=Object.keys(ue),at=0;at<Ne.length;)(!Ae||Ae&&J[Ne[at]]===o)&&(J[Ne[at]]=ue[Ne[at]]),at++;return J},"extend","Use `assign`."),Y=X(function(J,ue){return me(J,ue,!0)},"merge","Use `assign`.");function W(G,J,ue){var Ae=J.prototype,Ne;Ne=G.prototype=Object.create(Ae),Ne.constructor=G,Ne._super=Ae,ue&&ee(Ne,ue)}function q(G,J){return function(){return G.apply(J,arguments)}}function oe(G,J){return typeof G==l?G.apply(J&&J[0]||o,J):G}function ye(G,J){return G===o?J:G}function Se(G,J,ue){N(je(J),function(Ae){G.addEventListener(Ae,ue,!1)})}function Oe(G,J,ue){N(je(J),function(Ae){G.removeEventListener(Ae,ue,!1)})}function Fe(G,J){for(;G;){if(G==J)return!0;G=G.parentNode}return!1}function Ve(G,J){return G.indexOf(J)>-1}function je(G){return G.trim().split(/\s+/g)}function ut(G,J,ue){if(G.indexOf&&!ue)return G.indexOf(J);for(var Ae=0;Ae<G.length;){if(ue&&G[Ae][ue]==J||!ue&&G[Ae]===J)return Ae;Ae++}return-1}function Gt(G){return Array.prototype.slice.call(G,0)}function Yt(G,J,ue){for(var Ae=[],Ne=[],at=0;at<G.length;){var Ot=J?G[at][J]:G[at];ut(Ne,Ot)<0&&Ae.push(G[at]),Ne[at]=Ot,at++}return ue&&(J?Ae=Ae.sort(function(kt,Bn){return kt[J]>Bn[J]}):Ae=Ae.sort()),Ae}function Mt(G,J){for(var ue,Ae,Ne=J[0].toUpperCase()+J.slice(1),at=0;at<c.length;){if(ue=c[at],Ae=ue?ue+Ne:J,Ae in G)return Ae;at++}return o}var zn=1;function vt(){return zn++}function ii(G){var J=G.ownerDocument||G;return J.defaultView||J.parentWindow||e}var tt=/mobile|tablet|ip(ad|hone|od)|android/i,wt="ontouchstart"in e,St=Mt(e,"PointerEvent")!==o,nn=wt&&tt.test(navigator.userAgent),rn="touch",nr="pen",ri="mouse",bi="kinect",si=25,cn=1,wi=2,Wt=4,On=8,ns=1,Li=2,Yn=4,Lr=8,ji=16,fi=Li|Yn,Gi=Lr|ji,js=fi|Gi,Vt=["x","y"],ki=["clientX","clientY"];function Fn(G,J){var ue=this;this.manager=G,this.callback=J,this.element=G.element,this.target=G.options.inputTarget,this.domHandler=function(Ae){oe(G.options.enable,[G])&&ue.handler(Ae)},this.init()}Fn.prototype={handler:function(){},init:function(){this.evEl&&Se(this.element,this.evEl,this.domHandler),this.evTarget&&Se(this.target,this.evTarget,this.domHandler),this.evWin&&Se(ii(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Oe(this.element,this.evEl,this.domHandler),this.evTarget&&Oe(this.target,this.evTarget,this.domHandler),this.evWin&&Oe(ii(this.element),this.evWin,this.domHandler)}};function is(G){var J,ue=G.options.inputClass;return ue?J=ue:St?J=ir:nn?J=br:wt?J=Q:J=It,new J(G,_o)}function _o(G,J,ue){var Ae=ue.pointers.length,Ne=ue.changedPointers.length,at=J&cn&&Ae-Ne===0,Ot=J&(Wt|On)&&Ae-Ne===0;ue.isFirst=!!at,ue.isFinal=!!Ot,at&&(G.session={}),ue.eventType=J,kr(G,ue),G.emit("hammer.input",ue),G.recognize(ue),G.session.prevInput=ue}function kr(G,J){var ue=G.session,Ae=J.pointers,Ne=Ae.length;ue.firstInput||(ue.firstInput=vr(J)),Ne>1&&!ue.firstMultiple?ue.firstMultiple=vr(J):Ne===1&&(ue.firstMultiple=!1);var at=ue.firstInput,Ot=ue.firstMultiple,En=Ot?Ot.center:at.center,kt=J.center=Me(Ae);J.timeStamp=C(),J.deltaTime=J.timeStamp-at.timeStamp,J.angle=Bt(En,kt),J.distance=Ei(En,kt),Rr(ue,J),J.offsetDirection=rs(J.deltaX,J.deltaY);var Bn=We(J.deltaTime,J.deltaX,J.deltaY);J.overallVelocityX=Bn.x,J.overallVelocityY=Bn.y,J.overallVelocity=w(Bn.x)>w(Bn.y)?Bn.x:Bn.y,J.scale=Ot?Ri(Ot.pointers,Ae):1,J.rotation=Ot?$i(Ot.pointers,Ae):0,J.maxPointers=ue.prevInput?J.pointers.length>ue.prevInput.maxPointers?J.pointers.length:ue.prevInput.maxPointers:J.pointers.length,Gs(ue,J);var rr=G.element;Fe(J.srcEvent.target,rr)&&(rr=J.srcEvent.target),J.target=rr}function Rr(G,J){var ue=J.center,Ae=G.offsetDelta||{},Ne=G.prevDelta||{},at=G.prevInput||{};(J.eventType===cn||at.eventType===Wt)&&(Ne=G.prevDelta={x:at.deltaX||0,y:at.deltaY||0},Ae=G.offsetDelta={x:ue.x,y:ue.y}),J.deltaX=Ne.x+(ue.x-Ae.x),J.deltaY=Ne.y+(ue.y-Ae.y)}function Gs(G,J){var ue=G.lastInterval||J,Ae=J.timeStamp-ue.timeStamp,Ne,at,Ot,En;if(J.eventType!=On&&(Ae>si||ue.velocity===o)){var kt=J.deltaX-ue.deltaX,Bn=J.deltaY-ue.deltaY,rr=We(Ae,kt,Bn);at=rr.x,Ot=rr.y,Ne=w(rr.x)>w(rr.y)?rr.x:rr.y,En=rs(kt,Bn),G.lastInterval=J}else Ne=ue.velocity,at=ue.velocityX,Ot=ue.velocityY,En=ue.direction;J.velocity=Ne,J.velocityX=at,J.velocityY=Ot,J.direction=En}function vr(G){for(var J=[],ue=0;ue<G.pointers.length;)J[ue]={clientX:v(G.pointers[ue].clientX),clientY:v(G.pointers[ue].clientY)},ue++;return{timeStamp:C(),pointers:J,center:Me(J),deltaX:G.deltaX,deltaY:G.deltaY}}function Me(G){var J=G.length;if(J===1)return{x:v(G[0].clientX),y:v(G[0].clientY)};for(var ue=0,Ae=0,Ne=0;Ne<J;)ue+=G[Ne].clientX,Ae+=G[Ne].clientY,Ne++;return{x:v(ue/J),y:v(Ae/J)}}function We(G,J,ue){return{x:J/G||0,y:ue/G||0}}function rs(G,J){return G===J?ns:w(G)>=w(J)?G<0?Li:Yn:J<0?Lr:ji}function Ei(G,J,ue){ue||(ue=Vt);var Ae=J[ue[0]]-G[ue[0]],Ne=J[ue[1]]-G[ue[1]];return Math.sqrt(Ae*Ae+Ne*Ne)}function Bt(G,J,ue){ue||(ue=Vt);var Ae=J[ue[0]]-G[ue[0]],Ne=J[ue[1]]-G[ue[1]];return Math.atan2(Ne,Ae)*180/Math.PI}function $i(G,J){return Bt(J[1],J[0],ki)+Bt(G[1],G[0],ki)}function Ri(G,J){return Ei(J[0],J[1],ki)/Ei(G[0],G[1],ki)}var Di={mousedown:cn,mousemove:wi,mouseup:Wt},ss="mousedown",He="mousemove mouseup";function It(){this.evEl=ss,this.evWin=He,this.pressed=!1,Fn.apply(this,arguments)}W(It,Fn,{handler:function(J){var ue=Di[J.type];ue&cn&&J.button===0&&(this.pressed=!0),ue&wi&&J.which!==1&&(ue=Wt),this.pressed&&(ue&Wt&&(this.pressed=!1),this.callback(this.manager,ue,{pointers:[J],changedPointers:[J],pointerType:ri,srcEvent:J}))}});var Pt={pointerdown:cn,pointermove:wi,pointerup:Wt,pointercancel:On,pointerout:On},Kn={2:rn,3:nr,4:ri,5:bi},Dr="pointerdown",At="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Dr="MSPointerDown",At="MSPointerMove MSPointerUp MSPointerCancel");function ir(){this.evEl=Dr,this.evWin=At,Fn.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}W(ir,Fn,{handler:function(J){var ue=this.store,Ae=!1,Ne=J.type.toLowerCase().replace("ms",""),at=Pt[Ne],Ot=Kn[J.pointerType]||J.pointerType,En=Ot==rn,kt=ut(ue,J.pointerId,"pointerId");at&cn&&(J.button===0||En)?kt<0&&(ue.push(J),kt=ue.length-1):at&(Wt|On)&&(Ae=!0),!(kt<0)&&(ue[kt]=J,this.callback(this.manager,at,{pointers:ue,changedPointers:[J],pointerType:Ot,srcEvent:J}),Ae&&ue.splice(kt,1))}});var $n={touchstart:cn,touchmove:wi,touchend:Wt,touchcancel:On},$s="touchstart",Ln="touchstart touchmove touchend touchcancel";function oi(){this.evTarget=$s,this.evWin=Ln,this.started=!1,Fn.apply(this,arguments)}W(oi,Fn,{handler:function(J){var ue=$n[J.type];if(ue===cn&&(this.started=!0),!!this.started){var Ae=Qt.call(this,J,ue);ue&(Wt|On)&&Ae[0].length-Ae[1].length===0&&(this.started=!1),this.callback(this.manager,ue,{pointers:Ae[0],changedPointers:Ae[1],pointerType:rn,srcEvent:J})}}});function Qt(G,J){var ue=Gt(G.touches),Ae=Gt(G.changedTouches);return J&(Wt|On)&&(ue=Yt(ue.concat(Ae),"identifier",!0)),[ue,Ae]}var Hs={touchstart:cn,touchmove:wi,touchend:Wt,touchcancel:On},xr="touchstart touchmove touchend touchcancel";function br(){this.evTarget=xr,this.targetIds={},Fn.apply(this,arguments)}W(br,Fn,{handler:function(J){var ue=Hs[J.type],Ae=ws.call(this,J,ue);Ae&&this.callback(this.manager,ue,{pointers:Ae[0],changedPointers:Ae[1],pointerType:rn,srcEvent:J})}});function ws(G,J){var ue=Gt(G.touches),Ae=this.targetIds;if(J&(cn|wi)&&ue.length===1)return Ae[ue[0].identifier]=!0,[ue,ue];var Ne,at,Ot=Gt(G.changedTouches),En=[],kt=this.target;if(at=ue.filter(function(Bn){return Fe(Bn.target,kt)}),J===cn)for(Ne=0;Ne<at.length;)Ae[at[Ne].identifier]=!0,Ne++;for(Ne=0;Ne<Ot.length;)Ae[Ot[Ne].identifier]&&En.push(Ot[Ne]),J&(Wt|On)&&delete Ae[Ot[Ne].identifier],Ne++;if(En.length)return[Yt(at.concat(En),"identifier",!0),En]}var Ws=2500,os=25;function Q(){Fn.apply(this,arguments);var G=q(this.handler,this);this.touch=new br(this.manager,G),this.mouse=new It(this.manager,G),this.primaryTouch=null,this.lastTouches=[]}W(Q,Fn,{handler:function(J,ue,Ae){var Ne=Ae.pointerType==rn,at=Ae.pointerType==ri;if(!(at&&Ae.sourceCapabilities&&Ae.sourceCapabilities.firesTouchEvents)){if(Ne)R.call(this,ue,Ae);else if(at&&Z.call(this,Ae))return;this.callback(J,ue,Ae)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function R(G,J){G&cn?(this.primaryTouch=J.changedPointers[0].identifier,F.call(this,J)):G&(Wt|On)&&F.call(this,J)}function F(G){var J=G.changedPointers[0];if(J.identifier===this.primaryTouch){var ue={x:J.clientX,y:J.clientY};this.lastTouches.push(ue);var Ae=this.lastTouches,Ne=function(){var at=Ae.indexOf(ue);at>-1&&Ae.splice(at,1)};setTimeout(Ne,Ws)}}function Z(G){for(var J=G.srcEvent.clientX,ue=G.srcEvent.clientY,Ae=0;Ae<this.lastTouches.length;Ae++){var Ne=this.lastTouches[Ae],at=Math.abs(J-Ne.x),Ot=Math.abs(ue-Ne.y);if(at<=os&&Ot<=os)return!0}return!1}var K=Mt(d.style,"touchAction"),ce=K!==o,fe="compute",he="auto",le="manipulation",pe="none",Ie="pan-x",ze="pan-y",Pe=Ye();function rt(G,J){this.manager=G,this.set(J)}rt.prototype={set:function(G){G==fe&&(G=this.compute()),ce&&this.manager.element.style&&Pe[G]&&(this.manager.element.style[K]=G),this.actions=G.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var G=[];return N(this.manager.recognizers,function(J){oe(J.options.enable,[J])&&(G=G.concat(J.getTouchAction()))}),lt(G.join(" "))},preventDefaults:function(G){var J=G.srcEvent,ue=G.offsetDirection;if(this.manager.session.prevented){J.preventDefault();return}var Ae=this.actions,Ne=Ve(Ae,pe)&&!Pe[pe],at=Ve(Ae,ze)&&!Pe[ze],Ot=Ve(Ae,Ie)&&!Pe[Ie];if(Ne){var En=G.pointers.length===1,kt=G.distance<2,Bn=G.deltaTime<250;if(En&&kt&&Bn)return}if(!(Ot&&at)&&(Ne||at&&ue&fi||Ot&&ue&Gi))return this.preventSrc(J)},preventSrc:function(G){this.manager.session.prevented=!0,G.preventDefault()}};function lt(G){if(Ve(G,pe))return pe;var J=Ve(G,Ie),ue=Ve(G,ze);return J&&ue?pe:J||ue?J?Ie:ze:Ve(G,le)?le:he}function Ye(){if(!ce)return!1;var G={},J=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ue){G[ue]=J?e.CSS.supports("touch-action",ue):!0}),G}var gt=1,ft=2,Lt=4,xt=8,Tt=xt,zt=16,Nt=32;function hn(G){this.options=ee({},this.defaults,G||{}),this.id=vt(),this.manager=null,this.options.enable=ye(this.options.enable,!0),this.state=gt,this.simultaneous={},this.requireFail=[]}hn.prototype={defaults:{},set:function(G){return ee(this.options,G),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(G){if(P(G,"recognizeWith",this))return this;var J=this.simultaneous;return G=zr(G,this),J[G.id]||(J[G.id]=G,G.recognizeWith(this)),this},dropRecognizeWith:function(G){return P(G,"dropRecognizeWith",this)?this:(G=zr(G,this),delete this.simultaneous[G.id],this)},requireFailure:function(G){if(P(G,"requireFailure",this))return this;var J=this.requireFail;return G=zr(G,this),ut(J,G)===-1&&(J.push(G),G.requireFailure(this)),this},dropRequireFailure:function(G){if(P(G,"dropRequireFailure",this))return this;G=zr(G,this);var J=ut(this.requireFail,G);return J>-1&&this.requireFail.splice(J,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(G){return!!this.simultaneous[G.id]},emit:function(G){var J=this,ue=this.state;function Ae(Ne){J.manager.emit(Ne,G)}ue<xt&&Ae(J.options.event+dn(ue)),Ae(J.options.event),G.additionalEvent&&Ae(G.additionalEvent),ue>=xt&&Ae(J.options.event+dn(ue))},tryEmit:function(G){if(this.canEmit())return this.emit(G);this.state=Nt},canEmit:function(){for(var G=0;G<this.requireFail.length;){if(!(this.requireFail[G].state&(Nt|gt)))return!1;G++}return!0},recognize:function(G){var J=ee({},G);if(!oe(this.options.enable,[this,J])){this.reset(),this.state=Nt;return}this.state&(Tt|zt|Nt)&&(this.state=gt),this.state=this.process(J),this.state&(ft|Lt|xt|zt)&&this.tryEmit(J)},process:function(G){},getTouchAction:function(){},reset:function(){}};function dn(G){return G&zt?"cancel":G&xt?"end":G&Lt?"move":G&ft?"start":""}function Jn(G){return G==ji?"down":G==Lr?"up":G==Li?"left":G==Yn?"right":""}function zr(G,J){var ue=J.manager;return ue?ue.get(G):G}function pi(){hn.apply(this,arguments)}W(pi,hn,{defaults:{pointers:1},attrTest:function(G){var J=this.options.pointers;return J===0||G.pointers.length===J},process:function(G){var J=this.state,ue=G.eventType,Ae=J&(ft|Lt),Ne=this.attrTest(G);return Ae&&(ue&On||!Ne)?J|zt:Ae||Ne?ue&Wt?J|xt:J&ft?J|Lt:ft:Nt}});function qt(){pi.apply(this,arguments),this.pX=null,this.pY=null}W(qt,pi,{defaults:{event:"pan",threshold:10,pointers:1,direction:js},getTouchAction:function(){var G=this.options.direction,J=[];return G&fi&&J.push(ze),G&Gi&&J.push(Ie),J},directionTest:function(G){var J=this.options,ue=!0,Ae=G.distance,Ne=G.direction,at=G.deltaX,Ot=G.deltaY;return Ne&J.direction||(J.direction&fi?(Ne=at===0?ns:at<0?Li:Yn,ue=at!=this.pX,Ae=Math.abs(G.deltaX)):(Ne=Ot===0?ns:Ot<0?Lr:ji,ue=Ot!=this.pY,Ae=Math.abs(G.deltaY))),G.direction=Ne,ue&&Ae>J.threshold&&Ne&J.direction},attrTest:function(G){return pi.prototype.attrTest.call(this,G)&&(this.state&ft||!(this.state&ft)&&this.directionTest(G))},emit:function(G){this.pX=G.deltaX,this.pY=G.deltaY;var J=Jn(G.direction);J&&(G.additionalEvent=this.options.event+J),this._super.emit.call(this,G)}});function yo(){pi.apply(this,arguments)}W(yo,pi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[pe]},attrTest:function(G){return this._super.attrTest.call(this,G)&&(Math.abs(G.scale-1)>this.options.threshold||this.state&ft)},emit:function(G){if(G.scale!==1){var J=G.scale<1?"in":"out";G.additionalEvent=this.options.event+J}this._super.emit.call(this,G)}});function vo(){hn.apply(this,arguments),this._timer=null,this._input=null}W(vo,hn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[he]},process:function(G){var J=this.options,ue=G.pointers.length===J.pointers,Ae=G.distance<J.threshold,Ne=G.deltaTime>J.time;if(this._input=G,!Ae||!ue||G.eventType&(Wt|On)&&!Ne)this.reset();else if(G.eventType&cn)this.reset(),this._timer=L(function(){this.state=Tt,this.tryEmit()},J.time,this);else if(G.eventType&Wt)return Tt;return Nt},reset:function(){clearTimeout(this._timer)},emit:function(G){this.state===Tt&&(G&&G.eventType&Wt?this.manager.emit(this.options.event+"up",G):(this._input.timeStamp=C(),this.manager.emit(this.options.event,this._input)))}});function Ko(){pi.apply(this,arguments)}W(Ko,pi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[pe]},attrTest:function(G){return this._super.attrTest.call(this,G)&&(Math.abs(G.rotation)>this.options.threshold||this.state&ft)}});function Jo(){pi.apply(this,arguments)}W(Jo,pi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:fi|Gi,pointers:1},getTouchAction:function(){return qt.prototype.getTouchAction.call(this)},attrTest:function(G){var J=this.options.direction,ue;return J&(fi|Gi)?ue=G.overallVelocity:J&fi?ue=G.overallVelocityX:J&Gi&&(ue=G.overallVelocityY),this._super.attrTest.call(this,G)&&J&G.offsetDirection&&G.distance>this.options.threshold&&G.maxPointers==this.options.pointers&&w(ue)>this.options.velocity&&G.eventType&Wt},emit:function(G){var J=Jn(G.offsetDirection);J&&this.manager.emit(this.options.event+J,G),this.manager.emit(this.options.event,G)}});function qs(){hn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}W(qs,hn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[le]},process:function(G){var J=this.options,ue=G.pointers.length===J.pointers,Ae=G.distance<J.threshold,Ne=G.deltaTime<J.time;if(this.reset(),G.eventType&cn&&this.count===0)return this.failTimeout();if(Ae&&Ne&&ue){if(G.eventType!=Wt)return this.failTimeout();var at=this.pTime?G.timeStamp-this.pTime<J.interval:!0,Ot=!this.pCenter||Ei(this.pCenter,G.center)<J.posThreshold;this.pTime=G.timeStamp,this.pCenter=G.center,!Ot||!at?this.count=1:this.count+=1,this._input=G;var En=this.count%J.taps;if(En===0)return this.hasRequireFailures()?(this._timer=L(function(){this.state=Tt,this.tryEmit()},J.interval,this),ft):Tt}return Nt},failTimeout:function(){return this._timer=L(function(){this.state=Nt},this.options.interval,this),Nt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Tt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Or(G,J){return J=J||{},J.recognizers=ye(J.recognizers,Or.defaults.preset),new ta(G,J)}Or.VERSION="2.0.7",Or.defaults={domEvents:!1,touchAction:fe,enable:!0,inputTarget:null,inputClass:null,preset:[[Ko,{enable:!1}],[yo,{enable:!1},["rotate"]],[Jo,{direction:fi}],[qt,{direction:fi},["swipe"]],[qs],[qs,{event:"doubletap",taps:2},["tap"]],[vo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Qo=1,ea=2;function ta(G,J){this.options=ee({},Or.defaults,J||{}),this.options.inputTarget=this.options.inputTarget||G,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=G,this.input=is(this),this.touchAction=new rt(this,this.options.touchAction),Za(this,!0),N(this.options.recognizers,function(ue){var Ae=this.add(new ue[0](ue[1]));ue[2]&&Ae.recognizeWith(ue[2]),ue[3]&&Ae.requireFailure(ue[3])},this)}ta.prototype={set:function(G){return ee(this.options,G),G.touchAction&&this.touchAction.update(),G.inputTarget&&(this.input.destroy(),this.input.target=G.inputTarget,this.input.init()),this},stop:function(G){this.session.stopped=G?ea:Qo},recognize:function(G){var J=this.session;if(!J.stopped){this.touchAction.preventDefaults(G);var ue,Ae=this.recognizers,Ne=J.curRecognizer;(!Ne||Ne&&Ne.state&Tt)&&(Ne=J.curRecognizer=null);for(var at=0;at<Ae.length;)ue=Ae[at],J.stopped!==ea&&(!Ne||ue==Ne||ue.canRecognizeWith(Ne))?ue.recognize(G):ue.reset(),!Ne&&ue.state&(ft|Lt|xt)&&(Ne=J.curRecognizer=ue),at++}},get:function(G){if(G instanceof hn)return G;for(var J=this.recognizers,ue=0;ue<J.length;ue++)if(J[ue].options.event==G)return J[ue];return null},add:function(G){if(P(G,"add",this))return this;var J=this.get(G.options.event);return J&&this.remove(J),this.recognizers.push(G),G.manager=this,this.touchAction.update(),G},remove:function(G){if(P(G,"remove",this))return this;if(G=this.get(G),G){var J=this.recognizers,ue=ut(J,G);ue!==-1&&(J.splice(ue,1),this.touchAction.update())}return this},on:function(G,J){if(G!==o&&J!==o){var ue=this.handlers;return N(je(G),function(Ae){ue[Ae]=ue[Ae]||[],ue[Ae].push(J)}),this}},off:function(G,J){if(G!==o){var ue=this.handlers;return N(je(G),function(Ae){J?ue[Ae]&&ue[Ae].splice(ut(ue[Ae],J),1):delete ue[Ae]}),this}},emit:function(G,J){this.options.domEvents&&Wl(G,J);var ue=this.handlers[G]&&this.handlers[G].slice();if(!(!ue||!ue.length)){J.type=G,J.preventDefault=function(){J.srcEvent.preventDefault()};for(var Ae=0;Ae<ue.length;)ue[Ae](J),Ae++}},destroy:function(){this.element&&Za(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Za(G,J){var ue=G.element;if(ue.style){var Ae;N(G.options.cssProps,function(Ne,at){Ae=Mt(ue.style,at),J?(G.oldCssProps[Ae]=ue.style[Ae],ue.style[Ae]=Ne):ue.style[Ae]=G.oldCssProps[Ae]||""}),J||(G.oldCssProps={})}}function Wl(G,J){var ue=n.createEvent("Event");ue.initEvent(G,!0,!0),ue.gesture=J,J.target.dispatchEvent(ue)}ee(Or,{INPUT_START:cn,INPUT_MOVE:wi,INPUT_END:Wt,INPUT_CANCEL:On,STATE_POSSIBLE:gt,STATE_BEGAN:ft,STATE_CHANGED:Lt,STATE_ENDED:xt,STATE_RECOGNIZED:Tt,STATE_CANCELLED:zt,STATE_FAILED:Nt,DIRECTION_NONE:ns,DIRECTION_LEFT:Li,DIRECTION_RIGHT:Yn,DIRECTION_UP:Lr,DIRECTION_DOWN:ji,DIRECTION_HORIZONTAL:fi,DIRECTION_VERTICAL:Gi,DIRECTION_ALL:js,Manager:ta,Input:Fn,TouchAction:rt,TouchInput:br,MouseInput:It,PointerEventInput:ir,TouchMouseInput:Q,SingleTouchInput:oi,Recognizer:hn,AttrRecognizer:pi,Tap:qs,Pan:qt,Swipe:Jo,Pinch:yo,Rotate:Ko,Press:vo,on:Se,off:Oe,each:N,merge:Y,extend:me,assign:ee,inherit:W,bindFn:q,prefixed:Mt});var Es=typeof e<"u"?e:typeof self<"u"?self:{};Es.Hammer=Or,typeof o=="function"&&o.amd?o(function(){return Or}):t.exports?t.exports=Or:e[i]=Or})(window,document,"Hammer")})(qA);var zd=qA.exports;const YN=Cm(zd),so=pC({__proto__:null,default:YN},[zd]),ZA=1,XA=2,S0=4,KN={mousedown:ZA,mousemove:XA,mouseup:S0};function JN(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function QN(t){const e=t.prototype.handler;t.prototype.handler=function(i){const o=this.store;i.button>0&&i.type==="pointerdown"&&(JN(o,c=>c.pointerId===i.pointerId)||o.push(i)),e.call(this,i)}}function e5(t){t.prototype.handler=function(n){let i=KN[n.type];i&ZA&&n.button>=0&&(this.pressed=!0),i&XA&&n.which===0&&(i=S0),this.pressed&&(i&S0&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}QN(zd.PointerEventInput);e5(zd.MouseInput);const t5=zd.Manager;class Ym{constructor(e,n,i){this.element=e,this.callback=n,this.options={enable:!0,...i}}}const n5=so?[[so.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[so.Rotate,{enable:!1}],[so.Pinch,{enable:!1}],[so.Swipe,{enable:!1}],[so.Pan,{threshold:0,enable:!1}],[so.Press,{enable:!1}],[so.Tap,{event:"doubletap",taps:2,enable:!1}],[so.Tap,{event:"anytap",enable:!1}],[so.Tap,{enable:!1}]]:null,ME={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},i5={doubletap:["tap"]},r5={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},ax={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},s5={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},LE={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},o5=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",jc=typeof window<"u"?window:global;let A0=!1;try{const t={get passive(){return A0=!0,!0}};jc.addEventListener("test",null,t),jc.removeEventListener("test",null)}catch{A0=!1}const a5=o5.indexOf("firefox")!==-1,{WHEEL_EVENTS:l5}=ax,kE="wheel",RE=4.000244140625,c5=40,u5=.25;class h5 extends Ym{constructor(e,n,i){super(e,n,i),this.handleEvent=o=>{if(!this.options.enable)return;let c=o.deltaY;jc.WheelEvent&&(a5&&o.deltaMode===jc.WheelEvent.DOM_DELTA_PIXEL&&(c/=jc.devicePixelRatio),o.deltaMode===jc.WheelEvent.DOM_DELTA_LINE&&(c*=c5)),c!==0&&c%RE===0&&(c=Math.floor(c/RE)),o.shiftKey&&c&&(c=c*u5),this.callback({type:kE,center:{x:o.clientX,y:o.clientY},delta:-c,srcEvent:o,pointerType:"mouse",target:o.target})},this.events=(this.options.events||[]).concat(l5),this.events.forEach(o=>e.addEventListener(o,this.handleEvent,A0?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===kE&&(this.options.enable=n)}}const{MOUSE_EVENTS:d5}=ax,DE="pointermove",zE="pointerover",OE="pointerout",FE="pointerenter",BE="pointerleave";class f5 extends Ym{constructor(e,n,i){super(e,n,i),this.handleEvent=c=>{this.handleOverEvent(c),this.handleOutEvent(c),this.handleEnterEvent(c),this.handleLeaveEvent(c),this.handleMoveEvent(c)},this.pressed=!1;const{enable:o}=this.options;this.enableMoveEvent=o,this.enableLeaveEvent=o,this.enableEnterEvent=o,this.enableOutEvent=o,this.enableOverEvent=o,this.events=(this.options.events||[]).concat(d5),this.events.forEach(c=>e.addEventListener(c,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===DE&&(this.enableMoveEvent=n),e===zE&&(this.enableOverEvent=n),e===OE&&(this.enableOutEvent=n),e===FE&&(this.enableEnterEvent=n),e===BE&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(zE,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(OE,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(FE,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(BE,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(DE,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:p5}=ax,NE="keydown",UE="keyup";class m5 extends Ym{constructor(e,n,i){super(e,n,i),this.handleEvent=o=>{const c=o.target||o.srcElement;c.tagName==="INPUT"&&c.type==="text"||c.tagName==="TEXTAREA"||(this.enableDownEvent&&o.type==="keydown"&&this.callback({type:NE,srcEvent:o,key:o.key,target:o.target}),this.enableUpEvent&&o.type==="keyup"&&this.callback({type:UE,srcEvent:o,key:o.key,target:o.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(p5),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===NE&&(this.enableDownEvent=n),e===UE&&(this.enableUpEvent=n)}}const VE="contextmenu";class g5 extends Ym{constructor(e,n,i){super(e,n,i),this.handleEvent=o=>{this.options.enable&&this.callback({type:VE,center:{x:o.clientX,y:o.clientY},srcEvent:o,pointerType:"mouse",target:o.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===VE&&(this.options.enable=n)}}const P0=1,Tm=2,I0=4,_5={pointerdown:P0,pointermove:Tm,pointerup:I0,mousedown:P0,mousemove:Tm,mouseup:I0},y5=1,v5=2,x5=3,b5=0,w5=1,E5=2,T5=1,S5=2,A5=4;function P5(t){const e=_5[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i,which:o}=t.srcEvent;let c=!1,d=!1,l=!1;return e===I0||e===Tm&&!Number.isFinite(n)?(c=o===y5,d=o===v5,l=o===x5):e===Tm?(c=!!(n&T5),d=!!(n&A5),l=!!(n&S5)):e===P0&&(c=i===b5,d=i===w5,l=i===E5),{leftButton:c,middleButton:d,rightButton:l}}function I5(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),o=i.width/e.offsetWidth||1,c=i.height/e.offsetHeight||1,d={x:(n.x-i.left-e.clientLeft)/o,y:(n.y-i.top-e.clientTop)/c};return{center:n,offsetCenter:d}}const sy={srcElement:"root",priority:0};class C5{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let o=n.srcEvent.target;for(;o&&o!==i.rootElement;){if(this._emit(i,o),i.handled)return;o=o.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,i,o=!1,c=!1){const{handlers:d,handlersByElement:l}=this;let v=sy;typeof i=="string"||i&&i.addEventListener?v={...sy,srcElement:i}:i&&(v={...sy,...i});let w=l.get(v.srcElement);w||(w=[],l.set(v.srcElement,w));const C={type:e,handler:n,srcElement:v.srcElement,priority:v.priority};o&&(C.once=!0),c&&(C.passive=!0),d.push(C),this._active=this._active||!C.passive;let L=w.length-1;for(;L>=0&&!(w[L].priority>=C.priority);)L--;w.splice(L+1,0,C)}remove(e,n){const{handlers:i,handlersByElement:o}=this;for(let c=i.length-1;c>=0;c--){const d=i[c];if(d.type===e&&d.handler===n){i.splice(c,1);const l=o.get(d.srcElement);l.splice(l.indexOf(d),1),l.length===0&&o.delete(d.srcElement)}}this._active=i.some(c=>!c.passive)}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let o=!1;const c=()=>{e.handled=!0},d=()=>{e.handled=!0,o=!0},l=[];for(let v=0;v<i.length;v++){const{type:w,handler:C,once:L}=i[v];if(C({...e,type:w,stopPropagation:c,stopImmediatePropagation:d}),L&&l.push(i[v]),o)break}for(let v=0;v<l.length;v++){const{type:w,handler:C}=l[v];this.remove(w,C)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...P5(e),...I5(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const M5={events:null,recognizers:null,recognizerOptions:{},Manager:t5,touchAction:"none",tabIndex:0};class L5{constructor(e=null,n){this._onBasicInput=o=>{const{srcEvent:c}=o,d=r5[c.type];d&&this.manager.emit(d,o)},this._onOtherEvent=o=>{this.manager.emit(o.type,o)},this.options={...M5,...n},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,i=n.Manager;this.manager=new i(e,{touchAction:n.touchAction,recognizers:n.recognizers||n5}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(ME).forEach(o=>{const c=this.manager.get(o);c&&ME[o].forEach(d=>{c.recognizeWith(d)})});for(const o in n.recognizerOptions){const c=this.manager.get(o);if(c){const d=n.recognizerOptions[o];delete d.enable,c.set(d)}}this.wheelInput=new h5(e,this._onOtherEvent,{enable:!1}),this.moveInput=new f5(e,this._onOtherEvent,{enable:!1}),this.keyInput=new m5(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new g5(e,this._onOtherEvent,{enable:!1});for(const[o,c]of this.events)c.isEmpty()||(this._toggleRecognizer(c.recognizerName,!0),this.manager.on(o,c.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const o=i.get(e);if(o&&o.options.enable!==n){o.set({enable:n});const c=i5[e];c&&!this.options.recognizers&&c.forEach(d=>{const l=i.get(d);n?(l.requireFailure(e),o.dropRequireFailure(d)):l.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,i,o,c){if(typeof e!="string"){i=n;for(const C in e)this._addEventHandler(C,e[C],i,o,c);return}const{manager:d,events:l}=this,v=LE[e]||e;let w=l.get(v);w||(w=new C5(this),l.set(v,w),w.recognizerName=s5[v]||v,d&&d.on(v,w.handleEvent)),w.add(e,n,i,o,c),w.isEmpty()||this._toggleRecognizer(w.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const d in e)this._removeEventHandler(d,e[d]);return}const{events:i}=this,o=LE[e]||e,c=i.get(o);if(c&&(c.remove(e,n),c.isEmpty())){const{recognizerName:d}=c;let l=!1;for(const v of i.values())if(v.recognizerName===d&&!v.isEmpty()){l=!0;break}l||this._toggleRecognizer(d,!1)}}}function wl(){}const k5=({isDragging:t})=>t?"grabbing":"grab",YA={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:wl,onResize:wl,onViewStateChange:wl,onInteractionStateChange:wl,onBeforeRender:wl,onAfterRender:wl,onLoad:wl,onError:t=>yn.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:k5,getTooltip:null,debug:!1,drawPickingColors:!1};class Km{constructor(e){V(this,"props",void 0),V(this,"width",0),V(this,"height",0),V(this,"userData",{}),V(this,"canvas",null),V(this,"viewManager",null),V(this,"layerManager",null),V(this,"effectManager",null),V(this,"deckRenderer",null),V(this,"deckPicker",null),V(this,"eventManager",null),V(this,"tooltip",null),V(this,"metrics",void 0),V(this,"animationLoop",void 0),V(this,"stats",void 0),V(this,"viewState",void 0),V(this,"cursorState",void 0),V(this,"_needsRedraw",void 0),V(this,"_pickRequest",void 0),V(this,"_lastPointerDownInfo",null),V(this,"_metricsCounter",void 0),V(this,"_onPointerMove",n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const o=n.offsetCenter;if(!o)return;i.x=o.x,i.y=o.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n}),V(this,"_onEvent",n=>{const i=Tw[n.type],o=n.offsetCenter;if(!i||!o||!this.layerManager)return;const c=this.layerManager.getLayers(),d=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:c,viewports:this.getViewports(o)},this._lastPointerDownInfo),{layer:l}=d,v=l&&(l[i.handler]||l.props[i.handler]),w=this.props[i.handler];let C=!1;v&&(C=v.call(l,d,n)),!C&&w&&w(d,n)}),V(this,"_onPointerDown",n=>{const i=n.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo}),this.props={...YA,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&yn.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),GS()==="IE"&&yn.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Wv({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&pu.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,i,o,c,d,l,v;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)===null||n===void 0||n.finalize(),this.layerManager=null,(i=this.viewManager)===null||i===void 0||i.finalize(),this.viewManager=null,(o=this.effectManager)===null||o===void 0||o.finalize(),this.effectManager=null,(c=this.deckRenderer)===null||c===void 0||c.finalize(),this.deckRenderer=null,(d=this.deckPicker)===null||d===void 0||d.finalize(),this.deckPicker=null,(l=this.eventManager)===null||l===void 0||l.destroy(),this.eventManager=null,(v=this.tooltip)===null||v===void 0||v.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var w;(w=this.canvas.parentElement)===null||w===void 0||w.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&yn.removed("onLayerHover","onHover")(),"onLayerClick"in e&&yn.removed("onLayerClick","onClick")(),e.initialViewState&&!ho(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),o=this.layerManager.needsRedraw(e),c=this.effectManager.needsRedraw(e),d=this.deckRenderer.needsRedraw(e);return n=n||i||o||c||d,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Ci(this.viewManager),this.viewManager.views}getViewports(e){return Ci(this.viewManager),this.viewManager.getViewports(e)}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,n,i){Ci(this.deckPicker);const{stats:o}=this;o.get("Pick Count").incrementCount(),o.get(n).timeStart();const c=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return o.get(n).timeEnd(),c}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Ci(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:i}=e;if(n||n===0){const c=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=c}if(i||i===0){var o;const c=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((o=e.style)===null||o===void 0?void 0:o.position)||"absolute",this.canvas.style.height=c}}_updateCanvasSize(){var e,n;const{canvas:i}=this;if(!i)return;const o=(e=i.clientWidth)!==null&&e!==void 0?e:i.width,c=(n=i.clientHeight)!==null&&n!==void 0?n:i.height;if(o!==this.width||c!==this.height){var d,l;this.width=o,this.height=c,(d=this.viewManager)===null||d===void 0||d.setProps({width:o,height:c}),(l=this.layerManager)===null||l===void 0||l.activateViewport(this.getViewports()[0]),this.props.onResize({width:o,height:c})}}_createAnimationLoop(e){const{width:n,height:i,gl:o,glOptions:c,debug:d,onError:l,onBeforeRender:v,onAfterRender:w,useDevicePixels:C}=e;return new MO({width:n,height:i,useDevicePixels:C,autoResizeDrawingBuffer:!o,autoResizeViewport:!1,gl:o,onCreateContext:L=>YS({...c,...L,canvas:this.canvas,debug:d,onContextLost:()=>this._onContextLost()}),onInitialize:L=>this._setGLContext(L.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:v,onAfterRender:w,onError:l})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new $A({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let c=o,d=!1;for(const l of i){var n;c=l,d=((n=l.layer)===null||n===void 0?void 0:n.onHover(l,e.event))||d}if(!d&&this.props.onHover&&this.props.onHover(c,e.event),this.props.getTooltip&&this.tooltip){const l=this.props.getTooltip(c);this.tooltip.setTooltip(l,c.x,c.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,Hv(e,{enable:!0,copyState:!0})),this.tooltip=new XN(this.canvas),Wo(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new AA;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new L5(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in Tw)this.eventManager.on(o,this._onEvent);this.viewManager=new wN({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new bN(e,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new BN,this.deckRenderer=new VN(e),this.deckPicker=new qN(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:i}=this.layerManager.context;Wo(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),yn.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=Cl.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}V(Km,"defaultProps",YA);V(Km,"VERSION",zR);class oy{constructor(e,n){V(this,"opts",void 0),V(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:i}=this.source,{size:o}=n;let c=i;if(i&&i.length!==o){c=new Float32Array(o);const d=n.elementOffset||0;for(let l=0;l<o;++l)c[l]=i[d+l]}return c}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function R5(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function zp(t){return t.stride||t.size*t.bytesPerElement}function KA(t,e){e.offset&&yn.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=zp(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,o=e.elementOffset||0,c=i*n+o*t.bytesPerElement+(t.offset||0);return{...e,offset:c,stride:n}}function D5(t,e){const n=KA(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class z5{constructor(e,n,i){V(this,"gl",void 0),V(this,"id",void 0),V(this,"size",void 0),V(this,"settings",void 0),V(this,"value",void 0),V(this,"doublePrecision",void 0),V(this,"_buffer",void 0),V(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const o=n.logicalType||n.type,c=o===5130;let{defaultValue:d}=n;d=Number.isFinite(d)?[d]:d||new Array(this.size).fill(0);let l;c?l=5126:!o&&n.isIndexed?l=e&&oz(e,Cn.ELEMENT_INDEX_UINT32)?5125:5123:l=o||5126;let v=R5(o||l||5126);this.doublePrecision=c,c&&n.fp64===!1&&(v=Float32Array),this.value=null,this.settings={...n,defaultType:v,defaultValue:d,logicalType:o,type:l,size:this.size,bytesPerElement:v.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new _n(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*zp(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),pu.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const i={},o=this.value instanceof Float64Array,c=D5(this.getAccessor(),n||{});return i[e]=new oy(this,c.high),i["".concat(e,"64Low")]=o?new oy(this,c.low):new Float32Array(this.size),i}if(n){const i=KA(this.getAccessor(),n);return{[e]:new oy(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:i,size:o}=this,c=i*o;if(n&&c&&n.length>=c){const d=new Array(o).fill(1/0),l=new Array(o).fill(-1/0);for(let v=0;v<c;)for(let w=0;w<o;w++){const C=n[v++];C<d[w]&&(d[w]=C),C>l[w]&&(l[w]=C)}e=[d,l]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof _n?i={buffer:e}:i=e;const o={...this.settings,...i};if(n.bufferAccessor=o,n.bounds=null,i.constant){let c=i.value;if(c=this._normalizeValue(c,[],0),this.settings.normalized&&(c=this.normalizeConstant(c)),!(!n.constant||!this._areValuesEqual(c,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=c}else if(i.buffer){const c=i.buffer;n.externalBuffer=c,n.constant=!1,this.value=i.value||null;const d=i.value instanceof Float64Array;o.type=i.type||c.accessor.type,o.bytesPerElement=c.accessor.BYTES_PER_ELEMENT*(d?2:1),o.stride=zp(o)}else if(i.value){this._checkExternalBuffer(i);let c=i.value;n.externalBuffer=null,n.constant=!1,this.value=c,o.bytesPerElement=c.BYTES_PER_ELEMENT,o.stride=zp(o);const{buffer:d,byteOffset:l}=this;this.doublePrecision&&c instanceof Float64Array&&(c=ny(c,o));const v=c.byteLength+l+o.stride*2;d.byteLength<v&&d.reallocate(v),d.setAccessor(null),d.subData({data:c,offset:l}),o.type=i.type||d.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:i=0,endOffset:o}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?ny(n,{size:this.size,startIndex:i,endIndex:o}):n.subarray(i,o),offset:i*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:i}=this,o=i.allocatedValue,c=pu.allocate(o,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=c;const{buffer:d,byteOffset:l}=this;return d.byteLength<c.byteLength+l&&(d.reallocate(c.byteLength+l),n&&o&&d.subData({data:o instanceof Float64Array?ny(o,this):o,offset:l})),i.allocatedValue=c,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let o=!1;if(this.doublePrecision&&(o=n.BYTES_PER_ELEMENT<4),o)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&yn.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:o,size:c}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e){let d=c;for(;--d>=0;)n[i+d]=o[d];return n}switch(c){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:o[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:o[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:o[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:o[0];break;default:let d=c;for(;--d>=0;)n[i+d]=Number.isFinite(e[d])?e[d]:o[d]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let o=0;o<i;o++)if(e[o]!==n[o])return!1;return!0}}const jE=[],GE=[];function lx(t,e=0,n=1/0){let i=jE;const o={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(GE.length=t.length,i=GE):i=jE,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),o.index=e-1),{iterable:i,objectInfo:o}}function JA(t){return t&&t[Symbol.asyncIterator]}function QA(t,e){const{size:n,stride:i,offset:o,startIndices:c,nested:d}=e,l=t.BYTES_PER_ELEMENT,v=i?i/l:n,w=o?o/l:0,C=Math.floor((t.length-w)/v);return(L,{index:P,target:N})=>{if(!c){const Y=P*v+w;for(let W=0;W<n;W++)N[W]=t[Y+W];return N}const X=c[P],ee=c[P+1]||C;let me;if(d){me=new Array(ee-X);for(let Y=X;Y<ee;Y++){const W=Y*v+w;N=new Array(n);for(let q=0;q<n;q++)N[q]=t[W+q];me[Y-X]=N}}else if(v===n)me=t.subarray(X*n+w,ee*n+w);else{me=new t.constructor((ee-X)*n);let Y=0;for(let W=X;W<ee;W++){const q=W*v+w;for(let oe=0;oe<n;oe++)me[Y++]=t[q+oe]}}return me}}const O5=[],Op=[[0,1/0]];function F5(t,e){if(t===Op||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let o=0;for(let c=0;c<i;c++){const d=t[c];d[1]<e[0]?(n.push(d),o=c+1):d[0]>e[1]?n.push(d):e=[Math.min(d[0],e[0]),Math.max(d[1],e[1])]}return n.splice(o,0,e),n}function ay(t){const{source:e,target:n,start:i=0,size:o,getData:c}=t,d=t.end||n.length,l=e.length,v=d-i;if(l>v){n.set(e.subarray(0,v),i);return}if(n.set(e,i),!c)return;let w=l;for(;w<v;){const C=c(w,e);for(let L=0;L<o;L++)n[i+w]=C[L]||0,w++}}function B5({source:t,target:e,size:n,getData:i,sourceStartIndices:o,targetStartIndices:c}){if(!Array.isArray(c))return ay({source:t,target:e,size:n,getData:i}),e;let d=0,l=0;const v=i&&((C,L)=>i(C+l,L)),w=Math.min(o.length,c.length);for(let C=1;C<w;C++){const L=o[C]*n,P=c[C]*n;ay({source:t.subarray(d,L),target:e,start:l,end:P,size:n,getData:v}),d=L,l=P}return l<e.length&&ay({source:[],target:e,start:l,size:n,getData:v}),e}const N5={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function eP(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...N5[n],...e,...t,type:n}}function tP(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function nP(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function iP(t){t.push(t.shift())}function cx(t,e){const{doublePrecision:n,settings:i,value:o,size:c}=t,d=n&&o instanceof Float64Array?2:1;return(i.noAlloc?o.length:e*c)*d}function rP({buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:o,getData:c=d=>d}){const d=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*d,v=n.byteOffset,w=n.startIndices,C=o&&w,L=cx(n,e),P=n.isConstant;if(!C&&i>=L)return;const N=P?n.value:n.getBuffer().getData({srcByteOffset:v});if(n.settings.normalized&&!P){const Y=c;c=(W,q)=>n.normalizeConstant(Y(W,q))}const X=P?(Y,W)=>c(N,W):(Y,W)=>c(N.subarray(Y,Y+l),W),ee=t.getData({length:i}),me=new Float32Array(L);B5({source:ee,target:me,sourceStartIndices:o,targetStartIndices:w,size:l,getData:X}),t.byteLength<me.byteLength+v&&t.reallocate(me.byteLength+v),t.subData({data:me,offset:v})}class ux extends z5{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Op}),V(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,o=Array.isArray(n)?e[n.find(c=>e[c])]:e[n];return eP(o,i)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:o=1/0}=n;this.state.updateRanges=F5(this.state.updateRanges,[i,o])}else this.state.updateRanges=Op}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=O5}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,n.updateRanges!==Op),!0):!1}updateBuffer({numInstances:e,data:n,props:i,context:o}){if(!this.needsUpdate())return!1;const{state:{updateRanges:c},settings:{update:d,noAlloc:l}}=this;let v=!0;if(d){for(const[w,C]of c)d.call(o,this,{data:n,startRow:w,endRow:C,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[w,C]of c){const L=Number.isFinite(w)?this.getVertexOffset(w):0,P=Number.isFinite(C)?this.getVertexOffset(C):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:L,endOffset:P})}this._checkAttributeArray()}else v=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),v}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:i,settings:o}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(o.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),o.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const d=e;Ci(ArrayBuffer.isView(d.value),"invalid ".concat(o.accessor));const l=!!d.size&&d.size!==this.size;return i.binaryAccessor=QA(d.value,{size:d.size||this.size,stride:d.stride,offset:d.offset,startIndices:n,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const i in e)Object.assign(n,super.getShaderAttributes(i,e[i]));return n}_autoUpdater(e,{data:n,startRow:i,endRow:o,props:c,numInstances:d}){if(e.constant)return;const{settings:l,state:v,value:w,size:C,startIndices:L}=e,{accessor:P,transform:N}=l,X=v.binaryAccessor||(typeof P=="function"?P:c[P]);Ci(typeof X=="function",'accessor "'.concat(P,'" is not a function'));let ee=e.getVertexOffset(i);const{iterable:me,objectInfo:Y}=lx(n,i,o);for(const W of me){Y.index++;let q=X(W,Y);if(N&&(q=N.call(this,q)),L){const oe=(Y.index<L.length-1?L[Y.index+1]:d)-L[Y.index];if(q&&Array.isArray(q[0])){let ye=ee;for(const Se of q)e._normalizeValue(Se,w,ye),ye+=C}else q&&q.length>C?w.set(q,ee):(e._normalizeValue(q,Y.target,0),dN({target:w,source:Y.target,start:ee,count:oe}));ee+=oe*C}else e._normalizeValue(q,w,ee),ee+=C}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class U5{constructor({gl:e,attribute:n,timeline:i}){V(this,"gl",void 0),V(this,"type","interpolation"),V(this,"attributeInTransition",void 0),V(this,"settings",void 0),V(this,"attribute",void 0),V(this,"transition",void 0),V(this,"currentStartIndices",void 0),V(this,"currentLength",void 0),V(this,"transform",void 0),V(this,"buffers",void 0),this.gl=e,this.transition=new Dd(i),this.attribute=n,this.attributeInTransition=new ux(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=j5(e,n);const o={byteLength:0,usage:35050};this.buffers=[new _n(e,o),new _n(e,o)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:i,buffers:o,attribute:c}=this;iP(o);const d={numInstances:n,attribute:c,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of o)rP({buffer:l,...d});this.currentStartIndices=c.startIndices,this.currentLength=cx(c,n),this.attributeInTransition.setData({buffer:o[1],value:c.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/c.size),sourceBuffers:{aFrom:o[0],aTo:tP(i,c)},feedbackBuffers:{vCurrent:o[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:i}=this.settings,{time:o}=this.transition;let c=o/n;i&&(c=i(c)),this.transform.run({uniforms:{time:c}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const V5=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function j5(t,e){const n=nP(e.size);return new ex(t,{vs:V5,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class G5{constructor({gl:e,attribute:n,timeline:i}){V(this,"gl",void 0),V(this,"type","spring"),V(this,"attributeInTransition",void 0),V(this,"settings",void 0),V(this,"attribute",void 0),V(this,"transition",void 0),V(this,"currentStartIndices",void 0),V(this,"currentLength",void 0),V(this,"texture",void 0),V(this,"framebuffer",void 0),V(this,"transform",void 0),V(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Dd(i),this.attribute=n,this.attributeInTransition=new ux(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=H5(e),this.framebuffer=W5(e,this.texture),this.transform=$5(e,n,this.framebuffer);const o={byteLength:0,usage:35050};this.buffers=[new _n(e,o),new _n(e,o),new _n(e,o)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:i,buffers:o,attribute:c}=this,d={numInstances:n,attribute:c,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of o)rP({buffer:l,...d});this.settings=e,this.currentStartIndices=c.startIndices,this.currentLength=cx(c,n),this.attributeInTransition.setData({buffer:o[1],value:c.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/c.size),sourceBuffers:{aTo:tP(i,c)}})}update(){const{buffers:e,transform:n,framebuffer:i,transition:o}=this;if(!o.update())return!1;const d=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:d.stiffness,damping:d.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),iP(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),Xm(i)[0]>0||o.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function $5(t,e,n){const i=nP(e.size);return new ex(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function H5(t){return new Vs(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function W5(t,e){return new xi(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const q5={interpolation:U5,spring:G5};class Z5{constructor(e,{id:n,timeline:i}){V(this,"id",void 0),V(this,"isSupported",void 0),V(this,"gl",void 0),V(this,"timeline",void 0),V(this,"transitions",void 0),V(this,"needsRedraw",void 0),V(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=ex.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:i}){this.numInstances=i||1;for(const o in e){const c=e[o],d=c.getTransitionSetting(n);d&&this._updateAttribute(o,c,d)}for(const o in this.transitions){const c=e[o];(!c||!c.getTransitionSetting(n))&&this._removeTransition(o)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,i){const o=this.transitions[e];let c=!o||o.type!==i.type;if(c){if(!this.isSupported){yn.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}o&&this._removeTransition(e);const d=q5[i.type];d?this.transitions[e]=new d({attribute:n,timeline:this.timeline,gl:this.gl}):(yn.error("unsupported transition type '".concat(i.type,"'"))(),c=!1)}(c||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const $E="attributeManager.invalidate",X5="attributeManager.updateStart",Y5="attributeManager.updateEnd",K5="attribute.updateStart",J5="attribute.allocate",Q5="attribute.updateEnd";class e6{constructor(e,{id:n="attribute-manager",stats:i,timeline:o}={}){V(this,"id",void 0),V(this,"gl",void 0),V(this,"attributes",void 0),V(this,"updateTriggers",void 0),V(this,"needsRedraw",void 0),V(this,"userData",void 0),V(this,"stats",void 0),V(this,"attributeTransitionManager",void 0),V(this,"mergeBoundsMemoized",Rd(KB)),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new Z5(e,{id:"".concat(n,"-transitions"),timeline:o}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const i=this._invalidateTrigger(e,n);Qi($E,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Qi($E,this,"all")}update({data:e,numInstances:n,startIndices:i=null,transitions:o,props:c={},buffers:d={},context:l={}}){let v=!1;Qi(X5,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const w in this.attributes){const C=this.attributes[w],L=C.settings.accessor;C.startIndices=i,C.numInstances=n,c[w]&&yn.removed("props.".concat(w),"data.attributes.".concat(w))(),C.setExternalBuffer(d[w])||C.setBinaryValue(typeof L=="string"?d[L]:void 0,e.startIndices)||typeof L=="string"&&!d[L]&&C.setConstantValue(c[L])||C.needsUpdate()&&(v=!0,this._updateAttribute({attribute:C,numInstances:n,data:e,props:c,context:l})),this.needsRedraw=this.needsRedraw||C.needsRedraw()}v&&Qi(Y5,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:o})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getBounds(e){const n=e.map(i=>{var o;return(o=this.attributes[i])===null||o===void 0?void 0:o.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:i}=this,o={...i.getAttributes()};for(const c in n){const d=n[c];d.needsRedraw(e)&&!i.hasAttribute(c)&&(o[c]=d)}return o}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const i={};for(const o in e)n[o]||Object.assign(i,e[o].getShaderAttributes());return i}_add(e,n={}){for(const i in e){const o=e[i];this.attributes[i]=this._createAttribute(i,o,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,i){const o={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0};return new ux(this.gl,o)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(o=>{e[o]||(e[o]=[]),e[o].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:o}=this,c=o[e];return c&&c.forEach(d=>{const l=i[d];l&&l.setNeedsUpdate(l.id,n)}),c}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(Qi(K5,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&Qi(J5,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,Qi(Q5,n,i))}}class t6 extends Dd{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:o,easing:c}}=this,d=c(e/o);this._value=gm(n,i,d)}}const HE=1e-5;function WE(t,e,n,i,o){const c=e-t,l=(n-e)*o,v=-c*i;return l+v+c+e}function n6(t,e,n,i,o){if(Array.isArray(n)){const c=[];for(let d=0;d<n.length;d++)c[d]=WE(t[d],e[d],n[d],i,o);return c}return WE(t,e,n,i,o)}function qE(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const o=t[i]-e[i];n+=o*o}return Math.sqrt(n)}return Math.abs(t-e)}class i6 extends Dd{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:o}=this.settings,{_prevValue:c=e,_currValue:d=e}=this;let l=n6(c,d,n,i,o);const v=qE(l,n),w=qE(l,d);v<HE&&w<HE&&(l=n,this.end()),this._prevValue=d,this._currValue=l}}const r6={interpolation:t6,spring:i6};class s6{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,o){const{transitions:c}=this;if(c.has(e)){const v=c.get(e),{value:w=v.settings.fromValue}=v;n=w,this.remove(e)}if(o=eP(o),!o)return;const d=r6[o.type];if(!d){yn.error("unsupported transition type '".concat(o.type,"'"))();return}const l=new d(this.timeline);l.start({...o,fromValue:n,toValue:i}),c.set(e,l)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function o6(t){const e=t[Va];for(const n in e){const i=e[n],{validate:o}=i;if(o&&!o(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function a6(t,e){const n=sP({newProps:t,oldProps:e,propTypes:t[Va],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=c6(t,e);let o=!1;return i||(o=u6(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:o,extensionsChanged:h6(t,e),transitionsChanged:l6(t,e)}}function l6(t,e){if(!t.transitions)return!1;const n={},i=t[Va];let o=!1;for(const c in t.transitions){const d=i[c],l=d&&d.type;(l==="number"||l==="color"||l==="array")&&C0(t[c],e[c],d)&&(n[c]=!0,o=!0)}return o?n:!1}function sP({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:o="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(o," changed shallowly");for(const c of Object.keys(t))if(!(c in n)){if(!(c in e))return"".concat(o,".").concat(c," added");const d=C0(t[c],e[c],i[c]);if(d)return"".concat(o,".").concat(c," ").concat(d)}for(const c of Object.keys(e))if(!(c in n)){if(!(c in t))return"".concat(o,".").concat(c," dropped");if(!Object.hasOwnProperty.call(t,c)){const d=C0(t[c],e[c],i[c]);if(d)return"".concat(o,".").concat(c," ").concat(d)}}return!1}function C0(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function c6(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:o}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&o&&(n=o(t.data,e.data)||n),n}function u6(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&ZE(t,e,"all"))return{all:!0};const n={};let i=!1;for(const o in t.updateTriggers)o!=="all"&&ZE(t,e,o)&&(n[o]=!0,i=!0);return i?n:!1}function h6(t,e){if(e===null)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let o=0;o<i.length;o++)if(!i[o].equals(n[o]))return!0;return!1}function ZE(t,e,n){let i=t.updateTriggers[n];i=i??{};let o=e.updateTriggers[n];return o=o??{},sP({oldProps:o,newProps:i,triggerName:n})}const d6="count(): argument not an object",f6="count(): argument not a container";function p6(t){if(!g6(t))throw new Error(d6);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(m6(t))return Object.keys(t).length;throw new Error(f6)}function m6(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function g6(t){return t!==null&&typeof t=="object"}function _6(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(o=>o.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const o in e.inject)i[o]=(i[o]||"")+e.inject[o];n.inject=i}return n}const y6={10241:9987,10240:9729,10242:33071,10243:33071},M0={};function v6(t,e,n,i){if(n instanceof Vs)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let o=null;n.compressed&&(o={10241:n.data.length>1?9985:9729});const c=new Vs(e,{...n,parameters:{...y6,...o,...i}});return M0[c.id]=t,c}function x6(t,e){!e||!(e instanceof Vs)||M0[e.id]===t&&(e.delete(),delete M0[e.id])}const b6={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||L0(t)&&(t.length===3||t.length===4)},equal(t,e,n){return ho(t,e,1)}},accessor:{validate(t,e){const n=Sm(t);return n==="function"||n===Sm(e.value)},equal(t,e,n){return typeof e=="function"?!0:ho(t,e,1)}},array:{validate(t,e){return e.optional&&!t||L0(t)},equal(t,e,n){const{compare:i}=n,o=Number.isInteger(i)?i:i?1:0;return i?ho(t,e,o):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:i}=n,o=Number.isInteger(i)?i:i?1:0;return i?ho(t,e,o):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:i}=n.props;return i&&t?i(t):t}},image:{transform:(t,e,n)=>{const i=n.context;return!i||!i.gl?null:v6(n.id,i.gl,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{x6(n.id,t)}}};function w6(t){const e={},n={},i={};for(const[o,c]of Object.entries(t)){const d=c==null?void 0:c.deprecatedFor;if(d)i[o]=Array.isArray(d)?d:[d];else{const l=E6(o,c);e[o]=l,n[o]=l.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function E6(t,e){switch(Sm(e)){case"object":return Ih(t,e);case"array":return Ih(t,{type:"array",value:e,compare:!1});case"boolean":return Ih(t,{type:"boolean",value:e});case"number":return Ih(t,{type:"number",value:e});case"function":return Ih(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Ih(t,e){return"type"in e?{name:t,...b6[e.type],...e}:"value"in e?{name:t,type:Sm(e.value),...e}:{name:t,type:"object",value:e}}function L0(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Sm(t){return L0(t)?"array":t===null?"null":typeof t}function T6(t,e){let n;for(let c=e.length-1;c>=0;c--){const d=e[c];"extensions"in d&&(n=d.extensions)}const i=k0(t.constructor,n),o=Object.create(i);o[Em]=t,o[Bl]={},o[Ma]={};for(let c=0;c<e.length;++c){const d=e[c];for(const l in d)o[l]=d[l]}return Object.freeze(o),o}const S6="_mergedDefaultProps";function k0(t,e){let n=S6;if(e)for(const o of e){const c=o.constructor;c&&(n+=":".concat(c.extensionName||c.name))}const i=oP(t,n);return i||(t[n]=A6(t,e||[]))}function A6(t,e){if(!t.prototype)return null;const i=Object.getPrototypeOf(t),o=k0(i),c=oP(t,"defaultProps")||{},d=w6(c),l=Object.assign(Object.create(null),o,d.defaultProps),v=Object.assign(Object.create(null),o==null?void 0:o[Va],d.propTypes),w=Object.assign(Object.create(null),o==null?void 0:o[ry],d.deprecatedProps);for(const C of e){const L=k0(C.constructor);L&&(Object.assign(l,L),Object.assign(v,L[Va]),Object.assign(w,L[ry]))}return P6(l,t),C6(l,v),I6(l,w),l[Va]=v,l[ry]=w,e.length===0&&!hx(t,"_propTypes")&&(t._propTypes=v),l}function P6(t,e){const n=L6(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function I6(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const o="".concat(this.id,": ").concat(n);for(const c of e[n])hx(this,c)||(this[c]=i);yn.deprecated(o,e[n].join("/"))()}})}function C6(t,e){const n={},i={};for(const o in e){const c=e[o],{name:d,value:l}=c;c.async&&(n[d]=l,i[d]=M6(d))}t[Kc]=n,t[Bl]={},Object.defineProperties(t,i)}function M6(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||JA(e)?this[Bl][t]=e:this[Ma][t]=e},get(){if(this[Ma]){if(t in this[Ma])return this[Ma][t]||this[Kc][t];if(t in this[Bl]){const e=this[Em]&&this[Em].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Kc][t]}}return this[Kc][t]}}}function hx(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function oP(t,e){return hx(t,e)&&t[e]}function L6(t){const e=t.componentName;return e||yn.warn("".concat(t.name,".componentName not specified"))(),e||t.name}let k6=0;class dx{constructor(...e){V(this,"id",void 0),V(this,"props",void 0),V(this,"count",void 0),this.props=T6(this,e),this.id=this.props.id,this.count=k6++}clone(e){const{props:n}=this,i={};for(const o in n[Kc])o in n[Ma]?i[o]=n[Ma][o]:o in n[Bl]&&(i[o]=n[Bl][o]);return new this.constructor({...n,...i,...e})}}V(dx,"componentName","Component");V(dx,"defaultProps",{});const R6=Object.freeze({});class D6{constructor(e){V(this,"component",void 0),V(this,"onAsyncPropUpdated",void 0),V(this,"asyncProps",void 0),V(this,"oldProps",void 0),V(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||R6}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[Em]||this.component;const n=e[Ma]||{},i=e[Bl]||e,o=e[Kc]||{};for(const c in n){const d=n[c];this._createAsyncPropData(c,o[c]),this._updateAsyncProp(c,d),n[c]=this.getAsyncProp(c)}for(const c in i){const d=i[c];this._createAsyncPropData(c,o[c]),this._updateAsyncProp(c,d)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(JA(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,n,i){const o=this.asyncProps[e];o&&i>=o.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),o.resolvedValue=n,o.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const o=i.pendingLoadCount;n.then(c=>{this.component&&(c=this._postProcessValue(i,c),this._setAsyncPropValue(e,c,o),this._onResolve(e,c))}).catch(c=>{this._onError(e,c)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const o=i.pendingLoadCount;let c=[],d=0;for await(const l of n){if(!this.component)return;const{dataTransform:v}=this.component.props;v?c=v(l,c):c=c.concat(l),Object.defineProperty(c,"__diff",{enumerable:!1,value:[{startRow:d,endRow:c.length}]}),d=c.length,this._setAsyncPropValue(e,c,o)}this._onResolve(e,c)}_postProcessValue(e,n){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const o=this.component&&this.component.props[Va];this.asyncProps[e]={type:o&&o[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class z6 extends D6{constructor({attributeManager:e,layer:n}){super(n),V(this,"attributeManager",void 0),V(this,"needsRedraw",void 0),V(this,"needsUpdate",void 0),V(this,"subLayers",void 0),V(this,"usesPickingColorCache",void 0),V(this,"hasPickingBuffer",void 0),V(this,"changeFlags",void 0),V(this,"viewport",void 0),V(this,"uniformTransitions",void 0),V(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const i=this.layer,o=i==null?void 0:i.props.fetch;return o?o(n,{propName:e,layer:i}):super._fetch(e,n)}_onResolve(e,n){const i=this.layer;if(i){const o=i.props.onDataLoad;e==="data"&&o&&o(n,{propName:e,layer:i})}}_onError(e,n){const i=this.layer;i&&i.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const O6="layer.changeFlag",F6="layer.initialize",B6="layer.update",N6="layer.finalize",U6="layer.matched",XE=2**24-1,V6=Object.freeze([]),j6=Rd(({oldViewport:t,viewport:e})=>t.equals(e));let oo=new Uint8ClampedArray(0);const G6={data:{type:"data",value:V6,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:o,signal:c})=>{const{resourceManager:d}=n.context;if(o=o||n.getLoadOptions(),i=i||n.props.loaders,c){var l;o={...o,fetch:{...(l=o)===null||l===void 0?void 0:l.fetch,signal:c}}}let v=d.contains(t);return!v&&!o&&(d.add({resourceId:t,data:o0(t,i),persistent:!1}),v=!0),v?d.subscribe({resourceId:t,onChange:w=>{var C;return(C=n.internalState)===null||C===void 0?void 0:C.reloadAsyncProp(e,w)},consumerId:n.id,requestId:e}):o0(t,i,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:tn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class bu extends dx{constructor(...e){super(...e),V(this,"internalState",null),V(this,"lifecycle",Ic.NO_STATE),V(this,"context",void 0),V(this,"state",void 0),V(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Ci(this.internalState);const n=this.internalState.viewport||this.context.viewport,i=FA(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[o,c,d]=OA(i,n.pixelProjectionMatrix);return e.length===2?[o,c]:[o,c,d]}unproject(e){return Ci(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Ci(this.internalState);const i=this.internalState.viewport||this.context.viewport;return BA(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===tn.DEFAULT||e===tn.LNGLAT||e===tn.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Ci(e instanceof Uint8Array);const[n,i,o]=e;return n+i*256+o*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:p6(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const n of this.props.extensions)e=_6(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&n)if(Array.isArray(i))for(const o of i)n.invalidateAll(o);else n.invalidateAll();if(n){const{props:o}=e,c=this.internalState.hasPickingBuffer,d=Number.isInteger(o.highlightedObjectIndex)||o.pickable||o.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(c!==d){this.internalState.hasPickingBuffer=d;const{pickingColors:l,instancePickingColors:v}=n.attributes,w=l||v;w&&(d&&w.constant&&(w.constant=!1,n.invalidate(w.id)),!w.value&&!d&&(w.constant=!0,w.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:i}){const{index:o}=e;return o>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[o]),e}raiseError(e,n){var i,o;if(n&&(e=new Error("".concat(n,": ").concat(e.message),{cause:e})),!((i=(o=this.props).onError)!==null&&i!==void 0&&i.call(o,e))){var c,d;(c=this.context)===null||c===void 0||(d=c.onError)===null||d===void 0||d.call(c,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!j6({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,i=this.getNumInstances(),o=this.getStartIndices();e.update({data:n.data,numInstances:i,startIndices:o,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const c=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(c)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const o in n)Object.defineProperty(i,o,{value:n[o]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const i=Math.floor(oo.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>XE&&yn.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),oo=pu.allocate(oo,n,{size:3,copy:!0,maxCount:Math.max(n,XE)});const o=Math.floor(oo.length/3),c=[];for(let d=i;d<o;d++)this.encodePickingColor(d,c),oo[d*3+0]=c[0],oo[d*3+1]=c[1],oo[d*3+2]=c[2]}e.value=oo.subarray(0,n*3)}_setModelAttributes(e,n){const i=this.getAttributeManager(),o=e.userData.excludeAttributes||{},c=i.getShaderAttributes(n,o);e.setAttributes(c)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:o}=this.getAttributeManager().attributes,c=i||o,d=c&&n.attributes&&n.attributes[c.id];if(d&&d.value){const l=d.value,v=this.encodePickingColor(e);for(let w=0;w<n.length;w++){const C=c.getVertexOffset(w);l[C]===v[0]&&l[C+1]===v[1]&&l[C+2]===v[2]&&this._disablePickingIndex(w)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,o=n||i;if(!o)return;const c=o.getVertexOffset(e),d=o.getVertexOffset(e+1);o.buffer.subData({data:new Uint8Array(d-c),offset:c})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==oo.buffer&&(i.value=oo.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Ci(!this.internalState),Ci(Number.isFinite(this.props.coordinateSystem)),Qi(F6,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new z6({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(yn.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new s6(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Qi(U6,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Qi(B6,this,e),!e)return;const n=this.props,i=this.context,o=this.internalState,c=i.viewport,d=this._updateUniformTransition();o.propsInTransition=d,i.viewport=o.viewport||c,this.props=d;try{const l=this._getUpdateParams(),v=this.getModels();if(i.gl)this.updateState(l);else try{this.updateState(l)}catch{}for(const C of this.props.extensions)C.updateState.call(this,l,C);const w=this.getModels()[0]!==v[0];this._postUpdate(l,w)}finally{i.viewport=c,this.props=n,this._clearChangeFlags(),o.needsUpdate=!1,o.resetOldProps()}}_finalize(){Qi(N6,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const o=this.props,c=this.context;this.props=this.internalState.propsInTransition||o;const d=this.props.opacity;n.opacity=Math.pow(d,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:l}=this.props,v=l&&l(n)||[0,0];Wo(c.gl,{polygonOffset:v}),Ns(c.gl,i,()=>{const w={moduleParameters:e,uniforms:n,parameters:i,context:c};for(const C of this.props.extensions)C.draw.call(this,w,C);this.draw(w)})}finally{this.props=o}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const o in e)if(e[o]){let c=!1;switch(o){case"dataChanged":const d=e[o],l=n[o];d&&Array.isArray(l)&&(n.dataChanged=Array.isArray(d)?l.concat(d):d,c=!0);default:n[o]||(n[o]=e[o],c=!0)}c&&Qi(O6,this,o,e)}const i=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=i,n.somethingChanged=i||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const i=a6(e,n);if(i.updateTriggersChanged)for(const c in i.updateTriggersChanged)i.updateTriggersChanged[c]&&this.invalidateAttribute(c);if(i.transitionsChanged)for(const c in i.transitionsChanged){var o;this.internalState.uniformTransitions.add(c,n[c],e[c],(o=e.transitions)===null||o===void 0?void 0:o[c])}return this.setChangeFlags(i)}validateProps(){o6(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.pickingHighlightColor=i(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new e6(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:i,oldProps:o}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:c}=this.state;c==null||c.setInstanceCount(this.getNumInstances());const{autoHighlight:d,highlightedObjectIndex:l,highlightColor:v}=i;if(n||o.autoHighlight!==d||o.highlightedObjectIndex!==l||o.highlightColor!==v){const w={};d||(w.pickingSelectedColor=null),Array.isArray(v)&&(w.pickingHighlightColor=v),(n||l!==o.highlightedObjectIndex)&&(w.pickingSelectedColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setModuleParameters(w)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),o=i?i.getNeedsRedraw(e):!1;if(n=n||o,n)for(const c of this.props.extensions)c.onNeedsRedraw.call(this,c);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}V(bu,"defaultProps",G6);V(bu,"layerName","Layer");const $6="compositeLayer.renderLayers";class aP extends bu{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||n}getSubLayerRow(e,n,i){return e.__source={parent:this,object:n,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(i,o)=>i&&i.__source?(n.index=i.__source.index,e(i.__source.object,n)):e(i,o)}return e}getSubLayerProps(e={}){var n;const{opacity:i,pickable:o,visible:c,parameters:d,getPolygonOffset:l,highlightedObjectIndex:v,autoHighlight:w,highlightColor:C,coordinateSystem:L,coordinateOrigin:P,wrapLongitude:N,positionFormat:X,modelMatrix:ee,extensions:me,fetch:Y,operation:W,_subLayerProps:q}=this.props,oe={id:"",updateTriggers:{},opacity:i,pickable:o,visible:c,parameters:d,getPolygonOffset:l,highlightedObjectIndex:v,autoHighlight:w,highlightColor:C,coordinateSystem:L,coordinateOrigin:P,wrapLongitude:N,positionFormat:X,modelMatrix:ee,extensions:me,fetch:Y,operation:W},ye=q&&e.id&&q[e.id],Se=ye&&ye.updateTriggers,Oe=e.id||"sublayer";if(ye){const Fe=this.props[Va],Ve=e.type?e.type._propTypes:{};for(const je in ye){const ut=Ve[je]||Fe[je];ut&&ut.type==="accessor"&&(ye[je]=this.getSubLayerAccessor(ye[je]))}}Object.assign(oe,e,ye),oe.id="".concat(this.props.id,"-").concat(Oe),oe.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...Se};for(const Fe of me){const Ve=Fe.getSubLayerProps.call(this,Fe);Ve&&Object.assign(oe,Ve,{updateTriggers:Object.assign(oe.updateTriggers,Ve.updateTriggers)})}return oe}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let i=this.internalState.subLayers;const o=!i||this.needsUpdate();if(o){const c=this.renderLayers();i=ox(c,Boolean),this.internalState.subLayers=i}Qi($6,this,o,i);for(const c of i)c.parent=this}}V(aP,"layerName","CompositeLayer");class lP{constructor(e){V(this,"opts",void 0),V(this,"typedArrayManager",void 0),V(this,"indexStarts",[0]),V(this,"vertexStarts",[0]),V(this,"vertexCount",0),V(this,"instanceCount",0),V(this,"attributes",void 0),V(this,"_attributeDefs",void 0),V(this,"data",void 0),V(this,"getGeometry",void 0),V(this,"geometryBuffer",void 0),V(this,"buffers",void 0),V(this,"positionSize",void 0),V(this,"normalize",void 0);const{attributes:n={}}=e;this.typedArrayManager=pu,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:i={},getGeometry:o,geometryBuffer:c,positionFormat:d,dataChanged:l,normalize:v=!0}=this.opts;if(this.data=n,this.getGeometry=o,this.positionSize=c&&c.size||(d==="XY"?2:3),this.buffers=i,this.normalize=v,c&&(Ci(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(c),v||(i.positions=c)),this.geometryBuffer=i.positions,Array.isArray(l))for(const w of l)this._rebuildGeometry(w);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?QA(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:i,buffers:o,_attributeDefs:c,typedArrayManager:d}=this;for(const l in c)if(l in o)d.release(i[l]),i[l]=null;else{const v=c[l];v.copy=n,i[l]=d.allocate(i[l],e,v)}}_forEachGeometry(e,n,i){const{data:o,getGeometry:c}=this,{iterable:d,objectInfo:l}=lx(o,n,i);for(const v of d){l.index++;const w=c?c(v,l):null;e(w,l.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:i,instanceCount:o}=this;const{data:c,geometryBuffer:d}=this,{startRow:l=0,endRow:v=1/0}=e||{},w={};if(e||(n=[0],i=[0]),this.normalize||!d)this._forEachGeometry((L,P)=>{const N=L&&this.normalizeGeometry(L);w[P]=N,i[P+1]=i[P]+(N?this.getGeometrySize(N):0)},l,v),o=i[i.length-1];else if(i=c.startIndices,o=i[c.length]||0,ArrayBuffer.isView(d))o=o||d.length/this.positionSize;else if(d instanceof _n){const L=d.accessor.stride||this.positionSize*4;o=o||d.byteLength/L}else if(d.buffer){const L=d.stride||this.positionSize*4;o=o||d.buffer.byteLength/L}else if(d.value){const L=d.value,P=d.stride/L.BYTES_PER_ELEMENT||this.positionSize;o=o||L.length/P}this._allocate(o,!!e),this.indexStarts=n,this.vertexStarts=i,this.instanceCount=o;const C={};this._forEachGeometry((L,P)=>{const N=w[P]||L;C.vertexStart=i[P],C.indexStart=n[P];const X=P<i.length-1?i[P+1]:o;C.geometrySize=X-i[P],C.geometryIndex=P,this.updateGeometryAttributes(N,C)},l,v),this.vertexCount=n[n.length-1]}}const H6=typeof window<"u"?ot.useLayoutEffect:ot.useEffect,W6=H6;function Am(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const q6={position:"absolute",zIndex:-1};function cP(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>cP(n,e));if(Jm(t)){if(Z6(t))return e.style=q6,ot.cloneElement(t,e);if(X6(t))return ot.cloneElement(t,e)}return t}function Jm(t){return t&&typeof t=="object"&&"type"in t||!1}function Z6(t){var e;return(e=t.props)===null||e===void 0?void 0:e.mapStyle}function X6(t){const e=t.type;return e&&e.deckGLViewProps}function R0(t){if(typeof t=="function")return ot.createElement(gu,{},t);if(Array.isArray(t))return t.map(R0);if(Jm(t)){if(t.type===ot.Fragment)return R0(t.props.children);if(Am(t.type,gu))return t}return t}function Y6({children:t,layers:e=[],views:n=null}){const i=[],o=[],c={};return ot.Children.forEach(R0(t),d=>{if(Jm(d)){const l=d.type;if(Am(l,bu)){const v=K6(l,d.props);o.push(v)}else i.push(d);if(Am(l,gu)&&l!==gu&&d.props.id){const v=new l(d.props);c[v.id]=v}}else d&&i.push(d)}),Object.keys(c).length>0&&(Array.isArray(n)?n.forEach(d=>{c[d.id]=d}):n&&(c[n.id]=n),n=Object.values(c)),e=o.length>0?[...o,...e]:e,{layers:e,children:i,views:n}}function K6(t,e){const n={},i=t.defaultProps||{};for(const o in e)i[o]!==e[o]&&(n[o]=e[o]);return new t(n)}function J6({children:t,deck:e,ContextProvider:n}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const o={},c=i.views[0].id;for(const d of t){let l=c,v=d;Jm(d)&&Am(d.type,gu)&&(l=d.props.id||c,v=d.props.children);const w=i.getViewport(l),C=i.getViewState(l);if(w){C.padding=w.padding;const{x:L,y:P,width:N,height:X}=w;v=cP(v,{x:L,y:P,width:N,height:X,viewport:w,viewState:C}),o[l]||(o[l]={viewport:w,children:[]}),o[l].children.push(v)}}return Object.keys(o).map(d=>{const{viewport:l,children:v}=o[d],{x:w,y:C,width:L,height:P}=l,N={position:"absolute",left:w,top:C,width:L,height:P},X="view-".concat(d),ee=ot.createElement("div",{key:X,id:X,style:N},...v);if(n){const me={viewport:l,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:Y=>{Y.viewId=d,e._onViewStateChange(Y)}};return ot.createElement(n,{key:X,value:me},ee)}return ee})}const Q6={mixBlendMode:null};function eU({width:t,height:e,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},o={left:0,top:0};if(n)for(const c in n)c in Q6?o[c]=n[c]:i[c]=n[c];return{containerStyle:i,canvasStyle:o}}function tU(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function uP(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function nU(t,e,n){const i=new e({...n,_customRender:o=>{t.redrawReason=o;const c=i.getViewports();t.lastRenderedViewports!==c?t.forceUpdate():uP(t)}});return i}const hP=ot.forwardRef((t,e)=>{const[n,i]=ot.useState(0),c=ot.useRef({control:null,version:n,forceUpdate:()=>i(ye=>ye+1)}).current,d=ot.useRef(null),l=ot.useRef(null),v=ot.useMemo(()=>Y6(t),[t.layers,t.views,t.children]);let w=!0;const C=ye=>{var Se;return w&&t.viewState?(c.viewStateUpdateRequested=ye,null):(c.viewStateUpdateRequested=null,(Se=t.onViewStateChange)===null||Se===void 0?void 0:Se.call(t,ye))},L=ye=>{if(w)c.interactionStateUpdateRequested=ye;else{var Se;c.interactionStateUpdateRequested=null,(Se=t.onInteractionStateChange)===null||Se===void 0||Se.call(t,ye)}},P=ot.useMemo(()=>{const ye={...t,style:null,width:"100%",height:"100%",parent:d.current,canvas:l.current,layers:v.layers,views:v.views,onViewStateChange:C,onInteractionStateChange:L};return delete ye._customRender,c.deck&&c.deck.setProps(ye),ye},[t]);ot.useEffect(()=>{const ye=t.Deck||Km;return c.deck=nU(c,ye,{...P,parent:d.current,canvas:l.current}),()=>{var Se;return(Se=c.deck)===null||Se===void 0?void 0:Se.finalize()}},[]),W6(()=>{uP(c);const{viewStateUpdateRequested:ye,interactionStateUpdateRequested:Se}=c;ye&&C(ye),Se&&L(Se)}),ot.useImperativeHandle(e,()=>tU(c),[]);const N=c.deck&&c.deck.isInitialized?c.deck.getViewports():void 0,{ContextProvider:X,width:ee,height:me,id:Y,style:W}=t,{containerStyle:q,canvasStyle:oe}=ot.useMemo(()=>eU({width:ee,height:me,style:W}),[ee,me,W]);if(!c.viewStateUpdateRequested&&c.lastRenderedViewports===N||c.version!==n){c.lastRenderedViewports=N,c.version=n;const ye=J6({children:v.children,deck:c.deck,ContextProvider:X}),Se=ot.createElement("canvas",{key:"canvas",id:Y||"deckgl-overlay",ref:l,style:oe});c.control=ot.createElement("div",{id:"".concat(Y||"deckgl","-wrapper"),ref:d,style:q},[Se,ye])}return w=!1,c.control});hP.defaultProps=Km.defaultProps;const iU=hP,dP={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function fP(t,e,n={}){return rU(t,n)!==e?(oU(t,n),!0):!1}function rU(t,e={}){return Math.sign(sU(t,e))}function sU(t,e={}){const{start:n=0,end:i=t.length}=e,o=e.size||2;let c=0;for(let d=n,l=i-o;d<i;d+=o)c+=(t[d]-t[l])*(t[d+1]+t[l+1]),l=d;return c/2}function oU(t,e){const{start:n=0,end:i=t.length,size:o=2}=e,c=(i-n)/o,d=Math.floor(c/2);for(let l=0;l<d;++l){const v=n+l*o,w=n+(c-1-l)*o;for(let C=0;C<o;++C){const L=t[v+C];t[v+C]=t[w+C],t[w+C]=L}}}function Os(t,e){const n=e.length,i=t.length;if(i>0){let o=!0;for(let c=0;c<n;c++)if(t[i-n+c]!==e[c]){o=!1;break}if(o)return!1}for(let o=0;o<n;o++)t[i+o]=e[o];return!0}function D0(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i]}function gd(t,e,n,i,o=[]){const c=i+e*n;for(let d=0;d<n;d++)o[d]=t[c+d];return o}function z0(t,e,n,i,o=[]){let c,d;if(n&8)c=(i[3]-t[1])/(e[1]-t[1]),d=3;else if(n&4)c=(i[1]-t[1])/(e[1]-t[1]),d=1;else if(n&2)c=(i[2]-t[0])/(e[0]-t[0]),d=2;else if(n&1)c=(i[0]-t[0])/(e[0]-t[0]),d=0;else return null;for(let l=0;l<t.length;l++)o[l]=(d&1)===l?i[d]:c*(e[l]-t[l])+t[l];return o}function Fp(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function pP(t,e){const{size:n=2,broken:i=!1,gridResolution:o=10,gridOffset:c=[0,0],startIndex:d=0,endIndex:l=t.length}=e||{},v=(l-d)/n;let w=[];const C=[w],L=gd(t,0,n,d);let P,N;const X=gP(L,o,c,[]),ee=[];Os(w,L);for(let me=1;me<v;me++){for(P=gd(t,me,n,d,P),N=Fp(P,X);N;){z0(L,P,N,X,ee);const Y=Fp(ee,X);Y&&(z0(L,ee,Y,X,ee),N=Y),Os(w,ee),D0(L,ee),lU(X,o,N),i&&w.length>n&&(w=[],C.push(w),Os(w,L)),N=Fp(P,X)}Os(w,P),D0(L,P)}return i?C:C[0]}const YE=0,aU=1;function fp(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}function mP(t,e=null,n){if(!t.length)return[];const{size:i=2,gridResolution:o=10,gridOffset:c=[0,0],edgeTypes:d=!1}=n||{},l=[],v=[{pos:t,types:d?new Array(t.length/i).fill(aU):null,holes:e||[]}],w=[[],[]];let C=[];for(;v.length;){const{pos:L,types:P,holes:N}=v.shift();cU(L,i,N[0]||L.length,w),C=gP(w[0],o,c,C);const X=Fp(w[1],C);if(X){let ee=KE(L,P,i,0,N[0]||L.length,C,X);const me={pos:ee[0].pos,types:ee[0].types,holes:[]},Y={pos:ee[1].pos,types:ee[1].types,holes:[]};v.push(me,Y);for(let W=0;W<N.length;W++)ee=KE(L,P,i,N[W],N[W+1]||L.length,C,X),ee[0]&&(me.holes.push(me.pos.length),me.pos=fp(me.pos,ee[0].pos),d&&(me.types=fp(me.types,ee[0].types))),ee[1]&&(Y.holes.push(Y.pos.length),Y.pos=fp(Y.pos,ee[1].pos),d&&(Y.types=fp(Y.types,ee[1].types)))}else{const ee={positions:L};d&&(ee.edgeTypes=P),N.length&&(ee.holeIndices=N),l.push(ee)}}return l}function KE(t,e,n,i,o,c,d){const l=(o-i)/n,v=[],w=[],C=[],L=[],P=[];let N,X,ee;const me=gd(t,l-1,n,i);let Y=Math.sign(d&8?me[1]-c[3]:me[0]-c[2]),W=e&&e[l-1],q=0,oe=0;for(let ye=0;ye<l;ye++)N=gd(t,ye,n,i,N),X=Math.sign(d&8?N[1]-c[3]:N[0]-c[2]),ee=e&&e[i/n+ye],X&&Y&&Y!==X&&(z0(me,N,d,c,P),Os(v,P)&&C.push(W),Os(w,P)&&L.push(W)),X<=0?(Os(v,N)&&C.push(ee),q-=X):C.length&&(C[C.length-1]=YE),X>=0?(Os(w,N)&&L.push(ee),oe+=X):L.length&&(L[L.length-1]=YE),D0(me,N),Y=X,W=ee;return[q?{pos:v,types:e&&C}:null,oe?{pos:w,types:e&&L}:null]}function gP(t,e,n,i){const o=Math.floor((t[0]-n[0])/e)*e+n[0],c=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=o,i[1]=c,i[2]=o+e,i[3]=c+e,i}function lU(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function cU(t,e,n,i){let o=1/0,c=-1/0,d=1/0,l=-1/0;for(let v=0;v<n;v+=e){const w=t[v],C=t[v+1];o=w<o?w:o,c=w>c?w:c,d=C<d?C:d,l=C>l?C:l}return i[0][0]=o,i[0][1]=d,i[1][0]=c,i[1][1]=l,i}const uU=85.051129;function hU(t,e){const{size:n=2,startIndex:i=0,endIndex:o=t.length,normalize:c=!0}=e||{},d=t.slice(i,o);_P(d,n,0,o-i);const l=pP(d,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(c)for(const v of l)yP(v,n);return l}function dU(t,e=null,n){const{size:i=2,normalize:o=!0,edgeTypes:c=!1}=n||{};e=e||[];const d=[],l=[];let v=0,w=0;for(let L=0;L<=e.length;L++){const P=e[L]||t.length,N=w,X=fU(t,i,v,P);for(let ee=X;ee<P;ee++)d[w++]=t[ee];for(let ee=v;ee<X;ee++)d[w++]=t[ee];_P(d,i,N,w),pU(d,i,N,w,n==null?void 0:n.maxLatitude),v=P,l[L]=w}l.pop();const C=mP(d,l,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:c});if(o)for(const L of C)yP(L.positions,i);return C}function fU(t,e,n,i){let o=-1,c=-1;for(let d=n+1;d<i;d+=e){const l=Math.abs(t[d]);l>o&&(o=l,c=d-1)}return c}function pU(t,e,n,i,o=uU){const c=t[n],d=t[i-e];if(Math.abs(c-d)>180){const l=gd(t,0,e,n);l[0]+=Math.round((d-c)/360)*360,Os(t,l),l[1]=Math.sign(l[1])*o,Os(t,l),l[0]=c,Os(t,l)}}function _P(t,e,n,i){let o=t[0],c;for(let d=n;d<i;d+=e){c=t[d];const l=c-o;(l>180||l<-180)&&(c-=Math.round(l/360)*360),t[d]=o=c}}function yP(t,e){let n;const i=t.length/e;for(let c=0;c<i&&(n=t[c*e],(n+180)%360===0);c++);const o=-Math.round(n/360)*360;if(o!==0)for(let c=0;c<i;c++)t[c*e]+=o}function mU(t,e,n,i){let o;if(Array.isArray(t[0])){const c=t.length*e;o=new Array(c);for(let d=0;d<t.length;d++)for(let l=0;l<e;l++)o[d*e+l]=t[d][l]||0}else o=t;return n?pP(o,{size:e,gridResolution:n}):i?hU(o,{size:e}):o}const gU=1,_U=2,ly=4;class yU extends lP{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?mU(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(JE(e)){let i=0;for(const o of e)i+=this.getGeometrySize(o);return i}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&JE(e))for(const i of e){const o=this.getGeometrySize(i);n.geometrySize=o,this.updateGeometryAttributes(i,n),n.vertexStart+=o}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const i=this.attributes.segmentTypes,o=e?this.isClosed(e):!1,{vertexStart:c,geometrySize:d}=n;i.fill(0,c,c+d),o?(i[c]=ly,i[c+d-2]=ly):(i[c]+=gU,i[c+d-2]+=_U),i[c+d-1]=ly}_updatePositions(e,n){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:o,geometrySize:c}=n,d=new Array(3);for(let l=o,v=0;v<c;l++,v++)this.getPointOnPath(e,v,d),i[l*3]=d[0],i[l*3+1]=d[1],i[l*3+2]=d[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,i=[]){const{positionSize:o}=this;n*o>=e.length&&(n+=1-e.length/o);const c=n*o;return i[0]=e[c],i[1]=e[c+1],i[2]=o===3&&e[c+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,i=e.length-n;return e[0]===e[i]&&e[1]===e[i+1]&&(n===2||e[2]===e[i+2])}}function JE(t){return Array.isArray(t[0])}const vU=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  vec2 dir = isEnd ? dirA : dirB;
  vec2 perp = isEnd ? perpA : perpB;
  float L = isEnd ? lenA : lenB;
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
    gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
  } else {
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
    geometry.position = vec4(currPosition + offset, 1.0);
    gl_Position = project_common_position_to_clipspace(geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,xU=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,vP=[0,0,0,255],bU={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:vP},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},cy={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class Qm extends bu{constructor(...e){super(...e),V(this,"state",void 0)}getShaders(){return super.getShaders({vs:vU,fs:xU,modules:[VA,jA]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:cy,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:cy,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:cy,defaultValue:vP},instancePickingColors:{size:3,type:5121,accessor:(i,{index:o,target:c})=>this.encodePickingColor(i&&i.__source?i.__source.index:o,c)}}),this.setState({pathTesselator:new yU({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:n,changeFlags:i}=e,o=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:l}=this.state,v=n.data.attributes||{};l.updateGeometry({data:n.data,geometryBuffer:v.getPath,buffers:v,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),i.dataChanged||o.invalidateAll()}if(i.extensionsChanged){var d;const{gl:l}=this.context;(d=this.state.model)===null||d===void 0||d.delete(),this.state.model=this._getModel(l),o.invalidateAll()}}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:o}=this.props;return o[0]&&o[0].__source&&(n.object=o.find(c=>c.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:i,billboard:o,miterLimit:c,widthUnits:d,widthScale:l,widthMinPixels:v,widthMaxPixels:w}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(n),capType:Number(i),billboard:o,widthUnits:h0[d],widthScale:l,miterLimit:c,widthMinPixels:v,widthMaxPixels:w}).draw()}_getModel(e){const n=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new ym(e,{...this.getShaders(),id:this.props.id,geometry:new SA({drawMode:4,attributes:{indices:new Uint16Array(n),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}V(Qm,"defaultProps",bU);V(Qm,"layerName","PathLayer");var fx={exports:{}};fx.exports=eg;fx.exports.default=eg;function eg(t,e,n){n=n||2;var i=e&&e.length,o=i?e[0]*n:t.length,c=xP(t,0,o,n,!0),d=[];if(!c||c.next===c.prev)return d;var l,v,w,C,L,P,N;if(i&&(c=AU(t,e,c,n)),t.length>80*n){l=w=t[0],v=C=t[1];for(var X=n;X<o;X+=n)L=t[X],P=t[X+1],L<l&&(l=L),P<v&&(v=P),L>w&&(w=L),P>C&&(C=P);N=Math.max(w-l,C-v),N=N!==0?32767/N:0}return _d(c,d,n,l,v,N,0),d}function xP(t,e,n,i,o){var c,d;if(o===B0(t,e,n,i)>0)for(c=e;c<n;c+=i)d=QE(c,t[c],t[c+1],d);else for(c=n-i;c>=e;c-=i)d=QE(c,t[c],t[c+1],d);return d&&tg(d,d.next)&&(vd(d),d=d.next),d}function Nl(t,e){if(!t)return t;e||(e=t);var n=t,i;do if(i=!1,!n.steiner&&(tg(n,n.next)||Vn(n.prev,n,n.next)===0)){if(vd(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function _d(t,e,n,i,o,c,d){if(t){!d&&c&&LU(t,i,o,c);for(var l=t,v,w;t.prev!==t.next;){if(v=t.prev,w=t.next,c?EU(t,i,o,c):wU(t)){e.push(v.i/n|0),e.push(t.i/n|0),e.push(w.i/n|0),vd(t),t=w.next,l=w.next;continue}if(t=w,t===l){d?d===1?(t=TU(Nl(t),e,n),_d(t,e,n,i,o,c,2)):d===2&&SU(t,e,n,i,o,c):_d(Nl(t),e,n,i,o,c,1);break}}}}function wU(t){var e=t.prev,n=t,i=t.next;if(Vn(e,n,i)>=0)return!1;for(var o=e.x,c=n.x,d=i.x,l=e.y,v=n.y,w=i.y,C=o<c?o<d?o:d:c<d?c:d,L=l<v?l<w?l:w:v<w?v:w,P=o>c?o>d?o:d:c>d?c:d,N=l>v?l>w?l:w:v>w?v:w,X=i.next;X!==e;){if(X.x>=C&&X.x<=P&&X.y>=L&&X.y<=N&&Gc(o,l,c,v,d,w,X.x,X.y)&&Vn(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function EU(t,e,n,i){var o=t.prev,c=t,d=t.next;if(Vn(o,c,d)>=0)return!1;for(var l=o.x,v=c.x,w=d.x,C=o.y,L=c.y,P=d.y,N=l<v?l<w?l:w:v<w?v:w,X=C<L?C<P?C:P:L<P?L:P,ee=l>v?l>w?l:w:v>w?v:w,me=C>L?C>P?C:P:L>P?L:P,Y=O0(N,X,e,n,i),W=O0(ee,me,e,n,i),q=t.prevZ,oe=t.nextZ;q&&q.z>=Y&&oe&&oe.z<=W;){if(q.x>=N&&q.x<=ee&&q.y>=X&&q.y<=me&&q!==o&&q!==d&&Gc(l,C,v,L,w,P,q.x,q.y)&&Vn(q.prev,q,q.next)>=0||(q=q.prevZ,oe.x>=N&&oe.x<=ee&&oe.y>=X&&oe.y<=me&&oe!==o&&oe!==d&&Gc(l,C,v,L,w,P,oe.x,oe.y)&&Vn(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;q&&q.z>=Y;){if(q.x>=N&&q.x<=ee&&q.y>=X&&q.y<=me&&q!==o&&q!==d&&Gc(l,C,v,L,w,P,q.x,q.y)&&Vn(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;oe&&oe.z<=W;){if(oe.x>=N&&oe.x<=ee&&oe.y>=X&&oe.y<=me&&oe!==o&&oe!==d&&Gc(l,C,v,L,w,P,oe.x,oe.y)&&Vn(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function TU(t,e,n){var i=t;do{var o=i.prev,c=i.next.next;!tg(o,c)&&bP(o,i,i.next,c)&&yd(o,c)&&yd(c,o)&&(e.push(o.i/n|0),e.push(i.i/n|0),e.push(c.i/n|0),vd(i),vd(i.next),i=t=c),i=i.next}while(i!==t);return Nl(i)}function SU(t,e,n,i,o,c){var d=t;do{for(var l=d.next.next;l!==d.prev;){if(d.i!==l.i&&DU(d,l)){var v=wP(d,l);d=Nl(d,d.next),v=Nl(v,v.next),_d(d,e,n,i,o,c,0),_d(v,e,n,i,o,c,0);return}l=l.next}d=d.next}while(d!==t)}function AU(t,e,n,i){var o=[],c,d,l,v,w;for(c=0,d=e.length;c<d;c++)l=e[c]*i,v=c<d-1?e[c+1]*i:t.length,w=xP(t,l,v,i,!1),w===w.next&&(w.steiner=!0),o.push(RU(w));for(o.sort(PU),c=0;c<o.length;c++)n=IU(o[c],n);return n}function PU(t,e){return t.x-e.x}function IU(t,e){var n=CU(t,e);if(!n)return e;var i=wP(n,t);return Nl(i,i.next),Nl(n,n.next)}function CU(t,e){var n=e,i=t.x,o=t.y,c=-1/0,d;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var l=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(l<=i&&l>c&&(c=l,d=n.x<n.next.x?n:n.next,l===i))return d}n=n.next}while(n!==e);if(!d)return null;var v=d,w=d.x,C=d.y,L=1/0,P;n=d;do i>=n.x&&n.x>=w&&i!==n.x&&Gc(o<C?i:c,o,w,C,o<C?c:i,o,n.x,n.y)&&(P=Math.abs(o-n.y)/(i-n.x),yd(n,t)&&(P<L||P===L&&(n.x>d.x||n.x===d.x&&MU(d,n)))&&(d=n,L=P)),n=n.next;while(n!==v);return d}function MU(t,e){return Vn(t.prev,t,e.prev)<0&&Vn(e.next,t,t.next)<0}function LU(t,e,n,i){var o=t;do o.z===0&&(o.z=O0(o.x,o.y,e,n,i)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,kU(o)}function kU(t){var e,n,i,o,c,d,l,v,w=1;do{for(n=t,t=null,c=null,d=0;n;){for(d++,i=n,l=0,e=0;e<w&&(l++,i=i.nextZ,!!i);e++);for(v=w;l>0||v>0&&i;)l!==0&&(v===0||!i||n.z<=i.z)?(o=n,n=n.nextZ,l--):(o=i,i=i.nextZ,v--),c?c.nextZ=o:t=o,o.prevZ=c,c=o;n=i}c.nextZ=null,w*=2}while(d>1);return t}function O0(t,e,n,i,o){return t=(t-n)*o|0,e=(e-i)*o|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function RU(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Gc(t,e,n,i,o,c,d,l){return(o-d)*(e-l)>=(t-d)*(c-l)&&(t-d)*(i-l)>=(n-d)*(e-l)&&(n-d)*(c-l)>=(o-d)*(i-l)}function DU(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!zU(t,e)&&(yd(t,e)&&yd(e,t)&&OU(t,e)&&(Vn(t.prev,t,e.prev)||Vn(t,e.prev,e))||tg(t,e)&&Vn(t.prev,t,t.next)>0&&Vn(e.prev,e,e.next)>0)}function Vn(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function tg(t,e){return t.x===e.x&&t.y===e.y}function bP(t,e,n,i){var o=mp(Vn(t,e,n)),c=mp(Vn(t,e,i)),d=mp(Vn(n,i,t)),l=mp(Vn(n,i,e));return!!(o!==c&&d!==l||o===0&&pp(t,n,e)||c===0&&pp(t,i,e)||d===0&&pp(n,t,i)||l===0&&pp(n,e,i))}function pp(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function mp(t){return t>0?1:t<0?-1:0}function zU(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&bP(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function yd(t,e){return Vn(t.prev,t,t.next)<0?Vn(t,e,t.next)>=0&&Vn(t,t.prev,e)>=0:Vn(t,e,t.prev)<0||Vn(t,t.next,e)<0}function OU(t,e){var n=t,i=!1,o=(t.x+e.x)/2,c=(t.y+e.y)/2;do n.y>c!=n.next.y>c&&n.next.y!==n.y&&o<(n.next.x-n.x)*(c-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function wP(t,e){var n=new F0(t.i,t.x,t.y),i=new F0(e.i,e.x,e.y),o=t.next,c=e.prev;return t.next=e,e.prev=t,n.next=o,o.prev=n,i.next=n,n.prev=i,c.next=i,i.prev=c,i}function QE(t,e,n,i){var o=new F0(t,e,n);return i?(o.next=i.next,o.prev=i,i.next.prev=o,i.next=o):(o.prev=o,o.next=o),o}function vd(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function F0(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}eg.deviation=function(t,e,n,i){var o=e&&e.length,c=o?e[0]*n:t.length,d=Math.abs(B0(t,0,c,n));if(o)for(var l=0,v=e.length;l<v;l++){var w=e[l]*n,C=l<v-1?e[l+1]*n:t.length;d-=Math.abs(B0(t,w,C,n))}var L=0;for(l=0;l<i.length;l+=3){var P=i[l]*n,N=i[l+1]*n,X=i[l+2]*n;L+=Math.abs((t[P]-t[X])*(t[N+1]-t[P+1])-(t[P]-t[N])*(t[X+1]-t[P+1]))}return d===0&&L===0?0:Math.abs((L-d)/d)};function B0(t,e,n,i){for(var o=0,c=e,d=n-i;c<n;c+=i)o+=(t[d]-t[c])*(t[c+1]+t[d+1]),d=c;return o}eg.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,o=0;o<t.length;o++){for(var c=0;c<t[o].length;c++)for(var d=0;d<e;d++)n.vertices.push(t[o][c][d]);o>0&&(i+=t[o-1].length,n.holes.push(i))}return n};var FU=fx.exports;const BU=Cm(FU),gp=dP.CLOCKWISE,eT=dP.COUNTER_CLOCKWISE,La={isClosed:!0};function NU(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function zh(t){return"positions"in t?t.positions:t}function Bp(t){return"holeIndices"in t?t.holeIndices:null}function UU(t){return Array.isArray(t[0])}function VU(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function jU(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function GU(t,e,n,i){for(let o=0;o<e;o++)if(t[n+o]!==t[i-e+o])return!1;return!0}function tT(t,e,n,i,o){let c=e;const d=n.length;for(let l=0;l<d;l++)for(let v=0;v<i;v++)t[c++]=n[l][v]||0;if(!jU(n))for(let l=0;l<i;l++)t[c++]=n[0][l]||0;return La.start=e,La.end=c,La.size=i,fP(t,o,La),c}function nT(t,e,n,i,o=0,c,d){c=c||n.length;const l=c-o;if(l<=0)return e;let v=e;for(let w=0;w<l;w++)t[v++]=n[o+w];if(!GU(n,i,o,c))for(let w=0;w<i;w++)t[v++]=n[o+w];return La.start=e,La.end=v,La.size=i,fP(t,d,La),v}function EP(t,e){NU(t);const n=[],i=[];if("positions"in t){const{positions:o,holeIndices:c}=t;if(c){let d=0;for(let l=0;l<=c.length;l++)d=nT(n,d,o,e,c[l-1],c[l],l===0?gp:eT),i.push(d);return i.pop(),{positions:n,holeIndices:i}}t=o}if(!UU(t))return nT(n,0,t,e,0,n.length,gp),n;if(!VU(t)){let o=0;for(const[c,d]of t.entries())o=tT(n,o,d,e,c===0?gp:eT),i.push(o);return i.pop(),{positions:n,holeIndices:i}}return tT(n,0,t,e,gp),n}function uy(t,e,n){const i=t.length/3;let o=0;for(let c=0;c<i;c++){const d=(c+1)%i;o+=t[c*3+e]*t[d*3+n],o-=t[d*3+e]*t[c*3+n]}return Math.abs(o/2)}function iT(t,e,n,i){const o=t.length/3;for(let c=0;c<o;c++){const d=c*3,l=t[d+0],v=t[d+1],w=t[d+2];t[d+e]=l,t[d+n]=v,t[d+i]=w}}function $U(t,e,n,i){let o=Bp(t);o&&(o=o.map(l=>l/e));let c=zh(t);const d=i&&e===3;if(n){const l=c.length;c=c.slice();const v=[];for(let w=0;w<l;w+=e){v[0]=c[w],v[1]=c[w+1],d&&(v[2]=c[w+2]);const C=n(v);c[w]=C[0],c[w+1]=C[1],d&&(c[w+2]=C[2])}}if(d){const l=uy(c,0,1),v=uy(c,0,2),w=uy(c,1,2);if(!l&&!v&&!w)return[];l>v&&l>w||(v>w?(n||(c=c.slice()),iT(c,0,2,1)):(n||(c=c.slice()),iT(c,2,0,1)))}return BU(c,o,e)}class HU extends lP{constructor(e){const{fp64:n,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=EP(e,this.positionSize);return this.opts.resolution?mP(zh(n),Bp(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?dU(zh(n),Bp(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(rT(e)){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}return zh(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&rT(e))for(const i of e){const o=this.getGeometrySize(i);n.geometrySize=o,this.updateGeometryAttributes(i,n),n.vertexStart+=o,n.indexStart=this.indexStarts[n.geometryIndex+1]}else this._updateIndices(e,n),this._updatePositions(e,n),this._updateVertexValid(e,n)}_updateIndices(e,{geometryIndex:n,vertexStart:i,indexStart:o}){const{attributes:c,indexStarts:d,typedArrayManager:l}=this;let v=c.indices;if(!v||!e)return;let w=o;const C=$U(e,this.positionSize,this.opts.preproject,this.opts.full3d);v=l.allocate(v,o+C.length,{copy:!0});for(let L=0;L<C.length;L++)v[w++]=C[L]+i;d[n+1]=o+C.length,c.indices=v}_updatePositions(e,{vertexStart:n,geometrySize:i}){const{attributes:{positions:o},positionSize:c}=this;if(!o||!e)return;const d=zh(e);for(let l=n,v=0;v<i;l++,v++){const w=d[v*c],C=d[v*c+1],L=c>2?d[v*c+2]:0;o[l*3]=w,o[l*3+1]=C,o[l*3+2]=L}}_updateVertexValid(e,{vertexStart:n,geometrySize:i}){const{positionSize:o}=this,c=this.attributes.vertexValid,d=e&&Bp(e);if(e&&e.edgeTypes?c.set(e.edgeTypes,n):c.fill(1,n,n+i),d)for(let l=0;l<d.length;l++)c[n+d[l]/o-1]=0;c[n+i-1]=0}}function rT(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const TP=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,WU=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(TP,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`),qU=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(TP,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`),ZU=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Pm=[0,0,0,255],XU={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Pm},getLineColor:{type:"accessor",value:Pm},material:!0},_p={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class px extends bu{constructor(...e){super(...e),V(this,"state",void 0)}getShaders(e){return super.getShaders({vs:e==="top"?WU:qU,fs:ZU,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[VA,A4,jA]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:n}=this.context;let{coordinateSystem:i}=this.props;const{_full3d:o}=this.props;n.isGeospatial&&i===tn.DEFAULT&&(i=tn.LNGLAT);let c;i===tn.LNGLAT&&(o?c=n.projectPosition.bind(n):c=n.projectFlat.bind(n)),this.setState({numInstances:0,polygonTesselator:new HU({preproject:c,fp64:this.use64bitPositions(),IndexType:!e||Xv(e,Cn.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const d=this.getAttributeManager(),l=!0;d.remove(["instancePickingColors"]),d.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:l},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:_p,accessor:"getPolygon",update:this.calculatePositions,noAlloc:l,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:l},elevations:{size:1,transition:_p,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:_p,accessor:"getFillColor",defaultValue:Pm,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:_p,accessor:"getLineColor",defaultValue:Pm,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(v,{index:w,target:C})=>this.encodePickingColor(v&&v.__source?v.__source.index:w,C),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:o}=this.props;return o[0]&&o[0].__source&&(n.object=o.find(c=>c.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:i,wireframe:o,elevationScale:c}=this.props,{topModel:d,sideModel:l,polygonTesselator:v}=this.state,w={...e,extruded:!!n,elevationScale:c};l&&(l.setInstanceCount(v.instanceCount-1),l.setUniforms(w),o&&(l.setDrawMode(3),l.setUniforms({isWireframe:!0}).draw()),i&&(l.setDrawMode(6),l.setUniforms({isWireframe:!1}).draw())),d&&(d.setVertexCount(v.vertexCount),d.setUniforms(w).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:i,changeFlags:o}=e,c=this.getAttributeManager();if(o.extensionsChanged||n.filled!==i.filled||n.extruded!==i.extruded){var l;(l=this.state.models)===null||l===void 0||l.forEach(v=>v.delete()),this.setState(this._getModels(this.context.gl)),c.invalidateAll()}}updateGeometry({props:e,oldProps:n,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:c}=this.state,d=e.data.attributes||{};c.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:d.getPolygon,buffers:d,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:c.instanceCount,startIndices:c.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:n,filled:i,extruded:o}=this.props;let c,d;if(i){const l=this.getShaders("top");l.defines.NON_INSTANCED_MODEL=1,c=new ym(e,{...l,id:"".concat(n,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return o&&(d=new ym(e,{...this.getShaders("side"),id:"".concat(n,"-side"),geometry:new SA({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),d.userData.excludeAttributes={indices:!0}),{models:[d,c].filter(Boolean),topModel:c,sideModel:d}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}V(px,"defaultProps",XU);V(px,"layerName","SolidPolygonLayer");function YU({data:t,getIndex:e,dataRange:n,replace:i}){const{startRow:o=0,endRow:c=1/0}=n,d=t.length;let l=d,v=d;for(let P=0;P<d;P++){const N=e(t[P]);if(l>P&&N>=o&&(l=P),N>=c){v=P;break}}let w=l;const L=v-l!==i.length?t.slice(v):void 0;for(let P=0;P<i.length;P++)t[w++]=i[P];if(L){for(let P=0;P<L.length;P++)t[w++]=L[P];t.length=w}return{startRow:l,endRow:l+i.length}}const SP=[0,0,0,255],KU=[0,0,0,255],JU={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:KU},getLineColor:{type:"accessor",value:SP},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class Im extends aP{initializeState(){this.state={paths:[]},this.props.getLineDashArray&&yn.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const n=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(n&&Array.isArray(e.dataChanged)){const i=this.state.paths.slice(),o=e.dataChanged.map(c=>YU({data:i,getIndex:d=>d.__source.index,dataRange:c,replace:this._getPaths(c)}));this.setState({paths:i,pathsDiff:o})}else n&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:n,getPolygon:i,positionFormat:o,_normalize:c}=this.props,d=[],l=o==="XY"?2:3,{startRow:v,endRow:w}=e,{iterable:C,objectInfo:L}=lx(n,v,w);for(const P of C){L.index++;let N=i(P,L);c&&(N=EP(N,l));const{holeIndices:X}=N,ee=N.positions||N;if(X)for(let me=0;me<=X.length;me++){const Y=ee.slice(X[me-1]||0,X[me]||ee.length);d.push(this.getSubLayerRow({path:Y},P,L.index))}else d.push(this.getSubLayerRow({path:ee},P,L.index))}return d}renderLayers(){const{data:e,_dataDiff:n,stroked:i,filled:o,extruded:c,wireframe:d,_normalize:l,_windingOrder:v,elevationScale:w,transitions:C,positionFormat:L}=this.props,{lineWidthUnits:P,lineWidthScale:N,lineWidthMinPixels:X,lineWidthMaxPixels:ee,lineJointRounded:me,lineMiterLimit:Y,lineDashJustified:W}=this.props,{getFillColor:q,getLineColor:oe,getLineWidth:ye,getLineDashArray:Se,getElevation:Oe,getPolygon:Fe,updateTriggers:Ve,material:je}=this.props,{paths:ut,pathsDiff:Gt}=this.state,Yt=this.getSubLayerClass("fill",px),Mt=this.getSubLayerClass("stroke",Qm),zn=this.shouldRenderSubLayer("fill",ut)&&new Yt({_dataDiff:n,extruded:c,elevationScale:w,filled:o,wireframe:d,_normalize:l,_windingOrder:v,getElevation:Oe,getFillColor:q,getLineColor:c&&d?oe:SP,material:je,transitions:C},this.getSubLayerProps({id:"fill",updateTriggers:Ve&&{getPolygon:Ve.getPolygon,getElevation:Ve.getElevation,getFillColor:Ve.getFillColor,lineColors:c&&d,getLineColor:Ve.getLineColor}}),{data:e,positionFormat:L,getPolygon:Fe}),vt=!c&&i&&this.shouldRenderSubLayer("stroke",ut)&&new Mt({_dataDiff:Gt&&(()=>Gt),widthUnits:P,widthScale:N,widthMinPixels:X,widthMaxPixels:ee,jointRounded:me,miterLimit:Y,dashJustified:W,_pathType:"loop",transitions:C&&{getWidth:C.getLineWidth,getColor:C.getLineColor,getPath:C.getPolygon},getColor:this.getSubLayerAccessor(oe),getWidth:this.getSubLayerAccessor(ye),getDashArray:this.getSubLayerAccessor(Se)},this.getSubLayerProps({id:"stroke",updateTriggers:Ve&&{getWidth:Ve.getLineWidth,getColor:Ve.getLineColor,getDashArray:Ve.getLineDashArray}}),{data:ut,positionFormat:L,getPath:ii=>ii.path});return[!c&&zn,vt,c&&zn]}}V(Im,"layerName","PolygonLayer");V(Im,"defaultProps",JU);const QU={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:t=>t.timestamps}};class mx extends Qm{getShaders(){const e=super.getShaders();return e.inject={"vs:#decl":`uniform float trailLength;
attribute float instanceTimestamps;
attribute float instanceNextTimestamps;
varying float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`uniform bool fadeTrail;
uniform float trailLength;
uniform float currentTime;
varying float vTime;
`,"fs:#main-start":`if(vTime > currentTime || (fadeTrail && (vTime < currentTime - trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(fadeTrail) {
  color.a *= 1.0 - (currentTime - vTime) / trailLength;
}
`},e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){const{fadeTrail:n,trailLength:i,currentTime:o}=this.props;e.uniforms={...e.uniforms,fadeTrail:n,trailLength:i,currentTime:o},super.draw(e)}}V(mx,"layerName","TripsLayer");V(mx,"defaultProps",QU);const sT={BUILDINGS:"./assets/data/buildings.json",TRIPS:"./assets/data/trips.json"},eV=new PA({color:[255,255,255],intensity:1}),tV=new lN({color:[255,255,255],intensity:2,position:[-74.05,40.7,8e3]}),nV=new sx({ambientLight:eV,pointLight:tV}),iV={ambient:.3,diffuse:.8,shininess:42,specularColor:[160,164,170]},rV={buildingColor:[250,250,250],trailColor0:[253,128,93],trailColor1:[23,184,190],material:iV,effects:[nV]},sV={longitude:114.2,latitude:22.7,zoom:13,pitch:45,bearing:0},oV="https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json",aV=[[[114.616667,22.45],[113.766667,22.45],[113.766667,22.866667],[114.616667,22.866667]]];function lV({buildings:t=sT.BUILDINGS,trips:e=sT.TRIPS,trailLength:n=180,initialViewState:i=sV,mapStyle:o=oV,theme:c=rV,loopLength:d=1800,animationSpeed:l=1}){const[v,w]=ot.useState(0),[C]=ot.useState({}),L=()=>{w(N=>(N+l)%d),C.id=window.requestAnimationFrame(L)};ot.useEffect(()=>(C.id=window.requestAnimationFrame(L),()=>window.cancelAnimationFrame(C.id)),[C]);const P=[new Im({id:"ground",data:aV,getPolygon:N=>N,stroked:!1,getFillColor:[0,0,0,0]}),new mx({id:"trips",data:e,getPath:N=>N.path,getTimestamps:N=>N.timestamps,getColor:N=>N.vendor===0?c.trailColor0:c.trailColor1,opacity:.3,widthMinPixels:2,rounded:!0,trailLength:n,currentTime:v,shadowEnabled:!1}),new Im({id:"buildings",data:t,extruded:!0,wireframe:!1,opacity:.2,getPolygon:N=>N.polygon,getElevation:N=>N.height*8,getFillColor:c.buildingColor,material:c.material})];return hy.createElement(iU,{layers:P,effects:c.effects,initialViewState:i,controller:!0},hy.createElement(ok,{reuseMaps:!0,mapLib:lk,mapStyle:o,preventStyleDiffing:!0}))}function cV(t){_S(t).render(hy.createElement(lV,null))}cV(document.getElementById("app"));
